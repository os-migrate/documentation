<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>OS Migrate Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>OS Migrate Documentation</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_welcome_to_os_migrate">1. Welcome to OS Migrate</a></li>
<li><a href="#os-migrate-vmware-guide_vmware">2. VMware to OpenStack Guide</a>
<ul class="sectlevel2">
<li><a href="#_workflow">2.1. Workflow</a></li>
<li><a href="#_features_and_supported_os">2.2. Features and supported OS</a>
<ul class="sectlevel3">
<li><a href="#_features">2.2.1. Features</a></li>
<li><a href="#_supported_os">2.2.2. Supported OS</a></li>
<li><a href="#_nbdkit_migration_example">2.2.3. Nbdkit migration example</a></li>
<li><a href="#_nbdkit_migration_example_with_the_change_block_tracking">2.2.4. Nbdkit migration example with the Change Block Tracking</a></li>
</ul>
</li>
<li><a href="#_usage">2.3. Usage</a>
<ul class="sectlevel3">
<li><a href="#_nbdkit_default">2.3.1. Nbdkit (default)</a></li>
<li><a href="#_running_migration_from_local_shared_nfs">2.3.2. Running migration from local shared NFS</a></li>
<li><a href="#_ansible_configuration">2.3.3. Ansible configuration</a></li>
<li><a href="#_running_migration_outside_of_ansible">2.3.4. Running Migration outside of Ansible</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ansible_execution_environment_aee_images">3. Ansible Execution Environment (AEE) Images</a>
<ul class="sectlevel2">
<li><a href="#_overview">3.1. Overview</a></li>
<li><a href="#_available_aee_images">3.2. Available AEE Images</a>
<ul class="sectlevel3">
<li><a href="#_os_migrate_aee">3.2.1. os-migrate AEE</a></li>
<li><a href="#_vmware_migration_kit_aee">3.2.2. vmware-migration-kit AEE</a></li>
</ul>
</li>
<li><a href="#_building_aee_images">3.3. Building AEE Images</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites">3.3.1. Prerequisites</a></li>
<li><a href="#_building_os_migrate_aee">3.3.2. Building os-migrate AEE</a></li>
<li><a href="#_building_vmware_migration_kit_aee">3.3.3. Building vmware-migration-kit AEE</a></li>
<li><a href="#_automated_build_process">3.3.4. Automated Build Process</a></li>
<li><a href="#_release_versioning_and_tagging_strategy">3.3.5. Release Versioning and Tagging Strategy</a></li>
</ul>
</li>
<li><a href="#_using_aee_images">3.4. Using AEE Images</a>
<ul class="sectlevel3">
<li><a href="#_running_playbooks_with_aee">3.4.1. Running Playbooks with AEE</a></li>
<li><a href="#_interactive_shell_access">3.4.2. Interactive Shell Access</a></li>
<li><a href="#_volume_mounts">3.4.3. Volume Mounts</a></li>
</ul>
</li>
<li><a href="#_aee_configuration">3.5. AEE Configuration</a>
<ul class="sectlevel3">
<li><a href="#_execution_environment_definition">3.5.1. Execution Environment Definition</a></li>
<li><a href="#_customizing_aee_images">3.5.2. Customizing AEE Images</a></li>
</ul>
</li>
<li><a href="#_troubleshooting">3.6. Troubleshooting</a>
<ul class="sectlevel3">
<li><a href="#_secrets_and_variables_issues">3.6.1. Secrets and Variables Issues</a></li>
<li><a href="#_debugging_aee_issues">3.6.2. Debugging AEE Issues</a></li>
<li><a href="#_performance_optimization">3.6.3. Performance Optimization</a></li>
</ul>
</li>
<li><a href="#_maintenance">3.7. Maintenance</a>
<ul class="sectlevel3">
<li><a href="#_updating_aee_images">3.7.1. Updating AEE Images</a></li>
<li><a href="#_version_management">3.7.2. Version Management</a></li>
<li><a href="#_security_considerations">3.7.3. Security Considerations</a></li>
</ul>
</li>
<li><a href="#_best_practices">3.8. Best Practices</a>
<ul class="sectlevel3">
<li><a href="#_development_workflow">3.8.1. Development Workflow</a></li>
<li><a href="#_production_usage">3.8.2. Production Usage</a></li>
<li><a href="#_documentation">3.8.3. Documentation</a></li>
</ul>
</li>
<li><a href="#_todo">3.9. TODO</a>
<ul class="sectlevel3">
<li><a href="#_collection_installation_improvements">3.9.1. Collection Installation Improvements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#os-migrate-performance-expectations_planning">4. VMware to OpenStack OS Migrate Performance Expectations</a>
<ul class="sectlevel2">
<li><a href="#_table_1">4.1. Table 1</a></li>
<li><a href="#_table_2">4.2. Table 2</a></li>
<li><a href="#_table_3">4.3. Table 3</a></li>
<li><a href="#_table_4">4.4. Table 4</a></li>
<li><a href="#_conversion_host_requirements_and_recommendations">4.5. Conversion host requirements and recommendations</a></li>
<li><a href="#_how_to_proceed_with_a_large_workload">4.6. How to proceed with a large workload</a></li>
</ul>
</li>
<li><a href="#_community">5. Community</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_welcome_to_os_migrate"><a class="anchor" href="#_welcome_to_os_migrate"></a><a class="link" href="#_welcome_to_os_migrate">1. Welcome to OS Migrate</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>OS Migrate provides a framework and toolsuite for exporting and importing
resources between two clouds. It&#8217;s a collection of Ansible playbooks that
provide the basic functionality, but may not fit each use case out of
the box. You can craft custom playbooks using the OS Migrate
collection pieces (roles and modules) as building blocks.</p>
</div>
<div class="paragraph">
<p>At present OS Migrate supports migration from VMware clouds to OpenStack,
and OpenStack to OpenStack.</p>
</div>
<div class="paragraph">
<p>OS Migrate strictly uses the official OpenStack API and does not
utilize direct database access or other methods to export or import
data. The Ansible playbooks contained in OS Migrate are idempotent.
If a command fails, you can retry with the same command.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="os-migrate-vmware-guide_vmware"><a class="anchor" href="#os-migrate-vmware-guide_vmware"></a><a class="link" href="#os-migrate-vmware-guide_vmware">2. VMware to OpenStack Guide</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>An important function included in OS Migrate is our VMware tooling,
which allows you to migrade a virtual machine from an ESXi/Vcenter environment
to OpenStack environments.</p>
</div>
<div class="paragraph">
<p>The code used os-migrate Ansible collection in order to deploy conversion host and setup
correctly the prerequists in the Openstack destination cloud.
It also used the vmware community collection in order to gather informations from the source
VMWare environment.</p>
</div>
<div class="paragraph">
<p>The Ansible collection provides different steps to scale your migration from VMWare to Openstack:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A discovery phase where it analizes the VMWare source environment and provides collected data
to help for the migration.</p>
</li>
<li>
<p>A pre-migration phase where it make sure the destionation cloud is ready to perform the migration,
by creating the conversion host for example or the required network if needed.</p>
</li>
<li>
<p>A migration phase with different workflow where the user can basicaly scale the migration with
a very number of virtual machines as entry point, or can migrate sensitive virtual machine by using
a near zero down time with the change block tracking VMWare option (CBT) and so perform the virtual
machine migration in two steps. The migration can also be done without conversion host.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_workflow"><a class="anchor" href="#_workflow"></a><a class="link" href="#_workflow">2.1. Workflow</a></h3>
<div class="paragraph">
<p>There is different ways to run the migration from VMWare to OpenStack.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default is by using nbdkit server with a conversion host (an Openstack instance hosted in the destination cloud).
This way allow the user to use the CBT option and approach a zero downtime. It can also run the migration in one time cycle.</p>
</li>
<li>
<p>The second one by using virt-v2v binding with a conversion host. Here you can use a conversion
host (Openstack instance) already deployed or you can let OS-Migrate deployed a conversion host
for you.</p>
</li>
<li>
<p>A third way is available where you can skip the conversion host and perform the migration on a Linux machine, the volume
migrated and converted will be upload a Glance image or can be use later as a Cinder volume. This way is not recommended if
you have big disk or a huge amount of VMs to migrate: the performance are really slower than with the other ways.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these are configurable with Ansible boolean variables.</p>
</div>
</div>
<div class="sect2">
<h3 id="_features_and_supported_os"><a class="anchor" href="#_features_and_supported_os"></a><a class="link" href="#_features_and_supported_os">2.2. Features and supported OS</a></h3>
<div class="sect3">
<h4 id="_features"><a class="anchor" href="#_features"></a><a class="link" href="#_features">2.2.1. Features</a></h4>
<div class="paragraph">
<p>The following features are availables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Discovery mode</p>
</li>
<li>
<p>Network mapping</p>
</li>
<li>
<p>Port creation and mac addresses mapping</p>
</li>
<li>
<p>Openstack flavor mapping and creation</p>
</li>
<li>
<p>Migration with nbdkit server with change block tracking feature (CBT)</p>
</li>
<li>
<p>Migration with virt-v2v</p>
</li>
<li>
<p>Upload migrate volume via Glance</p>
</li>
<li>
<p>Multi disks migration</p>
</li>
<li>
<p>Multi nics</p>
</li>
<li>
<p>Parallel migration on a same conversion host</p>
</li>
<li>
<p>Ansible Automation Platform (AAP)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_supported_os"><a class="anchor" href="#_supported_os"></a><a class="link" href="#_supported_os">2.2.2. Supported OS</a></h4>
<div class="paragraph">
<p>Currently we are supporting the following matrice:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OS Family</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Supported &amp; Tested</th>
<th class="tableblock halign-left valign-top">Not Tested Yet</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.3 and lower</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.4 and lower</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2k22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_nbdkit_migration_example"><a class="anchor" href="#_nbdkit_migration_example"></a><a class="link" href="#_nbdkit_migration_example">2.2.3. Nbdkit migration example</a></h4>
<div class="imageblock">
<div class="content">
<img src="images/osm-migration-nbdkit-vmware-workflow-with-osm.drawio.svg" alt="Ndbkit">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nbdkit_migration_example_with_the_change_block_tracking"><a class="anchor" href="#_nbdkit_migration_example_with_the_change_block_tracking"></a><a class="link" href="#_nbdkit_migration_example_with_the_change_block_tracking">2.2.4. Nbdkit migration example with the Change Block Tracking</a></h4>
<div class="sect4">
<h5 id="_step_1_the_data_are_copied_and_the_change_id_from_the_vmware_disk_are_set_to_the_cinder_volume_as_metadata"><a class="anchor" href="#_step_1_the_data_are_copied_and_the_change_id_from_the_vmware_disk_are_set_to_the_cinder_volume_as_metadata"></a><a class="link" href="#_step_1_the_data_are_copied_and_the_change_id_from_the_vmware_disk_are_set_to_the_cinder_volume_as_metadata">Step 1: The data are copied and the change ID from the VMware disk are set to the Cinder volume as metadata</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The conversion cannot be made at this moment, and the OS instance is not created.
This functionality can be used for large disks with a lot of data to transfer. It helps avoid a prolonged service interruption.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/osm-migration-nbdkit-vmware-workflow-with-osm_cbt_step1.svg" alt="CBT Step 1">
</div>
</div>
<div class="paragraph">
<p>==== Step 2: OSM compare the source (VMware disk) and the destination (Openstack Volume) change ID</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the change IDs are not equal, the changed blocks between the source and destination are synced.
Then, the conversion to libvirt/KVM is triggered, and the OpenStack instance is created.
This allows for minimal downtime for the VMs.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/osm-migration-nbdkit-vmware-workflow-with-osm_cbt_step2.svg" alt="CBT Step 2">
</div>
</div>
<div class="paragraph">
<p>=== Migration demo from an AEE</p>
</div>
<div class="paragraph">
<p>The content of the Ansible Execution Environment could be find here:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/os-migrate/aap/blob/main/aae-container-file" class="bare">https://github.com/os-migrate/aap/blob/main/aae-container-file</a></p>
</div>
<div class="paragraph">
<p>And the live demo here:</p>
</div>
<div class="paragraph">
<p><a href="https://www.youtube.com/watch?v=XnEQ8WVGW64">Migration from VMware to OpenStack</a></p>
</div>
<div class="paragraph">
<p>=== Running migration</p>
</div>
<div class="paragraph">
<p>==== Conversion host</p>
</div>
<div class="paragraph">
<p>You can use os_migrate.os_migration collection to deploy a conversion, but you can
easily create your conversion host manually.</p>
</div>
<div class="paragraph">
<p>A conversion host is basically an OpenStack instance.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Important: If you want to take benefit of the current supported OS, it&#8217;s highly recommended to use a <strong>CentOS-10</strong> release or <strong>RHEL-9.5</strong> and superior. If you want to use other Linux distribution, make sure the virtio-win package is equal or higher than 1.40 version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-O</span> <span class="nt">-k</span> https://cloud.centos.org/centos/10-stream/x86_64/images/CentOS-Stream-GenericCloud-10-20250217.0.x86_64.qcow2

<span class="c"># Create OpenStack image:</span>
openstack image create <span class="nt">--disk-format</span> qcow2 <span class="nt">--file</span> CentOS-Stream-GenericCloud-10-20250217.0.x86_64.qcow2 CentOS-Stream-GenericCloud-10-20250217.0.x86_64.qcow2

<span class="c"># Create flavor, security group and network if needed</span>
openstack server create <span class="nt">--flavor</span> x.medium <span class="nt">--image</span> 14b1a895-5003-4396-888e-1fa55cd4adf8  <span class="se">\</span>
  <span class="nt">--key-name</span> default <span class="nt">--network</span> private   vmware-conv-host
openstack server add floating ip vmware-conv-host 192.168.18.205</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_inventory_variables_files_and_ansible_command"><a class="anchor" href="#_inventory_variables_files_and_ansible_command"></a><a class="link" href="#_inventory_variables_files_and_ansible_command">Inventory, Variables files and Ansible command:</a></h5>
<div class="paragraph">
<p><strong>inventory.yml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">migrator</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
    <span class="na">localhost</span><span class="pi">:</span>
      <span class="na">ansible_connection</span><span class="pi">:</span> <span class="s">local</span>
      <span class="na">ansible_python_interpreter</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_playbook_python</span><span class="nv"> </span><span class="s">}}"</span>
<span class="na">conversion_host</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
    <span class="na">192.168.18.205</span><span class="pi">:</span>
      <span class="na">ansible_ssh_user</span><span class="pi">:</span> <span class="s">cloud-user</span>
      <span class="na">ansible_ssh_private_key_file</span><span class="pi">:</span> <span class="s">key</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>myvars.yml:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># if you run the migration from an Ansible Execution Environment (AEE)</span>
<span class="c1"># set this to true:</span>
<span class="na">runner_from_aee</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># osm working directory:</span>
<span class="na">os_migrate_vmw_data_dir</span><span class="pi">:</span> <span class="s">/opt/os-migrate</span>
<span class="na">copy_openstack_credentials_to_conv_host</span><span class="pi">:</span> <span class="kc">false</span>

<span class="c1"># Re-use an already deployed conversion host:</span>
<span class="na">already_deploy_conversion_host</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># If no mapped network then set the openstack network:</span>
<span class="na">openstack_private_network</span><span class="pi">:</span> <span class="s">81cc01d2-5e47-4fad-b387-32686ec71fa4</span>

<span class="c1"># Security groups for the instance:</span>
<span class="na">security_groups</span><span class="pi">:</span> <span class="s">ab7e2b1a-b9d3-4d31-9d2a-bab63f823243</span>
<span class="na">use_existing_flavor</span><span class="pi">:</span> <span class="kc">true</span>
<span class="c1"># key pair name, could be left blank</span>
<span class="na">ssh_key_name</span><span class="pi">:</span> <span class="s">default</span>
<span class="c1"># network settings for openstack:</span>
<span class="na">os_migrate_create_network_port</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">copy_metadata_to_conv_host</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">used_mapped_networks</span><span class="pi">:</span> <span class="kc">false</span>

<span class="na">vms_list</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">rhel-9.4-1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>secrets.yml:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># VMware parameters:</span>
<span class="na">esxi_hostname</span><span class="pi">:</span> <span class="s">10.0.0.7</span>
<span class="na">vcenter_hostname</span><span class="pi">:</span> <span class="s">10.0.0.7</span>
<span class="na">vcenter_username</span><span class="pi">:</span> <span class="s">root</span>
<span class="na">vcenter_password</span><span class="pi">:</span> <span class="s">root</span>
<span class="na">vcenter_datacenter</span><span class="pi">:</span> <span class="s">Datacenter</span>

<span class="na">os_cloud_environ</span><span class="pi">:</span> <span class="s">psi-rhos-upgrades-ci</span>
<span class="na">dst_cloud</span><span class="pi">:</span>
  <span class="na">auth</span><span class="pi">:</span>
    <span class="na">auth_url</span><span class="pi">:</span> <span class="s">https://keystone-public-openstack.apps.ocp-4-16.standalone</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">admin</span>
    <span class="na">project_id</span><span class="pi">:</span> <span class="s">xyz</span>
    <span class="na">project_name</span><span class="pi">:</span> <span class="s">admin</span>
    <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">openstack</span>
  <span class="na">region_name</span><span class="pi">:</span> <span class="s">regionOne</span>
  <span class="na">interface</span><span class="pi">:</span> <span class="s">public</span>
  <span class="na">insecure</span><span class="pi">:</span> <span class="kc">true</span>
  <span class="na">identity_api_version</span><span class="pi">:</span> <span class="s">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ansible command:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-playbook <span class="nt">-i</span> inventory.yml os_migrate.vmware_migration_kit.migration <span class="nt">-e</span> @secrets.yml <span class="nt">-e</span> @myvars.yml</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_usage"><a class="anchor" href="#_usage"></a><a class="link" href="#_usage">2.3. Usage</a></h3>
<div class="paragraph">
<p>You can find a "how to" here, to start from sratch with a container:
<a href="https://gist.github.com/matbu/003c300fd99ebfbf383729c249e9956f" class="bare">https://gist.github.com/matbu/003c300fd99ebfbf383729c249e9956f</a></p>
</div>
<div class="paragraph">
<p>Clone repository or install from ansible galaxy</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">git clone https://github.com/os-migrate/vmware-migration-kit
ansible-galaxy collection <span class="nb">install </span>os_migrate.vmware_migration_kit</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_nbdkit_default"><a class="anchor" href="#_nbdkit_default"></a><a class="link" href="#_nbdkit_default">2.3.1. Nbdkit (default)</a></h4>
<div class="paragraph">
<p>Edit vars.yaml file and add our own setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">esxi_hostname</span><span class="pi">:</span> <span class="err">********</span>
<span class="na">vcenter_hostname</span><span class="pi">:</span> <span class="err">*******</span>
<span class="na">vcenter_username</span><span class="pi">:</span> <span class="s">root</span>
<span class="na">vcenter_password</span><span class="pi">:</span> <span class="err">*****</span>
<span class="na">vcenter_datacenter</span><span class="pi">:</span> <span class="s">Datacenter</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you already have a conversion host, or if you want to re-used a previously deployed one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">already_deploy_conversion_host</span><span class="pi">:</span> <span class="kc">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then specify the Openstack credentials:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># OpenStack destination cloud auth parameters:</span>
<span class="na">dst_cloud</span><span class="pi">:</span>
  <span class="na">auth</span><span class="pi">:</span>
    <span class="na">auth_url</span><span class="pi">:</span> <span class="s">https://openstack.dst.cloud:13000/v3</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">tenant</span>
    <span class="na">project_id</span><span class="pi">:</span> <span class="s">xyz</span>
    <span class="na">project_name</span><span class="pi">:</span> <span class="s">migration</span>
    <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">osm.com</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">password</span>
  <span class="na">region_name</span><span class="pi">:</span> <span class="s">regionOne</span>
  <span class="na">interface</span><span class="pi">:</span> <span class="s">public</span>
  <span class="na">identity_api_version</span><span class="pi">:</span> <span class="m">3</span>

<span class="c1"># OpenStack migration parameters:</span>
<span class="c1"># Use mapped networks or not:</span>
<span class="na">used_mapped_networks</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">network_map</span><span class="pi">:</span>
  <span class="na">VM Network</span><span class="pi">:</span> <span class="s">private</span>

<span class="c1"># If no mapped network then set the openstack network:</span>
<span class="na">openstack_private_network</span><span class="pi">:</span> <span class="s">81cc01d2-5e47-4fad-b387-32686ec71fa4</span>

<span class="c1"># Security groups for the instance:</span>
<span class="na">security_groups</span><span class="pi">:</span> <span class="s">4f077e64-bdf6-4d2a-9f2c-c5588f4948ce</span>
<span class="na">use_existing_flavor</span><span class="pi">:</span> <span class="kc">true</span>

<span class="na">os_migrate_create_network_port</span><span class="pi">:</span> <span class="kc">false</span>

<span class="c1"># OS-migrate parameters:</span>
<span class="c1"># osm working directory:</span>
<span class="na">os_migrate_vmw_data_dir</span><span class="pi">:</span> <span class="s">/opt/os-migrate</span>

<span class="c1"># Set this to true if the Openstack "dst_cloud" is a clouds.yaml file</span>
<span class="c1"># other, if the dest_cloud is a dict of authentication parameters, set</span>
<span class="c1"># this to false:</span>
<span class="na">copy_openstack_credentials_to_conv_host</span><span class="pi">:</span> <span class="kc">false</span>

<span class="c1"># Teardown</span>
<span class="c1"># Set to true if you want osm to delete everything on the destination cloud.</span>
<span class="na">os_migrate_tear_down</span><span class="pi">:</span> <span class="kc">true</span>

<span class="c1"># VMs list</span>
<span class="na">vms_list</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">rhel-1</span>
  <span class="pi">-</span> <span class="s">rhel-2</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_migration_from_local_shared_nfs"><a class="anchor" href="#_running_migration_from_local_shared_nfs"></a><a class="link" href="#_running_migration_from_local_shared_nfs">2.3.2. Running migration from local shared NFS</a></h4>
<div class="paragraph">
<p>OS-Migrate can migrate directly from a local shared directory mounted on the
conversion host. If the VMware virtual machines are located on an NFS datastore
that is accessible to the conversion host, you can mount the NFS storage on the
conversion host and provide the path to the NFS mount point.</p>
</div>
<div class="paragraph">
<p>OS-Migrate will then directly consume the disks of the virtual machines located
on the NFS mount point. Configure the Ansible variable to specify your mount
point as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">import_workloads_local_disk_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/srv/nfs"</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In this mode, only cold migration is supported.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ansible_configuration"><a class="anchor" href="#_ansible_configuration"></a><a class="link" href="#_ansible_configuration">2.3.3. Ansible configuration</a></h4>
<div class="paragraph">
<p>Create an invenvoty file, and replace the conv_host_ip by the ip address of your
conversion host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">migrator</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
    <span class="na">localhost</span><span class="pi">:</span>
      <span class="na">ansible_connection</span><span class="pi">:</span> <span class="s">local</span>
      <span class="na">ansible_python_interpreter</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_playbook_python</span><span class="nv"> </span><span class="s">}}"</span>
<span class="na">conversion_host</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
    <span class="na">conv_host_ip</span><span class="pi">:</span>
      <span class="na">ansible_ssh_user</span><span class="pi">:</span> <span class="s">cloud-user</span>
      <span class="na">ansible_ssh_private_key_file</span><span class="pi">:</span> <span class="s">/home/stack/.ssh/conv-host</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run the migration with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-playbook <span class="nt">-i</span> localhost_inventory.yml os_migrate.vmware_migration_kit.migration <span class="nt">-e</span> @vars.yaml</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_migration_outside_of_ansible"><a class="anchor" href="#_running_migration_outside_of_ansible"></a><a class="link" href="#_running_migration_outside_of_ansible">2.3.4. Running Migration outside of Ansible</a></h4>
<div class="paragraph">
<p>You can also run migration outside of Ansible because the Ansible module are written in Golang.
The binaries are located in the plugins directory.</p>
</div>
<div class="paragraph">
<p>From your conversion host (or an Openstack instance inside the destination cloud) you need to export
Openstack variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"> <span class="nb">export </span><span class="nv">OS_AUTH_URL</span><span class="o">=</span>https://keystone-public-openstack.apps.ocp-4-16.standalone
 <span class="nb">export </span><span class="nv">OS_PROJECT_NAME</span><span class="o">=</span>admin
 <span class="nb">export </span><span class="nv">OS_PASSWORD</span><span class="o">=</span>admin
 <span class="nb">export </span><span class="nv">OS_USERNAME</span><span class="o">=</span>admin
 <span class="nb">export </span><span class="nv">OS_DOMAIN_NAME</span><span class="o">=</span>Default
 <span class="nb">export </span><span class="nv">OS_PROJECT_ID</span><span class="o">=</span>xyz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create the argument json file, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="err">cat</span><span class="w"> </span><span class="err">&lt;&lt;EOF</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">args.json</span><span class="w">
</span><span class="p">{</span><span class="w">
		</span><span class="nl">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"root"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"root"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.0.0.7"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"vmname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rhel-9.4-3"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"cbtsync"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
		</span><span class="nl">"dst_cloud"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			</span><span class="nl">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
				</span><span class="nl">"auth_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://keystone-public-openstack.apps.ocp-4-16.standalone"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"project_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xyz"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"project_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"user_domain_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Default"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="w">
			</span><span class="p">},</span><span class="w">
			</span><span class="nl">"region_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"regionOne"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"interface"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"identity_api_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
		</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">EOF</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then execute the <code>migrate</code> binary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">pushd </span>vmware-migration-kit/vmware_migration_kit
./plugins/modules/migrate/migrate</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the logs into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">tail</span> <span class="nt">-f</span> /tmp/osm-nbdkit.log</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_execution_environment_aee_images"><a class="anchor" href="#_ansible_execution_environment_aee_images"></a><a class="link" href="#_ansible_execution_environment_aee_images">3. Ansible Execution Environment (AEE) Images</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>os-migrate and vmware-migration-kit provide containerized Ansible Execution Environment (AEE) images that encapsulate all necessary dependencies for running migration playbooks in a consistent, isolated environment.</p>
</div>
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a><a class="link" href="#_overview">3.1. Overview</a></h3>
<div class="paragraph">
<p>Ansible Execution Environments are container images that provide a standardized runtime environment for Ansible automation. They include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ansible Core and Ansible Runner</p>
</li>
<li>
<p>Python runtime and required packages</p>
</li>
<li>
<p>os-migrate and vmware-migration-kit collections</p>
</li>
<li>
<p>All necessary dependencies and tools</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This approach ensures consistent behavior across different environments and simplifies deployment and maintenance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_available_aee_images"><a class="anchor" href="#_available_aee_images"></a><a class="link" href="#_available_aee_images">3.2. Available AEE Images</a></h3>
<div class="sect3">
<h4 id="_os_migrate_aee"><a class="anchor" href="#_os_migrate_aee"></a><a class="link" href="#_os_migrate_aee">3.2.1. os-migrate AEE</a></h4>
<div class="paragraph">
<p>The os-migrate AEE image contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ansible Core</p>
</li>
<li>
<p>os-migrate Ansible collection</p>
</li>
<li>
<p>OpenStack SDK and related Python packages</p>
</li>
<li>
<p>All required dependencies for OpenStack resource migration</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_vmware_migration_kit_aee"><a class="anchor" href="#_vmware_migration_kit_aee"></a><a class="link" href="#_vmware_migration_kit_aee">3.2.2. vmware-migration-kit AEE</a></h4>
<div class="paragraph">
<p>The vmware-migration-kit AEE image contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ansible Core</p>
</li>
<li>
<p>vmware-migration-kit Ansible collection</p>
</li>
<li>
<p>VMware SDK and related Python packages</p>
</li>
<li>
<p>All required dependencies for VMware to OpenStack migration</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_building_aee_images"><a class="anchor" href="#_building_aee_images"></a><a class="link" href="#_building_aee_images">3.3. Building AEE Images</a></h3>
<div class="sect3">
<h4 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a><a class="link" href="#_prerequisites">3.3.1. Prerequisites</a></h4>
<div class="paragraph">
<p>Before building AEE images, ensure you have the following tools installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ansible-builder</code> - Tool for building execution environments</p>
</li>
<li>
<p><code>podman</code> or <code>docker</code> - Container runtime</p>
</li>
<li>
<p><code>git</code> - Version control system</p>
</li>
<li>
<p><code>python3</code> - Python runtime (version 3.8 or higher)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_setting_up_a_virtual_environment"><a class="anchor" href="#_setting_up_a_virtual_environment"></a><a class="link" href="#_setting_up_a_virtual_environment">Setting Up a Virtual Environment</a></h5>
<div class="paragraph">
<p>It&#8217;s recommended to use a Python virtual environment to isolate dependencies and avoid conflicts with system packages.</p>
</div>
<div class="paragraph">
<p>Create and activate a virtual environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Create virtual environment</span>
python3 <span class="nt">-m</span> venv .venv

<span class="c"># Activate virtual environment (Linux/macOS)</span>
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Activate virtual environment (Windows)</span>
.venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_installing_dependencies"><a class="anchor" href="#_installing_dependencies"></a><a class="link" href="#_installing_dependencies">Installing Dependencies</a></h5>
<div class="paragraph">
<p>Install the required dependencies using the project-specific requirements files:</p>
</div>
<div class="paragraph">
<p><strong>For os-migrate:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Clone the repository</span>
git clone https://github.com/os-migrate/os-migrate.git
<span class="nb">cd </span>os-migrate

<span class="c"># Create and activate virtual environment</span>
python3 <span class="nt">-m</span> venv .venv
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Install build dependencies</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements-build.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For vmware-migration-kit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Clone the repository</span>
git clone https://github.com/os-migrate/vmware-migration-kit.git
<span class="nb">cd </span>vmware-migration-kit

<span class="c"># Create and activate virtual environment</span>
python3 <span class="nt">-m</span> venv .venv
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Install build dependencies</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements-build.txt</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_requirements_files"><a class="anchor" href="#_requirements_files"></a><a class="link" href="#_requirements_files">Requirements Files</a></h5>
<div class="paragraph">
<p>Both repositories provide <code>requirements-build.txt</code> files that contain all necessary dependencies for building AEE images:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>os-migrate requirements</strong>: <a href="https://github.com/os-migrate/os-migrate/blob/main/requirements-build.txt" class="bare">https://github.com/os-migrate/os-migrate/blob/main/requirements-build.txt</a></p>
</li>
<li>
<p><strong>vmware-migration-kit requirements</strong>: <a href="https://github.com/os-migrate/vmware-migration-kit/blob/main/requirements-build.txt" class="bare">https://github.com/os-migrate/vmware-migration-kit/blob/main/requirements-build.txt</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These files include:
* <code>ansible-builder</code> - Core tool for building execution environments
* <code>ansible-core</code> - Ansible runtime
* <code>ansible-runner</code> - Execution environment runner
* Additional Python packages required for the build process</p>
</div>
</div>
<div class="sect4">
<h5 id="_collection_requirements_in_aee"><a class="anchor" href="#_collection_requirements_in_aee"></a><a class="link" href="#_collection_requirements_in_aee">Collection Requirements in AEE</a></h5>
<div class="paragraph">
<p>The AEE images use <code>requirements.yml</code> files to specify which Ansible collections to install. The collection installation method depends on the build context:</p>
</div>
<div class="paragraph">
<p><strong>For main branch builds (development):</strong></p>
</div>
<div class="paragraph">
<p>Install collections directly from Git repositories using the main branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># requirements.yml for main branch builds</span>
<span class="na">collections</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">https://github.com/os-migrate/os-migrate.git</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">git</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">main</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">https://github.com/os-migrate/vmware-migration-kit.git</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">git</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">main</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For stable/tagged builds (production):</strong></p>
</div>
<div class="paragraph">
<p>Install collections from Ansible Galaxy using specific version tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># requirements.yml for stable/tagged builds</span>
<span class="na">collections</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1.0.1"</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">os_migrate.vmware_migration_kit</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2.0.4"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Benefits of this approach:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Main branch builds</strong>: Always get the latest development code with latest features and fixes</p>
</li>
<li>
<p><strong>Stable builds</strong>: Use tested, released versions for production stability</p>
</li>
<li>
<p><strong>Version consistency</strong>: AEE image tags match the collection versions they contain</p>
</li>
<li>
<p><strong>Reproducible builds</strong>: Same collection versions produce identical AEE images</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_alternative_installation_methods"><a class="anchor" href="#_alternative_installation_methods"></a><a class="link" href="#_alternative_installation_methods">Alternative Installation Methods</a></h5>
<div class="paragraph">
<p>If you prefer not to use virtual environments, you can install ansible-builder globally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Install ansible-builder globally</span>
pip <span class="nb">install </span>ansible-builder

<span class="c"># Or install from requirements file</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements-build.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: Global installation may cause dependency conflicts with other Python projects on your system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_virtual_environment_management"><a class="anchor" href="#_virtual_environment_management"></a><a class="link" href="#_virtual_environment_management">Virtual Environment Management</a></h5>
<div class="paragraph">
<p>After completing your work, you can deactivate the virtual environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Deactivate virtual environment</span>
deactivate</code></pre>
</div>
</div>
<div class="paragraph">
<p>To reactivate the virtual environment in future sessions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Navigate to the project directory</span>
<span class="nb">cd</span> /path/to/os-migrate  <span class="c"># or vmware-migration-kit</span>

<span class="c"># Activate the virtual environment</span>
<span class="nb">source</span> .venv/bin/activate</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_troubleshooting_virtual_environment_issues"><a class="anchor" href="#_troubleshooting_virtual_environment_issues"></a><a class="link" href="#_troubleshooting_virtual_environment_issues">Troubleshooting Virtual Environment Issues</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Virtual environment not found</strong></dt>
<dd>
<p>Ensure you&#8217;re in the correct directory and the virtual environment was created successfully.</p>
</dd>
<dt class="hdlist1"><strong>Permission denied</strong></dt>
<dd>
<p>On some systems, you may need to use <code>python3</code> instead of <code>python</code> to create the virtual environment.</p>
</dd>
<dt class="hdlist1"><strong>Dependencies not found</strong></dt>
<dd>
<p>Make sure the virtual environment is activated before installing dependencies or building AEE images.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Check if virtual environment is active</span>
<span class="nb">echo</span> <span class="nv">$VIRTUAL_ENV</span>

<span class="c"># Verify ansible-builder is installed</span>
which ansible-builder
ansible-builder <span class="nt">--version</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_os_migrate_aee"><a class="anchor" href="#_building_os_migrate_aee"></a><a class="link" href="#_building_os_migrate_aee">3.3.2. Building os-migrate AEE</a></h4>
<div class="paragraph">
<p>Navigate to the os-migrate repository and build the AEE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Navigate to the repository</span>
<span class="nb">cd</span> /path/to/os-migrate

<span class="c"># Activate virtual environment (if using one)</span>
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Navigate to AEE directory</span>
<span class="nb">cd </span>aee

<span class="c"># Build the AEE image</span>
ansible-builder build <span class="nt">--tag</span> os-migrate:latest</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_vmware_migration_kit_aee"><a class="anchor" href="#_building_vmware_migration_kit_aee"></a><a class="link" href="#_building_vmware_migration_kit_aee">3.3.3. Building vmware-migration-kit AEE</a></h4>
<div class="paragraph">
<p>Navigate to the vmware-migration-kit repository and build the AEE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Navigate to the repository</span>
<span class="nb">cd</span> /path/to/vmware-migration-kit

<span class="c"># Activate virtual environment (if using one)</span>
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Navigate to AEE directory</span>
<span class="nb">cd </span>aee

<span class="c"># Build the AEE image</span>
ansible-builder build <span class="nt">--tag</span> vmware-migration-kit:latest</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_automated_build_process"><a class="anchor" href="#_automated_build_process"></a><a class="link" href="#_automated_build_process">3.3.4. Automated Build Process</a></h4>
<div class="paragraph">
<p>Both repositories include GitHub Actions workflows that automatically build and test AEE images:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>os-migrate/.github/workflows/build-aee.yml</code></p>
</li>
<li>
<p><code>vmware-migration-kit/.github/workflows/build-aee.yml</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Trigger on pushes to main branch and pull requests</p>
</li>
<li>
<p>Build the AEE image using ansible-builder</p>
</li>
<li>
<p>Run basic validation tests</p>
</li>
<li>
<p>Push images to container registries (when configured)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_release_versioning_and_tagging_strategy"><a class="anchor" href="#_release_versioning_and_tagging_strategy"></a><a class="link" href="#_release_versioning_and_tagging_strategy">3.3.5. Release Versioning and Tagging Strategy</a></h4>
<div class="paragraph">
<p>The GitHub Actions workflows implement a sophisticated versioning strategy for AEE images:</p>
</div>
<div class="sect4">
<h5 id="_main_branch_builds"><a class="anchor" href="#_main_branch_builds"></a><a class="link" href="#_main_branch_builds">Main Branch Builds</a></h5>
<div class="paragraph">
<p>Images built from the <code>main</code> branch are tagged as <code>latest</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># When building from main branch</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push AEE image</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">github.ref == 'refs/heads/main'</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">ansible-builder build --tag ${{ github.repository }}:latest</span>
    <span class="s">podman push ${{ github.repository }}:latest</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_tag_based_builds"><a class="anchor" href="#_tag_based_builds"></a><a class="link" href="#_tag_based_builds">Tag-based Builds</a></h5>
<div class="paragraph">
<p>When building from Git tags, images receive multiple tags for maximum compatibility:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># When building from tags</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push AEE image with version tags</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">startsWith(github.ref, 'refs/tags/')</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">TAG_VERSION=${GITHUB_REF#refs/tags/}</span>
    <span class="s">ansible-builder build --tag ${{ github.repository }}:$TAG_VERSION</span>
    <span class="s">ansible-builder build --tag ${{ github.repository }}:stable</span>

    <span class="s">podman push ${{ github.repository }}:$TAG_VERSION</span>
    <span class="s">podman push ${{ github.repository }}:stable</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_tagging_strategy"><a class="anchor" href="#_tagging_strategy"></a><a class="link" href="#_tagging_strategy">Tagging Strategy</a></h5>
<div class="paragraph">
<p>The versioning strategy follows these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>latest</code> - Always points to the most recent build from <code>main</code> branch</p>
</li>
<li>
<p><code>stable</code> - Points to the most recent tagged release (production-ready)</p>
</li>
<li>
<p><code>1.2.3</code> - Version without 'v' prefix for compatibility</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_usage_examples"><a class="anchor" href="#_usage_examples"></a><a class="link" href="#_usage_examples">Usage Examples</a></h5>
<div class="paragraph">
<p>Use the appropriate tag based on your requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Use latest development version</span>
podman run <span class="nt">--rm</span> os-migrate:latest ansible <span class="nt">--version</span>

<span class="c"># Use latest stable release</span>
podman run <span class="nt">--rm</span> os-migrate:stable ansible <span class="nt">--version</span>

<span class="c"># Use specific version</span>
podman run <span class="nt">--rm</span> os-migrate:1.2.3 ansible <span class="nt">--version</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_workflow_triggers"><a class="anchor" href="#_workflow_triggers"></a><a class="link" href="#_workflow_triggers">Workflow Triggers</a></h5>
<div class="paragraph">
<p>The GitHub Actions workflows are triggered by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>push</code> to <code>main</code> branch  builds <code>latest</code> tag</p>
</li>
<li>
<p><code>push</code> of tags  builds version-specific and <code>stable</code> tags</p>
</li>
<li>
<p><code>pull_request</code> to <code>main</code>  builds and tests (no push to registry)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_registry_configuration"><a class="anchor" href="#_registry_configuration"></a><a class="link" href="#_registry_configuration">Registry Configuration</a></h5>
<div class="paragraph">
<p>Configure the container registry in the workflow using environment variables and secrets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">env</span><span class="pi">:</span>
  <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">quay.io</span>
  <span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">os-migrate/os-migrate</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Container Registry</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">podman login -u ${{ secrets.REGISTRY_USERNAME }} \</span>
                 <span class="s">-p ${{ secrets.REGISTRY_PASSWORD }} \</span>
                 <span class="s">${{ env.REGISTRY }}</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">ansible-builder build --tag ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ steps.version.outputs.tag }}</span>
    <span class="s">podman push ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ steps.version.outputs.tag }}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_secrets_and_environment_variables"><a class="anchor" href="#_configuring_secrets_and_environment_variables"></a><a class="link" href="#_configuring_secrets_and_environment_variables">Configuring Secrets and Environment Variables</a></h5>
<div class="paragraph">
<p>GitHub Actions supports multiple levels of configuration for secrets and variables. Understanding these levels is crucial for proper AEE workflow configuration.</p>
</div>
<div class="sect5">
<h6 id="_repository_level_secrets"><a class="anchor" href="#_repository_level_secrets"></a><a class="link" href="#_repository_level_secrets">Repository-Level Secrets</a></h6>
<div class="paragraph">
<p>Create secrets at the repository level for AEE workflows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to your repository on GitHub</p>
</li>
<li>
<p>Click <strong>Settings</strong>  <strong>Secrets and variables</strong>  <strong>Actions</strong></p>
</li>
<li>
<p>Click <strong>New repository secret</strong></p>
</li>
<li>
<p>Add the following secrets for AEE workflows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Required secrets for AEE workflows</span>
<span class="na">REGISTRY_USERNAME</span><span class="pi">:</span> <span class="s">your-registry-username</span>
<span class="na">REGISTRY_PASSWORD</span><span class="pi">:</span> <span class="s">your-registry-password</span>
<span class="na">REGISTRY_TOKEN</span><span class="pi">:</span> <span class="s">your-registry-token</span>  <span class="c1"># Alternative to username/password</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_environment_level_secrets"><a class="anchor" href="#_environment_level_secrets"></a><a class="link" href="#_environment_level_secrets">Environment-Level Secrets</a></h6>
<div class="paragraph">
<p>For production deployments, use environment-level secrets:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <strong>Settings</strong>  <strong>Environments</strong></p>
</li>
<li>
<p>Create environments like <code>production</code>, <code>staging</code>, <code>development</code></p>
</li>
<li>
<p>Configure environment-specific secrets:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Environment-specific secrets</span>
<span class="na">production</span><span class="pi">:</span>
  <span class="na">REGISTRY_USERNAME</span><span class="pi">:</span> <span class="s">prod-registry-user</span>
  <span class="na">REGISTRY_PASSWORD</span><span class="pi">:</span> <span class="s">prod-registry-password</span>

<span class="na">staging</span><span class="pi">:</span>
  <span class="na">REGISTRY_USERNAME</span><span class="pi">:</span> <span class="s">staging-registry-user</span>
  <span class="na">REGISTRY_PASSWORD</span><span class="pi">:</span> <span class="s">staging-registry-password</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_organization_level_variables"><a class="anchor" href="#_organization_level_variables"></a><a class="link" href="#_organization_level_variables">Organization-Level Variables</a></h6>
<div class="paragraph">
<p>Use organization-level variables for shared configuration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to organization <strong>Settings</strong>  <strong>Secrets and variables</strong>  <strong>Actions</strong></p>
</li>
<li>
<p>Add organization variables:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Organization variables (not secrets)</span>
<span class="na">DEFAULT_REGISTRY</span><span class="pi">:</span> <span class="s">quay.io</span>
<span class="na">DEFAULT_IMAGE_PREFIX</span><span class="pi">:</span> <span class="s">os-migrate</span>
<span class="na">ANSIBLE_BUILDER_VERSION</span><span class="pi">:</span> <span class="s">3.0.0</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_repository_level_variables"><a class="anchor" href="#_repository_level_variables"></a><a class="link" href="#_repository_level_variables">Repository-Level Variables</a></h6>
<div class="paragraph">
<p>Create repository-level variables for project-specific configuration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to your repository on GitHub</p>
</li>
<li>
<p>Click <strong>Settings</strong>  <strong>Secrets and variables</strong>  <strong>Actions</strong></p>
</li>
<li>
<p>Click <strong>Variables</strong> tab  <strong>New repository variable</strong></p>
</li>
<li>
<p>Add variables for AEE workflows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Repository variables for AEE workflows</span>
<span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">os-migrate</span>
<span class="na">BASE_IMAGE</span><span class="pi">:</span> <span class="s">quay.io/ansible/ansible-runner:latest</span>
<span class="na">ANSIBLE_VERSION</span><span class="pi">:</span> <span class="s">6.0.0</span>
<span class="na">PYTHON_VERSION</span><span class="pi">:</span> <span class="m">3.11</span>
<span class="na">BUILD_CONTEXT</span><span class="pi">:</span> <span class="s">./aee</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_environment_level_variables"><a class="anchor" href="#_environment_level_variables"></a><a class="link" href="#_environment_level_variables">Environment-Level Variables</a></h6>
<div class="paragraph">
<p>Configure environment-specific variables:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <strong>Settings</strong>  <strong>Environments</strong></p>
</li>
<li>
<p>Select an environment (e.g., <code>production</code>)</p>
</li>
<li>
<p>Add environment-specific variables:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Environment-specific variables</span>
<span class="na">production</span><span class="pi">:</span>
  <span class="na">IMAGE_TAG</span><span class="pi">:</span> <span class="s">latest</span>
  <span class="na">REGISTRY_URL</span><span class="pi">:</span> <span class="s">quay.io</span>
  <span class="na">BUILD_ARGS</span><span class="pi">:</span> <span class="s">--no-cache --compress</span>

<span class="na">staging</span><span class="pi">:</span>
  <span class="na">IMAGE_TAG</span><span class="pi">:</span> <span class="s">staging</span>
  <span class="na">REGISTRY_URL</span><span class="pi">:</span> <span class="s">ghcr.io</span>
  <span class="na">BUILD_ARGS</span><span class="pi">:</span> <span class="s">--no-cache</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="na">IMAGE_TAG</span><span class="pi">:</span> <span class="s">dev</span>
  <span class="na">REGISTRY_URL</span><span class="pi">:</span> <span class="s">ghcr.io</span>
  <span class="na">BUILD_ARGS</span><span class="pi">:</span> <span class="s">--progress=plain</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_using_variables_in_workflows"><a class="anchor" href="#_using_variables_in_workflows"></a><a class="link" href="#_using_variables_in_workflows">Using Variables in Workflows</a></h6>
<div class="paragraph">
<p>Access variables using the <code>vars</code> context in your workflows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s">AEE Build with Variables</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Podman</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">redhat-actions/setup-podman@v1</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build AEE Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">cd ${{ vars.BUILD_CONTEXT }}</span>
          <span class="s">ansible-builder build \</span>
            <span class="s">--tag ${{ vars.REGISTRY_URL }}/${{ vars.IMAGE_NAME }}:${{ vars.IMAGE_TAG }} \</span>
            <span class="s">${{ vars.BUILD_ARGS }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Push Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">podman push ${{ vars.REGISTRY_URL }}/${{ vars.IMAGE_NAME }}:${{ vars.IMAGE_TAG }}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_variable_precedence"><a class="anchor" href="#_variable_precedence"></a><a class="link" href="#_variable_precedence">Variable Precedence</a></h6>
<div class="paragraph">
<p>GitHub Actions follows this precedence order for variables and secrets:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Environment variables</strong> (highest priority)</p>
</li>
<li>
<p><strong>Environment-level secrets/variables</strong></p>
</li>
<li>
<p><strong>Repository-level secrets/variables</strong></p>
</li>
<li>
<p><strong>Organization-level secrets/variables</strong></p>
</li>
<li>
<p><strong>System variables</strong> (lowest priority)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Example showing variable precedence</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Variable Precedence Example</span>
<span class="na">on</span><span class="pi">:</span> <span class="s">push</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Show Variable Values</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">echo "Repository variable: ${{ vars.IMAGE_NAME }}"</span>
          <span class="s">echo "Environment variable: ${{ vars.IMAGE_TAG }}"</span>
          <span class="s">echo "Organization variable: ${{ vars.DEFAULT_REGISTRY }}"</span>
          <span class="s">echo "System variable: ${{ github.ref_name }}"</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># This overrides all other variables</span>
          <span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">override-from-env</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_workflow_configuration_examples"><a class="anchor" href="#_workflow_configuration_examples"></a><a class="link" href="#_workflow_configuration_examples">Workflow Configuration Examples</a></h6>

</div>
<div class="sect5">
<h6 id="_basic_registry_authentication"><a class="anchor" href="#_basic_registry_authentication"></a><a class="link" href="#_basic_registry_authentication">Basic Registry Authentication</a></h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s">Build AEE Image</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">v*'</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>  <span class="c1"># Uses environment-level secrets</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Podman</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">redhat-actions/setup-podman@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">podman-version</span><span class="pi">:</span> <span class="s">latest</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Registry</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
            <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
            <span class="s">--password-stdin \</span>
            <span class="s">${{ vars.DEFAULT_REGISTRY }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build AEE Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">cd aee</span>
          <span class="s">ansible-builder build --tag ${{ vars.DEFAULT_REGISTRY }}/${{ vars.DEFAULT_IMAGE_PREFIX }}:${{ github.ref_name }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Push Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">podman push ${{ vars.DEFAULT_REGISTRY }}/${{ vars.DEFAULT_IMAGE_PREFIX }}:${{ github.ref_name }}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_multi_registry_support"><a class="anchor" href="#_multi_registry_support"></a><a class="link" href="#_multi_registry_support">Multi-Registry Support</a></h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push to Multiple Registries</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">v*'</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">registry</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">quay.io</span><span class="pi">,</span> <span class="nv">ghcr.io</span><span class="pi">,</span> <span class="nv">docker.io</span><span class="pi">]</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Podman</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">redhat-actions/setup-podman@v1</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to ${{ matrix.registry }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">case "${{ matrix.registry }}" in</span>
            <span class="s">"quay.io")</span>
              <span class="s">echo ${{ secrets.QUAY_TOKEN }} | podman login --username ${{ secrets.QUAY_USERNAME }} --password-stdin quay.io</span>
              <span class="s">;;</span>
            <span class="s">"ghcr.io")</span>
              <span class="s">echo ${{ secrets.GITHUB_TOKEN }} | podman login --username ${{ github.actor }} --password-stdin ghcr.io</span>
              <span class="s">;;</span>
            <span class="s">"docker.io")</span>
              <span class="s">echo ${{ secrets.DOCKERHUB_TOKEN }} | podman login --username ${{ secrets.DOCKERHUB_USERNAME }} --password-stdin docker.io</span>
              <span class="s">;;</span>
          <span class="s">esac</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">cd aee</span>
          <span class="s">ansible-builder build --tag ${{ matrix.registry }}/os-migrate:${{ github.ref_name }}</span>
          <span class="s">podman push ${{ matrix.registry }}/os-migrate:${{ github.ref_name }}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_secure_secret_handling"><a class="anchor" href="#_secure_secret_handling"></a><a class="link" href="#_secure_secret_handling">Secure Secret Handling</a></h6>
<div class="paragraph">
<p>Follow security best practices when using secrets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Secure Secret Usage</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">#  Good: Use environment variables</span>
    <span class="s">export REGISTRY_PASSWORD="${{ secrets.REGISTRY_PASSWORD }}"</span>
    <span class="s">podman login --username ${{ secrets.REGISTRY_USERNAME }} --password-stdin ${{ env.REGISTRY }}</span>

    <span class="s">#  Good: Use proper quoting</span>
    <span class="s">podman login --username "${{ secrets.REGISTRY_USERNAME }}" --password "${{ secrets.REGISTRY_PASSWORD }}" ${{ env.REGISTRY }}</span>

    <span class="s">#  Bad: Direct command line usage without quoting</span>
    <span class="s">podman login --username ${{ secrets.REGISTRY_USERNAME }} --password ${{ secrets.REGISTRY_PASSWORD }} ${{ env.REGISTRY }}</span>
  <span class="na">env</span><span class="pi">:</span>
    <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">${{ vars.DEFAULT_REGISTRY }}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_conditional_secret_usage"><a class="anchor" href="#_conditional_secret_usage"></a><a class="link" href="#_conditional_secret_usage">Conditional Secret Usage</a></h6>
<div class="paragraph">
<p>Use secrets conditionally based on workflow context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Conditional Registry Login</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">github.event_name == 'push' &amp;&amp; github.ref == 'refs/heads/main'</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
      <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
      <span class="s">--password-stdin \</span>
      <span class="s">${{ env.REGISTRY }}</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push (Main Branch)</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">github.event_name == 'push' &amp;&amp; github.ref == 'refs/heads/main'</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">cd aee</span>
    <span class="s">ansible-builder build --tag ${{ env.REGISTRY }}/os-migrate:latest</span>
    <span class="s">podman push ${{ env.REGISTRY }}/os-migrate:latest</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push (Tags)</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">github.event_name == 'push' &amp;&amp; startsWith(github.ref, 'refs/tags/')</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">cd aee</span>
    <span class="s">TAG_VERSION=${GITHUB_REF#refs/tags/}</span>
    <span class="s">ansible-builder build --tag ${{ env.REGISTRY }}/os-migrate:$TAG_VERSION</span>
    <span class="s">ansible-builder build --tag ${{ env.REGISTRY }}/os-migrate:stable</span>
    <span class="s">podman push ${{ env.REGISTRY }}/os-migrate:$TAG_VERSION</span>
    <span class="s">podman push ${{ env.REGISTRY }}/os-migrate:stable</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_secret_rotation_and_management"><a class="anchor" href="#_secret_rotation_and_management"></a><a class="link" href="#_secret_rotation_and_management">Secret Rotation and Management</a></h6>
<div class="paragraph">
<p>Implement secret rotation strategies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Validate Secrets</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">if [ -z "${{ secrets.REGISTRY_USERNAME }}" ]; then</span>
      <span class="s">echo " REGISTRY_USERNAME secret is not set"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span>

    <span class="s">if [ -z "${{ secrets.REGISTRY_PASSWORD }}" ]; then</span>
      <span class="s">echo " REGISTRY_PASSWORD secret is not set"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span>

    <span class="s">echo " All required secrets are configured"</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test Registry Access</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
      <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
      <span class="s">--password-stdin \</span>
      <span class="s">${{ env.REGISTRY }} --test</span>
    <span class="s">echo " Registry authentication successful"</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_environment_specific_configuration"><a class="anchor" href="#_environment_specific_configuration"></a><a class="link" href="#_environment_specific_configuration">Environment-Specific Configuration</a></h6>
<div class="paragraph">
<p>Use different configurations for different environments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s">AEE Build Matrix</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">,</span> <span class="nv">develop</span><span class="pi">]</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">v*'</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">include</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">environment</span><span class="pi">:</span> <span class="s">development</span>
            <span class="na">registry</span><span class="pi">:</span> <span class="s">ghcr.io</span>
            <span class="na">image_tag</span><span class="pi">:</span> <span class="s">dev</span>
          <span class="pi">-</span> <span class="na">environment</span><span class="pi">:</span> <span class="s">staging</span>
            <span class="na">registry</span><span class="pi">:</span> <span class="s">quay.io</span>
            <span class="na">image_tag</span><span class="pi">:</span> <span class="s">staging</span>
          <span class="pi">-</span> <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>
            <span class="na">registry</span><span class="pi">:</span> <span class="s">quay.io</span>
            <span class="na">image_tag</span><span class="pi">:</span> <span class="s">latest</span>

    <span class="na">environment</span><span class="pi">:</span> <span class="s">${{ matrix.environment }}</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Podman</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">redhat-actions/setup-podman@v1</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Registry</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
            <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
            <span class="s">--password-stdin \</span>
            <span class="s">${{ matrix.registry }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build AEE Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">cd aee</span>
          <span class="s">ansible-builder build --tag ${{ matrix.registry }}/os-migrate:${{ matrix.image_tag }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Push Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">podman push ${{ matrix.registry }}/os-migrate:${{ matrix.image_tag }}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_aee_images"><a class="anchor" href="#_using_aee_images"></a><a class="link" href="#_using_aee_images">3.4. Using AEE Images</a></h3>
<div class="sect3">
<h4 id="_running_playbooks_with_aee"><a class="anchor" href="#_running_playbooks_with_aee"></a><a class="link" href="#_running_playbooks_with_aee">3.4.1. Running Playbooks with AEE</a></h4>
<div class="paragraph">
<p>Execute os-migrate playbooks using the AEE container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">podman run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/runner <span class="se">\</span>
  <span class="nt">-v</span> ~/.ssh:/home/runner/.ssh:ro <span class="se">\</span>
  os-migrate:latest <span class="se">\</span>
  ansible-playbook <span class="nt">-i</span> inventory playbook.yml</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_interactive_shell_access"><a class="anchor" href="#_interactive_shell_access"></a><a class="link" href="#_interactive_shell_access">3.4.2. Interactive Shell Access</a></h4>
<div class="paragraph">
<p>Access the AEE container interactively for debugging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">podman run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/runner <span class="se">\</span>
  <span class="nt">-v</span> ~/.ssh:/home/runner/.ssh:ro <span class="se">\</span>
  os-migrate:latest <span class="se">\</span>
  /bin/bash</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_volume_mounts"><a class="anchor" href="#_volume_mounts"></a><a class="link" href="#_volume_mounts">3.4.3. Volume Mounts</a></h4>
<div class="paragraph">
<p>Common volume mounts for AEE usage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$(pwd):/runner</code> - Mount current directory as working directory</p>
</li>
<li>
<p><code>~/.ssh:/home/runner/.ssh:ro</code> - Mount SSH keys (read-only)</p>
</li>
<li>
<p><code>~/.config/openstack:/home/runner/.config/openstack:ro</code> - Mount OpenStack credentials</p>
</li>
<li>
<p><code>/path/to/inventory:/runner/inventory:ro</code> - Mount inventory files</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aee_configuration"><a class="anchor" href="#_aee_configuration"></a><a class="link" href="#_aee_configuration">3.5. AEE Configuration</a></h3>
<div class="sect3">
<h4 id="_execution_environment_definition"><a class="anchor" href="#_execution_environment_definition"></a><a class="link" href="#_execution_environment_definition">3.5.1. Execution Environment Definition</a></h4>
<div class="paragraph">
<p>AEE images are defined using <code>execution-environment.yml</code> files that specify:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Base image (typically <code>quay.io/ansible/ansible-runner:latest</code>)</p>
</li>
<li>
<p>Python dependencies</p>
</li>
<li>
<p>Ansible collections</p>
</li>
<li>
<p>Additional system packages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">version</span><span class="pi">:</span> <span class="m">1</span>
<span class="na">dependencies</span><span class="pi">:</span>
  <span class="na">galaxy</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">https://github.com/os-migrate/os-migrate</span>
  <span class="na">python</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">openstacksdk&gt;=1.0.0</span>
    <span class="pi">-</span> <span class="s">ansible&gt;=6.0.0</span>
  <span class="na">system</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">git</span>
    <span class="pi">-</span> <span class="s">openssh-clients</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_aee_images"><a class="anchor" href="#_customizing_aee_images"></a><a class="link" href="#_customizing_aee_images">3.5.2. Customizing AEE Images</a></h4>
<div class="paragraph">
<p>To customize AEE images for specific requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the <code>execution-environment.yml</code> file</p>
</li>
<li>
<p>Add custom requirements or collections</p>
</li>
<li>
<p>Rebuild the image using ansible-builder</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-builder build <span class="nt">--tag</span> custom-aee:latest</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a><a class="link" href="#_troubleshooting">3.6. Troubleshooting</a></h3>
<div class="sect3">
<h4 id="_secrets_and_variables_issues"><a class="anchor" href="#_secrets_and_variables_issues"></a><a class="link" href="#_secrets_and_variables_issues">3.6.1. Secrets and Variables Issues</a></h4>
<div class="sect4">
<h5 id="_common_secret_configuration_problems"><a class="anchor" href="#_common_secret_configuration_problems"></a><a class="link" href="#_common_secret_configuration_problems">Common Secret Configuration Problems</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Secret Not Found</strong></dt>
<dd>
<p>Ensure the secret is created at the correct level (repository, environment, or organization) and the name matches exactly in the workflow.</p>
</dd>
<dt class="hdlist1"><strong>Permission Denied</strong></dt>
<dd>
<p>Verify that the workflow has access to the environment containing the secrets. Check environment protection rules and required reviewers.</p>
</dd>
<dt class="hdlist1"><strong>Empty Secret Value</strong></dt>
<dd>
<p>Secrets that are not set return empty strings. Always validate secret existence before use.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Validate Required Secrets</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">if [ -z "${{ secrets.REGISTRY_USERNAME }}" ]; then</span>
      <span class="s">echo " REGISTRY_USERNAME secret is not configured"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span>

    <span class="s">if [ -z "${{ secrets.REGISTRY_PASSWORD }}" ]; then</span>
      <span class="s">echo " REGISTRY_PASSWORD secret is not configured"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span>

    <span class="s">echo " All required secrets are available"</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_variable_access_issues"><a class="anchor" href="#_variable_access_issues"></a><a class="link" href="#_variable_access_issues">Variable Access Issues</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Variable Not Defined</strong></dt>
<dd>
<p>Check that variables are created at the appropriate level and use the correct context (<code>vars</code> for variables, <code>secrets</code> for secrets).</p>
</dd>
<dt class="hdlist1"><strong>Wrong Variable Context</strong></dt>
<dd>
<p>Use <code>${{ vars.VARIABLE_NAME }}</code> for variables and <code>${{ secrets.SECRET_NAME }}</code> for secrets.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Debug Variable Access</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">echo "Repository variables:"</span>
    <span class="s">echo "  IMAGE_NAME: ${{ vars.IMAGE_NAME }}"</span>
    <span class="s">echo "  BUILD_CONTEXT: ${{ vars.BUILD_CONTEXT }}"</span>

    <span class="s">echo "Environment variables:"</span>
    <span class="s">echo "  IMAGE_TAG: ${{ vars.IMAGE_TAG }}"</span>
    <span class="s">echo "  REGISTRY_URL: ${{ vars.REGISTRY_URL }}"</span>

    <span class="s">echo "Organization variables:"</span>
    <span class="s">echo "  DEFAULT_REGISTRY: ${{ vars.DEFAULT_REGISTRY }}"</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_registry_authentication_troubleshooting"><a class="anchor" href="#_registry_authentication_troubleshooting"></a><a class="link" href="#_registry_authentication_troubleshooting">Registry Authentication Troubleshooting</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Authentication Failed</strong></dt>
<dd>
<p>Verify credentials are correct and have appropriate permissions for the registry.</p>
</dd>
<dt class="hdlist1"><strong>Token Expired</strong></dt>
<dd>
<p>Check if the registry token has expired and needs renewal.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test Registry Authentication</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">echo "Testing authentication to ${{ vars.DEFAULT_REGISTRY }}"</span>

    <span class="s"># Test login without pushing</span>
    <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
      <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
      <span class="s">--password-stdin \</span>
      <span class="s">${{ vars.DEFAULT_REGISTRY }} --test</span>

    <span class="s">if [ $? -eq 0 ]; then</span>
      <span class="s">echo " Registry authentication successful"</span>
    <span class="s">else</span>
      <span class="s">echo " Registry authentication failed"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_debugging_aee_issues"><a class="anchor" href="#_debugging_aee_issues"></a><a class="link" href="#_debugging_aee_issues">3.6.2. Debugging AEE Issues</a></h4>
<div class="paragraph">
<p>Enable verbose output for troubleshooting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">podman run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/runner <span class="se">\</span>
  os-migrate:latest <span class="se">\</span>
  ansible-playbook <span class="nt">-vvv</span> <span class="nt">-i</span> inventory playbook.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check container logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">podman logs &lt;container_id&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_performance_optimization"><a class="anchor" href="#_performance_optimization"></a><a class="link" href="#_performance_optimization">3.6.3. Performance Optimization</a></h4>
<div class="ulist">
<ul>
<li>
<p>Use volume mounts instead of copying files into containers</p>
</li>
<li>
<p>Mount only necessary directories to reduce I/O overhead</p>
</li>
<li>
<p>Consider using read-only mounts where possible</p>
</li>
<li>
<p>Use appropriate resource limits for container execution</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maintenance"><a class="anchor" href="#_maintenance"></a><a class="link" href="#_maintenance">3.7. Maintenance</a></h3>
<div class="sect3">
<h4 id="_updating_aee_images"><a class="anchor" href="#_updating_aee_images"></a><a class="link" href="#_updating_aee_images">3.7.1. Updating AEE Images</a></h4>
<div class="paragraph">
<p>Regular updates ensure security and compatibility:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update base images in execution environment definitions</p>
</li>
<li>
<p>Update Ansible collections to latest versions</p>
</li>
<li>
<p>Update Python dependencies</p>
</li>
<li>
<p>Rebuild and test AEE images</p>
</li>
<li>
<p>Update documentation with any changes</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_version_management"><a class="anchor" href="#_version_management"></a><a class="link" href="#_version_management">3.7.2. Version Management</a></h4>
<div class="paragraph">
<p>The automated GitHub Actions workflows handle version management based on Git references:</p>
</div>
<div class="sect4">
<h5 id="_manual_version_management"><a class="anchor" href="#_manual_version_management"></a><a class="link" href="#_manual_version_management">Manual Version Management</a></h5>
<div class="paragraph">
<p>For local development, you can manually tag images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Build specific version locally</span>
ansible-builder build <span class="nt">--tag</span> os-migrate:1.2.3

<span class="c"># Build latest development version</span>
ansible-builder build <span class="nt">--tag</span> os-migrate:latest</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_automated_version_management"><a class="anchor" href="#_automated_version_management"></a><a class="link" href="#_automated_version_management">Automated Version Management</a></h5>
<div class="paragraph">
<p>The GitHub Actions workflows automatically handle versioning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Main branch pushes</strong>  <code>latest</code> tag</p>
</li>
<li>
<p><strong>Tag pushes</strong>  version-specific tag + <code>stable</code> tag</p>
</li>
<li>
<p><strong>Pull requests</strong>  build and test only (no registry push)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_creating_releases"><a class="anchor" href="#_creating_releases"></a><a class="link" href="#_creating_releases">Creating Releases</a></h5>
<div class="paragraph">
<p>To create a new release:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create and push a Git tag:
[source,bash]
----
git tag -a 1.2.3 -m "Release version 1.2.3"
git push origin 1.2.3
----</p>
</li>
<li>
<p>The GitHub Actions workflow will automatically:</p>
<div class="ulist">
<ul>
<li>
<p>Build the AEE image</p>
</li>
<li>
<p>Tag it with <code>1.2.3</code> and <code>stable</code></p>
</li>
<li>
<p>Push to the configured registry</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_version_tag_strategy"><a class="anchor" href="#_version_tag_strategy"></a><a class="link" href="#_version_tag_strategy">Version Tag Strategy</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>latest</code> - Development builds from main branch</p>
</li>
<li>
<p><code>stable</code> - Latest tagged release (production-ready)</p>
</li>
<li>
<p><code>1.2.3</code> - Specific version</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_considerations"><a class="anchor" href="#_security_considerations"></a><a class="link" href="#_security_considerations">3.7.3. Security Considerations</a></h4>
<div class="ulist">
<ul>
<li>
<p>Regularly update base images to include security patches</p>
</li>
<li>
<p>Scan AEE images for vulnerabilities</p>
</li>
<li>
<p>Use minimal base images when possible</p>
</li>
<li>
<p>Review and audit all included dependencies</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_best_practices"><a class="anchor" href="#_best_practices"></a><a class="link" href="#_best_practices">3.8. Best Practices</a></h3>
<div class="sect3">
<h4 id="_development_workflow"><a class="anchor" href="#_development_workflow"></a><a class="link" href="#_development_workflow">3.8.1. Development Workflow</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Test changes locally using AEE containers</p>
</li>
<li>
<p>Use version-controlled execution environment definitions</p>
</li>
<li>
<p>Document any customizations or modifications</p>
</li>
<li>
<p>Test AEE images in target environments before deployment</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_production_usage"><a class="anchor" href="#_production_usage"></a><a class="link" href="#_production_usage">3.8.2. Production Usage</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use specific version tags instead of <code>latest</code></p>
</li>
<li>
<p>Implement proper monitoring and logging</p>
</li>
<li>
<p>Regular security updates and vulnerability scanning</p>
</li>
<li>
<p>Backup and disaster recovery planning</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_documentation"><a class="anchor" href="#_documentation"></a><a class="link" href="#_documentation">3.8.3. Documentation</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Keep execution environment definitions well-documented</p>
</li>
<li>
<p>Document any custom modifications or extensions</p>
</li>
<li>
<p>Provide clear usage examples and troubleshooting guides</p>
</li>
<li>
<p>Maintain compatibility matrices for different versions</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_todo"><a class="anchor" href="#_todo"></a><a class="link" href="#_todo">3.9. TODO</a></h3>
<div class="sect3">
<h4 id="_collection_installation_improvements"><a class="anchor" href="#_collection_installation_improvements"></a><a class="link" href="#_collection_installation_improvements">3.9.1. Collection Installation Improvements</a></h4>
<div class="paragraph">
<p>Improve the way collections (os-migrate or vmware-migration-kit) are installed within AEE images to ensure proper version alignment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Main branch builds</strong>: When the image tag is <code>main</code>, install the collection content directly from the main branch repository as the source of installation using Git-based requirements</p>
</li>
<li>
<p><strong>Stable/tagged builds</strong>: When the image tag is <code>stable</code> or matches a repository tag, ensure the installation uses the corresponding tagged version of the collection from Ansible Galaxy</p>
</li>
<li>
<p><strong>Dynamic requirements.yml</strong>: Implement automated generation of <code>requirements.yml</code> files based on build context to ensure proper collection versioning</p>
</li>
<li>
<p><strong>Version consistency validation</strong>: Add build-time checks to verify that AEE image tags match the collection versions they contain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This improvement will ensure that AEE images always contain the correct version of the collection that matches the build context and tag strategy, providing better reproducibility and version alignment.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="os-migrate-performance-expectations_planning"><a class="anchor" href="#os-migrate-performance-expectations_planning"></a><a class="link" href="#os-migrate-performance-expectations_planning">4. VMware to OpenStack OS Migrate Performance Expectations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document outlines some performance expectations for VMware to OpenStack transfers via the os-migrate tooling.
For the purposes of the these metrics, we are considering the following hardware for a Conversion Host:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>6 vCPU</p>
</li>
<li>
<p>8GB RAM</p>
</li>
<li>
<p>20GB disk unless otherwise stated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>All of the below metrics apply to VMware to OpenStack via the Ansible Automation Platform</em></p>
</div>
<div class="sect2">
<h3 id="_table_1"><a class="anchor" href="#_table_1"></a><a class="link" href="#_table_1">4.1. Table 1</a></h3>
<div class="paragraph">
<p>Time of execution to completion including instance boot &amp; ping for RHEL machines in our lab.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VMs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conversion Hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 minutes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Note</strong>: The average time for 1 virtual machine is around 2 minutes. The migration can be parallelized on the same conversion host (threads) or on multiple conversion hosts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_table_2"><a class="anchor" href="#_table_2"></a><a class="link" href="#_table_2">4.2. Table 2</a></h3>
<div class="paragraph">
<p>Time for RHEL machines with a larger disk for a full migration run with and without CBT<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CBT enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time total</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cutover time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expected downtime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7 minutes</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 minutes 30 secondes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9 minutes 30 secondes</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9 minutes 30 secondes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">300 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">300 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15 minutes</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 TB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">39 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 minutes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 TB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35 minutes</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35 minutes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Note 1</strong>: The disks are 99% full of random data during the test.</p>
</div>
<div class="paragraph">
<p><strong>Note 2</strong>: The CBT option takes a bit more time overall but the downtime is actually lower due to the smaller data cutover time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_table_3"><a class="anchor" href="#_table_3"></a><a class="link" href="#_table_3">4.3. Table 3</a></h3>
<div class="paragraph">
<p>Example of a Migration plan for 55 VMs with 200 GB of disk full. <em>(estimation)</em></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disk size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conversion Hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CBT enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Migration time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">115 minutes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">105 minutes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110 minutes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For this example, the best plan is to parallelize the migration on a single Conversion Host to 5 threads and use the CBT option to pre-migrate the volume data; this will shortern the cutover time (2 minutes in our lab environment), reducing the downtime overall.</p>
</div>
</div>
<div class="sect2">
<h3 id="_table_4"><a class="anchor" href="#_table_4"></a><a class="link" href="#_table_4">4.4. Table 4</a></h3>
<div class="paragraph">
<p>Migration of 1500 VMs: Time for RHEL machines in our lab with a disk capacity of 20GB, with a full migration run which comprises of migration of data, conversion and instance creation, boot time, and ability to ping.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VMs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conversion Hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60 minutes (without the preparation steps)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 hours</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Note 1</strong>: The conversion flavor was set to: <strong>12GB of RAM and 6 vcpus</strong> which allow OS-Migrate to comfortably run 6 migrations in parallel on the same host. There is space to execute more parallel migrations with this configuration but it&#8217;s a best practice to let 2GB of RAM and 1 CPU for each migration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conversion_host_requirements_and_recommendations"><a class="anchor" href="#_conversion_host_requirements_and_recommendations"></a><a class="link" href="#_conversion_host_requirements_and_recommendations">4.5. Conversion host requirements and recommendations</a></h3>
<div class="paragraph">
<p>Recommended guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>For 1 migration allocate 2GB of RAM and 1 vCPU on your Conversion Host</strong></p>
</li>
<li>
<p>RHEL 9.5 or CentOS 10 to benefit from the latest drivers (virtio-win) to convert the recent Windows distributions.</p>
</li>
<li>
<p>Fedora (38 and +) if you want to convert btrfs file system</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_proceed_with_a_large_workload"><a class="anchor" href="#_how_to_proceed_with_a_large_workload"></a><a class="link" href="#_how_to_proceed_with_a_large_workload">4.6. How to proceed with a large workload</a></h3>
<div class="paragraph">
<p>It&#8217;s important to first focus on sizing your target OpenStack environment adequately. It will of course receive large numbers of instances, ports, volumes, floating ips and all the OpenStack resources that the instances will require. So set the OpenStack quotas with the correct values.</p>
</div>
<div class="paragraph">
<p>Second you need to split your workload regarding the number of conversion hosts you will create.</p>
</div>
<div class="paragraph">
<p>For example, with a workload of 1000 VMs, you can use two conversion hosts which will run the migration in parallel and execute 5 or 6 migrations simultaneously on each conversion host.</p>
</div>
<div class="paragraph">
<p>If you followed the requirements for the conversion host above, the migration time will be linear:</p>
</div>
<div class="paragraph">
<p>If 1 virtual machine takes 5 minutes to be migrated then the 1000 Vms will take:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>5*1000/12 (where 12 is 6 parallel migrations x 2 conversion hosts): 6 hours and 56 minutes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The more you divide your workload, the faster you will move it to OpenStack.</p>
</div>
<div class="paragraph">
<p>In the example above, if we decide to add 2 more conversion hosts then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>5*1000/24 = 3h and 28 minutes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, some known issues we have seen may happen during a large-scale migration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, when the conversion hosts are too solicited. For example, a single conversion host which has performed more than 5 000 of migrations in a very short time may have some issues with the device mount mechanism in the OS itself.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When this behavior appears, sometimes just a reboot might help to clean the /dev/ devices.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Another issue may appear on the Vmware side with the message "snapshot hierarchy is too deep" because OS-Migrate is working with Snapshot. If this error appears, then clean the guest snapshots hierarchy and re-run the migration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note 1</strong> - Make sure all the OpenStack services are configured to support a large amount of requests. OS-Migrate is driven by Ansible but the core of the migration is a binary which does not consume a lot of resources. So the more you use the binary, the more the OpenStack Api will receive requests. For example Rabbitmq, Galera and also Nova or Cinder will be impacted.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_community"><a class="anchor" href="#_community"></a><a class="link" href="#_community">5. Community</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/os-migrate/os-migrate">source code of OS Migrate</a>
is hosted on GitHub.</p>
</div>
<div class="paragraph">
<p>For issue reports please use the GitHub
<a href="https://github.com/os-migrate/os-migrate/issues">OS Migrate issue tracker</a>.</p>
</div>
<div class="paragraph">
<p>To get help, feel free to also create an
<a href="https://github.com/os-migrate/os-migrate/issues">issue</a>
on GitHub with your question.</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. CBT = <a href="https://knowledge.broadcom.com/external/article/320557/changed-block-tracking-cbt-on-virtual-ma.html" class="bare">https://knowledge.broadcom.com/external/article/320557/changed-block-tracking-cbt-on-virtual-ma.html</a>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-10-24 08:00:04 -0400
</div>
</div>
</body>
</html>