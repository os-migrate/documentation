<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>OS Migrate Developer Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<link rel="stylesheet" href="../assets/css/toc-fold.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>OS Migrate Developer Documentation</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_architecture_and_design">Architecture and Design</a></li>
<li><a href="#_os_migrate_design">OS Migrate Design</a>
<ul class="sectlevel2">
<li><a href="#_high_level_development_goals">High-level development goals</a></li>
<li><a href="#_challenges_of_the_problem_domain">Challenges of the problem domain</a></li>
<li><a href="#_basic_ansible_workflow_design">Basic Ansible workflow design</a></li>
<li><a href="#_misc">Misc</a></li>
</ul>
</li>
<li><a href="#_development_environment">Development Environment</a></li>
<li><a href="#_development_environment_setup">Development Environment Setup</a>
<ul class="sectlevel2">
<li><a href="#_prerequisites">Prerequisites</a></li>
<li><a href="#_running_e2e_tests">Running e2e tests</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites_for_e2e_test">Prerequisites for e2e test</a></li>
<li><a href="#_create_source_environment_and_destination_environment_projects_and_users">Create source environment and destination environment projects and users</a></li>
<li><a href="#_create_images">Create images</a></li>
<li><a href="#_create_flavors">Create flavors</a></li>
<li><a href="#_create_public_network">Create public network</a></li>
<li><a href="#_sample_e2e_config_yaml_using_the_above_prerequisites">Sample e2e config yaml using the above prerequisites</a></li>
<li><a href="#_run_e2e_test_using_the_os_migrate_toolbox_and_the_above_config">Run e2e test using the OS Migrate toolbox and the above config</a></li>
<li><a href="#_expected_output_from_successful_e2e_test_run">Expected output from successful e2e test run</a></li>
<li><a href="#_optional_tags_to_pass_to_e2e_tests">Optional tags to pass to e2e tests</a></li>
<li><a href="#_optional_playbook_variable">Optional playbook variable</a></li>
<li><a href="#_environment_variables">Environment variables</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_installing_vagrant_directly_on_host_alternative_path">Installing Vagrant directly on host (alternative path)</a></li>
<li><a href="#_cicd_and_automation">CI/CD and Automation</a></li>
<li><a href="#_github_actions_documentation_for_os_migrate_repositories">GitHub Actions Documentation for os-migrate Repositories</a>
<ul class="sectlevel2">
<li><a href="#_os_migrateos_migrate">.1. os-migrate/os-migrate</a>
<ul class="sectlevel3">
<li><a href="#_existing_github_actions">.1.1. Existing GitHub Actions</a></li>
</ul>
</li>
<li><a href="#_os_migratevmware_migration_kit">.2. os-migrate/vmware-migration-kit</a>
<ul class="sectlevel3">
<li><a href="#_existing_github_actions_2">.2.1. Existing GitHub Actions</a></li>
</ul>
</li>
<li><a href="#_how_to_add_a_new_github_action">.3. How to Add a New GitHub Action</a>
<ul class="sectlevel3">
<li><a href="#_see_also">.3.1. See Also</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_contributing_guidelines">1. Contributing Guidelines</a></li>
<li><a href="#_general_contribution_guidelines">2. General Contribution Guidelines</a>
<ul class="sectlevel2">
<li><a href="#_commit_messages_for_changelog">2.1. Commit Messages for Changelog</a>
<ul class="sectlevel3">
<li><a href="#_format">2.1.1. Format</a></li>
<li><a href="#_keeping_changelog_clean">2.1.2. Keeping Changelog Clean</a></li>
<li><a href="#_summary_first_line">2.1.3. Summary (First Line)</a></li>
<li><a href="#_message_body">2.1.4. Message Body</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_contributing_code">3. Contributing Code</a>
<ul class="sectlevel2">
<li><a href="#_adding_a_new_role">3.1. Adding a New Role</a>
<ul class="sectlevel3">
<li><a href="#_creating_the_role_skeleton_automatically">3.1.1. Creating the role skeleton automatically</a></li>
<li><a href="#_resources">3.1.2. Resources</a></li>
<li><a href="#_export_roles">3.1.3. Export Roles</a></li>
<li><a href="#_import_roles">3.1.4. Import Roles</a></li>
</ul>
</li>
<li><a href="#_writing_tests">3.2. Writing Tests</a>
<ul class="sectlevel3">
<li><a href="#_functional_tests">3.2.1. Functional Tests</a></li>
<li><a href="#_unit_tests">3.2.2. Unit Tests</a></li>
<li><a href="#_integration_tests">3.2.3. Integration Tests</a></li>
<li><a href="#_documentation_and_examples">3.2.4. Documentation and Examples</a></li>
<li><a href="#_test_execution_in_ci">3.2.5. Test Execution in CI</a></li>
<li><a href="#_review_and_inspection">3.2.6. Review and Inspection</a></li>
<li><a href="#_location_of_tests">3.2.7. Location of Tests</a></li>
<li><a href="#_special_considerations">3.2.8. Special Considerations</a></li>
<li><a href="#_necessary_documentation">3.2.9. Necessary Documentation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_contributing_documentation">4. Contributing Documentation</a>
<ul class="sectlevel2">
<li><a href="#_rendering_the_documentation">4.1. Rendering the Documentation</a></li>
</ul>
</li>
<li><a href="#_creating_new_go_based_ansible_modules">5. Creating New Go-based Ansible Modules</a>
<ul class="sectlevel2">
<li><a href="#_1_introduction_to_go_based_ansible_modules">5.1. 1. Introduction to Go-based Ansible Modules</a></li>
<li><a href="#_2_project_structure_for_go_modules">5.2. 2. Project Structure for Go Modules</a></li>
<li><a href="#_3_step_by_step_development_guide">5.3. 3. Step-by-Step Development Guide</a>
<ul class="sectlevel3">
<li><a href="#_3_1_create_the_directory_and_files">5.3.1. 3.1. Create the Directory and Files</a></li>
<li><a href="#_3_2_write_the_go_module_code">5.3.2. 3.2. Write the Go Module Code</a></li>
<li><a href="#_3_3_create_the_python_documentation_file">5.3.3. 3.3. Create the Python Documentation File</a></li>
<li><a href="#_3_4_build_the_module_binary">5.3.4. 3.4. Build the Module Binary</a></li>
</ul>
</li>
<li><a href="#_4_handling_ci_sanity_tests">5.4. 4. Handling CI Sanity Tests</a>
<ul class="sectlevel3">
<li><a href="#_4_1_bypassing_ansible_test_sanity_for_go_source">5.4.1. 4.1. Bypassing <code>ansible-test sanity</code> for Go Source</a></li>
<li><a href="#_4_2_ignoring_the_gplv3_license_check">5.4.2. 4.2. Ignoring the GPLv3 License Check</a></li>
</ul>
</li>
<li><a href="#_5_contribution_workflow">5.5. 5. Contribution Workflow</a></li>
</ul>
</li>
<li><a href="#_release_management">6. Release Management</a></li>
<li><a href="#_releasing_the_os_migrate_collection">7. Releasing the OS Migrate collection</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_architecture_and_design"><a class="anchor" href="#_architecture_and_design"></a><a class="link" href="#_architecture_and_design">Architecture and Design</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_os_migrate_design"><a class="anchor" href="#_os_migrate_design"></a><a class="link" href="#_os_migrate_design">OS Migrate Design</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_high_level_development_goals"><a class="anchor" href="#_high_level_development_goals"></a><a class="link" href="#_high_level_development_goals">High-level development goals</a></h3>
<div class="ulist">
<ul>
<li>
<p>I/O-based. Fetch metadata and/or content from source cloud &#8594; write
them as outputs &#8594; read them as inputs &#8594; push it to the destination
cloud. This allows other tools to enter the phase between the "write
output" and "read input".</p>
<div class="ulist">
<ul>
<li>
<p>E.g. arbitrary/custom yaml-parsing tools can be used as a smart
filter to analyze the exported contents from source cloud and
choose what (not) to import into the destination cloud.</p>
</li>
<li>
<p>Sometimes (e.g. in workload migration) only metadata may be
written out and editable on the migrator machine, and the actual
binary data is transferred in a direct path between the clouds
for performance reasons.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logging. When contributing code, don&#8217;t forget about logging and how
will information be presented to the user. Try to think about what
can potentially fail and what kind of log output might help figuring
out what went wrong, and on the contrary, what kind of log output
would add clutter without much information value.</p>
</li>
<li>
<p>Testing. Unit-test semantics of small parts wherever possible.
Emphasize automated functional tests (end-to-end, talking to a real
OpenStack backend). Functional tests are closest to the real use
cases and provide at least basic level of comfort that the software
does what it should.</p>
<div class="ulist">
<ul>
<li>
<p>Avoid excessive mocking in unit tests. Focus on writing unit
tests for self-contained (pure) functions/methods, and structure
the code so that as much as possible is written as pure
functions/methods. When this is not possible, consider writing
functional/end-to-end tests instead of unit tests.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Always talking to OpenStack via API. The tool must be able to be
deployed externally to both source and destination clouds. No looking
at DBs or other hacks. If we hit a hurdle due to no-hacks approach,
it could mean that OpenStack&#8217;s capabilities for tenant-to-tenant
content migration are lacking, and an RFE for OpenStack might be
required.</p>
</li>
<li>
<p>Idempotency where possible. When a command fails, it should be
possible to retry with the same command.</p>
</li>
<li>
<p>Whenever simplicity / understandability / clarity gets into conflict
with convenience / ease-of-use, we prefer simplicity /
understandability / clarity.</p>
<div class="ulist">
<ul>
<li>
<p>Prefer running several CLI commands to do something where each
command is simple and human can enter the process by amending
inputs/outputs e.g. with additional tools or a text editor,
rather than one magical command which aims to satisfy all use
cases and eventually turns out to satisfy very few, and tends to
fail in mysterious ways with partial completion and limited
re-runnability.</p>
</li>
</ul>
</div>
</li>
<li>
<p>OS Migrate is intended to be a building block for tenant migrations
rather than a push-button solution. The assumption is that to cover
needs of a particular tenant migration, a knowledgeable human is
running OS Migrate manually and/or has tweaked it to their needs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_challenges_of_the_problem_domain"><a class="anchor" href="#_challenges_of_the_problem_domain"></a><a class="link" href="#_challenges_of_the_problem_domain">Challenges of the problem domain</a></h3>
<div class="ulist">
<ul>
<li>
<p>Generally, admins can view resources of all projects, but cannot
create resources in those projects (unless they have a role in the
project). To create a resource under a project, either credentials of
the target non-admin user have to be used for importing, or the admin
user has to be added into the project for the duration of the import.</p>
<div class="ulist">
<ul>
<li>
<p>This is not true for <strong>some</strong> resources. As of January 2020,
e.g. networking resources can be created under arbitrary
domain/project by admin using Networking API v2, but it&#8217;s not the
case for e.g. volumes, servers, keypairs. At least initially, we
will assume the general scenario that we&#8217;re running the migration
as the tenant who owns the resources on both src/dst sides.</p>
</li>
</ul>
</div>
</li>
<li>
<p>OpenStack doesn&#8217;t have strict requirements on resource naming
(doesn&#8217;t require non-empty, unique names). The migration tool will
enforce names which are non-empty, and unique per resource type. This
is to allow idempotent imports, which is necessary for retrying
imports on failure. The tool should allow to export/serialize
resources that are not properly named, but the exported data should
fail validation and be refused when fed into the import command.</p>
<div class="ulist">
<ul>
<li>
<p>In the future, if we implement running all migrations as admin
(might need OpenStack RFEs) instead of the tenant, we&#8217;d perhaps
require uniqueness per resource type per tenant, rather than just
per resource type.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_basic_ansible_workflow_design"><a class="anchor" href="#_basic_ansible_workflow_design"></a><a class="link" href="#_basic_ansible_workflow_design">Basic Ansible workflow design</a></h3>
<div class="ulist">
<ul>
<li>
<p>The challenge and a goal here is to give meaningful Ansible log
output for debugging. This means, for example, that we shouldn&#8217;t have
a single Ansible task (one module call) to export/import the whole
tenant, and we should also consider not having a single task to
export/import all resources of some type. Ideally, each resource
export/import would have its own module call (own task in Ansible
playbook), so if the export or import fails, we can easily tell which
resource was the one that caused a failure.</p>
<div class="ulist">
<ul>
<li>
<p>We have a YAML file per resource type. Export modules are able to
add a resource (idempotently) to an existing YAML file without
affecting the rest. There is reusable code for this idempotence.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example workflow: export networks. Provided playbook.</p>
<div class="ulist">
<ul>
<li>
<p>Ansible task, provided: fetch metadata (at least name and ID, but
perhaps the more the better for advanced filtering) of all
networks that are visible for the tenant, register a list
variable.</p>
</li>
<li>
<p>Ansible task(s) optionally added by user into our playbook on
per-environment basis: filter the metadata according to custom
needs, re-register the list var.</p>
<div class="ulist">
<ul>
<li>
<p>Eventually we may want to provide some hooks here, but
initially we&#8217;d be fine with users simply editing the provided
playbook.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ansible task, provided: filter networks by names, either via exact
matches or via regexes.</p>
</li>
<li>
<p>Anisble task, provided, calling our custom module: Iterate
(<code>loop</code>) over the list of metadata, and call our module which
will fetch the data and write a YAML with our defined format for
Network resources. If necessary, do any data mangling here to
satisfy the format requirements.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example workflow: transform networks.</p>
<div class="ulist">
<ul>
<li>
<p>Initially we will not provide any tooling here, but at this point
the user should have a YAML file (or a bunch of them) with the
serialized resources. They can use any automation (Ansible, yq,
sed, â€¦) to go through them and edit as they please before
importing.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example workflow: import networks. Provided playbook.</p>
<div class="ulist">
<ul>
<li>
<p>Ansible task, provided: read the serialized YAML networks into
memory, register a list variable.</p>
</li>
<li>
<p>Anisble task, provided: Iterate (<code>loop</code>) over the list of
networks, and call an Ansible module to create each network. We&#8217;ll
want to create our own module here to deal with our file format
specifics, but underneath we may be calling the community
OpenStack Ansible module if that proves helpful.</p>
</li>
</ul>
</div>
</li>
<li>
<p>We may want to consider using <code>tags</code> on our tasks to allow some
sub-executions. However, it may be that chunking up the code and
using <code>import_playbook</code> might be more clear and safe to use than
<code>tags</code> in many cases. If we do happen to add <code>tags</code>, they
shouldn&#8217;t be added wildly, use cases should be thought through and
documented for both users and developers. Tags need clarity and
disciplined use in order to be helpful.</p>
<div class="ulist">
<ul>
<li>
<p>The above talks about tags in end-user code. We do use tags in
our test suites, and it&#8217;s much less sensitive there as we can
change those tags any time without breaking user expectations.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_misc"><a class="anchor" href="#_misc"></a><a class="link" href="#_misc">Misc</a></h3>
<div class="ulist">
<ul>
<li>
<p>Naming conventions - <a href="https://github.com/ansible/galaxy/issues/1128#issuecomment-454519526">underscores rather than hyphens in Ansible</a>.</p>
<div class="ulist">
<ul>
<li>
<p>Github does not support underscores in organization URLs though.
So we have repo named os-migrate/os-migrate, and inside we have
os_migrate Ansible collection.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Distribution - the preference is to distribute os-migrate via Ansible
Galaxy.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_environment"><a class="anchor" href="#_development_environment"></a><a class="link" href="#_development_environment">Development Environment</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_development_environment_setup"><a class="anchor" href="#_development_environment_setup"></a><a class="link" href="#_development_environment_setup">Development Environment Setup</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a><a class="link" href="#_prerequisites">Prerequisites</a></h3>
<div class="ulist">
<ul>
<li>
<p>Local clone of the os-migrate git repo from
<a href="https://github.com/os-migrate/os-migrate" class="bare">https://github.com/os-migrate/os-migrate</a></p>
</li>
<li>
<p><a href="https://podman.io/">Podman</a> and <a href="https://buildah.io/">Buildah</a>
for running rootless development environment containers.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_running_e2e_tests"><a class="anchor" href="#_running_e2e_tests"></a><a class="link" href="#_running_e2e_tests">Running e2e tests</a></h3>
<div class="paragraph">
<p>OS Migrate also has a suite of end to end, e2e, tests which tests a migration from one existing openstack deployment
to another existing openstack deployment.</p>
</div>
<div class="paragraph">
<p>You can also test with a single existing openstack deployment migrating from one project to another.</p>
</div>
<div class="paragraph">
<p>These docs cover the testing of a single existing openstack deployment migrating from one project to another scenario.</p>
</div>
<div class="paragraph">
<p>The concepts and prerequisites are the same for other deployments.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_for_e2e_test"><a class="anchor" href="#_prerequisites_for_e2e_test"></a><a class="link" href="#_prerequisites_for_e2e_test">Prerequisites for e2e test</a></h4>
<div class="ulist">
<ul>
<li>
<p>Source environment credentials</p>
</li>
<li>
<p>Destination environment credentials</p>
</li>
<li>
<p>Existing images in both source and destination environments</p>
</li>
<li>
<p>Flavors</p>
</li>
<li>
<p>Public network</p>
</li>
<li>
<p>Space requirements</p>
<div class="ulist">
<ul>
<li>
<p>2 images totalling 1.25 GB</p>
</li>
<li>
<p>1 volume totalling 1 GB in source environment</p>
</li>
<li>
<p>2 volumes totalling 6 GB in destination environment</p>
</li>
<li>
<p>2 VMs totalling 35 GB disk usage in each environment</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Below are the steps required to satisfy the above requirements and run e2e tests in a test environment, migrating
resources from one project to another.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_source_environment_and_destination_environment_projects_and_users"><a class="anchor" href="#_create_source_environment_and_destination_environment_projects_and_users"></a><a class="link" href="#_create_source_environment_and_destination_environment_projects_and_users">Create source environment and destination environment projects and users</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Create the src user in the default domain with password 'redhat'</span>
openstack user create <span class="nt">--domain</span> default <span class="nt">--password</span> redhat src

<span class="c"># Create the src project</span>
openstack project create <span class="nt">--domain</span> default src

<span class="c"># Assign src user a 'member' role in the src project</span>
openstack role add <span class="se">\</span>
<span class="nt">--user</span> src <span class="nt">--user-domain</span> default <span class="se">\</span>
<span class="nt">--project</span> src <span class="nt">--project-domain</span> default member

<span class="c"># Confirm role assignment was successful</span>
openstack role assignment list <span class="nt">--project</span> src

<span class="c"># Create the dst user in the default domain with password 'redhat'</span>
openstack user create <span class="nt">--domain</span> default <span class="nt">--password</span> redhat dst

<span class="c"># Create the dst project</span>
openstack project create <span class="nt">--domain</span> default dst

<span class="c"># Assign dst user a 'member' role in the src project</span>
openstack role add <span class="se">\</span>
<span class="nt">--user</span> dst <span class="nt">--user-domain</span> default <span class="se">\</span>
<span class="nt">--project</span> dst <span class="nt">--project-domain</span> default member

<span class="c"># Confirm role assignment was successful</span>
openstack role assignment list <span class="nt">--project</span> dst</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_images"><a class="anchor" href="#_create_images"></a><a class="link" href="#_create_images">Create images</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Download images</span>
wget https://cloud.centos.org/centos/9-stream/x86_64/images/CentOS-Stream-GenericCloud-9-20230704.1.x86_64.qcow2
wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img

<span class="c"># Create images in glance from these downloads</span>
openstack image create <span class="nt">--public</span> <span class="nt">--disk-format</span> qcow2 <span class="nt">--file</span> <span class="se">\</span>
    CentOS-Stream-GenericCloud-9-20230704.1.x86_64.qcow2 CentOS-Stream-GenericCloud-9-20230704.1.x86_64.qcow2
openstack image create <span class="nt">--public</span> <span class="nt">--disk-format</span> raw <span class="nt">--file</span> cirros-0.4.0-x86_64-disk.img cirros-0.4.0-x86_64-disk.img</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_flavors"><a class="anchor" href="#_create_flavors"></a><a class="link" href="#_create_flavors">Create flavors</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">openstack flavor create <span class="nt">--public</span> <span class="se">\</span>
<span class="nt">--ram</span> 256 <span class="nt">--disk</span> 5 <span class="nt">--vcpus</span> 1 <span class="nt">--rxtx-factor</span> 1 m1.xtiny

openstack flavor create <span class="nt">--public</span> <span class="se">\</span>
<span class="nt">--ram</span> 2048 <span class="nt">--disk</span> 30 <span class="nt">--vcpus</span> 2 <span class="nt">--rxtx-factor</span> 1 m1.large</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_public_network"><a class="anchor" href="#_create_public_network"></a><a class="link" href="#_create_public_network">Create public network</a></h4>
<div class="paragraph">
<p>If your OpenStack environment doesn&#8217;t have a public network created
yet, you&#8217;ll need to create one. The parameters below should work if
you&#8217;re deploying your OpenStack environment with Infrared Virsh
plugin. If you deployed using something else, you may need to adjust
the parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">openstack network create <span class="se">\</span>
     <span class="nt">--mtu</span> 1500 <span class="se">\</span>
     <span class="nt">--external</span> <span class="se">\</span>
     <span class="nt">--provider-network-type</span> flat <span class="se">\</span>
     <span class="nt">--provider-physical-network</span> datacentre <span class="se">\</span>
     public

openstack subnet create <span class="se">\</span>
    <span class="nt">--network</span> public <span class="se">\</span>
    <span class="nt">--gateway</span> 10.0.0.1 <span class="se">\</span>
    <span class="nt">--subnet-range</span> 10.0.0.0/24 <span class="se">\</span>
    <span class="nt">--allocation-pool</span> <span class="nv">start</span><span class="o">=</span>10.0.0.150,end<span class="o">=</span>10.0.0.190 <span class="se">\</span>
    public</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sample_e2e_config_yaml_using_the_above_prerequisites"><a class="anchor" href="#_sample_e2e_config_yaml_using_the_above_prerequisites"></a><a class="link" href="#_sample_e2e_config_yaml_using_the_above_prerequisites">Sample e2e config yaml using the above prerequisites</a></h4>
<div class="paragraph">
<p>Also see <a href="https://github.com/os-migrate/os-migrate/blob/main/tests/e2e/tenant/scenario_variables.yml" class="bare">https://github.com/os-migrate/os-migrate/blob/main/tests/e2e/tenant/scenario_variables.yml</a></p>
</div>
<div class="paragraph">
<p>Auth URLs and network names will change based on your environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_src_auth</span><span class="pi">:</span>
  <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://10.0.0.131:5000/v3</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">redhat</span>
  <span class="na">project_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">project_name</span><span class="pi">:</span> <span class="s">src</span>
  <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">src</span>
<span class="na">os_migrate_src_region_name</span><span class="pi">:</span> <span class="s">regionOne</span>
<span class="na">os_migrate_dst_auth</span><span class="pi">:</span>
  <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://10.0.0.131:5000/v3</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">redhat</span>
  <span class="na">project_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">project_name</span><span class="pi">:</span> <span class="s">dst</span>
  <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">dst</span>
<span class="na">os_migrate_dst_region_name</span><span class="pi">:</span> <span class="s">regionOne</span>

<span class="na">os_migrate_data_dir</span><span class="pi">:</span> <span class="s">/root/os_migrate/local/migrate-data</span>

<span class="na">os_migrate_conversion_host_ssh_user</span><span class="pi">:</span> <span class="s">cloud-user</span>
<span class="na">os_migrate_src_conversion_external_network_name</span><span class="pi">:</span> <span class="s">nova</span>
<span class="na">os_migrate_dst_conversion_external_network_name</span><span class="pi">:</span> <span class="s">nova</span>
<span class="na">os_migrate_conversion_flavor_name</span><span class="pi">:</span> <span class="s">m1.large</span>
<span class="na">os_migrate_conversion_image_name</span><span class="pi">:</span> <span class="s">CentOS-Stream-GenericCloud-8-20220913.0.x86_64.qcow2</span>

<span class="na">os_migrate_src_osm_server_flavor</span><span class="pi">:</span> <span class="s">m1.xtiny</span>
<span class="na">os_migrate_src_osm_server_image</span><span class="pi">:</span> <span class="s">cirros-0.4.0-x86_64-disk.img</span>
<span class="na">os_migrate_src_osm_router_external_network</span><span class="pi">:</span> <span class="s">nova</span>

<span class="na">os_migrate_src_validate_certs</span><span class="pi">:</span> <span class="s">False</span>
<span class="na">os_migrate_dst_validate_certs</span><span class="pi">:</span> <span class="s">False</span>

<span class="na">os_migrate_src_release</span><span class="pi">:</span> <span class="m">16</span>
<span class="na">os_migrate_dst_release</span><span class="pi">:</span> <span class="m">16</span>

<span class="na">os_migrate_src_conversion_net_mtu</span><span class="pi">:</span> <span class="m">1400</span>
<span class="na">os_migrate_dst_conversion_net_mtu</span><span class="pi">:</span> <span class="s">1400</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_e2e_test_using_the_os_migrate_toolbox_and_the_above_config"><a class="anchor" href="#_run_e2e_test_using_the_os_migrate_toolbox_and_the_above_config"></a><a class="link" href="#_run_e2e_test_using_the_os_migrate_toolbox_and_the_above_config">Run e2e test using the OS Migrate toolbox and the above config</a></h4>
<div class="paragraph">
<p>Copy the above config to file <code>custom-config.yaml</code> in the <code>local</code> directory of your local <code>os-migrate</code> source.</p>
</div>
<div class="paragraph">
<p>Run the full test suite using the above config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">OS_MIGRATE_E2E_TEST_ARGS</span><span class="o">=</span><span class="s1">'-e @/root/os_migrate/local/custom-config.yaml'</span> ./toolbox/run make test-e2e-tenant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expected_output_from_successful_e2e_test_run"><a class="anchor" href="#_expected_output_from_successful_e2e_test_run"></a><a class="link" href="#_expected_output_from_successful_e2e_test_run">Expected output from successful e2e test run</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">PLAY RECAP <span class="k">********************************************************************************************************</span>
localhost                  : <span class="nv">ok</span><span class="o">=</span>318  <span class="nv">changed</span><span class="o">=</span>110  <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0    <span class="nv">skipped</span><span class="o">=</span>27   <span class="nv">rescued</span><span class="o">=</span>0    <span class="nv">ignored</span><span class="o">=</span>0
os_migrate_conv_dst        : <span class="nv">ok</span><span class="o">=</span>12   <span class="nv">changed</span><span class="o">=</span>5    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0    <span class="nv">skipped</span><span class="o">=</span>3    <span class="nv">rescued</span><span class="o">=</span>0    <span class="nv">ignored</span><span class="o">=</span>0
os_migrate_conv_src        : <span class="nv">ok</span><span class="o">=</span>12   <span class="nv">changed</span><span class="o">=</span>5    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0    <span class="nv">skipped</span><span class="o">=</span>3    <span class="nv">rescued</span><span class="o">=</span>0    <span class="nv">ignored</span><span class="o">=</span>0

Wednesday 21 July 2021  09:59:17 +0000 <span class="o">(</span>0:00:03.419<span class="o">)</span>       0:29:17.016 <span class="k">********</span>
<span class="o">===============================================================================</span>
os_migrate.os_migrate.conversion_host_content : update all packages <span class="nt">---------------------------------------</span> 435.56s
os_migrate.os_migrate.import_workloads : transfer volumes to destination <span class="nt">----------------------------------</span> 101.72s
os_migrate.os_migrate.import_workloads : expose <span class="nb">source </span>volumes <span class="nt">---------------------------------------------</span> 66.67s
os_migrate.os_migrate.conversion_host_content : <span class="nb">install </span>content <span class="nt">--------------------------------------------</span> 62.35s
os_migrate.os_migrate.import_workloads : transfer volumes to destination <span class="nt">-----------------------------------</span> 58.75s
os_migrate.os_migrate.import_workloads : clean up <span class="k">in </span>the <span class="nb">source </span>cloud after migration <span class="nt">----------------------</span> 27.40s
os_migrate.os_migrate.import_workloads : expose <span class="nb">source </span>volumes <span class="nt">---------------------------------------------</span> 27.30s
Create osm_server <span class="nt">------------------------------------------------------------------------------------------</span> 24.71s
create osm_image <span class="nt">-------------------------------------------------------------------------------------------</span> 23.86s
os_migrate.os_migrate.export_images : <span class="nb">export </span>image blobs <span class="nt">---------------------------------------------------</span> 23.80s
os_migrate.os_migrate.import_images : import images <span class="nt">--------------------------------------------------------</span> 23.69s
os_migrate.os_migrate.import_workloads : create destination instance <span class="nt">---------------------------------------</span> 23.30s
os_migrate.os_migrate.import_workloads : create destination instance <span class="nt">---------------------------------------</span> 21.93s
Create osm_server <span class="nt">------------------------------------------------------------------------------------------</span> 21.61s
os_migrate.os_migrate.import_workloads : clean up <span class="k">in </span>the <span class="nb">source </span>cloud after migration <span class="nt">----------------------</span> 21.16s
os_migrate.os_migrate.conversion_host : create os_migrate conversion host <span class="nt">----------------------------------</span> 20.03s
Remove osm_server <span class="nt">------------------------------------------------------------------------------------------</span> 19.01s
os_migrate.os_migrate.conversion_host : create os_migrate conversion host <span class="nt">----------------------------------</span> 18.23s
Shutdown osm_server <span class="nt">----------------------------------------------------------------------------------------</span> 18.14s
Shutdown osm_server <span class="nt">----------------------------------------------------------------------------------------</span> 17.88s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_optional_tags_to_pass_to_e2e_tests"><a class="anchor" href="#_optional_tags_to_pass_to_e2e_tests"></a><a class="link" href="#_optional_tags_to_pass_to_e2e_tests">Optional tags to pass to e2e tests</a></h4>
<div class="paragraph">
<p>There are a set of tags that can be used to filter which tasks to run during test.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>test_clean_before</p>
</li>
<li>
<p>test_workload</p>
</li>
<li>
<p>test_image_workload_boot_copy</p>
</li>
<li>
<p>test_image_workload_boot_nocopy</p>
</li>
<li>
<p>test_image_workload_boot_copy_clean</p>
</li>
<li>
<p>test_clean_before</p>
</li>
<li>
<p>test_pre_workload</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_optional_playbook_variable"><a class="anchor" href="#_optional_playbook_variable"></a><a class="link" href="#_optional_playbook_variable">Optional playbook variable</a></h4>
<div class="paragraph">
<p>There is also an optional variable <code>test_clean_conversion_hosts_after</code> which can be set to <code>false</code> if you do not wish
to clean up conversion hosts after test is complete.</p>
</div>
</div>
<div class="sect3">
<h4 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a><a class="link" href="#_environment_variables">Environment variables</a></h4>
<div class="paragraph">
<p>The following environment variables can be used when running e2e tests.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OS_MIGRATE_E2E_TEST_ARGS</code>: All of the above tags and playbook variables can be set using the
<code>OS_MIGRATE_E2E_TEST_ARGS</code> environment variable. This variable is also used to pass in the playbook custom config
file. eg:</p>
<div class="literalblock">
<div class="content">
<pre>`OS_MIGRATE_E2E_TEST_ARGS='-e @/root/os_migrate/local/custom-config.yaml \
--tags test_clean_before,test_workload --skip-tags test_clean_after -e test_clean_conversion_hosts_after=false'`</pre>
</div>
</div>
</li>
<li>
<p><code>ROOT_DIR</code>: Absolute directory path to OS Migrate source. When not set the default when run using OS Migrate developer
toolbox this is set to <code>/root/os_migrate</code>.</p>
</li>
<li>
<p><code>OS_MIGRATE</code>: Absolute directory path to the OS Migrate ansible collection. When not set the default when run using
os-migrate developer toolbox this is set to <code>/root/.ansible/collections/ansible_collections/os_migrate/os_migrate</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installing_vagrant_directly_on_host_alternative_path"><a class="anchor" href="#_installing_vagrant_directly_on_host_alternative_path"></a><a class="link" href="#_installing_vagrant_directly_on_host_alternative_path">Installing Vagrant directly on host (alternative path)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Normally you should run Vagrant containerized as the <a href="chapter_os-migrate-dev-env-setup.adoc">developer environment setup</a> doc suggests. If you have a
reason to install on bare metal instead, here are relevant
instructions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>yum install https://releases.hashicorp.com/vagrant/2.4.1/vagrant-2.4.1-1.x86_64.rpm -y
vagrant --version</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>virsh pool-define-as vagrant dir - - - - "/var/lib/libvirt/images/vagrant"
virsh pool-list --all
virsh pool-build vagrant
virsh pool-start vagrant
virsh pool-autostart vagrant
virsh pool-info vagrant</pre>
</div>
</div>
<div class="paragraph">
<p>We need to install the libvirt provider</p>
</div>
<div class="listingblock">
<div class="content">
<pre>yum groupinstall "Virtualization Host" -y
yum install libvirt-devel -y
vagrant plugin install vagrant-libvirt
systemctl restart libvirtd</pre>
</div>
</div>
<div class="paragraph">
<p>Go to the toolbox/vagrant folder</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cd toolbox/vagrant</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>vagrant box add --name fedora37 https://app.vagrantup.com/fedora/boxes/37-cloud-base/versions/37.20221105.0/providers/libvirt/unknown/vagrant.box</pre>
</div>
</div>
<div class="paragraph">
<p>Start the environment using the libvirt provider</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vagrant up --provider libvirt</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cicd_and_automation"><a class="anchor" href="#_cicd_and_automation"></a><a class="link" href="#_cicd_and_automation">CI/CD and Automation</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_github_actions_documentation_for_os_migrate_repositories"><a class="anchor" href="#_github_actions_documentation_for_os_migrate_repositories"></a><a class="link" href="#_github_actions_documentation_for_os_migrate_repositories">GitHub Actions Documentation for os-migrate Repositories</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document provides a definitive and accurate overview of the GitHub Actions used in the <code>os-migrate/os-migrate</code> and <code>os-migrate/vmware-migration-kit</code> repositories, based on their current <code>main</code> branch.</p>
</div>
<hr>
<div class="sect2">
<h3 id="_os_migrateos_migrate"><a class="anchor" href="#_os_migrateos_migrate"></a><a class="link" href="#_os_migrateos_migrate">.1. os-migrate/os-migrate</a></h3>
<div class="sect3">
<h4 id="_existing_github_actions"><a class="anchor" href="#_existing_github_actions"></a><a class="link" href="#_existing_github_actions">.1.1. Existing GitHub Actions</a></h4>
<div class="ulist">
<ul>
<li>
<p><code>ansible-lint.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>pull_request</code> and <code>push</code> to the <code>main</code> branch.</p>
</div>
<div class="paragraph">
<p>This workflow ensures code quality by <strong>linting the Ansible collection</strong>. It uses the official <code>ansible/ansible-lint-action</code> to check all Ansible playbooks for best practices and potential errors.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>ansible-test.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>pull_request</code> and <code>push</code> to the <code>main</code> branch.</p>
</div>
<div class="paragraph">
<p>This is the main <strong>integration testing</strong> workflow. It runs <code>ansible-test</code> to validate the collection&#8217;s functionality across a matrix of different Python and Ansible Core versions, ensuring broad compatibility.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>build-aee.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>pull_request</code> and <code>push</code> to the <code>main</code> branch.</p>
</div>
<div class="paragraph">
<p>This workflow builds the <strong>Ansible Execution Environment (AEE)</strong>. It uses <code>ansible-builder</code> to create a container image with all the necessary dependencies, which is then pushed to <code>quay.io</code>.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>docs-build-pr.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>pull_request</code>.</p>
</div>
<div class="paragraph">
<p>This workflow specifically validates documentation changes in pull requests. It <strong>builds the Sphinx documentation</strong> to ensure that proposed changes do not break the doc generation process before merging.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>docs-build.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>push</code> to the <code>main</code> branch.</p>
</div>
<div class="paragraph">
<p>This workflow <strong>builds and deploys the official documentation</strong>. After a successful build, it pushes the generated HTML to the <code>gh-pages</code> branch, making it live on the project&#8217;s GitHub Pages site.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>import-galaxy.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>workflow_dispatch</code> (manual) and a daily <code>schedule</code>.</p>
</div>
<div class="paragraph">
<p>This workflow <strong>tests the collection&#8217;s compatibility with the Galaxy importer</strong>. It uses the <code>ansible-community/github-action-test-galaxy-import</code> action to take the built collection artifact and simulate the import process used by Ansible Galaxy, ensuring the package is correctly structured for publication.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_os_migratevmware_migration_kit"><a class="anchor" href="#_os_migratevmware_migration_kit"></a><a class="link" href="#_os_migratevmware_migration_kit">.2. os-migrate/vmware-migration-kit</a></h3>
<div class="sect3">
<h4 id="_existing_github_actions_2"><a class="anchor" href="#_existing_github_actions_2"></a><a class="link" href="#_existing_github_actions_2">.2.1. Existing GitHub Actions</a></h4>
<div class="ulist">
<ul>
<li>
<p><code>ansible-lint.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>pull_request</code> and <code>push</code> to the <code>main</code> branch.</p>
</div>
<div class="paragraph">
<p>This workflow <strong>lints all Ansible content</strong> in the repository using <code>ansible-lint</code> to maintain code quality and adherence to best practices.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>ansible-test.yaml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>pull_request</code> and <code>push</code> to the <code>main</code> branch.</p>
</div>
<div class="paragraph">
<p>This workflow performs <strong>integration testing for the Ansible collection</strong>. It runs <code>ansible-test sanity</code> to catch common structural issues.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>build-aee.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>pull_request</code> and <code>push</code> to the <code>main</code> branch.</p>
</div>
<div class="paragraph">
<p>This workflow builds the <strong>Ansible Execution Environment (AEE)</strong> using <code>ansible-builder</code> and pushes the resulting container image to <code>quay.io</code>, ensuring the project&#8217;s runtime is always up-to-date.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>golang-lint.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>pull_request</code> and <code>push</code> to the <code>main</code> branch.</p>
</div>
<div class="paragraph">
<p>This workflow ensures <strong>Go code quality</strong>. It runs <code>golangci-lint</code> to perform static analysis and check for formatting issues, bugs, and stylistic errors in the Go source code.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>import-galaxy.yml</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Triggered on: <code>workflow_dispatch</code> (manual) and a daily <code>schedule</code>.</p>
</div>
<div class="paragraph">
<p>This workflow <strong>tests the collection&#8217;s compatibility with the Galaxy importer</strong>. It takes the built collection artifact and uses the <code>ansible-community/github-action-test-galaxy-import</code> action to verify that the package is properly structured for a successful import into Ansible Galaxy.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_add_a_new_github_action"><a class="anchor" href="#_how_to_add_a_new_github_action"></a><a class="link" href="#_how_to_add_a_new_github_action">.3. How to Add a New GitHub Action</a></h3>
<div class="paragraph">
<p>To add a new GitHub Action to either of the repositories, follow these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create a new YAML file</strong> in the <code>.github/workflows</code> directory of the repository.</p>
</li>
<li>
<p><strong>Define the workflow</strong> in the YAML file. Here&#8217;s a basic template you can use:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s">My New Workflow</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span> <span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span> <span class="nv">main</span> <span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Check out code</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run a one-line script</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">echo Hello, world!</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Customize the workflow</strong> to your needs, including the <code>name</code>, <code>on</code> triggers, and <code>jobs</code>.</p>
</li>
<li>
<p><strong>Commit and push</strong> the new workflow file to the repository.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_see_also"><a class="anchor" href="#_see_also"></a><a class="link" href="#_see_also">.3.1. See Also</a></h4>
<div class="paragraph">
<p>For more detailed information on syntax and features, refer to the official documentation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.github.com/en/actions">Official GitHub Actions Documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_guidelines"><a class="anchor" href="#_contributing_guidelines"></a><a class="link" href="#_contributing_guidelines">1. Contributing Guidelines</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_general_contribution_guidelines"><a class="anchor" href="#_general_contribution_guidelines"></a><a class="link" href="#_general_contribution_guidelines">2. General Contribution Guidelines</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_commit_messages_for_changelog"><a class="anchor" href="#_commit_messages_for_changelog"></a><a class="link" href="#_commit_messages_for_changelog">2.1. Commit Messages for Changelog</a></h3>
<div class="paragraph">
<p>OS Migrate uses commit messages for automated generation of project
changelog. For every pull request we request contributors to be
compliant with the following commit message notation.</p>
</div>
<div class="sect3">
<h4 id="_format"><a class="anchor" href="#_format"></a><a class="link" href="#_format">2.1.1. Format</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">&lt;type&gt;</span>: &lt;summary&gt;
<span class="go">
</span><span class="gp">&lt;body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Accepted <code>&lt;type&gt;</code> values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>new</code> - newly implemented user-facing features</p>
</li>
<li>
<p><code>chg</code> - changes in existing user-facing features</p>
</li>
<li>
<p><code>fix</code> - user-facing bugfixes</p>
</li>
<li>
<p><code>oth</code> - other changes which users should know about</p>
</li>
<li>
<p><code>dev</code> - any developer-facing changes, regardless of
new/chg/fix status</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_keeping_changelog_clean"><a class="anchor" href="#_keeping_changelog_clean"></a><a class="link" href="#_keeping_changelog_clean">2.1.2. Keeping Changelog Clean</a></h4>
<div class="paragraph">
<p>If the commit message subject starts with <code>dev:</code>, it will be omitted
when rendering the changelog.</p>
</div>
<div class="paragraph">
<p>Using this convention is important to keep the changelog document
concise and focused on user-facing changes. Any developer-facing
changes (developer environment, CI, developer-only docs) or miniature
"cosmetic" edits should be tagged as <code>dev</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_summary_first_line"><a class="anchor" href="#_summary_first_line"></a><a class="link" href="#_summary_first_line">2.1.3. Summary (First Line)</a></h4>
<div class="paragraph">
<p>The first line should not be longer than 75 characters, the second
line is always blank and other lines should be wrapped at 80
characters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_message_body"><a class="anchor" href="#_message_body"></a><a class="link" href="#_message_body">2.1.4. Message Body</a></h4>
<div class="paragraph">
<p>Uses the imperative, present tense: "change" not "changed" nor
"changes" and includes motivation for the change and contrasts with
previous behavior. Think how the commit message will appear in the
project changelog.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_code"><a class="anchor" href="#_contributing_code"></a><a class="link" href="#_contributing_code">3. Contributing Code</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As an open source project, OS Migrate welcomes contributions from the
community at large. The following guide provides information on how to
add a new role to the project and where additional testing or
documentation artifacts should be added. This isn&#8217;t an exhaustive
reference and is a living document subject to change as needed when
the project formalizes any practice or pattern.</p>
</div>
<div class="sect2">
<h3 id="_adding_a_new_role"><a class="anchor" href="#_adding_a_new_role"></a><a class="link" href="#_adding_a_new_role">3.1. Adding a New Role</a></h3>
<div class="paragraph">
<p>The most common contribution to OS Migrate is adding a new role to
support the export or import of resources. The construction of the roles
will likely follow a similar pattern. Each role also has specific unit
and functional test requirements. The most common pattern for adding a
new role will follow these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a resource class to <code>os_migrate/plugins/module_utils</code> that
inherits from
<code>ansible_collections.os_migrate.os_migrate.plugins.module_utils.resource.Resource</code></p>
</li>
<li>
<p>Add a unit test to <code>os_migrate/tests/unit</code> to test serializing and
de-serializing data, and any other functionality your class may have.</p>
</li>
<li>
<p>Create a new module in <code>os_migrate/plugins/modules</code> to facilitate
the import or export of the resource.</p>
</li>
<li>
<p>Add a new playbook to <code>os_migrate/playbooks</code>.</p>
</li>
<li>
<p>Add a new role to <code>os_migrate/roles</code>.</p>
</li>
<li>
<p>Add functional tests to <code>tests/func</code> that test primary use,
idempotency, and updates as a minimum. Additional tests as necessary.</p>
</li>
<li>
<p>Add documentation within classes and roles/playbooks as required.
Update developer or user documentation as needed.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_creating_the_role_skeleton_automatically"><a class="anchor" href="#_creating_the_role_skeleton_automatically"></a><a class="link" href="#_creating_the_role_skeleton_automatically">3.1.1. Creating the role skeleton automatically</a></h4>
<div class="paragraph">
<p>Adding roles into os-migrate can be easily achieved by
creating the role structure skeleton automatically.</p>
</div>
<div class="paragraph">
<p>From the repository root directory execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-playbook <span class="se">\</span>
   <span class="nt">-i</span> <span class="s1">'localhost,'</span> <span class="se">\</span>
   ./scripts/role-addition.yml <span class="se">\</span>
   <span class="nt">-e</span> <span class="nv">ansible_connection</span><span class="o">=</span><span class="nb">local</span> <span class="se">\</span>
   <span class="nt">-e</span> <span class="nv">role_name</span><span class="o">=</span>import_example_resource</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate the role, the default variables file,
and the documentation stub.</p>
</div>
</div>
<div class="sect3">
<h4 id="_resources"><a class="anchor" href="#_resources"></a><a class="link" href="#_resources">3.1.2. Resources</a></h4>
<div class="paragraph">
<p>Resources are the primary data structures that are exported from and
imported to clouds. In
<code>os_migrate/plugins/module_utils/resource.py</code>, there is a
<code>Resource</code> class provided for your new resource to inherit from. It
provides a way to quickly build an organized class that uses
openstacksdk to retrieve, create and update data within a connected
OpenStack tenant. See how other classes in the <code>module_utils</code>
directory inherit from <code>Resource</code> for inspiration.</p>
</div>
<div class="paragraph">
<p>Two very important properties are the 'params' and '_info', as these are
the primary data fields that will be exported and imported. At a
minimum, the name property of any resource should be in params_from_sdk,
and most likely addresses should be there too. The difference between
info and params is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A property that would be an '_info' type is something that we don&#8217;t
want or cannot "make the same" in the destination cloud. For example,
typically UUIDs can&#8217;t be the same between two tenants so an 'id'
property should remain in info.</p>
</li>
<li>
<p>A property that would be in a 'params' type are things that we do
want to copy to the destination cloud. These typically also get
looked at when we&#8217;re making sure the import behavior is idempotent.
I.e. when we re-run import playbooks, things that already got
imported before are not attempted to be imported again.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_export_roles"><a class="anchor" href="#_export_roles"></a><a class="link" href="#_export_roles">3.1.3. Export Roles</a></h4>
<div class="paragraph">
<p>In the <code>defaults/main.yml</code> file, at a minimum you will need to
define the <code>os_migrate_[resource]_filter</code> variable to support
filtering of resources by the name property.</p>
</div>
<div class="paragraph">
<p>In the <code>meta/main.yml</code> file you will likely just need to add the
following default content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="nn">---</span>
<span class="na">galaxy_info</span><span class="pi">:</span>
  <span class="na">author</span><span class="pi">:</span> <span class="s">os-migrate</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">os-migrate resource</span>
  <span class="na">company</span><span class="pi">:</span> <span class="s">Red Hat</span>
  <span class="na">license</span><span class="pi">:</span> <span class="s">Apache-2.0</span>
  <span class="na">min_ansible_version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2.9"</span>
  <span class="na">platforms</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Fedora</span>
      <span class="na">versions</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">34"</span>
  <span class="na">galaxy_tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">osmigrate"</span><span class="pi">]</span>
<span class="na">dependencies</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate.prelude_src</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>tasks/main.yml</code> file, add your Ansible tasks for exporting the
data. A common pattern is retrieving data from an OpenStack tenant via a
<a href="https://docs.ansible.com/ansible/latest/collections/openstack/cloud/index.html">cloud module</a>,
creating a collection of name/id pairs for export, filtering the names
for specific resources, and then calling the module you created for
export.</p>
</div>
</div>
<div class="sect3">
<h4 id="_import_roles"><a class="anchor" href="#_import_roles"></a><a class="link" href="#_import_roles">3.1.4. Import Roles</a></h4>
<div class="paragraph">
<p>In the <code>defaults/main.yml</code> file, at a minimum you will need to
define the same <code>os_migrate_[resource]<em>filter</code> variable as with
export, and <code>import</em>[resource]_validate_file: true</code> variable to set
whether or not the import data file should be validated for this
role. In most cases, it should be set to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>In the <code>meta/main.yml</code> file you will likely just need to add the
following default content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="nn">---</span>
<span class="na">galaxy_info</span><span class="pi">:</span>
  <span class="na">author</span><span class="pi">:</span> <span class="s">os-migrate</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">os-migrate resource</span>
  <span class="na">company</span><span class="pi">:</span> <span class="s">Red Hat</span>
  <span class="na">license</span><span class="pi">:</span> <span class="s">Apache-2.0</span>
  <span class="na">min_ansible_version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2.9"</span>
  <span class="na">platforms</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Fedora</span>
      <span class="na">versions</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">34"</span>
  <span class="na">galaxy_tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">osmigrate"</span><span class="pi">]</span>
<span class="na">dependencies</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate.prelude_dst</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>tasks/main.yml</code> file, add your Ansible tasks for importing the
data. A common pattern is validating the data file created by the
associated export role, reading the data file and then calling the
module you created for import.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_tests"><a class="anchor" href="#_writing_tests"></a><a class="link" href="#_writing_tests">3.2. Writing Tests</a></h3>
<div class="paragraph">
<p>For newly implemented resources, ensure comprehensive test coverage by following this checklist:</p>
</div>
<div class="sect3">
<h4 id="_functional_tests"><a class="anchor" href="#_functional_tests"></a><a class="link" href="#_functional_tests">3.2.1. Functional Tests</a></h4>
<div class="ulist">
<ul>
<li>
<p>Ensure both import and export functionalities are tested, not just idempotency.</p>
</li>
<li>
<p>Include tests for admin-only resources, ensuring they are renamed before import.</p>
</li>
<li>
<p>Test resources as a tenant whenever possible to ensure broader coverage.</p>
</li>
<li>
<p>For resources with special properties like <code>links</code> or <code>extra_specs</code>, write detailed tests inspecting these properties closely.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_unit_tests"><a class="anchor" href="#_unit_tests"></a><a class="link" href="#_unit_tests">3.2.2. Unit Tests</a></h4>
<div class="ulist">
<ul>
<li>
<p>Write unit tests for each new module created, focusing on the logic within the module.</p>
</li>
<li>
<p>Ensure that edge cases and error handling paths are covered in unit tests.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_integration_tests"><a class="anchor" href="#_integration_tests"></a><a class="link" href="#_integration_tests">3.2.3. Integration Tests</a></h4>
<div class="ulist">
<ul>
<li>
<p>Add integration tests that cover the entire process of exporting and then importing the resource, verifying the integrity and consistency of the data.</p>
</li>
<li>
<p>Verify that the resource behaves as expected in the context of the os-migrate ecosystem.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_documentation_and_examples"><a class="anchor" href="#_documentation_and_examples"></a><a class="link" href="#_documentation_and_examples">3.2.4. Documentation and Examples</a></h4>
<div class="ulist">
<ul>
<li>
<p>In the <code>DOCUMENTATION</code> constant of each module, include examples of how to use the module in a playbook.</p>
</li>
<li>
<p>Ensure that the <code>README.md</code> file for the new role is comprehensive, covering the role&#8217;s purpose, usage, and any dependencies.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_test_execution_in_ci"><a class="anchor" href="#_test_execution_in_ci"></a><a class="link" href="#_test_execution_in_ci">3.2.5. Test Execution in CI</a></h4>
<div class="ulist">
<ul>
<li>
<p>Confirm that all tests are executed in the Continuous Integration (CI) environment before merging.</p>
</li>
<li>
<p>If a feature is merged without proper tests due to specific circumstances, create a technical debt tracking card to follow up.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_review_and_inspection"><a class="anchor" href="#_review_and_inspection"></a><a class="link" href="#_review_and_inspection">3.2.6. Review and Inspection</a></h4>
<div class="ulist">
<ul>
<li>
<p>Conduct thorough reviews, especially when introducing new resources, to catch potential issues early.</p>
</li>
<li>
<p>Implement policies or checklists in development documentation to ensure test soundness and coverage.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_location_of_tests"><a class="anchor" href="#_location_of_tests"></a><a class="link" href="#_location_of_tests">3.2.7. Location of Tests</a></h4>
<div class="ulist">
<ul>
<li>
<p>Place functional and integration tests in the <code>tests/e2e</code> or <code>tests/func</code> directory respectively, following the existing structure for similar resources.</p>
</li>
<li>
<p>Unit tests should reside alongside the modules they are testing, in the <code>os_migrate/tests/</code> directory.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_special_considerations"><a class="anchor" href="#_special_considerations"></a><a class="link" href="#_special_considerations">3.2.8. Special Considerations</a></h4>
<div class="ulist">
<ul>
<li>
<p>For resources that are only accessible by admin users, ensure tests reflect this by running them with appropriate permissions.</p>
</li>
<li>
<p>Address any known issues from previous retrospectives, such as fixing the handling of Nova keypairs or ensuring resources are tested in tenant context.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_necessary_documentation"><a class="anchor" href="#_necessary_documentation"></a><a class="link" href="#_necessary_documentation">3.2.9. Necessary Documentation</a></h4>
<div class="paragraph">
<p>If this is your first time adding a pull request to the os-migrate
repository, add your author information to <code>galaxy.yml</code>.</p>
</div>
<div class="paragraph">
<p>In each Ansible module in <code>os_migrate/plugins/modules</code>, there is a
<code>DOCUMENTATION</code> constant where you must provide standard
documentation on what the module does and an example of how you would
use it in a playbook.</p>
</div>
<div class="paragraph">
<p>Each new role must have a <code>README.md</code> file as a requirement for
Ansible Galaxy publishing.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_documentation"><a class="anchor" href="#_contributing_documentation"></a><a class="link" href="#_contributing_documentation">4. Contributing Documentation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you notice missing or errorneous documentation, you can either
create an <a href="https://github.com/os-migrate/os-migrate/issues">issue on Github</a>,
or you can create a <a href="https://github.com/os-migrate/os-migrate/pulls">pull request</a>
with the desired documentation changes.</p>
</div>
<div class="paragraph">
<p>Documentation sources in the repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The majority of documentation is located under <code>docs/src</code> folder.</p>
</li>
<li>
<p>Individual roles have a readme file under
<code>os_migrate/roles/&lt;ROLE&gt;/README.md</code> (Ansible Galaxy requirement).</p>
</li>
<li>
<p>Modules are documented directly in their Python file
<code>os_migrate/plugins/modules/&lt;MODULE&gt;.py</code> (Ansible convention).</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_rendering_the_documentation"><a class="anchor" href="#_rendering_the_documentation"></a><a class="link" href="#_rendering_the_documentation">4.1. Rendering the Documentation</a></h3>
<div class="paragraph">
<p>After you make your change and before you submit a pull request, it&#8217;s
good to verify that the changes you made are getting rendered into
HTML correctly.</p>
</div>
<div class="paragraph">
<p>If you haven&#8217;t yet built a toolbox container for OS Migrate
development, do so now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>make toolbox-build</pre>
</div>
</div>
<div class="paragraph">
<p>To build the documentation, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./toolbox/run make docs</pre>
</div>
</div>
<div class="paragraph">
<p>You can inspect the rendered documentation by opening
<code>docs/src/_build/html/index.html</code> in your web browser.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_new_go_based_ansible_modules"><a class="anchor" href="#_creating_new_go_based_ansible_modules"></a><a class="link" href="#_creating_new_go_based_ansible_modules">5. Creating New Go-based Ansible Modules</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document provides a comprehensive guide for developers on creating new Ansible modules written in Go for the <code>os-migrate/vmware-migration-kit</code> project.</p>
</div>
<div class="sect2">
<h3 id="_1_introduction_to_go_based_ansible_modules"><a class="anchor" href="#_1_introduction_to_go_based_ansible_modules"></a><a class="link" href="#_1_introduction_to_go_based_ansible_modules">5.1. 1. Introduction to Go-based Ansible Modules</a></h3>
<div class="paragraph">
<p>Ansible can be extended with modules written in any programming language, including Go. These are referred to as "binary modules." Instead of being interpreted Python files, they are compiled executables that Ansible runs. They work by reading a JSON file of arguments from the command line and printing a JSON string of results to standard output.</p>
</div>
<div class="paragraph">
<p>For more detailed background information on how binary modules work in Ansible, please refer to the official documentation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Official Ansible Documentation:</strong> <a href="https://docs.ansible.com/ansible/latest/dev_guide/developing_program_flow_modules.html#binary-modules" class="bare">https://docs.ansible.com/ansible/latest/dev_guide/developing_program_flow_modules.html#binary-modules</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_2_project_structure_for_go_modules"><a class="anchor" href="#_2_project_structure_for_go_modules"></a><a class="link" href="#_2_project_structure_for_go_modules">5.2. 2. Project Structure for Go Modules</a></h3>
<div class="paragraph">
<p>To integrate properly with the existing project structure and build system, your new module must follow these conventions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Go Source Code:</strong> All Go source files for your new module, let&#8217;s call it <code>my_new_module</code>, must reside in their own subdirectory within <code>plugins/modules/src/</code>.</p>
</li>
<li>
<p>Example: <code>plugins/modules/src/my_new_module/my_new_module.go</code></p>
</li>
<li>
<p><strong>Shared Go Code:</strong> If you create utility functions or types that could be shared across multiple Go modules, place them in <code>plugins/module_utils/</code>.</p>
</li>
<li>
<p><strong>Python Documentation File:</strong> Every binary module requires a corresponding Python file in <code>plugins/modules/</code> that contains the Ansible documentation string. This file is what <code>ansible-doc</code> reads, and it also serves as a pointer to the compiled binary.</p>
</li>
<li>
<p>Example: <code>plugins/modules/my_new_module.py</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_3_step_by_step_development_guide"><a class="anchor" href="#_3_step_by_step_development_guide"></a><a class="link" href="#_3_step_by_step_development_guide">5.3. 3. Step-by-Step Development Guide</a></h3>
<div class="sect3">
<h4 id="_3_1_create_the_directory_and_files"><a class="anchor" href="#_3_1_create_the_directory_and_files"></a><a class="link" href="#_3_1_create_the_directory_and_files">5.3.1. 3.1. Create the Directory and Files</a></h4>
<div class="paragraph">
<p>First, create the necessary directory for your Go source code and the documentation file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Replace 'my_new_module' with the name of your module</span>
<span class="nv">MODULE_NAME</span><span class="o">=</span><span class="s2">"my_new_module"</span>

<span class="c"># Create the source directory</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"plugins/modules/src/</span><span class="k">${</span><span class="nv">MODULE_NAME</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># Create the Go source file and the Python documentation file</span>
<span class="nb">touch</span> <span class="s2">"plugins/modules/src/</span><span class="k">${</span><span class="nv">MODULE_NAME</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">MODULE_NAME</span><span class="k">}</span><span class="s2">.go"</span>
<span class="nb">touch</span> <span class="s2">"plugins/modules/</span><span class="k">${</span><span class="nv">MODULE_NAME</span><span class="k">}</span><span class="s2">.py"</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_3_2_write_the_go_module_code"><a class="anchor" href="#_3_2_write_the_go_module_code"></a><a class="link" href="#_3_2_write_the_go_module_code">5.3.2. 3.2. Write the Go Module Code</a></h4>
<div class="paragraph">
<p>Your Go program will form the core logic of the Ansible module. The <code>main</code> function should be the entry point. Common dependencies you might need include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>govmomi:</strong> for interacting with VMware vSphere (<code>github.com/vmware/govmomi</code>)</p>
</li>
<li>
<p><strong>gophercloud:</strong> for interacting with OpenStack (<code>github.com/gophercloud/gophercloud</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_3_3_create_the_python_documentation_file"><a class="anchor" href="#_3_3_create_the_python_documentation_file"></a><a class="link" href="#_3_3_create_the_python_documentation_file">5.3.3. 3.3. Create the Python Documentation File</a></h4>
<div class="paragraph">
<p>This file does not contain Go code. It&#8217;s a Python file that holds the documentation and metadata for your module in pydoc format. Ansible uses this to understand your module&#8217;s parameters, return values, and to generate documentation.</p>
</div>
<div class="paragraph">
<p>Copy the contents of an existing module like <code>plugins/modules/create_server.py</code> and adapt it for your new module.</p>
</div>
<div class="paragraph">
<p>Here is a template for <code>plugins/modules/my_new_module.py</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="c1">#!/usr/bin/python
# -*- coding: utf-8 -*-
</span>
<span class="c1"># ANSIBLE_METADATA is a machine-readable block that provides metadata
# about the module.
</span><span class="n">ANSIBLE_METADATA</span> <span class="o">=</span> <span class="p">{</span><span class="s">'metadata_version'</span><span class="p">:</span> <span class="s">'1.1'</span><span class="p">,</span>
                    <span class="s">'status'</span><span class="p">:</span> <span class="p">[</span><span class="s">'preview'</span><span class="p">],</span>
                    <span class="s">'supported_by'</span><span class="p">:</span> <span class="s">'community'</span><span class="p">}</span>

<span class="c1"># DOCUMENTATION is a string in YAML format that provides human-readable
# documentation for the module.
</span><span class="n">DOCUMENTATION</span> <span class="o">=</span> <span class="s">'''
---
module: my_new_module
short_description: A brief description of what this module does.
version_added: "1.0.0"
description:
    - "A more detailed description of the module's purpose and functionality."
options:
    name:
        description:
            - A required parameter for this example.
        required: true
        type: str
author:
    - Your Name (@your-github-handle)
'''</span>

<span class="c1"># EXAMPLES provides one or more examples of how to use the module in a playbook.
</span><span class="n">EXAMPLES</span> <span class="o">=</span> <span class="s">'''
- name: Run my new module
  my_new_module:
    name: "World"
'''</span>

<span class="c1"># RETURN provides documentation on the values returned by the module upon success.
</span><span class="n">RETURN</span> <span class="o">=</span> <span class="s">'''
original_message:
    description: A message constructed from the input parameters.
    type: str
    returned: always
    sample: 'Hello, World!'
message:
    description: A static success message.
    type: str
    returned: always
    sample: 'This is a successful result from the Go module.'
'''</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_3_4_build_the_module_binary"><a class="anchor" href="#_3_4_build_the_module_binary"></a><a class="link" href="#_3_4_build_the_module_binary">5.3.4. 3.4. Build the Module Binary</a></h4>
<div class="paragraph">
<p>The project&#8217;s <code>Makefile</code> provides a target to compile all Go-based modules. This process runs inside a container to ensure a clean and consistent build environment, using the <code>scripts/build.sh</code> script.</p>
</div>
<div class="paragraph">
<p>To compile your new module, simply run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">make binaries</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the build completes, your compiled binary will be located at <code>plugins/modules/my_new_module</code>. Ansible will now be able to execute it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_handling_ci_sanity_tests"><a class="anchor" href="#_4_handling_ci_sanity_tests"></a><a class="link" href="#_4_handling_ci_sanity_tests">5.4. 4. Handling CI Sanity Tests</a></h3>
<div class="paragraph">
<p>The <code>ansible-test sanity</code> checks can cause issues with Go code. The following sections describe the required workarounds.</p>
</div>
<div class="sect3">
<h4 id="_4_1_bypassing_ansible_test_sanity_for_go_source"><a class="anchor" href="#_4_1_bypassing_ansible_test_sanity_for_go_source"></a><a class="link" href="#_4_1_bypassing_ansible_test_sanity_for_go_source">5.4.1. 4.1. Bypassing <code>ansible-test sanity</code> for Go Source</a></h4>
<div class="paragraph">
<p>The <code>ansible-test sanity</code> tool does not recognize Go source code and will fail. To prevent this, you must exclude your module&#8217;s source directory from the test.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open the <code>Makefile</code> in the root of the project.</p>
</li>
<li>
<p>Locate the <code>test-ansible-sanity</code> target.</p>
</li>
<li>
<p>Add your module&#8217;s source directory to the <code>--exclude</code> list.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example Modification in <code>Makefile</code>:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="makefile"><span class="c"># ... (other parts of the Makefile)
</span>
<span class="nl">test-ansible-sanity</span><span class="o">:</span>
	<span class="c"># ... </span><span class="o">(</span>other commands<span class="o">)</span>
	<span class="nv">$(CONTAINER_ENGINE)</span> run <span class="nt">--rm</span> <span class="se">\</span>
		<span class="nt">-v</span> <span class="nv">$(CURDIR)</span>:/work:z <span class="se">\</span>
		<span class="nv">$(AEE_IMAGE)</span> <span class="se">\</span>
		ansible-test sanity <span class="se">\</span>
		<span class="nt">--docker</span> <span class="se">\</span>
		<span class="nt">--color</span> <span class="se">\</span>
		<span class="nt">--junit</span> <span class="se">\</span>
		<span class="nt">--exclude</span> plugins/modules/src/create_server/ <span class="se">\</span>
		<span class="nt">--exclude</span> plugins/modules/src/delete_server/ <span class="se">\</span>
		<span class="nt">--exclude</span> plugins/modules/src/my_new_module/ <span class="se">\ </span><span class="c"># &lt;--- ADD THIS LINE</span>
		<span class="p">-</span><span class="nt">-skip-test</span> validate-modules <span class="se">\</span>
		<span class="nv">$(ANSIBLE_TEST_OPTS)</span>

<span class="err">#</span> <span class="err">...</span> <span class="err">(rest</span> <span class="err">of</span> <span class="err">the</span> <span class="err">Makefile)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you submit your pull request, mention this change so that it can be properly handled by the project maintainers.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_4_2_ignoring_the_gplv3_license_check"><a class="anchor" href="#_4_2_ignoring_the_gplv3_license_check"></a><a class="link" href="#_4_2_ignoring_the_gplv3_license_check">5.4.2. 4.2. Ignoring the GPLv3 License Check</a></h4>
<div class="paragraph">
<p>The sanity tests will also report a <code>missing-gplv3-license</code> error for your Python documentation file. You need to add an entry to the <code>ignore-*.txt</code> file to suppress this error.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <code>tests/sanity/</code> directory.</p>
</li>
<li>
<p>Find the <code>ignore-X.Y.txt</code> file that corresponds to the Ansible version being used (e.g., <code>ignore-2.18.txt</code>).</p>
</li>
<li>
<p>Add a line for your module&#8217;s documentation file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Example for <code>tests/sanity/ignore-2.18.txt</code>:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code># ... (other entries)
plugins/modules/create_server.py validate-modules:missing-gplv3-license
plugins/modules/delete_server.py validate-modules:missing-gplv3-license
plugins/modules/my_new_module.py validate-modules:missing-gplv3-license # &lt;--- ADD THIS LINE</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_contribution_workflow"><a class="anchor" href="#_5_contribution_workflow"></a><a class="link" href="#_5_contribution_workflow">5.5. 5. Contribution Workflow</a></h3>
<div class="paragraph">
<p>Once you have developed and tested your module, follow the standard GitHub workflow to contribute it to the project:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Fork</strong> the repository.</p>
</li>
<li>
<p>Create a new <strong>feature branch</strong>.</p>
</li>
<li>
<p><strong>Commit</strong> your changes.</p>
</li>
<li>
<p><strong>Push</strong> the branch to your fork.</p>
</li>
<li>
<p>Open a <strong>Pull Request</strong> against the main repository.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Congratulations! You are now ready to develop and contribute new Go-based Ansible modules.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_release_management"><a class="anchor" href="#_release_management"></a><a class="link" href="#_release_management">6. Release Management</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_releasing_the_os_migrate_collection"><a class="anchor" href="#_releasing_the_os_migrate_collection"></a><a class="link" href="#_releasing_the_os_migrate_collection">7. Releasing the OS Migrate collection</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Set env vars with old and new versions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OLD_VERSION=$(./toolbox/run bash -c 'cat os_migrate/galaxy.yml | shyaml get-value version')
echo "OLD_VERSION=$OLD_VERSION"

NEW_VERSION="SOME.NEW.VERSION"</pre>
</div>
</div>
<div class="paragraph">
<p>Edit the version in galaxy.yml and any hardcoded values in functional
tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sed</span> <span class="nt">-i</span> <span class="nt">-e</span> <span class="s2">"s/^version: </span><span class="nv">$OLD_VERSION</span><span class="s2">/version: </span><span class="nv">$NEW_VERSION</span><span class="s2">/"</span> ./os_migrate/galaxy.yml
<span class="nb">grep</span> <span class="nt">-lr</span> <span class="s2">"os_migrate_version: </span><span class="nv">$OLD_VERSION</span><span class="s2">"</span> ./tests | xargs <span class="nb">sed</span> <span class="nt">-i</span> <span class="nt">-e</span> <span class="s2">"s/^os_migrate_version: </span><span class="nv">$OLD_VERSION</span><span class="s2">/os_migrate_version: </span><span class="nv">$NEW_VERSION</span><span class="s2">/"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A build is required to update const.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./toolbox/run make</pre>
</div>
</div>
<div class="paragraph">
<p>Create a pull request with these changes. Once it&#8217;s merged, check out
the merge commit and release to galaxy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git checkout $MERGED_COMMIT
./toolbox/run ./scripts/publish.sh -k &lt;YOUR_GALAXY_TOKEN&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>After a successful release, create a tag on the commit you built the
release from, and push the tag to the upstream repo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git tag -m "$NEW_VERSION" "$NEW_VERSION"
# assuming the os-migrate upstream repo is named 'upstream' in your repo clone
git push upstream --tags</pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;ve incremented "X" or "Y" in "X.Y.Z" version scheme, create also
a stable branch to allow us to create ".Z" releases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>STABLE_VERSION=$(awk -F. '{ print $1 "." $2; }' &lt;&lt;&lt;"$NEW_VERSION")
git checkout -b stable/$STABLE_VERSION
git push upstream stable/$STABLE_VERSION</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-09-20 09:05:19 -0400
</div>
</div>
<script src="../assets/js/toc-fold.js"></script>
</body>
</html>