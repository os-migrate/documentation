<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>OS Migrate Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>OS Migrate Documentation</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_welcome_to_os_migrate">1. Welcome to OS Migrate</a></li>
<li><a href="#_community">2. Community</a></li>
<li><a href="#_contents">3. Contents</a></li>
<li><a href="#_os_migrate_operator_guide">4. OS Migrate Operator Guide</a>
<ul class="sectlevel2">
<li><a href="#os-migrate-overview_{context}">4.1. os-migrate overview</a></li>
<li><a href="#os-migrate-walkthrough_{context}">4.2. OS Migrate walkthrough</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites">4.2.1. Prerequisites</a></li>
</ul>
</li>
<li><a href="#"os-migrate-process-summary_{context}">4.3. How it works: Workload migration</a>
<ul class="sectlevel3">
<li><a href="#_data_flow">4.3.1. Data flow</a></li>
<li><a href="#_migration_sequence">4.3.2. Migration sequence</a></li>
</ul>
</li>
<li><a href="#"os-migrate-capacity-planning_planning">4.4. OS Migrate Capacity Planning</a>
<ul class="sectlevel3">
<li><a href="#_hardware_requirements">4.4.1. Hardware Requirements</a></li>
<li><a href="#_expectations">4.4.2. Expectations</a></li>
</ul>
</li>
<li><a href="#os-migrate-migrator-host_planning">4.5. Migrator Host Requirements</a>
<ul class="sectlevel3">
<li><a href="#_overview">4.5.1. Overview</a></li>
<li><a href="#_system_requirements">4.5.2. System Requirements</a></li>
<li><a href="#_configuration_requirements">4.5.3. Configuration Requirements</a></li>
<li><a href="#_deployment_options">4.5.4. Deployment Options</a></li>
<li><a href="#_special_considerations">4.5.5. Special Considerations</a></li>
</ul>
</li>
<li><a href="#os-migrate-conversion-host-guide_planning">4.6. Conversion Host Guide</a>
<ul class="sectlevel3">
<li><a href="#_purpose">4.6.1. Purpose</a></li>
<li><a href="#_architecture">4.6.2. Architecture</a></li>
<li><a href="#_how_it_works">4.6.3. How It Works</a></li>
<li><a href="#_configuration">4.6.4. Configuration</a></li>
<li><a href="#_usage">4.6.5. Usage</a></li>
<li><a href="#_integration_with_workload_migration">4.6.6. Integration with Workload Migration</a></li>
<li><a href="#_prerequisites_2">4.6.7. Prerequisites</a></li>
<li><a href="#_troubleshooting">4.6.8. Troubleshooting</a></li>
<li><a href="#_best_practices">4.6.9. Best Practices</a></li>
<li><a href="#_related_components">4.6.10. Related Components</a></li>
<li><a href="#_examples">4.6.11. Examples</a></li>
</ul>
</li>
<li><a href="#"os-migrate-performance-expectations_planning">4.7. OS Migrate Performance Expectations</a>
<ul class="sectlevel3">
<li><a href="#_red_hat_testing_results">4.7.1. Red Hat Testing Results</a></li>
<li><a href="#_expectations_2">4.7.2. Expectations</a></li>
<li><a href="#_formulas">4.7.3. Formulas</a></li>
</ul>
</li>
<li><a href="#"os-migrate-quickstart-guide_planning">4.8. OS Migrate Quickstart Guide</a>
<ul class="sectlevel3">
<li><a href="#_software_pre_requisites">4.8.1. Software Pre-Requisites</a></li>
<li><a href="#_installation">4.8.2. Installation</a></li>
</ul>
</li>
<li><a href="#"os-migrate-vmware-guide_planning">4.9. OS Migrate VMware Guide</a>
<ul class="sectlevel3">
<li><a href="#_workflow">4.9.1. Workflow</a></li>
<li><a href="#_features_and_supported_os">4.9.2. Features and supported OS</a></li>
<li><a href="#_usage_2">4.9.3. Usage</a></li>
</ul>
</li>
<li><a href="#_os_migrate_glossary">4.10. OS Migrate Glossary</a>
<ul class="sectlevel3">
<li><a href="#_core_concepts">4.10.1. Core Concepts</a></li>
<li><a href="#_resource_types">4.10.2. Resource Types</a></li>
<li><a href="#_migration_infrastructure">4.10.3. Migration Infrastructure</a></li>
<li><a href="#_data_management">4.10.4. Data Management</a></li>
<li><a href="#_resource_structure">4.10.5. Resource Structure</a></li>
<li><a href="#_authentication_configuration">4.10.6. Authentication &amp; Configuration</a></li>
<li><a href="#_ansible_components">4.10.7. Ansible Components</a></li>
<li><a href="#_development_testing">4.10.8. Development &amp; Testing</a></li>
<li><a href="#_container_environment">4.10.9. Container Environment</a></li>
<li><a href="#_build_deployment">4.10.10. Build &amp; Deployment</a></li>
<li><a href="#_migration_process">4.10.11. Migration Process</a></li>
</ul>
</li>
<li><a href="#"os-migrate-contributing_vmware">4.11. OS Migrate Contribution Guidelines</a>
<ul class="sectlevel3">
<li><a href="#_tbd_but_largely_based_on_combination_of_existing_guide_and_david_roberto_collaboration">4.11.1. TBD - but largely based on combination of existing guide, and David &amp; Roberto collaboration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_os_migrate_user_documentation">5. OS Migrate User Documentation</a>
<ul class="sectlevel2">
<li><a href="#_installation_from_galaxy_recommended">5.1. Installation from Galaxy (recommended)</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites_3">5.1.1. Prerequisites</a></li>
<li><a href="#_using_virtualenv_for_prerequisites">5.1.2. Using virtualenv for prerequisites</a></li>
<li><a href="#installation-1">5.1.3. Installation of OS Migrate collection</a></li>
</ul>
</li>
<li><a href="#_installation_from_source_when_customizing">5.2. Installation from source (when customizing)</a></li>
<li><a href="#_upgrading">5.3. Upgrading</a>
<ul class="sectlevel3">
<li><a href="#_collection_upgrade">5.3.1. Collection upgrade</a></li>
<li><a href="#_usage_notes_related_to_upgrading">5.3.2. Usage notes related to upgrading</a></li>
</ul>
</li>
<li><a href="#_os_migrate_walkthrough">5.4. OS Migrate Walkthrough</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites_4">5.4.1. Prerequisites</a></li>
<li><a href="#_pre_workload_migration_2">5.4.2. Pre-workload migration</a></li>
<li><a href="#_detached_volume_migration">5.4.3. Detached volume migration</a></li>
<li><a href="#_workload_migration_3">5.4.4. Workload migration</a></li>
</ul>
</li>
<li><a href="#_general_usage_notes">5.5. General usage notes</a></li>
<li><a href="#_variables_guide">5.6. Variables Guide</a>
<ul class="sectlevel3">
<li><a href="#_general_variables">5.6.1. General variables</a></li>
<li><a href="#_conversion_host_variables">5.6.2. Conversion host variables</a></li>
<li><a href="#_openstack_rest_api_tls_variables">5.6.3. OpenStack REST API TLS variables</a></li>
<li><a href="#_workload_importexport_variables">5.6.4. Workload import/export variables</a></li>
<li><a href="#_workload_migration_variables">5.6.5. Workload migration variables</a></li>
</ul>
</li>
<li><a href="#_migration_parameters_guide">5.7. Migration Parameters Guide</a>
<ul class="sectlevel3">
<li><a href="#_what_are_migration_parameters">5.7.1. What are migration parameters</a></li>
<li><a href="#_workload_migration_parameters">5.7.2. Workload migration parameters</a></li>
</ul>
</li>
<li><a href="#_how_it_works_workload_migration">5.8. How it works: Workload migration</a>
<ul class="sectlevel3">
<li><a href="#_data_flow_2">5.8.1. Data flow</a></li>
<li><a href="#_migration_sequence_2">5.8.2. Migration sequence</a></li>
</ul>
</li>
<li><a href="#_troubleshooting_2">5.9. Troubleshooting</a>
<ul class="sectlevel3">
<li><a href="#_general_tips">5.9.1. General tips</a></li>
<li><a href="#_common_issues_2">5.9.2. Common issues</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_documented_roles_in_os_migrate">6. Documented roles in os-migrate</a>
<ul class="sectlevel2">
<li><a href="#_contents_2">6.1. Contents</a></li>
</ul>
</li>
<li><a href="#_role_conversion_host">7. Role - conversion_host</a></li>
<li><a href="#_role_conversion_host_content">8. Role - conversion_host_content</a></li>
<li><a href="#_role_export_detached_volumes">9. Role - export_detached_volumes</a></li>
<li><a href="#_role_export_flavors">10. Role - export_flavors</a></li>
<li><a href="#_role_export_images">11. Role - export_images</a></li>
<li><a href="#_role_export_keypairs">12. Role - export_keypairs</a></li>
<li><a href="#_role_export_networks">13. Role - export_networks</a></li>
<li><a href="#_role_export_projects">14. Role - export_projects</a></li>
<li><a href="#_role_export_router_interfaces">15. Role - export_router_interfaces</a></li>
<li><a href="#_role_export_routers">16. Role - export_routers</a></li>
<li><a href="#_role_export_security_group_rules">17. Role - export_security_group_rules</a></li>
<li><a href="#_role_export_security_groups">18. Role - export_security_groups</a></li>
<li><a href="#_role_export_subnets">19. Role - export_subnets</a></li>
<li><a href="#_role_export_user_project_role_assignments">20. Role - export_user_project_role_assignments</a></li>
<li><a href="#_role_export_users">21. Role - export_users</a></li>
<li><a href="#_role_export_users_keypairs">22. Role - export_users_keypairs</a></li>
<li><a href="#_role_export_workloads">23. Role - export_workloads</a></li>
<li><a href="#_role_import_detached_volumes">24. Role - import_detached_volumes</a></li>
<li><a href="#_role_import_flavors">25. Role - import_flavors</a></li>
<li><a href="#_role_import_images">26. Role - import_images</a></li>
<li><a href="#_role_import_keypairs">27. Role - import_keypairs</a></li>
<li><a href="#_role_import_networks">28. Role - import_networks</a></li>
<li><a href="#_role_import_projects">29. Role - import_projects</a></li>
<li><a href="#_role_import_router_interfaces">30. Role - import_router_interfaces</a></li>
<li><a href="#_role_import_routers">31. Role - import_routers</a></li>
<li><a href="#_role_import_security_group_rules">32. Role - import_security_group_rules</a></li>
<li><a href="#_role_import_security_groups">33. Role - import_security_groups</a></li>
<li><a href="#_role_import_subnets">34. Role - import_subnets</a></li>
<li><a href="#_role_import_user_project_role_assignments">35. Role - import_user_project_role_assignments</a></li>
<li><a href="#_role_import_users">36. Role - import_users</a></li>
<li><a href="#_role_import_users_keypairs">37. Role - import_users_keypairs</a></li>
<li><a href="#_role_import_workloads">38. Role - import_workloads</a></li>
<li><a href="#_role_prelude_common">39. Role - prelude_common</a></li>
<li><a href="#_role_prelude_dst">40. Role - prelude_dst</a></li>
<li><a href="#_role_prelude_src">41. Role - prelude_src</a></li>
<li><a href="#_role_validate_data_dir">42. Role - validate_data_dir</a></li>
<li><a href="#_role_validate_resource_files">43. Role - validate_resource_files</a></li>
<li><a href="#_documented_modules_in_os_migrate">44. Documented modules in os-migrate</a>
<ul class="sectlevel2">
<li><a href="#_contents_3">44.1. Contents</a></li>
</ul>
</li>
<li><a href="#_module_auth_info">45. Module - auth_info</a></li>
<li><a href="#_module_export_detached_volume">46. Module - export_detached_volume</a></li>
<li><a href="#_module_export_flavor">47. Module - export_flavor</a></li>
<li><a href="#_module_export_image_blob">48. Module - export_image_blob</a></li>
<li><a href="#_module_export_image_meta">49. Module - export_image_meta</a></li>
<li><a href="#_module_export_keypair">50. Module - export_keypair</a></li>
<li><a href="#_module_export_network">51. Module - export_network</a></li>
<li><a href="#_module_export_project">52. Module - export_project</a></li>
<li><a href="#_module_export_router">53. Module - export_router</a></li>
<li><a href="#_module_export_router_interfaces">54. Module - export_router_interfaces</a></li>
<li><a href="#_module_export_security_group">55. Module - export_security_group</a></li>
<li><a href="#_module_export_security_group_rules">56. Module - export_security_group_rules</a></li>
<li><a href="#_module_export_subnet">57. Module - export_subnet</a></li>
<li><a href="#_module_export_user">58. Module - export_user</a></li>
<li><a href="#_module_export_user_project_role_assignment">59. Module - export_user_project_role_assignment</a></li>
<li><a href="#_module_export_workload">60. Module - export_workload</a></li>
<li><a href="#_module_import_flavor">61. Module - import_flavor</a></li>
<li><a href="#_module_import_image">62. Module - import_image</a></li>
<li><a href="#_module_import_keypair">63. Module - import_keypair</a></li>
<li><a href="#_module_import_network">64. Module - import_network</a></li>
<li><a href="#_module_import_project">65. Module - import_project</a></li>
<li><a href="#_module_import_router">66. Module - import_router</a></li>
<li><a href="#_module_import_router_interface">67. Module - import_router_interface</a></li>
<li><a href="#_module_import_security_group">68. Module - import_security_group</a></li>
<li><a href="#_module_import_security_group_rule">69. Module - import_security_group_rule</a></li>
<li><a href="#_module_import_subnet">70. Module - import_subnet</a></li>
<li><a href="#_module_import_user">71. Module - import_user</a></li>
<li><a href="#_module_import_user_project_role_assignment">72. Module - import_user_project_role_assignment</a></li>
<li><a href="#_module_import_volumes_export">73. Module - import_volumes_export</a></li>
<li><a href="#_module_import_volumes_src_cleanup">74. Module - import_volumes_src_cleanup</a></li>
<li><a href="#_module_import_volumes_transfer">75. Module - import_volumes_transfer</a></li>
<li><a href="#_module_import_workload_create_instance">76. Module - import_workload_create_instance</a></li>
<li><a href="#_module_import_workload_dst_check">77. Module - import_workload_dst_check</a></li>
<li><a href="#_module_import_workload_dst_failure_cleanup">78. Module - import_workload_dst_failure_cleanup</a></li>
<li><a href="#_module_import_workload_export_volumes">79. Module - import_workload_export_volumes</a></li>
<li><a href="#_module_import_workload_prelim">80. Module - import_workload_prelim</a></li>
<li><a href="#_module_import_workload_src_check">81. Module - import_workload_src_check</a></li>
<li><a href="#_module_import_workload_src_cleanup">82. Module - import_workload_src_cleanup</a></li>
<li><a href="#_module_import_workload_transfer_volumes">83. Module - import_workload_transfer_volumes</a></li>
<li><a href="#_module_os_conversion_host_info">84. Module - os_conversion_host_info</a></li>
<li><a href="#_module_os_keypairs_info">85. Module - os_keypairs_info</a></li>
<li><a href="#_module_os_role_assignments_info">86. Module - os_role_assignments_info</a></li>
<li><a href="#_module_os_routers_info">87. Module - os_routers_info</a></li>
<li><a href="#_module_os_security_groups_info">88. Module - os_security_groups_info</a></li>
<li><a href="#_module_read_resources">89. Module - read_resources</a></li>
<li><a href="#_module_validate_resource_files">90. Module - validate_resource_files</a></li>
<li><a href="#_os_migrate_developer_documentation">91. OS Migrate Developer Documentation</a></li>
<li><a href="#_os_migrate_design">92. OS Migrate Design</a>
<ul class="sectlevel2">
<li><a href="#_high_level_development_goals">92.1. High-level development goals</a></li>
<li><a href="#_challenges_of_the_problem_domain">92.2. Challenges of the problem domain</a></li>
<li><a href="#_basic_ansible_workflow_design">92.3. Basic Ansible workflow design</a></li>
<li><a href="#_misc">92.4. Misc</a></li>
</ul>
</li>
<li><a href="#_development_environment_setup">93. Development Environment Setup</a>
<ul class="sectlevel2">
<li><a href="#_prerequisites_5">93.1. Prerequisites</a></li>
<li><a href="#_running_e2e_tests">93.2. Running e2e tests</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites_for_e2e_test">93.2.1. Prerequisites for e2e test</a></li>
<li><a href="#_create_source_environment_and_destination_environment_projects_and_users">93.2.2. Create source environment and destination environment projects and users</a></li>
<li><a href="#_create_images">93.2.3. Create images</a></li>
<li><a href="#_create_flavors">93.2.4. Create flavors</a></li>
<li><a href="#_create_public_network">93.2.5. Create public network</a></li>
<li><a href="#_sample_e2e_config_yaml_using_the_above_prerequisites">93.2.6. Sample e2e config yaml using the above prerequisites</a></li>
<li><a href="#_run_e2e_test_using_the_os_migrate_toolbox_and_the_above_config">93.2.7. Run e2e test using the OS Migrate toolbox and the above config</a></li>
<li><a href="#_expected_output_from_successful_e2e_test_run">93.2.8. Expected output from successful e2e test run</a></li>
<li><a href="#_optional_tags_to_pass_to_e2e_tests">93.2.9. Optional tags to pass to e2e tests</a></li>
<li><a href="#_optional_playbook_variable">93.2.10. Optional playbook variable</a></li>
<li><a href="#_environment_variables">93.2.11. Environment variables</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_general_contribution_guidelines">94. General Contribution Guidelines</a>
<ul class="sectlevel2">
<li><a href="#_commit_messages_for_changelog">94.1. Commit Messages for Changelog</a>
<ul class="sectlevel3">
<li><a href="#_format">94.1.1. Format</a></li>
<li><a href="#_keeping_changelog_clean">94.1.2. Keeping Changelog Clean</a></li>
<li><a href="#_summary_first_line">94.1.3. Summary (First Line)</a></li>
<li><a href="#_message_body">94.1.4. Message Body</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_contributing_code">95. Contributing Code</a>
<ul class="sectlevel2">
<li><a href="#_adding_a_new_role">95.1. Adding a New Role</a>
<ul class="sectlevel3">
<li><a href="#_creating_the_role_skeleton_automatically">95.1.1. Creating the role skeleton automatically</a></li>
<li><a href="#_resources">95.1.2. Resources</a></li>
<li><a href="#_export_roles">95.1.3. Export Roles</a></li>
<li><a href="#_import_roles">95.1.4. Import Roles</a></li>
</ul>
</li>
<li><a href="#_writing_tests">95.2. Writing Tests</a>
<ul class="sectlevel3">
<li><a href="#_functional_tests">95.2.1. Functional Tests</a></li>
<li><a href="#_unit_tests">95.2.2. Unit Tests</a></li>
<li><a href="#_integration_tests">95.2.3. Integration Tests</a></li>
<li><a href="#_documentation_and_examples">95.2.4. Documentation and Examples</a></li>
<li><a href="#_test_execution_in_ci">95.2.5. Test Execution in CI</a></li>
<li><a href="#_review_and_inspection">95.2.6. Review and Inspection</a></li>
<li><a href="#_location_of_tests">95.2.7. Location of Tests</a></li>
<li><a href="#_special_considerations_2">95.2.8. Special Considerations</a></li>
<li><a href="#_necessary_documentation">95.2.9. Necessary Documentation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_contributing_documentation">96. Contributing Documentation</a>
<ul class="sectlevel2">
<li><a href="#_rendering_the_documentation">96.1. Rendering the Documentation</a></li>
</ul>
</li>
<li><a href="#_ansible_execution_environment_aee_images">97. Ansible Execution Environment (AEE) Images</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">97.1. Overview</a></li>
<li><a href="#_available_aee_images">97.2. Available AEE Images</a>
<ul class="sectlevel3">
<li><a href="#_os_migrate_aee">97.2.1. os-migrate AEE</a></li>
<li><a href="#_vmware_migration_kit_aee">97.2.2. vmware-migration-kit AEE</a></li>
</ul>
</li>
<li><a href="#_building_aee_images">97.3. Building AEE Images</a>
<ul class="sectlevel3">
<li><a href="#_prerequisites_6">97.3.1. Prerequisites</a></li>
<li><a href="#_building_os_migrate_aee">97.3.2. Building os-migrate AEE</a></li>
<li><a href="#_building_vmware_migration_kit_aee">97.3.3. Building vmware-migration-kit AEE</a></li>
<li><a href="#_automated_build_process">97.3.4. Automated Build Process</a></li>
<li><a href="#_release_versioning_and_tagging_strategy">97.3.5. Release Versioning and Tagging Strategy</a></li>
</ul>
</li>
<li><a href="#_using_aee_images">97.4. Using AEE Images</a>
<ul class="sectlevel3">
<li><a href="#_running_playbooks_with_aee">97.4.1. Running Playbooks with AEE</a></li>
<li><a href="#_interactive_shell_access">97.4.2. Interactive Shell Access</a></li>
<li><a href="#_volume_mounts">97.4.3. Volume Mounts</a></li>
</ul>
</li>
<li><a href="#_aee_configuration">97.5. AEE Configuration</a>
<ul class="sectlevel3">
<li><a href="#_execution_environment_definition">97.5.1. Execution Environment Definition</a></li>
<li><a href="#_customizing_aee_images">97.5.2. Customizing AEE Images</a></li>
</ul>
</li>
<li><a href="#_troubleshooting_3">97.6. Troubleshooting</a>
<ul class="sectlevel3">
<li><a href="#_secrets_and_variables_issues">97.6.1. Secrets and Variables Issues</a></li>
<li><a href="#_debugging_aee_issues">97.6.2. Debugging AEE Issues</a></li>
<li><a href="#_performance_optimization">97.6.3. Performance Optimization</a></li>
</ul>
</li>
<li><a href="#_maintenance">97.7. Maintenance</a>
<ul class="sectlevel3">
<li><a href="#_updating_aee_images">97.7.1. Updating AEE Images</a></li>
<li><a href="#_version_management">97.7.2. Version Management</a></li>
<li><a href="#_security_considerations">97.7.3. Security Considerations</a></li>
</ul>
</li>
<li><a href="#_best_practices_2">97.8. Best Practices</a>
<ul class="sectlevel3">
<li><a href="#_development_workflow">97.8.1. Development Workflow</a></li>
<li><a href="#_production_usage">97.8.2. Production Usage</a></li>
<li><a href="#_documentation">97.8.3. Documentation</a></li>
</ul>
</li>
<li><a href="#_todo">97.9. TODO</a>
<ul class="sectlevel3">
<li><a href="#_collection_installation_improvements">97.9.1. Collection Installation Improvements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_releasing_the_os_migrate_collection">98. Releasing the OS Migrate collection</a></li>
<li><a href="#_installing_vagrant_directly_on_host_alternative_path">99. Installing Vagrant directly on host (alternative path)</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_welcome_to_os_migrate"><a class="anchor" href="#_welcome_to_os_migrate"></a><a class="link" href="#_welcome_to_os_migrate">1. Welcome to OS Migrate</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>OS Migrate is an open source toolbox for parallel cloud migration
between OpenStack clouds. Parallel cloud migration is a way to
modernize an OpenStack deployment. Instead of upgrading an OpenStack
cluster in place, a second OpenStack cluster is deployed alongside,
and tenant content is migrated from the original cluster to the new
one. As hardware resources free up in the original cluster, they can
be gradually added to the new cluster.</p>
</div>
<div class="paragraph">
<p>OS Migrate provides a framework for exporting and importing resources
between two clouds. It&#8217;s a collection of Ansible playbooks that
provide the basic functionality, but may not fit each use case out of
the box. You can craft custom playbooks using the OS Migrate
collection pieces (roles and modules) as building blocks.</p>
</div>
<div class="paragraph">
<p>OS Migrate strictly uses the official OpenStack API and does not
utilize direct database access or other methods to export or import
data. The Ansible playbooks contained in OS Migrate are idempotent.
If a command fails, you can retry with the same command.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_community"><a class="anchor" href="#_community"></a><a class="link" href="#_community">2. Community</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://github.com/os-migrate/os-migrate">source code of OS Migrate</a>
is hosted on GitHub.</p>
</div>
<div class="paragraph">
<p>For issue reports please use the GitHub
<a href="https://github.com/os-migrate/os-migrate/issues">OS Migrate issue tracker</a>.</p>
</div>
<div class="paragraph">
<p>To get help, feel free to also create an
<a href="https://github.com/os-migrate/os-migrate/issues">issue</a>
on GitHub with your question.</p>
</div>
<div class="paragraph">
<p>For a more interactive chat, join the Matrix room
<a href="https://app.element.io/#/room/#os-migrate:matrix.org">#os-migrate:matrix.org</a>.</p>
</div>
<div class="paragraph">
<p>If you want to contribute to the project (code, docs, &#8230;&#8203;), please
refer to the <a href="devel/README.adoc">developer docs</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contents"><a class="anchor" href="#_contents"></a><a class="link" href="#_contents">3. Contents</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_os_migrate_operator_guide"><a class="anchor" href="#_os_migrate_operator_guide"></a><a class="link" href="#_os_migrate_operator_guide">4. OS Migrate Operator Guide</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide provides comprehensive information for operators planning and executing OpenStack cloud migrations using OS Migrate.</p>
</div>
<div class="paragraph">
<p>ifdev::context[:parent-context: {context}]</p>
</div>
<div class="sect2">
<h3 id="os-migrate-overview_{context}"><a class="anchor" href="#os-migrate-overview_{context}"></a><a class="link" href="#os-migrate-overview_{context}">4.1. os-migrate overview</a></h3>
<div class="paragraph">
<p>OS-Migrate is a toolsuite designed to assist in the process of moving OpenStack workloads from one environment to another. Please read tthe entire workflow notes in order to be sufficiently prepared for this endeavour.</p>
</div>
<div class="paragraph">
<p>ifdev::context[:parent-context: {context}]</p>
</div>
</div>
<div class="sect2">
<h3 id="os-migrate-walkthrough_{context}"><a class="anchor" href="#os-migrate-walkthrough_{context}"></a><a class="link" href="#os-migrate-walkthrough_{context}">4.2. OS Migrate walkthrough</a></h3>
<div class="paragraph">
<p>OS Migrate is a framework for OpenStack parallel cloud migration
(migrating content between OpenStack tenants which are not necessarily
in the same cloud). It&#8217;s a collection of Ansible playbooks that provide
the basic functionality, but may not fit each use case out of the box.
You can craft custom playbooks using the OS Migrate collection pieces
(roles and modules) as building blocks.</p>
</div>
<div class="paragraph">
<p>Parallel cloud migration is a way to modernize an OpenStack deployment.
Instead of upgrading an OpenStack cluster in place, a second OpenStack
cluster is deployed alongside, and tenant content is migrated from the
original cluster to the new one. Parallel cloud migration is best suited
for environments which are due for a hardware refresh cycle. It may also
be performed without a hardware refresh, but extra hardware resources
are needed to bootstrap the new cluster. As hardware resources free up
in the original cluster, they can be gradually added to the new cluster.</p>
</div>
<div class="paragraph">
<p>OS Migrate strictly uses the official OpenStack API and does not utilize
direct database access or other methods to export or import data. The
Ansible playbooks contained in OS Migrate are idempotent. If a command
fails, you can retry with the same command.</p>
</div>
<div class="paragraph">
<p>The migration is generally performed in this sequence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prerequisites: prepare authentication info, parameter files,</p>
</li>
<li>
<p>pre-workload migration, which copies applicable resources into the
destination cloud (e.g.networks, security groups, images) while
workloads keep running in the source cloud,</p>
</li>
<li>
<p>workload migration, which stops usage of applicable resources in the
source cloud and moves them into the destination cloud (VMs,
volumes).</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a><a class="link" href="#_prerequisites">4.2.1. Prerequisites</a></h4>
<div class="sect4">
<h5 id="_authentication"><a class="anchor" href="#_authentication"></a><a class="link" href="#_authentication">Authentication</a></h5>
<div class="paragraph">
<p>Users are encouraged to use os-migrate using specific credentials for
each project/tenant, this means <strong>not using the admin user to execute
the resources migration</strong> (unless the resource is owned by the admin
project, e.g. public Glance images).</p>
</div>
<div class="paragraph">
<p>In case the circumstances require migrating by the <code>admin</code> user,
this user needs to have access to the respective projects. There are
two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <code>admin</code> user as a <code><em>member</em></code> of each project.</p>
<div class="literalblock">
<div class="content">
<pre>Depending on how many projects need to be migrated this approach seems
to be suboptimal as there are involved several configuration updates in
the projects that will need to be reverted after the migration
completes.</pre>
</div>
</div>
</li>
<li>
<p>Create a group including the admin user and add the group to each
project as member.</p>
<div class="literalblock">
<div class="content">
<pre>The difference with this approach is that once the migration is
completed, by removing the group, all the references in all the projects
will be removed automatically.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_parameter_file"><a class="anchor" href="#_parameter_file"></a><a class="link" href="#_parameter_file">Parameter file</a></h5>
<div class="paragraph">
<p>Let&#8217;s create an <code>os-migrate-vars.yml</code> file with Ansible variables:</p>
</div>
<div class="listingblock">
<div class="title">YAML Ansible Variables</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">   <span class="na">os_migrate_src_auth</span><span class="pi">:</span>
     <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://192.168.0.13.199/v3</span>
     <span class="na">password</span><span class="pi">:</span> <span class="s">srcpassword</span>
     <span class="na">project_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
     <span class="na">project_name</span><span class="pi">:</span> <span class="s">src</span>
     <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
     <span class="na">username</span><span class="pi">:</span> <span class="s">src</span>
   <span class="na">os_migrate_src_region_name</span><span class="pi">:</span> <span class="s">regionOne</span>
   <span class="na">os_migrate_dst_auth</span><span class="pi">:</span>
     <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://192.167.0.16:5000/v3</span>
     <span class="na">password</span><span class="pi">:</span> <span class="s">dstpassword</span>
     <span class="na">project_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
     <span class="na">project_name</span><span class="pi">:</span> <span class="s">dst</span>
     <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
     <span class="na">username</span><span class="pi">:</span> <span class="s">dst</span>
   <span class="na">os_migrate_dst_region_name</span><span class="pi">:</span> <span class="s">regionOne</span>
   <span class="na">os_migrate_data_dir</span><span class="pi">:</span> <span class="s">/home/migrator/os-migrate-data</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The file contains the source and destination tenant credentials, a
directory on the migrator host (typically localhost) and a directory
where the exported data will be saved.</p>
</div>
<div class="paragraph">
<p><strong>If you are migrating content from multiple source projects, make
sure to use a separate data directory for each source project.</strong> In
other words, when changing <code>os_migrate_src_auth</code> or
<code>os_migrate_src_region_name</code>, make sure to also change
<code>os_migrate_data_dir</code>.</p>
</div>
<div class="paragraph">
<div class="title">A note about Keystone v2</div>
<p>As depicted in content of the previously defined <code>os-migrate-vars.yml</code>
file, the parameters <code>os_migrate_src_auth</code> and <code>os_migrate_dst_auth</code>
refer to the usage of Keystone v3. In the case of a user needing to
execute a migration between tenants not supporting Keystone v3 the
following error will be raised:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>keystoneauth1.exceptions.discovery.DiscoveryFailure: Cannot use v2 authentication with domain scope</pre>
</div>
</div>
<div class="paragraph">
<p>To fix this issue, the user must adjust their auth parameters:</p>
</div>
<div class="listingblock">
<div class="title">YAML Keystone V2 Auth Params</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">   <span class="na">os_migrate_src_auth</span><span class="pi">:</span>
     <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://192.168.0.13.199/v2.0</span>
     <span class="na">password</span><span class="pi">:</span> <span class="s">srcpassword</span>
     <span class="na">project_name</span><span class="pi">:</span> <span class="s">src</span>
     <span class="na">username</span><span class="pi">:</span> <span class="s">src</span>
   <span class="na">os_migrate_src_region_name</span><span class="pi">:</span> <span class="s">regionOne</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the parameters <code>project_domain_name</code> and
<code>user_domain_name</code> are removed and the <code>auth_url</code> parameter points
to the Keystone v2 endpoint.</p>
</div>
<div class="sect5">
<h6 id="_shortcuts"><a class="anchor" href="#_shortcuts"></a><a class="link" href="#_shortcuts">Shortcuts</a></h6>
<div class="paragraph">
<p>We will use the OS Migrate collection path and an ansible-playbook
command with the following arguments routinely, so let&#8217;s save them as
variables in the shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>export OSM_DIR=/home/migrator/.ansible/collections/ansible_collections/os_migrate/os_migrate
export OSM_CMD="ansible-playbook -v -i $OSM_DIR/localhost_inventory.yml -e @os-migrate-vars.yml"</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pre_workload_migration"><a class="anchor" href="#_pre_workload_migration"></a><a class="link" href="#_pre_workload_migration">Pre-workload migration</a></h5>
<div class="paragraph">
<p>Workloads require the support of several resources in a given cloud to
operate properly. Some of these resources include networks, subnets,
routers, router interfaces, security groups, and security group rules.
The pre-workload migration process includes exporting these resources
from the source cloud onto the migrator machine, the option to edit the
resources if desired, and importing them into the destination cloud.</p>
</div>
<div class="paragraph">
<p>Exporting or importing resources is enabled by running the corresponding
playbook from OS Migrate. Let&#8217;s look at a concrete example. To export
the networks, run the "export_networks" playbook.</p>
</div>
<div class="sect5">
<h6 id="_export_and_import"><a class="anchor" href="#_export_and_import"></a><a class="link" href="#_export_and_import">Export and import</a></h6>
<div class="paragraph">
<p>To export the networks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$OSM_CMD $OSM_DIR/playbooks/export_networks.yml</pre>
</div>
</div>
<div class="paragraph">
<p>This will create networks.yml file in the data directory, similar to
this:</p>
</div>
<div class="listingblock">
<div class="title">Networks YAML example</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">   <span class="na">os_migrate_version</span><span class="pi">:</span> <span class="s">0.17.0</span>
   <span class="na">resources</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="na">_info</span><span class="pi">:</span>
         <span class="na">availability_zones</span><span class="pi">:</span>
           <span class="pi">-</span> <span class="s">nova</span>
         <span class="na">created_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-04-07T14:08:30Z'</span>
         <span class="na">id</span><span class="pi">:</span> <span class="s">a1eb31f6-2cdc-4896-b582-8950dafa34aa</span>
         <span class="na">project_id</span><span class="pi">:</span> <span class="s">2f444c71265048f7a9d21f81db6f21a4</span>
         <span class="na">qos_policy_id</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">revision_number</span><span class="pi">:</span> <span class="m">3</span>
         <span class="na">status</span><span class="pi">:</span> <span class="s">ACTIVE</span>
         <span class="na">subnet_ids</span><span class="pi">:</span>
           <span class="pi">-</span> <span class="s">a5052e10-5e00-432b-a826-29695677aca0</span>
           <span class="pi">-</span> <span class="s">d450ffd0-972e-4398-ab49-6ba9e29e2499</span>
         <span class="na">updated_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-04-07T14:08:34Z'</span>
       <span class="na">params</span><span class="pi">:</span>
         <span class="na">availability_zone_hints</span><span class="pi">:</span> <span class="pi">[]</span>
         <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">'</span>
         <span class="na">dns_domain</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">is_admin_state_up</span><span class="pi">:</span> <span class="no">true</span>
         <span class="na">is_default</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">is_port_security_enabled</span><span class="pi">:</span> <span class="no">true</span>
         <span class="na">is_router_external</span><span class="pi">:</span> <span class="no">false</span>
         <span class="na">is_shared</span><span class="pi">:</span> <span class="no">false</span>
         <span class="na">is_vlan_transparent</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">mtu</span><span class="pi">:</span> <span class="m">1450</span>
         <span class="na">name</span><span class="pi">:</span> <span class="s">osm_net</span>
         <span class="na">provider_network_type</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">provider_physical_network</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">provider_segmentation_id</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">qos_policy_name</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">segments</span><span class="pi">:</span> <span class="no">null</span>
       <span class="na">type</span><span class="pi">:</span> <span class="s">openstack.network.Network</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You may edit the file as needed and then run the "import_networks"
playbook to import the networks from this file into the destination
cloud:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$OSM_CMD $OSM_DIR/playbooks/import_networks.yml</pre>
</div>
</div>
<div class="paragraph">
<p>You can repeat this process for other resources like subnets, security
groups, security group rules, routers, router interfaces, images and
keypairs.</p>
</div>
<div class="paragraph">
<p>For a full list of available playbooks, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ls $OSM_DIR/playbooks</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_diagrams"><a class="anchor" href="#_diagrams"></a><a class="link" href="#_diagrams">Diagrams</a></h6>
<div class="paragraph">
<p>///TODO need to figure out these UMLs in the source
.. figure:: ../images/plantuml/render/pre-workload-migration-workflow.png
   :alt: Pre-workload Migration (workflow)
   :width: 50%</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Pre-workload Migration (workflow)</pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>figure:: ../images/plantuml/render/pre-workload-migration-data-flow.png
:alt: Pre-workload Migration (data flow)
:width: 50%</p>
<div class="literalblock">
<div class="content">
<pre>Pre-workload Migration (data flow)</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="_demo"><a class="anchor" href="#_demo"></a><a class="link" href="#_demo">Demo</a></h6>
<div class="paragraph">
<p>///TODO: Video link
`Pre-workload migration recorded demo &lt;<a href="https://youtu.be/e7KXy5Hq4CMA&gt;`_" class="bare">https://youtu.be/e7KXy5Hq4CMA&gt;`_</a>:</p>
</div>
<div class="paragraph">
<p>|Watch the video1|</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_workload_migration"><a class="anchor" href="#_workload_migration"></a><a class="link" href="#_workload_migration">Workload migration</a></h5>
<div class="paragraph">
<p>Workload information is exported in a similar method to networks,
security groups, etc. as in the previous sections. Run the
"export_workloads" playbook, and edit the resulting workloads.yml as
desired:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">   <span class="na">os_migrate_version</span><span class="pi">:</span> <span class="s">0.17.0</span>
   <span class="na">resources</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">_info</span><span class="pi">:</span>
       <span class="na">addresses</span><span class="pi">:</span>
         <span class="na">external_network</span><span class="pi">:</span>
         <span class="pi">-</span> <span class="s">OS-EXT-IPS-MAC:mac_addr: fa:16:3e:98:19:a0</span>
           <span class="s">OS-EXT-IPS:type: fixed</span>
           <span class="s">addr</span><span class="err">:</span> <span class="s">10.19.2.41</span>
           <span class="s">version</span><span class="err">:</span> <span class="m">4</span>
       <span class="na">flavor_id</span><span class="pi">:</span> <span class="s">a96b2815-3525-4eea-9ab4-14ba58e17835</span>
       <span class="na">id</span><span class="pi">:</span> <span class="s">0025f062-f684-4e02-9da2-3219e011ec74</span>
       <span class="na">status</span><span class="pi">:</span> <span class="s">SHUTOFF</span>
     <span class="na">params</span><span class="pi">:</span>
       <span class="na">flavor_name</span><span class="pi">:</span> <span class="s">m1.small</span>
       <span class="na">name</span><span class="pi">:</span> <span class="s">migration-vm</span>
       <span class="na">security_group_names</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">testing123</span>
       <span class="pi">-</span> <span class="s">default</span>
     <span class="na">type</span><span class="pi">:</span> <span class="s">openstack.compute.Server</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this playbook only extracts metadata about servers in the
specified tenant - it does not download OpenStack volumes directly to
the migration data directory. Data transfer is handled by the
import_workloads playbook. The data is transfered directly between the
clouds, meaning both clouds have to be running and reachable at the
same time. The following sections describe the process in more detail.</p>
</div>
<div class="sect5">
<h6 id="_process_summary"><a class="anchor" href="#_process_summary"></a><a class="link" href="#_process_summary">Process Summary</a></h6>
<div class="paragraph">
<p>This flowchart illustrates the high-level migration workflow, from a
user&#8217;s point of view:</p>
</div>
<div class="paragraph">
<p>///TODO UML image
.. figure:: ../images/plantuml/render/workload-migration-workflow.png
   :alt: Workload migration (workflow)
   :width: 50%</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Workload migration (workflow)</pre>
</div>
</div>
<div class="paragraph">
<p>The process involves the deployment of a "conversion host" on source
and destination clouds. A conversion host is an OpenStack server which
will be used to transfer binary volume data from the source to the
destination cloud. The conversion hosts are expected to be created
from CentOS 9 or RHEL 8 cloud images.</p>
</div>
<div class="paragraph">
<p>The following diagram helps explain the need for a conversion host VM:</p>
</div>
<div class="paragraph">
<p>///TODO UML image
.. figure:: ../images/plantuml/render/workload-migration-data-flow.png
   :alt: Workload migration (data flow)
   :width: 80%</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Workload migration (data flow)</pre>
</div>
</div>
<div class="paragraph">
<p>This shows that volumes on the source and destination clouds are
removed from their original VMs and attached to their respective
conversion hosts, and then transferred over the network from the
source conversion host to the destination. The tooling inside the
conversion host migrates one server by automating these actions on
the source and destination clouds:</p>
</div>
<div class="paragraph">
<p>Source Cloud:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Detach volumes from the target server to migrate</p>
</li>
<li>
<p>Attach the volumes to the source conversion host</p>
</li>
<li>
<p>Export the volumes as block devices and wait for destination
conversion host to connect</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Destination Cloud:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create new volumes on the destination conversion host, one for each source volume</p>
</li>
<li>
<p>Attach the new volumes to the destination conversion host</p>
</li>
<li>
<p>Connect to the block devices exported by source conversion host, and copy the data to the new attached volumes</p>
</li>
<li>
<p>Detach the volumes from the destination conversion host</p>
</li>
<li>
<p>Create a new server using the new volumes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This method keeps broad compatibility with the various flavors and
configurations of OpenStack using as much of an API-only approach as
possible, while allowing the use of libguestfs-based tooling to minimize
total data transfer.</p>
</div>
</div>
<div class="sect5">
<h6 id="_preparation"><a class="anchor" href="#_preparation"></a><a class="link" href="#_preparation">Preparation</a></h6>
<div class="paragraph">
<p>We&#8217;ll put additional parameters into <code>os-migrate-vars.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">   <span class="na">os_migrate_conversion_external_network_name</span><span class="pi">:</span> <span class="s">public</span>
   <span class="na">os_migrate_conversion_flavor_name</span><span class="pi">:</span> <span class="s">m1.large</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These define the flavor and external network we want to use for our
conversion hosts.</p>
</div>
<div class="paragraph">
<p>By default the migration will use an image named <code>os_migrate_conv</code> for
conversion hosts. Make sure this image exists in Glance on both clouds.
Currently it should be a
<a href="https://cloud.centos.org/centos/9-stream/x86_64/images/CentOS-Stream-GenericCloud-9-20220914.0.x86_64.qcow2">CentOS 9 Cloud Image</a>
or
<a href="https://access.redhat.com/downloads/content/479/ver=/rhel---8/8.3/x86_64/product-software">RHEL 8 KVM Guest Image</a></p>
</div>
<div class="paragraph">
<p>When using RHEL as conversion host, make sure to set the necessary <a href="https://os-migrate.github.io/os-migrate/user/variables-guide.html#conversion-host-rhel-variables">RHEL Variables</a></p>
</div>
</div>
<div class="sect5">
<h6 id="_conversion_host_deployment"><a class="anchor" href="#_conversion_host_deployment"></a><a class="link" href="#_conversion_host_deployment">Conversion host deployment</a></h6>
<div class="paragraph">
<p>The conversion host deployment playbook creates the servers, installs
additional required packages, and authorizes the destination conversion
host to connect to the source conversion host for the actual data
transfer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$OSM_CMD $OSM_DIR/playbooks/deploy_conversion_hosts.yml</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_export"><a class="anchor" href="#_export"></a><a class="link" href="#_export">Export</a></h6>
<div class="paragraph">
<p>Before migrating workloads, the destination cloud must have imported all
other resources (networks, security groups, etc.) or the migration will
fail. Matching named resources (including flavor names) must exist on
the destination before the servers are created.</p>
</div>
<div class="paragraph">
<p>Export workload information with the export_workloads playbook. Each
server listed in the resulting workloads.yml will be migrated,
except for the one matching the name given to the source conversion
host server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$OSM_CMD $OSM_DIR/playbooks/export_workloads.yml</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting workloads.yml file will look similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml">   <span class="na">os_migrate_version</span><span class="pi">:</span> <span class="s">0.17.0</span>
   <span class="na">resources</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="na">_info</span><span class="pi">:</span>
       <span class="na">created_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-11-12T17:55:40Z'</span>
       <span class="na">flavor_id</span><span class="pi">:</span> <span class="s">cd6258f9-c34b-4a9c-a1e2-8cb81826781e</span>
       <span class="na">id</span><span class="pi">:</span> <span class="s">af615f8c-378a-4a2e-be6a-b4d38a954242</span>
       <span class="na">launched_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-11-12T17:56:00.000000'</span>
       <span class="na">security_group_ids</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="s">1359ec88-4873-40d2-aa0b-18ad0588f107</span>
       <span class="na">status</span><span class="pi">:</span> <span class="s">SHUTOFF</span>
       <span class="na">updated_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-11-12T17:56:30Z'</span>
       <span class="na">user_id</span><span class="pi">:</span> <span class="s">48be0a2e86a84682b8e4992a65d39e3e</span>
     <span class="na">_migration_params</span><span class="pi">:</span>
       <span class="na">boot_disk_copy</span><span class="pi">:</span> <span class="no">false</span>
     <span class="na">params</span><span class="pi">:</span>
       <span class="na">availability_zone</span><span class="pi">:</span> <span class="s">nova</span>
       <span class="na">config_drive</span><span class="pi">:</span> <span class="no">null</span>
       <span class="na">description</span><span class="pi">:</span> <span class="s">osm_server</span>
       <span class="na">disk_config</span><span class="pi">:</span> <span class="s">MANUAL</span>
       <span class="na">flavor_ref</span><span class="pi">:</span>
         <span class="na">domain_name</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">name</span><span class="pi">:</span> <span class="s">m1.xtiny</span>
         <span class="na">project_name</span><span class="pi">:</span> <span class="no">null</span>
       <span class="na">image_ref</span><span class="pi">:</span>
         <span class="na">domain_name</span><span class="pi">:</span> <span class="no">null</span>
         <span class="na">name</span><span class="pi">:</span> <span class="s">cirros-0.4.0-x86_64-disk.img</span>
         <span class="na">project_name</span><span class="pi">:</span> <span class="no">null</span>
       <span class="na">key_name</span><span class="pi">:</span> <span class="s">osm_key</span>
       <span class="na">metadata</span><span class="pi">:</span> <span class="pi">{}</span>
       <span class="na">name</span><span class="pi">:</span> <span class="s">osm_server</span>
       <span class="na">ports</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">_info</span><span class="pi">:</span>
           <span class="na">device_id</span><span class="pi">:</span> <span class="s">af615f8c-378a-4a2e-be6a-b4d38a954242</span>
           <span class="na">device_owner</span><span class="pi">:</span> <span class="s">compute:nova</span>
           <span class="na">id</span><span class="pi">:</span> <span class="s">cf5d73c3-089b-456b-abb9-dc5da988844e</span>
         <span class="na">_migration_params</span><span class="pi">:</span> <span class="pi">{}</span>
         <span class="na">params</span><span class="pi">:</span>
           <span class="na">fixed_ips_refs</span><span class="pi">:</span>
           <span class="pi">-</span> <span class="na">ip_address</span><span class="pi">:</span> <span class="s">192.168.20.7</span>
             <span class="na">subnet_ref</span><span class="pi">:</span>
               <span class="na">domain_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
               <span class="na">name</span><span class="pi">:</span> <span class="s">osm_subnet</span>
               <span class="na">project_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
           <span class="na">network_ref</span><span class="pi">:</span>
             <span class="na">domain_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
             <span class="na">name</span><span class="pi">:</span> <span class="s">osm_net</span>
             <span class="na">project_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
         <span class="na">type</span><span class="pi">:</span> <span class="s">openstack.network.ServerPort</span>
       <span class="na">scheduler_hints</span><span class="pi">:</span> <span class="no">null</span>
       <span class="na">security_group_refs</span><span class="pi">:</span>
       <span class="pi">-</span> <span class="na">domain_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
         <span class="na">name</span><span class="pi">:</span> <span class="s">osm_security_group</span>
         <span class="na">project_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
       <span class="na">tags</span><span class="pi">:</span> <span class="pi">[]</span>
       <span class="na">user_data</span><span class="pi">:</span> <span class="no">null</span>
     <span class="na">type</span><span class="pi">:</span> <span class="s">openstack.compute.Server</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_migration_parameters"><a class="anchor" href="#_migration_parameters"></a><a class="link" href="#_migration_parameters">Migration parameters</a></h6>
<div class="paragraph">
<p>///TODO next chapter, inc. link
You can edit the exported <code>workloads.yml</code> to adjust desired
properties for the servers which will be created in the destination
cloud during migration. You can also edit migration parameters to
control how a workload should be migrated. Refer to
`Migration Parameters Guide &lt;migration-params-guide.html&gt;`_
for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="_ansible_variables"><a class="anchor" href="#_ansible_variables"></a><a class="link" href="#_ansible_variables">Ansible Variables</a></h6>
<div class="paragraph">
<p>///TODO next chapter, inc. link
In addition to the migration parameters in the resource YAML files,
you can alter the behavior of OS Migrate via Ansible variables,
e.g. to specify a subset of resources/workloads that will be exported
or imported. Refer to the `Variables Guide &lt;variables-guide.html&gt;`_ for
details.</p>
</div>
</div>
<div class="sect5">
<h6 id="_migration"><a class="anchor" href="#_migration"></a><a class="link" href="#_migration">Migration</a></h6>
<div class="paragraph">
<p>Then run the import_workloads playbook to migrate the workloads:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$OSM_CMD $OSM_DIR/playbooks/import_workloads.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Any server marked "changed" should be successfully migrated to the
destination cloud. Servers are "skipped" if they match the name or
ID of the specified conversion host. If there is already an server
on the destination matching the name of the current server, it will
be marked "ok" and no extra work will be performed.</p>
</div>
</div>
<div class="sect5">
<h6 id="_cleanup_of_conversion_hosts"><a class="anchor" href="#_cleanup_of_conversion_hosts"></a><a class="link" href="#_cleanup_of_conversion_hosts">Cleanup of conversion hosts</a></h6>
<div class="paragraph">
<p>When you are done migrating workloads in given tenants, delete their
conversion hosts via the delete_conversion_hosts playbook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$OSM_CMD $OSM_DIR/playbooks/delete_conversion_hosts.yml</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_demo_2"><a class="anchor" href="#_demo_2"></a><a class="link" href="#_demo_2">Demo</a></h6>
<div class="paragraph">
<p><a href="https://youtu.be/gEKvgIZqrQY">Workload migration recorded demo</a></p>
</div>
<div class="paragraph">
<p>ifdev::context[:parent-context: {context}]</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id=""os-migrate-process-summary_{context}"><a class="anchor" href="#"os-migrate-process-summary_{context}"></a><a class="link" href="#"os-migrate-process-summary_{context}">4.3. How it works: Workload migration</a></h3>
<div class="paragraph">
<p>The information described in this page is not necessary knowledge for
using OS Migrate workload migration. However, knowing how the
migration works under the hood may be useful for troubleshooting or
forming deeper understanding of OS Migrate.</p>
</div>
<div class="sect3">
<h4 id="_data_flow"><a class="anchor" href="#_data_flow"></a><a class="link" href="#_data_flow">4.3.1. Data flow</a></h4>
<div class="paragraph">
<p>The workload migration utilizes so called <strong>conversion hosts</strong> to
transfer data from the source cloud to the destination cloud.</p>
</div>
<div class="paragraph">
<p>The conversion hosts are temporarily deployed in the source &amp;
destination projects. Being in the same project as the source (and
destination, respectively) VMs ensures that the conversion hosts will
have access to the data that needs to be migrated (snapshots and
volumes).</p>
</div>
<div class="paragraph">
<p>///TODO need to figure out these UMLs in the source
.. figure:: ../images/plantuml/render/workload-migration-data-flow.png
   :alt: Workload migration (data flow)
   :width: 80%</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Workload migration (data flow)</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_migration_sequence"><a class="anchor" href="#_migration_sequence"></a><a class="link" href="#_migration_sequence">4.3.2. Migration sequence</a></h4>
<div class="paragraph">
<p>The <code>export_workloads.yml</code> playbook simply exports workload metadata
into <code>workloads.yml</code>.</p>
</div>
<div class="paragraph">
<p>The actual main migration sequence happens inside
<code>import_workloads.yml</code> playbook and the <code>import_workloads</code>
role. The initial common steps are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The resources loaded from <code>workloads.yml</code> are validated.</p>
</li>
<li>
<p>Resources are filtered according to <code>os_migrate_workloads_filter</code>.</p>
</li>
<li>
<p>Reachability of source &amp; destination conversion hosts is verified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you&#8217;re defaulting to the default storage migration mode <code>data_copy</code>
then the role starts iterating over all workloads that passed the
filter. The steps performed for each workload (Nova Server) are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>import_workload_prelim</code> module creates log and state files
under <code>{{ os_migrate_data_dir }}/workload_logs</code>. It also takes
care of skipping migration of VMs that already exist in the
destination, and skipping of conversion hosts, should such
migration be attempted.</p>
</li>
<li>
<p>The <code>import_workload_dst_check</code> module checks whether migration
prerequisites are satisfied in the destination cloud/project. This
means verifying that resources which are referenced by name from
the workload serialization can be de-referenced in the destination
cloud. In other words, this verifies the networks, subnets etc.,
that the destination VM should be attached to, indeed exist in the
destination cloud.</p>
</li>
<li>
<p>If <code>os_migrate_workload_stop_before_migration</code> is <code>true</code>, the VM
in the source cloud is stopped.</p>
</li>
<li>
<p>The <code>import_workload_src_check</code> checks whether the source workload
is ready to be migrated. This means verifying that the Nova Server
is <code>SHUTOFF</code>.</p>
</li>
<li>
<p>The <code>import_workload_export_volumes</code> module prepares data for
transfer to the destination cloud:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>boot_disk_copy</code> is <code>true</code>, a snapshot of the source VM is
created, converted to a Cinder volume and attached to the source
conversion host.</p>
</li>
<li>
<p>Additional Cinder volumes attached to the source VM are detached
from it and attached to the source conversion host.</p>
</li>
<li>
<p>All VM&#8217;s volumes (boot &amp; additional) on the conversion host are
exported as NBD drives, listening on localhost only.</p>
</li>
<li>
<p>The <code>import_workload_transfer_volumes</code> copies data from source to
destination:</p>
</li>
<li>
<p>SSH port forwarding is created for the NBD drives of the source
conversion host, so that they are accessible on the destination
conversion host, again on localhost only. (The data transfer
mechanism could be described as "NBD over SSH".)</p>
</li>
<li>
<p>Cinder volumes are created in the destination project for both
the boot disk and additional volumes (as applicable). The
destination volume sizes match the volume sizes in the source
cloud. The volumes are attached to the destination conversion
host.</p>
</li>
<li>
<p>Sparsification of the NBDs is performed, only for recognizable
filesystems that the <code>virt-sparsify</code> tool supports. This
significantly speeds up copying of empty space on supported
filesystems.</p>
</li>
<li>
<p>Data is copied from the NBDs to the respective destination Cinder
volumes.</p>
</li>
<li>
<p>SSH port forwarding for the NBDs are closed, and volumes are
detached from the destination conversion host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>import_workload_create_instance</code> creates new Nova server in
the destination cloud according to the data from the resource
serialization, and using the copied Cinder volumes as applicable.</p>
</li>
<li>
<p>The <code>import_workload_src_cleanup</code> cleans up after the migration in
the source cloud. It closes the NBD exports, detaches volumes from
the conversion host, deletes the temporary boot disk snapshot
volume and re-attaches any additional volumes back onto the
source VM (as applicable).</p>
</li>
<li>
<p>In case of failure during the migration, the
<code>import_workload_src_cleanup</code> module is executed too, and an
extra <code>import_workload_dst_failure_cleanup</code> module is executed,
which aims to clean up failed partial migration from the
destination cloud. (In case of successful migration, no further
clean up is necessary in the destination cloud.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ifdev::context[:parent-context: planning]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id=""os-migrate-capacity-planning_planning"><a class="anchor" href="#"os-migrate-capacity-planning_planning"></a><a class="link" href="#"os-migrate-capacity-planning_planning">4.4. OS Migrate Capacity Planning</a></h3>
<div class="sect3">
<h4 id="_hardware_requirements"><a class="anchor" href="#_hardware_requirements"></a><a class="link" href="#_hardware_requirements">4.4.1. Hardware Requirements</a></h4>

</div>
<div class="sect3">
<h4 id="_expectations"><a class="anchor" href="#_expectations"></a><a class="link" href="#_expectations">4.4.2. Expectations</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="os-migrate-migrator-host_planning"><a class="anchor" href="#os-migrate-migrator-host_planning"></a><a class="link" href="#os-migrate-migrator-host_planning">4.5. Migrator Host Requirements</a></h3>
<div class="sect3">
<h4 id="_overview"><a class="anchor" href="#_overview"></a><a class="link" href="#_overview">4.5.1. Overview</a></h4>
<div class="paragraph">
<p>The migrator host is the machine that executes OS Migrate Ansible playbooks and serves as the orchestration point for OpenStack cloud migrations. It can be deployed as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A source cloud instance</p>
</li>
<li>
<p>A third-party machine (physical/virtual)</p>
</li>
<li>
<p>An Ansible Execution Environment (container)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_system_requirements"><a class="anchor" href="#_system_requirements"></a><a class="link" href="#_system_requirements">4.5.2. System Requirements</a></h4>
<div class="sect4">
<h5 id="_operating_system"><a class="anchor" href="#_operating_system"></a><a class="link" href="#_operating_system">Operating System</a></h5>
<div class="ulist">
<ul>
<li>
<p>Recommended: CentOS Stream 10 or RHEL 9.5+</p>
</li>
<li>
<p>Alternative: Any Linux distribution with virtio-win package 1.40 (for workload migrations)</p>
</li>
<li>
<p>Container environments supported for Ansible Execution Environments</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_software_dependencies"><a class="anchor" href="#_software_dependencies"></a><a class="link" href="#_software_dependencies">Software Dependencies</a></h5>
<div class="sect5">
<h6 id="_core_requirements"><a class="anchor" href="#_core_requirements"></a><a class="link" href="#_core_requirements">Core Requirements</a></h6>
<div class="ulist">
<ul>
<li>
<p>Python: 3.7+ (badges show 3.7+, container uses 3.12)</p>
</li>
<li>
<p>Ansible: 2.9+ minimum (current: 11.7.0)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_python_packages"><a class="anchor" href="#_python_packages"></a><a class="link" href="#_python_packages">Python Packages</a></h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">ansible==11.7.0
ansible-lint==25.6.1
openstacksdk==1.5.1
python-openstackclient==6.3.0
passlib==1.7.4
PyYAML==6.0.2</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_ansible_collections"><a class="anchor" href="#_ansible_collections"></a><a class="link" href="#_ansible_collections">Ansible Collections</a></h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="text">community.crypto: "&gt;=1.4.0"
community.general: "&lt;5.0.0"
openstack.cloud: "&gt;=2.3.0,&lt;2.4.0"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_storage_requirements"><a class="anchor" href="#_storage_requirements"></a><a class="link" href="#_storage_requirements">Storage Requirements</a></h5>
<div class="ulist">
<ul>
<li>
<p>Sufficient disk space in os_migrate_data_dir (default: /home/migrator/os-migrate-data)</p>
</li>
<li>
<p>Separate data directories required for each source project migration</p>
</li>
<li>
<p>Additional space for volume conversion during workload migrations</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_network_access"><a class="anchor" href="#_network_access"></a><a class="link" href="#_network_access">Network Access</a></h5>
<div class="ulist">
<ul>
<li>
<p>Outbound: HTTPS access to both source and destination OpenStack APIs</p>
</li>
<li>
<p>Inbound: SSH access if used as remote conversion host</p>
</li>
<li>
<p>Bandwidth: Adequate for volume/image data transfer during migrations</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_requirements"><a class="anchor" href="#_configuration_requirements"></a><a class="link" href="#_configuration_requirements">4.5.3. Configuration Requirements</a></h4>
<div class="sect4">
<h5 id="_authentication_2"><a class="anchor" href="#_authentication_2"></a><a class="link" href="#_authentication_2">Authentication</a></h5>
<div class="ulist">
<ul>
<li>
<p>Valid OpenStack credentials for both source and destination clouds</p>
</li>
<li>
<p>clouds.yaml configuration or environment variables</p>
</li>
<li>
<p>Support for Keystone v2/v3 authentication types</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_inventory_configuration"><a class="anchor" href="#_inventory_configuration"></a><a class="link" href="#_inventory_configuration">Inventory Configuration</a></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">migrator</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
    <span class="na">localhost</span><span class="pi">:</span>
      <span class="na">ansible_connection</span><span class="pi">:</span> <span class="s">local</span>
      <span class="na">ansible_python_interpreter</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_playbook_python</span><span class="nv"> </span><span class="s">}}"</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_required_variables"><a class="anchor" href="#_required_variables"></a><a class="link" href="#_required_variables">Required Variables</a></h5>
<div class="ulist">
<ul>
<li>
<p>os_migrate_src_auth: Source cloud authentication</p>
</li>
<li>
<p>os_migrate_dst_auth: Destination cloud authentication</p>
</li>
<li>
<p>os_migrate_data_dir: Migration data storage location</p>
</li>
<li>
<p>Region and API version configurations as needed</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deployment_options"><a class="anchor" href="#_deployment_options"></a><a class="link" href="#_deployment_options">4.5.4. Deployment Options</a></h4>
<div class="sect4">
<h5 id="_1_source_cloud_instance"><a class="anchor" href="#_1_source_cloud_instance"></a><a class="link" href="#_1_source_cloud_instance">1. Source Cloud Instance</a></h5>
<div class="ulist">
<ul>
<li>
<p>Pros: Close network proximity to source resources</p>
</li>
<li>
<p>Cons: Resource consumption on source cloud</p>
</li>
<li>
<p>Use case: When destination cloud has limited external access</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_2_third_party_machine"><a class="anchor" href="#_2_third_party_machine"></a><a class="link" href="#_2_third_party_machine">2. Third-Party Machine</a></h5>
<div class="ulist">
<ul>
<li>
<p>Pros: Independent resource allocation, flexible placement</p>
</li>
<li>
<p>Cons: Network latency considerations</p>
</li>
<li>
<p>Use case: Large migrations, dedicated migration infrastructure</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_3_ansible_execution_environment"><a class="anchor" href="#_3_ansible_execution_environment"></a><a class="link" href="#_3_ansible_execution_environment">3. Ansible Execution Environment</a></h5>
<div class="ulist">
<ul>
<li>
<p>Pros: Consistent, portable, containerized execution</p>
</li>
<li>
<p>Cons: Container orchestration complexity</p>
</li>
<li>
<p>Use case: CI/CD pipelines, automated migrations</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_special_considerations"><a class="anchor" href="#_special_considerations"></a><a class="link" href="#_special_considerations">4.5.5. Special Considerations</a></h4>
<div class="sect4">
<h5 id="_workload_migration_2"><a class="anchor" href="#_workload_migration_2"></a><a class="link" href="#_workload_migration_2">Workload Migration</a></h5>
<div class="ulist">
<ul>
<li>
<p>Additional conversion host may be required for instance migrations</p>
</li>
<li>
<p>SSH key access to conversion hosts</p>
</li>
<li>
<p>Volume attachment/detachment capabilities</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_multi_project_migrations"><a class="anchor" href="#_multi_project_migrations"></a><a class="link" href="#_multi_project_migrations">Multi-Project Migrations</a></h5>
<div class="ulist">
<ul>
<li>
<p>Separate data directories for each source project</p>
</li>
<li>
<p>Proper isolation of migration data</p>
</li>
<li>
<p>Sequential or parallel execution planning</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_security"><a class="anchor" href="#_security"></a><a class="link" href="#_security">Security</a></h5>
<div class="ulist">
<ul>
<li>
<p>No direct database access (API-only operations)</p>
</li>
<li>
<p>Secure credential management</p>
</li>
<li>
<p>Network security between clouds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>ifdev::context[:parent-context: planning]</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="os-migrate-conversion-host-guide_planning"><a class="anchor" href="#os-migrate-conversion-host-guide_planning"></a><a class="link" href="#os-migrate-conversion-host-guide_planning">4.6. Conversion Host Guide</a></h3>
<div class="paragraph">
<p>The conversion host role is a critical component of OS Migrate for migrating OpenStack workloads (instances) and their associated volumes between OpenStack clouds. It deploys dedicated compute instances that act as intermediary hosts for data transfer and conversion operations during workload migration.</p>
</div>
<div class="sect3">
<h4 id="_purpose"><a class="anchor" href="#_purpose"></a><a class="link" href="#_purpose">4.6.1. Purpose</a></h4>
<div class="paragraph">
<p>Conversion hosts serve as temporary staging instances that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data Transfer</strong>: Facilitate the transfer of workload disk data between source and destination clouds</p>
</li>
<li>
<p><strong>Format Conversion</strong>: Handle disk format conversions if needed between different storage backends</p>
</li>
<li>
<p><strong>Network Bridging</strong>: Provide network connectivity between source and destination environments</p>
</li>
<li>
<p><strong>Migration Orchestration</strong>: Execute the complex multi-step process of workload migration</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_architecture"><a class="anchor" href="#_architecture"></a><a class="link" href="#_architecture">4.6.2. Architecture</a></h4>
<div class="paragraph">
<p>The conversion host system consists of two main Ansible roles:</p>
</div>
<div class="sect4">
<h5 id="_conversion_host_role"><a class="anchor" href="#_conversion_host_role"></a><a class="link" href="#_conversion_host_role"><code>conversion_host</code> Role</a></h5>
<div class="paragraph">
<p><strong>Location</strong>: <code>/roles/conversion_host/</code></p>
</div>
<div class="paragraph">
<p><strong>Purpose</strong>: Deploys the infrastructure and compute instances needed for conversion hosts.</p>
</div>
<div class="paragraph">
<p><strong>Key Responsibilities</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creates networking infrastructure (networks, subnets, routers, security groups)</p>
</li>
<li>
<p>Generates SSH keypairs for secure communication</p>
</li>
<li>
<p>Deploys conversion host instances in both source and destination clouds</p>
</li>
<li>
<p>Configures floating IPs for external connectivity</p>
</li>
<li>
<p>Sets up security group rules for SSH and ICMP access</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_content_role"><a class="anchor" href="#_conversion_host_content_role"></a><a class="link" href="#_conversion_host_content_role"><code>conversion_host_content</code> Role</a></h5>
<div class="paragraph">
<p><strong>Location</strong>: <code>/roles/conversion_host_content/</code></p>
</div>
<div class="paragraph">
<p><strong>Purpose</strong>: Installs and configures software packages on the conversion hosts.</p>
</div>
<div class="paragraph">
<p><strong>Key Responsibilities</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Installs OS-specific packages (supports CentOS and RHEL)</p>
</li>
<li>
<p>Configures RHEL subscription management if needed</p>
</li>
<li>
<p>Sets up SSH keys for inter-host communication</p>
</li>
<li>
<p>Enables password access if required</p>
</li>
<li>
<p>Runs pre/post installation hooks</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_it_works"><a class="anchor" href="#_how_it_works"></a><a class="link" href="#_how_it_works">4.6.3. How It Works</a></h4>
<div class="sect4">
<h5 id="_deployment_process"><a class="anchor" href="#_deployment_process"></a><a class="link" href="#_deployment_process">Deployment Process</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Infrastructure Setup</strong> (<code>conversion_host</code> role):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Network Infrastructure</span>
<span class="pi">-</span> <span class="na">Creates conversion network (default</span><span class="pi">:</span> <span class="s">os_migrate_conv)</span>
<span class="pi">-</span> <span class="s">Creates subnet with CIDR 192.168.10.0/24</span>
<span class="pi">-</span> <span class="s">Creates router connected to external network</span>
<span class="pi">-</span> <span class="s">Creates security group with SSH/ICMP rules</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Instance Deployment</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Source Cloud Instance</span>
<span class="na">os_migrate_src_conversion_host_name</span><span class="pi">:</span> <span class="s">os_migrate_conv_src</span>

<span class="c1"># Destination Cloud Instance</span>
<span class="na">os_migrate_dst_conversion_host_name</span><span class="pi">:</span> <span class="s">os_migrate_conv_dst</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>SSH Key Configuration</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Generates keypair for conversion host access</p>
</li>
<li>
<p>Configures authorized keys on source host</p>
</li>
<li>
<p>Installs private key on destination host for srcdst communication</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Software Installation</strong> (<code>conversion_host_content</code> role):</p>
<div class="ulist">
<ul>
<li>
<p>Installs required packages based on OS distribution</p>
</li>
<li>
<p>Configures any RHEL subscriptions</p>
</li>
<li>
<p>Sets up conversion tools and dependencies</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_migration_workflow_integration"><a class="anchor" href="#_migration_workflow_integration"></a><a class="link" href="#_migration_workflow_integration">Migration Workflow Integration</a></h5>
<div class="paragraph">
<p>During workload migration, conversion hosts are used in the following workflow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Volume Export</strong>: Source conversion host exports volumes from source cloud storage</p>
</li>
<li>
<p><strong>Data Transfer</strong>: Volumes are transferred from source to destination conversion host</p>
</li>
<li>
<p><strong>Volume Import</strong>: Destination conversion host imports volumes to destination storage</p>
</li>
<li>
<p><strong>Instance Creation</strong>: New instance is created using imported volumes</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_network_architecture"><a class="anchor" href="#_network_architecture"></a><a class="link" href="#_network_architecture">Network Architecture</a></h5>
<div class="literalblock">
<div class="content">
<pre>Source Cloud                 Destination Cloud
+------------------+        +------------------+
| Conversion Host  |        | Conversion Host  |
| (os_migrate_conv)|   SSH  | (os_migrate_conv)|
| 192.168.10.x     |&lt;------&gt;| 192.168.10.x     |
+------------------+        +------------------+
         |                           |
    [Floating IP]              [Floating IP]
         |                           |
    [External Net]             [External Net]</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration"><a class="anchor" href="#_configuration"></a><a class="link" href="#_configuration">4.6.4. Configuration</a></h4>
<div class="sect4">
<h5 id="_required_variables_2"><a class="anchor" href="#_required_variables_2"></a><a class="link" href="#_required_variables_2">Required Variables</a></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Must be defined</span>
<span class="na">os_migrate_conversion_flavor_name</span><span class="pi">:</span> <span class="s">m1.large</span>
<span class="na">os_migrate_conversion_external_network_name</span><span class="pi">:</span> <span class="s">public</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_network_configuration"><a class="anchor" href="#_network_configuration"></a><a class="link" href="#_network_configuration">Network Configuration</a></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Network settings (with defaults)</span>
<span class="na">os_migrate_conversion_net_name</span><span class="pi">:</span> <span class="s">os_migrate_conv</span>
<span class="na">os_migrate_conversion_subnet_name</span><span class="pi">:</span> <span class="s">os_migrate_conv</span>
<span class="na">os_migrate_conversion_subnet_cidr</span><span class="pi">:</span> <span class="s">192.168.10.0/24</span>
<span class="na">os_migrate_conversion_subnet_alloc_start</span><span class="pi">:</span> <span class="s">192.168.10.10</span>
<span class="na">os_migrate_conversion_subnet_alloc_end</span><span class="pi">:</span> <span class="s">192.168.10.99</span>
<span class="na">os_migrate_conversion_router_name</span><span class="pi">:</span> <span class="s">os_migrate_conv</span>
<span class="na">os_migrate_conversion_router_ip</span><span class="pi">:</span> <span class="s">192.168.10.1</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_host_configuration"><a class="anchor" href="#_host_configuration"></a><a class="link" href="#_host_configuration">Host Configuration</a></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Instance settings</span>
<span class="na">os_migrate_src_conversion_host_name</span><span class="pi">:</span> <span class="s">os_migrate_conv_src</span>
<span class="na">os_migrate_dst_conversion_host_name</span><span class="pi">:</span> <span class="s">os_migrate_conv_dst</span>
<span class="na">os_migrate_conversion_image_name</span><span class="pi">:</span> <span class="s">os_migrate_conv</span>
<span class="na">os_migrate_conversion_host_ssh_user</span><span class="pi">:</span> <span class="s">cloud-user</span>

<span class="c1"># Boot from volume options</span>
<span class="na">os_migrate_src_conversion_host_boot_from_volume</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">os_migrate_dst_conversion_host_boot_from_volume</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">os_migrate_src_conversion_host_volume_size</span><span class="pi">:</span> <span class="m">20</span>
<span class="na">os_migrate_dst_conversion_host_volume_size</span><span class="pi">:</span> <span class="s">20</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_security_configuration"><a class="anchor" href="#_security_configuration"></a><a class="link" href="#_security_configuration">Security Configuration</a></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># SSH and security</span>
<span class="na">os_migrate_conversion_keypair_name</span><span class="pi">:</span> <span class="s">os_migrate_conv</span>
<span class="na">os_migrate_conversion_keypair_private_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">os_migrate_data_dir</span><span class="nv"> </span><span class="s">}}/conversion/ssh.key"</span>
<span class="na">os_migrate_conversion_secgroup_name</span><span class="pi">:</span> <span class="s">os_migrate_conv</span>

<span class="c1"># Password access (disabled by default)</span>
<span class="na">os_migrate_conversion_host_ssh_user_enable_password_access</span><span class="pi">:</span> <span class="no">false</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_management_options"><a class="anchor" href="#_management_options"></a><a class="link" href="#_management_options">Management Options</a></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Infrastructure management</span>
<span class="na">os_migrate_conversion_manage_network</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">os_migrate_conversion_manage_fip</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">os_migrate_conversion_delete_fip</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># Content installation</span>
<span class="na">os_migrate_conversion_host_content_install</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># Deployment control</span>
<span class="na">os_migrate_deploy_src_conversion_host</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">os_migrate_deploy_dst_conversion_host</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">os_migrate_link_conversion_hosts</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">os_migrate_reboot_conversion_hosts</span><span class="pi">:</span> <span class="no">false</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a><a class="link" href="#_usage">4.6.5. Usage</a></h4>
<div class="sect4">
<h5 id="_deploy_conversion_hosts"><a class="anchor" href="#_deploy_conversion_hosts"></a><a class="link" href="#_deploy_conversion_hosts">Deploy Conversion Hosts</a></h5>
<div class="paragraph">
<p>Use the provided playbook to deploy conversion hosts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-playbook os_migrate.os_migrate.deploy_conversion_hosts</code></pre>
</div>
</div>
<div class="paragraph">
<p>This playbook will:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy source conversion host infrastructure and instance</p>
</li>
<li>
<p>Deploy destination conversion host infrastructure and instance</p>
</li>
<li>
<p>Configure SSH linking between hosts</p>
</li>
<li>
<p>Install required software packages</p>
</li>
<li>
<p>Perform health checks</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_delete_conversion_hosts"><a class="anchor" href="#_delete_conversion_hosts"></a><a class="link" href="#_delete_conversion_hosts">Delete Conversion Hosts</a></h5>
<div class="paragraph">
<p>Clean up conversion hosts and their infrastructure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-playbook os_migrate.os_migrate.delete_conversion_hosts</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_manual_role_usage"><a class="anchor" href="#_manual_role_usage"></a><a class="link" href="#_manual_role_usage">Manual Role Usage</a></h5>
<div class="paragraph">
<p>You can also use the roles directly for more control:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Deploy source conversion host</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy source conversion host</span>
  <span class="na">include_role</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate.conversion_host</span>
  <span class="na">vars</span><span class="pi">:</span>
    <span class="na">os_migrate_conversion_cloud</span><span class="pi">:</span> <span class="s">src</span>
    <span class="na">os_migrate_conversion_host_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">os_migrate_src_conversion_host_name</span><span class="nv"> </span><span class="s">}}"</span>
    <span class="c1"># ... other source-specific variables</span>

<span class="c1"># Deploy destination conversion host</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy destination conversion host</span>
  <span class="na">include_role</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate.conversion_host</span>
  <span class="na">vars</span><span class="pi">:</span>
    <span class="na">os_migrate_conversion_cloud</span><span class="pi">:</span> <span class="s">dst</span>
    <span class="na">os_migrate_conversion_host_name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">os_migrate_dst_conversion_host_name</span><span class="nv"> </span><span class="s">}}"</span>
    <span class="c1"># ... other destination-specific variables</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_integration_with_workload_migration"><a class="anchor" href="#_integration_with_workload_migration"></a><a class="link" href="#_integration_with_workload_migration">4.6.6. Integration with Workload Migration</a></h4>
<div class="paragraph">
<p>Conversion hosts are automatically used during workload migration when:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Workload Export/Import</strong>: The <code>import_workloads</code> role checks conversion host status</p>
</li>
<li>
<p><strong>Data Copy Operations</strong>: Volume data is transferred via conversion hosts</p>
</li>
<li>
<p><strong>Health Checks</strong>: Ensures conversion hosts are active and reachable before migration</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>os_conversion_host_info</code> module provides runtime information about conversion hosts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get conversion host info</span>
  <span class="na">os_migrate.os_migrate.os_conversion_host_info</span><span class="pi">:</span>
    <span class="na">cloud</span><span class="pi">:</span> <span class="s">src</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">os_migrate_src_conversion_host_name</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="na">register</span><span class="pi">:</span> <span class="s">conversion_host_info</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites_2"><a class="anchor" href="#_prerequisites_2"></a><a class="link" href="#_prerequisites_2">4.6.7. Prerequisites</a></h4>
<div class="sect4">
<h5 id="_cloud_requirements"><a class="anchor" href="#_cloud_requirements"></a><a class="link" href="#_cloud_requirements">Cloud Requirements</a></h5>
<div class="ulist">
<ul>
<li>
<p><strong>Flavor</strong>: Adequate flavor for conversion operations (recommended: &gt;= 2 vCPU, 4GB RAM)</p>
</li>
<li>
<p><strong>Image</strong>: Compatible base image (CentOS/RHEL with cloud-init)</p>
</li>
<li>
<p><strong>Network</strong>: External network for floating IP assignment</p>
</li>
<li>
<p><strong>Quotas</strong>: Sufficient quota for additional instances, networks, and floating IPs</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_permissions"><a class="anchor" href="#_permissions"></a><a class="link" href="#_permissions">Permissions</a></h5>
<div class="paragraph">
<p>The deployment requires OpenStack permissions for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Instance creation/deletion</p>
</li>
<li>
<p>Network resource management (networks, subnets, routers)</p>
</li>
<li>
<p>Security group management</p>
</li>
<li>
<p>Keypair management</p>
</li>
<li>
<p>Floating IP allocation</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a><a class="link" href="#_troubleshooting">4.6.8. Troubleshooting</a></h4>
<div class="sect4">
<h5 id="_common_issues"><a class="anchor" href="#_common_issues"></a><a class="link" href="#_common_issues">Common Issues</a></h5>
<div class="paragraph">
<p><strong>1. Conversion Host Not Reachable</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre># Check conversion host status
- os_conversion_host_info module will fail if host is not ACTIVE
- Verify floating IP assignment
- Check security group rules allow SSH (port 22)</pre>
</div>
</div>
<div class="paragraph">
<p><strong>2. Network Connectivity Issues</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre># Verify network configuration
- External network name is correct
- Router has gateway set to external network
- DNS nameservers are accessible (default: 8.8.8.8)</pre>
</div>
</div>
<div class="paragraph">
<p><strong>3. SSH Key Problems</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre># Key file permissions
- Private key must have 0600 permissions
- Public key must be accessible to Ansible
- Verify keypair exists in OpenStack</pre>
</div>
</div>
<div class="paragraph">
<p><strong>4. Package Installation Failures</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre># RHEL subscription issues
- Check RHEL subscription configuration
- Verify repository access
- Review pre/post content hooks</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_debugging_steps"><a class="anchor" href="#_debugging_steps"></a><a class="link" href="#_debugging_steps">Debugging Steps</a></h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Check Conversion Host Status</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Debug conversion host</span>
  <span class="na">os_migrate.os_migrate.os_conversion_host_info</span><span class="pi">:</span>
    <span class="na">cloud</span><span class="pi">:</span> <span class="s">src</span>
    <span class="na">server</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">os_migrate_src_conversion_host_name</span><span class="nv"> </span><span class="s">}}"</span>
  <span class="na">register</span><span class="pi">:</span> <span class="s">debug_info</span>

<span class="pi">-</span> <span class="na">debug</span><span class="pi">:</span> <span class="s">var=debug_info</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Verify Network Connectivity</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test SSH connectivity</span>
  <span class="na">wait_for</span><span class="pi">:</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">22</span>
    <span class="na">host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">conversion_host_ip</span><span class="nv"> </span><span class="s">}}"</span>
    <span class="na">timeout</span><span class="pi">:</span> <span class="s">60</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Check Infrastructure</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Verify OpenStack resources exist</span>
openstack server list <span class="nt">--name</span> os_migrate_conv
openstack network list <span class="nt">--name</span> os_migrate_conv
openstack security group list <span class="nt">--name</span> os_migrate_conv</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_best_practices"><a class="anchor" href="#_best_practices"></a><a class="link" href="#_best_practices">4.6.9. Best Practices</a></h4>
<div class="sect4">
<h5 id="_security_2"><a class="anchor" href="#_security_2"></a><a class="link" href="#_security_2">Security</a></h5>
<div class="ulist">
<ul>
<li>
<p>Use dedicated keypairs for conversion hosts</p>
</li>
<li>
<p>Limit security group rules to necessary ports only</p>
</li>
<li>
<p>Consider using specific subnets for conversion traffic</p>
</li>
<li>
<p>Disable password authentication unless specifically required</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_performance"><a class="anchor" href="#_performance"></a><a class="link" href="#_performance">Performance</a></h5>
<div class="ulist">
<ul>
<li>
<p>Choose appropriate flavors with sufficient CPU and memory</p>
</li>
<li>
<p>Consider boot-from-volume for larger disk operations</p>
</li>
<li>
<p>Use local storage-optimized flavors when available</p>
</li>
<li>
<p>Monitor network bandwidth during large migrations</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_cleanup"><a class="anchor" href="#_cleanup"></a><a class="link" href="#_cleanup">Cleanup</a></h5>
<div class="ulist">
<ul>
<li>
<p>Always clean up conversion hosts after migration</p>
</li>
<li>
<p>Set <code>os_migrate_conversion_delete_fip: true</code> to clean floating IPs</p>
</li>
<li>
<p>Use the delete playbook to ensure complete cleanup</p>
</li>
<li>
<p>Monitor for orphaned resources after deletion</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_testing"><a class="anchor" href="#_testing"></a><a class="link" href="#_testing">Testing</a></h5>
<div class="ulist">
<ul>
<li>
<p>Test conversion host deployment in development environment first</p>
</li>
<li>
<p>Verify connectivity between source and destination hosts</p>
</li>
<li>
<p>Test package installation and configuration</p>
</li>
<li>
<p>Validate migration workflow with small test instances</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_related_components"><a class="anchor" href="#_related_components"></a><a class="link" href="#_related_components">4.6.10. Related Components</a></h4>
<div class="ulist">
<ul>
<li>
<p><strong><code>import_workloads</code> role</strong>: Uses conversion hosts for actual migration operations</p>
</li>
<li>
<p><strong><code>os_conversion_host_info</code> module</strong>: Provides runtime host information</p>
</li>
<li>
<p><strong>Volume migration modules</strong>: Transfer data via conversion hosts</p>
</li>
<li>
<p><strong>Workload migration utilities</strong>: Coordinate conversion host operations</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_examples"><a class="anchor" href="#_examples"></a><a class="link" href="#_examples">4.6.11. Examples</a></h4>
<div class="sect4">
<h5 id="_basic_deployment"><a class="anchor" href="#_basic_deployment"></a><a class="link" href="#_basic_deployment">Basic Deployment</a></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Minimal configuration for conversion host deployment</span>
<span class="na">os_migrate_conversion_flavor_name</span><span class="pi">:</span> <span class="s">m1.large</span>
<span class="na">os_migrate_conversion_external_network_name</span><span class="pi">:</span> <span class="s">public</span>
<span class="na">os_migrate_src_conversion_image_name</span><span class="pi">:</span> <span class="s">centos-stream-9</span>
<span class="na">os_migrate_dst_conversion_image_name</span><span class="pi">:</span> <span class="s">centos-stream-9</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_configuration"><a class="anchor" href="#_advanced_configuration"></a><a class="link" href="#_advanced_configuration">Advanced Configuration</a></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Advanced configuration with custom networks</span>
<span class="na">os_migrate_conversion_flavor_name</span><span class="pi">:</span> <span class="s">m1.xlarge</span>
<span class="na">os_migrate_conversion_external_network_name</span><span class="pi">:</span> <span class="s">external</span>
<span class="na">os_migrate_src_conversion_net_name</span><span class="pi">:</span> <span class="s">migration_src_net</span>
<span class="na">os_migrate_dst_conversion_net_name</span><span class="pi">:</span> <span class="s">migration_dst_net</span>
<span class="na">os_migrate_conversion_subnet_cidr</span><span class="pi">:</span> <span class="s">10.10.10.0/24</span>
<span class="na">os_migrate_src_conversion_host_boot_from_volume</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">os_migrate_dst_conversion_host_boot_from_volume</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">os_migrate_src_conversion_host_volume_size</span><span class="pi">:</span> <span class="m">50</span>
<span class="na">os_migrate_dst_conversion_host_volume_size</span><span class="pi">:</span> <span class="s">50</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>ifdev::context[:parent-context: planning]</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id=""os-migrate-performance-expectations_planning"><a class="anchor" href="#"os-migrate-performance-expectations_planning"></a><a class="link" href="#"os-migrate-performance-expectations_planning">4.7. OS Migrate Performance Expectations</a></h3>
<div class="sect3">
<h4 id="_red_hat_testing_results"><a class="anchor" href="#_red_hat_testing_results"></a><a class="link" href="#_red_hat_testing_results">4.7.1. Red Hat Testing Results</a></h4>

</div>
<div class="sect3">
<h4 id="_expectations_2"><a class="anchor" href="#_expectations_2"></a><a class="link" href="#_expectations_2">4.7.2. Expectations</a></h4>

</div>
<div class="sect3">
<h4 id="_formulas"><a class="anchor" href="#_formulas"></a><a class="link" href="#_formulas">4.7.3. Formulas</a></h4>
<div class="paragraph">
<p>ifdev::context[:parent-context: planning]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id=""os-migrate-quickstart-guide_planning"><a class="anchor" href="#"os-migrate-quickstart-guide_planning"></a><a class="link" href="#"os-migrate-quickstart-guide_planning">4.8. OS Migrate Quickstart Guide</a></h3>
<div class="sect3">
<h4 id="_software_pre_requisites"><a class="anchor" href="#_software_pre_requisites"></a><a class="link" href="#_software_pre_requisites">4.8.1. Software Pre-Requisites</a></h4>

</div>
<div class="sect3">
<h4 id="_installation"><a class="anchor" href="#_installation"></a><a class="link" href="#_installation">4.8.2. Installation</a></h4>
<div class="paragraph">
<p>ifdev::context[:parent-context: planning]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id=""os-migrate-vmware-guide_planning"><a class="anchor" href="#"os-migrate-vmware-guide_planning"></a><a class="link" href="#"os-migrate-vmware-guide_planning">4.9. OS Migrate VMware Guide</a></h3>
<div class="paragraph">
<p>An important auxilliary function included in OS Migrate is our VMware tooling,
which allows you to migrade a virtual machine from an ESXi/Vcenter environment
to OpenStack or OpenShift environments.</p>
</div>
<div class="paragraph">
<p>The code used os-migrate Ansible collection in order to deploy conversion host and setup
correctly the prerequists in the Openstack destination cloud.
It also used the vmware community collection in order to gather informations from the source
VMWare environment.</p>
</div>
<div class="paragraph">
<p>The Ansible collection provides different steps to scale your migration from VMWare to Openstack
and Openshift:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A discovery phase where it analizes the VMWare source environment and provides collected data
to help for the migration.</p>
</li>
<li>
<p>A pre-migration phase where it make sure the destionation cloud is ready to perform the migration,
by creating the conversion host for example or the required network if needed.</p>
</li>
<li>
<p>A migration phase with different workflow where the user can basicaly scale the migration with
a very number of virtual machines as entry point, or can migrate sensitive virtual machine by using
a near zero down time with the change block tracking VMWare option (CBT) and so perform the virtual
machine migration in two steps. The migration can also be done without conversion host.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_workflow"><a class="anchor" href="#_workflow"></a><a class="link" href="#_workflow">4.9.1. Workflow</a></h4>
<div class="paragraph">
<p>There is different ways to run the migration from VMWare to OpenStack.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default is by using nbdkit server with a conversion host (an Openstack instance hosted in the destination cloud).
This way allow the user to use the CBT option and approach a zero downtime. It can also run the migration in one time cycle.</p>
</li>
<li>
<p>The second one by using virt-v2v binding with a conversion host. Here you can use a conversion
host (Openstack instance) already deployed or you can let OS-Migrate deployed a conversion host
for you.</p>
</li>
<li>
<p>A third way is available where you can skip the conversion host and perform the migration on a Linux machine, the volume
migrated and converted will be upload a Glance image or can be use later as a Cinder volume. This way is not recommended if
you have big disk or a huge amount of VMs to migrate: the performance are really slower than with the other ways.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All of these are configurable with Ansible boolean variables.</p>
</div>
</div>
<div class="sect3">
<h4 id="_features_and_supported_os"><a class="anchor" href="#_features_and_supported_os"></a><a class="link" href="#_features_and_supported_os">4.9.2. Features and supported OS</a></h4>
<div class="sect4">
<h5 id="_features"><a class="anchor" href="#_features"></a><a class="link" href="#_features">Features</a></h5>
<div class="paragraph">
<p>The following features are availables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Discovery mode</p>
</li>
<li>
<p>Network mapping</p>
</li>
<li>
<p>Port creation and mac addresses mapping</p>
</li>
<li>
<p>Openstack flavor mapping and creation</p>
</li>
<li>
<p>Migration with nbdkit server with change block tracking feature (CBT)</p>
</li>
<li>
<p>Migration with virt-v2v</p>
</li>
<li>
<p>Upload migrate volume via Glance</p>
</li>
<li>
<p>Multi disks migration</p>
</li>
<li>
<p>Multi nics</p>
</li>
<li>
<p>Parallel migration on a same conversion host</p>
</li>
<li>
<p>Ansible Automation Platform (AAP)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_supported_os"><a class="anchor" href="#_supported_os"></a><a class="link" href="#_supported_os">Supported OS</a></h5>
<div class="paragraph">
<p>Currently we are supporting the following matrice:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OS Family</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Supported &amp; Tested</th>
<th class="tableblock halign-left valign-top">Not Tested Yet</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.3 and lower</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RHEL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8.4 and lower</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CentOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ubuntu Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2k22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_nbdkit_migration_example"><a class="anchor" href="#_nbdkit_migration_example"></a><a class="link" href="#_nbdkit_migration_example">Nbdkit migration example</a></h5>
<div class="imageblock">
<div class="content">
<img src="images/osm-migration-nbdkit-vmware-workflow-with-osm.drawio.svg" alt="Ndbkit">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_nbdkit_migration_example_with_the_change_block_tracking"><a class="anchor" href="#_nbdkit_migration_example_with_the_change_block_tracking"></a><a class="link" href="#_nbdkit_migration_example_with_the_change_block_tracking">Nbdkit migration example with the Change Block Tracking</a></h5>
<div class="sect5">
<h6 id="_step_1_the_data_are_copied_and_the_change_id_from_the_vmware_disk_are_set_to_the_cinder_volume_as_metadata"><a class="anchor" href="#_step_1_the_data_are_copied_and_the_change_id_from_the_vmware_disk_are_set_to_the_cinder_volume_as_metadata"></a><a class="link" href="#_step_1_the_data_are_copied_and_the_change_id_from_the_vmware_disk_are_set_to_the_cinder_volume_as_metadata">Step 1: The data are copied and the change ID from the VMware disk are set to the Cinder volume as metadata</a></h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The conversion cannot be made at this moment, and the OS instance is not created.
This functionality can be used for large disks with a lot of data to transfer. It helps avoid a prolonged service interruption.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/osm-migration-nbdkit-vmware-workflow-with-osm_cbt_step1.svg" alt="CBT Step 1">
</div>
</div>
<div class="paragraph">
<p>==== Step 2: OSM compare the source (VMware disk) and the destination (Openstack Volume) change ID</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the change IDs are not equal, the changed blocks between the source and destination are synced.
Then, the conversion to libvirt/KVM is triggered, and the OpenStack instance is created.
This allows for minimal downtime for the VMs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/osm-migration-nbdkit-vmware-workflow-with-osm_cbt_step2.svg" alt="CBT Step 2">
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_migration_demo_from_an_aee"><a class="anchor" href="#_migration_demo_from_an_aee"></a><a class="link" href="#_migration_demo_from_an_aee">Migration demo from an AEE</a></h5>
<div class="paragraph">
<p>The content of the Ansible Execution Environment could be find here:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/os-migrate/aap/blob/main/aae-container-file" class="bare">https://github.com/os-migrate/aap/blob/main/aae-container-file</a></p>
</div>
<div class="paragraph">
<p>And the live demo here:</p>
</div>
<div class="paragraph">
<p><a href="https://www.youtube.com/watch?v=XnEQ8WVGW64">Migration from VMware to OpenStack</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_running_migration"><a class="anchor" href="#_running_migration"></a><a class="link" href="#_running_migration">Running migration</a></h5>
<div class="sect5">
<h6 id="_conversion_host"><a class="anchor" href="#_conversion_host"></a><a class="link" href="#_conversion_host">Conversion host</a></h6>
<div class="paragraph">
<p>You can use os_migrate.os_migration collection to deploy a conversion, but you can
easily create your conversion host manually.</p>
</div>
<div class="paragraph">
<p>A conversion host is basically an OpenStack instance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Important: If you want to take benefit of the current supported OS, it&#8217;s highly recommended to use a <strong>CentOS-10</strong> release or <strong>RHEL-9.5</strong> and superior. If you want to use other Linux distribution, make sure the virtio-win package is equal or higher than 1.40 version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">curl <span class="nt">-O</span> <span class="nt">-k</span> https://cloud.centos.org/centos/10-stream/x86_64/images/CentOS-Stream-GenericCloud-10-20250217.0.x86_64.qcow2

<span class="c"># Create OpenStack image:</span>
openstack image create <span class="nt">--disk-format</span> qcow2 <span class="nt">--file</span> CentOS-Stream-GenericCloud-10-20250217.0.x86_64.qcow2 CentOS-Stream-GenericCloud-10-20250217.0.x86_64.qcow2

<span class="c"># Create flavor, security group and network if needed</span>
openstack server create <span class="nt">--flavor</span> x.medium <span class="nt">--image</span> 14b1a895-5003-4396-888e-1fa55cd4adf8  <span class="se">\</span>
  <span class="nt">--key-name</span> default <span class="nt">--network</span> private   vmware-conv-host
openstack server add floating ip vmware-conv-host 192.168.18.205</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_inventory_variables_files_and_ansible_command"><a class="anchor" href="#_inventory_variables_files_and_ansible_command"></a><a class="link" href="#_inventory_variables_files_and_ansible_command">Inventory, Variables files and Ansible command:</a></h6>
<div class="paragraph">
<p><strong>inventory.yml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">migrator</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
    <span class="na">localhost</span><span class="pi">:</span>
      <span class="na">ansible_connection</span><span class="pi">:</span> <span class="s">local</span>
      <span class="na">ansible_python_interpreter</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_playbook_python</span><span class="nv"> </span><span class="s">}}"</span>
<span class="na">conversion_host</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
    <span class="na">192.168.18.205</span><span class="pi">:</span>
      <span class="na">ansible_ssh_user</span><span class="pi">:</span> <span class="s">cloud-user</span>
      <span class="na">ansible_ssh_private_key_file</span><span class="pi">:</span> <span class="s">key</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>myvars.yml:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># if you run the migration from an Ansible Execution Environment (AEE)</span>
<span class="c1"># set this to true:</span>
<span class="na">runner_from_aee</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># osm working directory:</span>
<span class="na">os_migrate_vmw_data_dir</span><span class="pi">:</span> <span class="s">/opt/os-migrate</span>
<span class="na">copy_openstack_credentials_to_conv_host</span><span class="pi">:</span> <span class="no">false</span>

<span class="c1"># Re-use an already deployed conversion host:</span>
<span class="na">already_deploy_conversion_host</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># If no mapped network then set the openstack network:</span>
<span class="na">openstack_private_network</span><span class="pi">:</span> <span class="s">81cc01d2-5e47-4fad-b387-32686ec71fa4</span>

<span class="c1"># Security groups for the instance:</span>
<span class="na">security_groups</span><span class="pi">:</span> <span class="s">ab7e2b1a-b9d3-4d31-9d2a-bab63f823243</span>
<span class="na">use_existing_flavor</span><span class="pi">:</span> <span class="no">true</span>
<span class="c1"># key pair name, could be left blank</span>
<span class="na">ssh_key_name</span><span class="pi">:</span> <span class="s">default</span>
<span class="c1"># network settings for openstack:</span>
<span class="na">os_migrate_create_network_port</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">copy_metadata_to_conv_host</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">used_mapped_networks</span><span class="pi">:</span> <span class="no">false</span>

<span class="na">vms_list</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">rhel-9.4-1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>secrets.yml:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># VMware parameters:</span>
<span class="na">esxi_hostname</span><span class="pi">:</span> <span class="s">10.0.0.7</span>
<span class="na">vcenter_hostname</span><span class="pi">:</span> <span class="s">10.0.0.7</span>
<span class="na">vcenter_username</span><span class="pi">:</span> <span class="s">root</span>
<span class="na">vcenter_password</span><span class="pi">:</span> <span class="s">root</span>
<span class="na">vcenter_datacenter</span><span class="pi">:</span> <span class="s">Datacenter</span>

<span class="na">os_cloud_environ</span><span class="pi">:</span> <span class="s">psi-rhos-upgrades-ci</span>
<span class="na">dst_cloud</span><span class="pi">:</span>
  <span class="na">auth</span><span class="pi">:</span>
    <span class="na">auth_url</span><span class="pi">:</span> <span class="s">https://keystone-public-openstack.apps.ocp-4-16.standalone</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">admin</span>
    <span class="na">project_id</span><span class="pi">:</span> <span class="s">xyz</span>
    <span class="na">project_name</span><span class="pi">:</span> <span class="s">admin</span>
    <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">openstack</span>
  <span class="na">region_name</span><span class="pi">:</span> <span class="s">regionOne</span>
  <span class="na">interface</span><span class="pi">:</span> <span class="s">public</span>
  <span class="na">insecure</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">identity_api_version</span><span class="pi">:</span> <span class="s">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Ansible command:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-playbook <span class="nt">-i</span> inventory.yml os_migrate.vmware_migration_kit.migration <span class="nt">-e</span> @secrets.yml <span class="nt">-e</span> @myvars.yml</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_usage_2"><a class="anchor" href="#_usage_2"></a><a class="link" href="#_usage_2">4.9.3. Usage</a></h4>
<div class="paragraph">
<p>You can find a "how to" here, to start from sratch with a container:
<a href="https://gist.github.com/matbu/003c300fd99ebfbf383729c249e9956f" class="bare">https://gist.github.com/matbu/003c300fd99ebfbf383729c249e9956f</a></p>
</div>
<div class="paragraph">
<p>Clone repository or install from ansible galaxy</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">git clone https://github.com/os-migrate/vmware-migration-kit
ansible-galaxy collection <span class="nb">install </span>os_migrate.vmware_migration_kit</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_nbdkit_default"><a class="anchor" href="#_nbdkit_default"></a><a class="link" href="#_nbdkit_default">Nbdkit (default)</a></h5>
<div class="paragraph">
<p>Edit vars.yaml file and add our own setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">esxi_hostname</span><span class="pi">:</span> <span class="err">********</span>
<span class="na">vcenter_hostname</span><span class="pi">:</span> <span class="err">*******</span>
<span class="na">vcenter_username</span><span class="pi">:</span> <span class="s">root</span>
<span class="na">vcenter_password</span><span class="pi">:</span> <span class="err">*****</span>
<span class="na">vcenter_datacenter</span><span class="pi">:</span> <span class="s">Datacenter</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you already have a conversion host, or if you want to re-used a previously deployed one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">already_deploy_conversion_host</span><span class="pi">:</span> <span class="no">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then specify the Openstack credentials:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># OpenStack destination cloud auth parameters:</span>
<span class="na">dst_cloud</span><span class="pi">:</span>
  <span class="na">auth</span><span class="pi">:</span>
    <span class="na">auth_url</span><span class="pi">:</span> <span class="s">https://openstack.dst.cloud:13000/v3</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">tenant</span>
    <span class="na">project_id</span><span class="pi">:</span> <span class="s">xyz</span>
    <span class="na">project_name</span><span class="pi">:</span> <span class="s">migration</span>
    <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">osm.com</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">password</span>
  <span class="na">region_name</span><span class="pi">:</span> <span class="s">regionOne</span>
  <span class="na">interface</span><span class="pi">:</span> <span class="s">public</span>
  <span class="na">identity_api_version</span><span class="pi">:</span> <span class="m">3</span>

<span class="c1"># OpenStack migration parameters:</span>
<span class="c1"># Use mapped networks or not:</span>
<span class="na">used_mapped_networks</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">network_map</span><span class="pi">:</span>
  <span class="na">VM Network</span><span class="pi">:</span> <span class="s">private</span>

<span class="c1"># If no mapped network then set the openstack network:</span>
<span class="na">openstack_private_network</span><span class="pi">:</span> <span class="s">81cc01d2-5e47-4fad-b387-32686ec71fa4</span>

<span class="c1"># Security groups for the instance:</span>
<span class="na">security_groups</span><span class="pi">:</span> <span class="s">4f077e64-bdf6-4d2a-9f2c-c5588f4948ce</span>
<span class="na">use_existing_flavor</span><span class="pi">:</span> <span class="no">true</span>

<span class="na">os_migrate_create_network_port</span><span class="pi">:</span> <span class="no">false</span>

<span class="c1"># OS-migrate parameters:</span>
<span class="c1"># osm working directory:</span>
<span class="na">os_migrate_vmw_data_dir</span><span class="pi">:</span> <span class="s">/opt/os-migrate</span>

<span class="c1"># Set this to true if the Openstack "dst_cloud" is a clouds.yaml file</span>
<span class="c1"># other, if the dest_cloud is a dict of authentication parameters, set</span>
<span class="c1"># this to false:</span>
<span class="na">copy_openstack_credentials_to_conv_host</span><span class="pi">:</span> <span class="no">false</span>

<span class="c1"># Teardown</span>
<span class="c1"># Set to true if you want osm to delete everything on the destination cloud.</span>
<span class="na">os_migrate_tear_down</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># VMs list</span>
<span class="na">vms_list</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">rhel-1</span>
  <span class="pi">-</span> <span class="s">rhel-2</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_virt_v2v"><a class="anchor" href="#_virt_v2v"></a><a class="link" href="#_virt_v2v">Virt-v2v</a></h5>
<div class="paragraph">
<p>Provide the following additional informations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># virt-v2v parameters</span>
<span class="na">vddk_thumbprint</span><span class="pi">:</span> <span class="s">XX:XX:XX</span>
<span class="na">vddk_libdir</span><span class="pi">:</span> <span class="s">/usr/lib/vmware-vix-disklib</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to generate the thumbprint of your VMWare source cloud you need to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># thumbprint</span>
<span class="s">openssl s_client -connect ESXI_SERVER_NAME:443 &lt;/dev/null |</span>
   <span class="s">openssl x509 -in /dev/stdin -fingerprint -sha1 -noout</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ansible_configuration"><a class="anchor" href="#_ansible_configuration"></a><a class="link" href="#_ansible_configuration">Ansible configuration</a></h5>
<div class="paragraph">
<p>Create an invenvoty file, and replace the conv_host_ip by the ip address of your
conversion host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">migrator</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
    <span class="na">localhost</span><span class="pi">:</span>
      <span class="na">ansible_connection</span><span class="pi">:</span> <span class="s">local</span>
      <span class="na">ansible_python_interpreter</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_playbook_python</span><span class="nv"> </span><span class="s">}}"</span>
<span class="na">conversion_host</span><span class="pi">:</span>
  <span class="na">hosts</span><span class="pi">:</span>
    <span class="na">conv_host_ip</span><span class="pi">:</span>
      <span class="na">ansible_ssh_user</span><span class="pi">:</span> <span class="s">cloud-user</span>
      <span class="na">ansible_ssh_private_key_file</span><span class="pi">:</span> <span class="s">/home/stack/.ssh/conv-host</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run the migration with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-playbook <span class="nt">-i</span> localhost_inventory.yml os_migrate.vmware_migration_kit.migration <span class="nt">-e</span> @vars.yaml</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_running_migration_outside_of_ansible"><a class="anchor" href="#_running_migration_outside_of_ansible"></a><a class="link" href="#_running_migration_outside_of_ansible">Running Migration outside of Ansible</a></h5>
<div class="paragraph">
<p>You can also run migration outside of Ansible because the Ansible module are written in Golang.
The binaries are located in the plugins directory.</p>
</div>
<div class="paragraph">
<p>From your conversion host (or an Openstack instance inside the destination cloud) you need to export
Openstack variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"> <span class="nb">export </span><span class="nv">OS_AUTH_URL</span><span class="o">=</span>https://keystone-public-openstack.apps.ocp-4-16.standalone
 <span class="nb">export </span><span class="nv">OS_PROJECT_NAME</span><span class="o">=</span>admin
 <span class="nb">export </span><span class="nv">OS_PASSWORD</span><span class="o">=</span>admin
 <span class="nb">export </span><span class="nv">OS_USERNAME</span><span class="o">=</span>admin
 <span class="nb">export </span><span class="nv">OS_DOMAIN_NAME</span><span class="o">=</span>Default
 <span class="nb">export </span><span class="nv">OS_PROJECT_ID</span><span class="o">=</span>xyz</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create the argument json file, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="err">cat</span><span class="w"> </span><span class="err">&lt;&lt;EOF</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="err">args.json</span><span class="w">
</span><span class="p">{</span><span class="w">
		</span><span class="nl">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"root"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"root"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.0.0.7"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"vmname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rhel-9.4-3"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"cbtsync"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
		</span><span class="nl">"dst_cloud"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
			</span><span class="nl">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
				</span><span class="nl">"auth_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://keystone-public-openstack.apps.ocp-4-16.standalone"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"project_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xyz"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"project_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"user_domain_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Default"</span><span class="p">,</span><span class="w">
				</span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="w">
			</span><span class="p">},</span><span class="w">
			</span><span class="nl">"region_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"regionOne"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"interface"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public"</span><span class="p">,</span><span class="w">
			</span><span class="nl">"identity_api_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
		</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="err">EOF</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then execute the <code>migrate</code> binary:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">pushd </span>vmware-migration-kit/vmware_migration_kit
./plugins/modules/migrate/migrate</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see the logs into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">tail</span> <span class="nt">-f</span> /tmp/osm-nbdkit.log</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_os_migrate_glossary"><a class="anchor" href="#_os_migrate_glossary"></a><a class="link" href="#_os_migrate_glossary">4.10. OS Migrate Glossary</a></h3>
<div class="paragraph">
<p>A comprehensive glossary of terms for operators learning about the OS Migrate project.</p>
</div>
<div class="sect3">
<h4 id="_core_concepts"><a class="anchor" href="#_core_concepts"></a><a class="link" href="#_core_concepts">4.10.1. Core Concepts</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>OS Migrate Collection</strong></dt>
<dd>
<p>An Ansible collection (<code>os_migrate.os_migrate</code>) that provides modules, roles, and playbooks for migrating OpenStack resources between clouds.</p>
</dd>
<dt class="hdlist1"><strong>Resource</strong></dt>
<dd>
<p>An OpenStack entity that can be migrated (networks, instances, flavors, images, etc.). Each resource type has its own export/import workflow.</p>
</dd>
<dt class="hdlist1"><strong>Export Phase</strong></dt>
<dd>
<p>The process of extracting resource definitions from a source OpenStack cloud and serializing them to YAML files.</p>
</dd>
<dt class="hdlist1"><strong>Import Phase</strong></dt>
<dd>
<p>The process of reading YAML resource files and creating corresponding resources in a destination OpenStack cloud.</p>
</dd>
<dt class="hdlist1"><strong>Parallel Migration</strong></dt>
<dd>
<p>A modernization strategy where a new OpenStack deployment runs alongside an existing one, with tenant resources migrated between them.</p>
</dd>
<dt class="hdlist1"><strong>Idempotent Operations</strong></dt>
<dd>
<p>All playbooks can be re-run safely; they won&#8217;t duplicate resources or cause conflicts.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_resource_types"><a class="anchor" href="#_resource_types"></a><a class="link" href="#_resource_types">4.10.2. Resource Types</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Workloads</strong></dt>
<dd>
<p>Running instances/VMs that are migrated from source to destination cloud, including their attached storage and network configuration.</p>
</dd>
<dt class="hdlist1"><strong>Detached Volumes</strong></dt>
<dd>
<p>Storage volumes not currently attached to any instance.</p>
</dd>
<dt class="hdlist1"><strong>Flavors</strong></dt>
<dd>
<p>Virtual machine templates that define CPU, memory, and disk specifications.</p>
</dd>
<dt class="hdlist1"><strong>Images</strong></dt>
<dd>
<p>Disk images used as templates for creating instances.</p>
</dd>
<dt class="hdlist1"><strong>Networks</strong></dt>
<dd>
<p>Virtual networks that provide connectivity between instances.</p>
</dd>
<dt class="hdlist1"><strong>Subnets</strong></dt>
<dd>
<p>IP address ranges within networks that define available IP addresses.</p>
</dd>
<dt class="hdlist1"><strong>Routers</strong></dt>
<dd>
<p>Virtual routers that provide connectivity between networks and external networks.</p>
</dd>
<dt class="hdlist1"><strong>Router Interfaces</strong></dt>
<dd>
<p>Connections between routers and subnets.</p>
</dd>
<dt class="hdlist1"><strong>Security Groups</strong></dt>
<dd>
<p>Firewall rule sets that control network traffic to instances.</p>
</dd>
<dt class="hdlist1"><strong>Security Group Rules</strong></dt>
<dd>
<p>Individual firewall rules within security groups.</p>
</dd>
<dt class="hdlist1"><strong>Projects</strong></dt>
<dd>
<p>OpenStack tenants that contain and isolate resources.</p>
</dd>
<dt class="hdlist1"><strong>Users</strong></dt>
<dd>
<p>OpenStack user accounts with authentication credentials.</p>
</dd>
<dt class="hdlist1"><strong>Keypairs</strong></dt>
<dd>
<p>SSH key pairs used for secure instance access.</p>
</dd>
<dt class="hdlist1"><strong>User Project Role Assignments</strong></dt>
<dd>
<p>Mappings that grant users specific roles within projects.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_migration_infrastructure"><a class="anchor" href="#_migration_infrastructure"></a><a class="link" href="#_migration_infrastructure">4.10.3. Migration Infrastructure</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Conversion Host</strong></dt>
<dd>
<p>A temporary VM created in the destination cloud to facilitate workload migration, particularly for disk image transfer.</p>
</dd>
<dt class="hdlist1"><strong>Conversion Host Content</strong></dt>
<dd>
<p>Software and configuration deployed on conversion hosts to enable migration functionality.</p>
</dd>
<dt class="hdlist1"><strong>Migrator Host</strong></dt>
<dd>
<p>The system where OS Migrate playbooks are executed, coordinating the migration process.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_data_management"><a class="anchor" href="#_data_management"></a><a class="link" href="#_data_management">4.10.4. Data Management</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Data Directory</strong> (<code>os_migrate_data_dir</code>)</dt>
<dd>
<p>Local filesystem location where exported YAML resource files are stored during migration.</p>
</dd>
<dt class="hdlist1"><strong>Resource Filter</strong> (<code>os_migrate_&lt;resource&gt;_filter</code>)</dt>
<dd>
<p>Name-based filtering to selectively export/import specific resources rather than all resources of a type.</p>
</dd>
<dt class="hdlist1"><strong>Serialization</strong></dt>
<dd>
<p>The process of converting OpenStack SDK objects into OS Migrate&#8217;s standardized YAML format.</p>
</dd>
<dt class="hdlist1"><strong>Resource Validation</strong></dt>
<dd>
<p>Checking that imported YAML files contain valid resource definitions before attempting import.</p>
</dd>
<dt class="hdlist1"><strong>File Validation</strong> (<code>import_&lt;resource&gt;_validate_file</code>)</dt>
<dd>
<p>Optional validation step that verifies resource data integrity before import operations.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_resource_structure"><a class="anchor" href="#_resource_structure"></a><a class="link" href="#_resource_structure">4.10.5. Resource Structure</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>params_from_sdk</strong></dt>
<dd>
<p>Resource properties that are copied to the destination cloud (configuration, settings).</p>
</dd>
<dt class="hdlist1"><strong>info_from_sdk</strong></dt>
<dd>
<p>Resource properties that are NOT copied (UUIDs, timestamps, read-only data).</p>
</dd>
<dt class="hdlist1"><strong>Migration Parameters</strong></dt>
<dd>
<p>OS Migrate-specific settings that control migration behavior for each resource.</p>
</dd>
<dt class="hdlist1"><strong>SDK Parameters</strong></dt>
<dd>
<p>Parameters used when making OpenStack API calls to create or update resources.</p>
</dd>
<dt class="hdlist1"><strong>Readonly SDK Parameters</strong></dt>
<dd>
<p>Parameters that are allowed during resource creation but not during updates.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_authentication_configuration"><a class="anchor" href="#_authentication_configuration"></a><a class="link" href="#_authentication_configuration">4.10.6. Authentication &amp; Configuration</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Source Auth</strong> (<code>os_migrate_src_auth</code>)</dt>
<dd>
<p>OpenStack authentication credentials for the source cloud.</p>
</dd>
<dt class="hdlist1"><strong>Destination Auth</strong> (<code>os_migrate_dst_auth</code>)</dt>
<dd>
<p>OpenStack authentication credentials for the destination cloud.</p>
</dd>
<dt class="hdlist1"><strong>clouds.yaml</strong></dt>
<dd>
<p>OpenStack client configuration file containing cloud authentication details.</p>
</dd>
<dt class="hdlist1"><strong>Source Cloud</strong> (<code>SRC_CLOUD</code>)</dt>
<dd>
<p>Environment variable identifying the source cloud configuration in clouds.yaml.</p>
</dd>
<dt class="hdlist1"><strong>Destination Cloud</strong> (<code>DST_CLOUD</code>)</dt>
<dd>
<p>Environment variable identifying the destination cloud configuration in clouds.yaml.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_ansible_components"><a class="anchor" href="#_ansible_components"></a><a class="link" href="#_ansible_components">4.10.7. Ansible Components</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Export Roles</strong></dt>
<dd>
<p>Ansible roles that call export modules and handle resource filtering (e.g., <code>export_networks</code>, <code>export_workloads</code>).</p>
</dd>
<dt class="hdlist1"><strong>Import Roles</strong></dt>
<dd>
<p>Ansible roles that validate data files and call import modules (e.g., <code>import_networks</code>, <code>import_workloads</code>).</p>
</dd>
<dt class="hdlist1"><strong>Export Modules</strong></dt>
<dd>
<p>Ansible modules that retrieve resources from source cloud and serialize to YAML (e.g., <code>export_flavor.py</code>).</p>
</dd>
<dt class="hdlist1"><strong>Import Modules</strong></dt>
<dd>
<p>Ansible modules that read YAML files and create resources in destination cloud (e.g., <code>import_flavor.py</code>).</p>
</dd>
<dt class="hdlist1"><strong>Prelude Roles</strong></dt>
<dd>
<p>Setup roles that prepare the environment:</p>
<div class="ulist">
<ul>
<li>
<p><code>prelude_src</code> - Source cloud preparation</p>
</li>
<li>
<p><code>prelude_dst</code> - Destination cloud preparation</p>
</li>
<li>
<p><code>prelude_common</code> - Common setup tasks</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>Resource Class</strong></dt>
<dd>
<p>Python class that defines how OpenStack SDK objects are converted to/from OS Migrate format. All inherit from the base <code>Resource</code> class.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_development_testing"><a class="anchor" href="#_development_testing"></a><a class="link" href="#_development_testing">4.10.8. Development &amp; Testing</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Role Skeleton</strong></dt>
<dd>
<p>Template structure for creating new export/import roles using the role-addition script.</p>
</dd>
<dt class="hdlist1"><strong>Unit Tests</strong></dt>
<dd>
<p>Tests that verify module logic and resource class behavior in isolation.</p>
</dd>
<dt class="hdlist1"><strong>Functional Tests</strong></dt>
<dd>
<p>Tests that verify roles and modules work correctly in integration scenarios.</p>
</dd>
<dt class="hdlist1"><strong>End-to-End Tests</strong> (E2E)</dt>
<dd>
<p>Full migration workflow tests that validate complete export/import cycles.</p>
</dd>
<dt class="hdlist1"><strong>Sanity Tests</strong></dt>
<dd>
<p>Ansible collection sanity checks that verify code quality and standards compliance.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_container_environment"><a class="anchor" href="#_container_environment"></a><a class="link" href="#_container_environment">4.10.9. Container Environment</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Container Engine</strong></dt>
<dd>
<p>Configurable container runtime (Podman/Docker) used for development environment via <code>CONTAINER_ENGINE</code> variable.</p>
</dd>
<dt class="hdlist1"><strong>Development Container</strong></dt>
<dd>
<p>CentOS Stream 10 container with Python 3.12 where all OS Migrate commands execute.</p>
</dd>
<dt class="hdlist1"><strong>Source Mount</strong></dt>
<dd>
<p>The <code>/code</code> directory inside the container where the OS Migrate source code is mounted.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_build_deployment"><a class="anchor" href="#_build_deployment"></a><a class="link" href="#_build_deployment">4.10.10. Build &amp; Deployment</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Collection Build</strong></dt>
<dd>
<p>Process of packaging OS Migrate into an Ansible collection archive for distribution.</p>
</dd>
<dt class="hdlist1"><strong>Galaxy Installation</strong></dt>
<dd>
<p>Installing the OS Migrate collection via <code>ansible-galaxy collection install os_migrate.os_migrate</code>.</p>
</dd>
<dt class="hdlist1"><strong>Dependencies</strong></dt>
<dd>
<p>Required Ansible collections (<code>community.crypto</code>, <code>community.general</code>, <code>openstack.cloud</code>) and Python packages.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_migration_process"><a class="anchor" href="#_migration_process"></a><a class="link" href="#_migration_process">4.10.11. Migration Process</a></h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Three-Phase Migration</strong></dt>
<dd>
<p>The standard workflow: Export  Transfer  Import.</p>
</dd>
<dt class="hdlist1"><strong>Transfer Phase</strong></dt>
<dd>
<p>Moving exported YAML data files from source environment to destination environment.</p>
</dd>
<dt class="hdlist1"><strong>Validation Phase</strong></dt>
<dd>
<p>Verifying that resources were created correctly and handling any migration errors.</p>
</dd>
<dt class="hdlist1"><strong>Resource References</strong></dt>
<dd>
<p>Cross-references between resources (e.g., instances referencing networks) that must be resolved during import.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>ifdev::context[:parent-context: vmware]</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id=""os-migrate-contributing_vmware"><a class="anchor" href="#"os-migrate-contributing_vmware"></a><a class="link" href="#"os-migrate-contributing_vmware">4.11. OS Migrate Contribution Guidelines</a></h3>
<div class="sect3">
<h4 id="_tbd_but_largely_based_on_combination_of_existing_guide_and_david_roberto_collaboration"><a class="anchor" href="#_tbd_but_largely_based_on_combination_of_existing_guide_and_david_roberto_collaboration"></a><a class="link" href="#_tbd_but_largely_based_on_combination_of_existing_guide_and_david_roberto_collaboration">4.11.1. TBD - but largely based on combination of existing guide, and David &amp; Roberto collaboration</a></h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_os_migrate_user_documentation"><a class="anchor" href="#_os_migrate_user_documentation"></a><a class="link" href="#_os_migrate_user_documentation">5. OS Migrate User Documentation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>OS Migrate is a tool to migrate tenant content from one OpenStack cloud
to another.</p>
</div>
<div class="sect2">
<h3 id="_installation_from_galaxy_recommended"><a class="anchor" href="#_installation_from_galaxy_recommended"></a><a class="link" href="#_installation_from_galaxy_recommended">5.1. Installation from Galaxy (recommended)</a></h3>
<div class="paragraph">
<p>This document describes the recommended method of installing OS Migrate,
from Ansible Galaxy. Alternatively, you can <a href="install-from-source.html">install from source</a>.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_3"><a class="anchor" href="#_prerequisites_3"></a><a class="link" href="#_prerequisites_3">5.1.1. Prerequisites</a></h4>
<div class="ulist">
<ul>
<li>
<p>Ansible 2.9 or newer.</p>
</li>
<li>
<p>Ansible must run using Python 3. (When using Ansible from RHEL
packages, this means running on RHEL 8 or newer.)</p>
</li>
<li>
<p>Additional package requirements from Ansible modules:
<code>iputils python3-openstackclient python3-openstacksdk</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_using_virtualenv_for_prerequisites"><a class="anchor" href="#_using_virtualenv_for_prerequisites"></a><a class="link" href="#_using_virtualenv_for_prerequisites">5.1.2. Using virtualenv for prerequisites</a></h4>
<div class="paragraph">
<p>If your distribution doesn&#8217;t ship the required dependency versions,
you can use virtualenv, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">python3 <span class="nt">-m</span> venv <span class="nv">$HOME</span>/os_migrate_venv
<span class="nb">source</span> <span class="nv">$HOME</span>/os_migrate_venv/bin/activate
python3 <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">--upgrade</span> <span class="s1">'openstacksdk'</span>
python3 <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">--upgrade</span> <span class="s1">'ansible-core'</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="installation-1"><a class="anchor" href="#installation-1"></a><a class="link" href="#installation-1">5.1.3. Installation of OS Migrate collection</a></h4>
<div class="paragraph">
<p>To install latest release:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-galaxy collection <span class="nb">install </span>os_migrate.os_migrate</code></pre>
</div>
</div>
<div class="paragraph">
<p>To install a particular release:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-galaxy collection <span class="nb">install </span>os_migrate.os_migrate:&lt;VERSION&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find available releases at <a href="https://galaxy.ansible.com/os_migrate/os_migrate">OS Migrate Galaxy page</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation_from_source_when_customizing"><a class="anchor" href="#_installation_from_source_when_customizing"></a><a class="link" href="#_installation_from_source_when_customizing">5.2. Installation from source (when customizing)</a></h3>
<div class="paragraph">
<p>Install prerequisites as documented in <a href="install-from-galaxy.html">install from Galaxy</a>. Then install OS Migrate from source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">git clone https://github.com/os-migrate/os-migrate
<span class="nb">cd </span>os-migrate
<span class="c"># &gt; Here you can checkout a specific commit/branch if desired &lt;</span>

make toolbox-build
./toolbox/run make

<span class="nb">pushd </span>releases
ansible-galaxy collection <span class="nb">install</span> <span class="nt">--force</span> os_migrate-os_migrate-latest.tar.gz
<span class="nb">popd</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_upgrading"><a class="anchor" href="#_upgrading"></a><a class="link" href="#_upgrading">5.3. Upgrading</a></h3>
<div class="paragraph">
<p>This document describes the recommended method of upgrading OS Migrate
from Ansible Galaxy.</p>
</div>
<div class="sect3">
<h4 id="_collection_upgrade"><a class="anchor" href="#_collection_upgrade"></a><a class="link" href="#_collection_upgrade">5.3.1. Collection upgrade</a></h4>
<div class="paragraph">
<p>To upgrade to the latest release if you already have the OS Migrate
collection installed, make sure to pass the <code>-f</code> flag to the
installation command, which will force installing the (latest)
collection even if it is already present:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-galaxy collection <span class="nb">install</span> <span class="nt">-f</span> os_migrate.os_migrate</code></pre>
</div>
</div>
<div class="paragraph">
<p>To upgrade/downgrade to a particular release:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-galaxy collection <span class="nb">install </span>os_migrate.os_migrate:&lt;VERSION&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find available releases at <a href="https://galaxy.ansible.com/os_migrate/os_migrate">OS Migrate Galaxy page</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_usage_notes_related_to_upgrading"><a class="anchor" href="#_usage_notes_related_to_upgrading"></a><a class="link" href="#_usage_notes_related_to_upgrading">5.3.2. Usage notes related to upgrading</a></h4>
<div class="ulist">
<ul>
<li>
<p>OS Migrate presently does not guarantee any forward compatibility of
exported data. <strong>The same version of OS Migrate should be used during
export and import.</strong></p>
</li>
<li>
<p>After upgrading, <strong>clear any potential existing data files</strong> from
your <code>os_migrate_data_dir</code>, or use a different one.</p>
<div class="paragraph">
<p>During export, OS Migrate will attempt to parse exsiting data files
(with the intention of adding new resources to them), and an error
will be raised if the existing data files were created with a
different OS Migrate version.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_os_migrate_walkthrough"><a class="anchor" href="#_os_migrate_walkthrough"></a><a class="link" href="#_os_migrate_walkthrough">5.4. OS Migrate Walkthrough</a></h3>
<div class="paragraph">
<p>OS Migrate is a framework for OpenStack parallel cloud migration
(migrating content between OpenStack tenants which are not necessarily
in the same cloud). It&#8217;s a collection of Ansible playbooks that provide
the basic functionality, but may not fit each use case out of the box.
You can craft custom playbooks using the OS Migrate collection pieces
(roles and modules) as building blocks.</p>
</div>
<div class="paragraph">
<p>Parallel cloud migration is a way to modernize an OpenStack deployment.
Instead of upgrading an OpenStack cluster in place, a second OpenStack
cluster is deployed alongside, and tenant content is migrated from the
original cluster to the new one. Parallel cloud migration is best suited
for environments which are due for a hardware refresh cycle. It may also
be performed without a hardware refresh, but extra hardware resources
are needed to bootstrap the new cluster. As hardware resources free up
in the original cluster, they can be gradually added to the new cluster.</p>
</div>
<div class="paragraph">
<p>OS Migrate strictly uses the official OpenStack API and does not utilize
direct database access or other methods to export or import data. The
Ansible playbooks contained in OS Migrate are idempotent. If a command
fails, you can retry with the same command.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/plantuml/render/pcm-birds-eye.png" alt="OSP-OSP Migration Overview" width="80%">
</div>
<div class="title">Figure 1. OSP-OSP Migration Overview</div>
</div>
<div class="paragraph">
<p>The migration is generally performed in this sequence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>prerequisites: prepare authentication info, parameter files,</p>
</li>
<li>
<p>pre-workload migration, which copies applicable resources into the
destination cloud (e.g. networks, security groups, images) while
workloads keep running in the source cloud,</p>
</li>
<li>
<p>workload migration, which stops usage of applicable resources in the
source cloud and moves them into the destination cloud (VMs,
volumes).</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_prerequisites_4"><a class="anchor" href="#_prerequisites_4"></a><a class="link" href="#_prerequisites_4">5.4.1. Prerequisites</a></h4>
<div class="sect4">
<h5 id="_authentication_3"><a class="anchor" href="#_authentication_3"></a><a class="link" href="#_authentication_3">Authentication</a></h5>
<div class="paragraph">
<p>Users are encouraged to use os-migrate using specific credentials for
each project/tenant, this means <strong>not using the admin user to execute
the resources migration</strong> (unless the resource is owned by the admin
project, e.g. public Glance images).</p>
</div>
<div class="paragraph">
<p>In case the circumstances require migrating by the <code>admin</code> user,
this user needs to have access to the respective projects. There are
two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <code>admin</code> user as a <code><em>member</em></code> of each project.</p>
<div class="paragraph">
<p>Depending on how many projects need to be migrated this approach seems
to be suboptimal as there are involved several configuration updates in
the projects that will need to be reverted after the migration
completes.</p>
</div>
</li>
<li>
<p>Create a group including the admin user and add the group to each
project as member.</p>
<div class="paragraph">
<p>The difference with this approach is that once the migration is
completed, by removing the group, all the references in all the projects
will be removed automatically.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_parameter_file_2"><a class="anchor" href="#_parameter_file_2"></a><a class="link" href="#_parameter_file_2">Parameter file</a></h5>
<div class="paragraph">
<p>Let&#8217;s create an <code>os-migrate-vars.yml</code> file with Ansible variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_src_auth</span><span class="pi">:</span>
  <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://192.168.0.13.199/v3</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">srcpassword</span>
  <span class="na">project_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">project_name</span><span class="pi">:</span> <span class="s">src</span>
  <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">src</span>
<span class="na">os_migrate_src_region_name</span><span class="pi">:</span> <span class="s">regionOne</span>
<span class="na">os_migrate_dst_auth</span><span class="pi">:</span>
  <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://192.167.0.16:5000/v3</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">dstpassword</span>
  <span class="na">project_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">project_name</span><span class="pi">:</span> <span class="s">dst</span>
  <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">dst</span>
<span class="na">os_migrate_dst_region_name</span><span class="pi">:</span> <span class="s">regionOne</span>

<span class="na">os_migrate_data_dir</span><span class="pi">:</span> <span class="s">/home/migrator/os-migrate-data</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The file contains the source and destination tenant credentials, a
directory on the migrator host (typically localhost) and a directory
where the exported data will be saved.</p>
</div>
<div class="paragraph">
<p><strong>If you are migrating content from multiple source projects, make
sure to use a separate data directory for each source project.</strong> In
other words, when changing <code>os_migrate_src_auth</code> or
<code>os_migrate_src_region_name</code>, make sure to also change
<code>os_migrate_data_dir</code>.</p>
</div>
<div class="sect5">
<h6 id="_a_note_about_keystone_v2"><a class="anchor" href="#_a_note_about_keystone_v2"></a><a class="link" href="#_a_note_about_keystone_v2">A note about Keystone v2</a></h6>
<div class="paragraph">
<p>As depicted in content of the previously defined <code>os-migrate-vars.yml</code>
file, the parameters <code>os_migrate_src_auth</code> and <code>os_migrate_dst_auth</code>
refer to the usage of Keystone v3. In the case of a user needing to
execute a migration between tenants not supporting Keystone v3 the
following error will be raised:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>keystoneauth1.exceptions.discovery.DiscoveryFailure: Cannot use v2 authentication with domain scope</pre>
</div>
</div>
<div class="paragraph">
<p>To fix this issue, the user must adjust their auth parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_src_auth</span><span class="pi">:</span>
  <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://192.168.0.13.199/v2.0</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">srcpassword</span>
  <span class="na">project_name</span><span class="pi">:</span> <span class="s">src</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">src</span>
<span class="na">os_migrate_src_region_name</span><span class="pi">:</span> <span class="s">regionOne</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the parameters <code>project_domain_name</code> and
<code>user_domain_name</code> are removed and the <code>auth_url</code> parameter points
to the Keystone v2 endpoint.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_shortcuts_2"><a class="anchor" href="#_shortcuts_2"></a><a class="link" href="#_shortcuts_2">Shortcuts</a></h5>
<div class="paragraph">
<p>We will use the OS Migrate collection path and an ansible-playbook
command with the following arguments routinely, so let&#8217;s save them as
variables in the shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">export </span><span class="nv">OSM_DIR</span><span class="o">=</span>/home/migrator/.ansible/collections/ansible_collections/os_migrate/os_migrate
<span class="nb">export </span><span class="nv">OSM_CMD</span><span class="o">=</span><span class="s2">"ansible-playbook -v -i </span><span class="nv">$OSM_DIR</span><span class="s2">/localhost_inventory.yml -e @os-migrate-vars.yml"</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pre_workload_migration_2"><a class="anchor" href="#_pre_workload_migration_2"></a><a class="link" href="#_pre_workload_migration_2">5.4.2. Pre-workload migration</a></h4>
<div class="paragraph">
<p>Workloads require the support of several resources in a given cloud to
operate properly. Some of these resources include networks, subnets,
routers, router interfaces, security groups, and security group rules.
The pre-workload migration process includes exporting these resources
from the source cloud onto the migrator machine, the option to edit the
resources if desired, and importing them into the destination cloud.</p>
</div>
<div class="paragraph">
<p>Exporting or importing resources is enabled by running the corresponding
playbook from OS Migrate. Let&#8217;s look at a concrete example. To export
the networks, run the "export_networks" playbook.</p>
</div>
<div class="sect4">
<h5 id="_export_and_import_2"><a class="anchor" href="#_export_and_import_2"></a><a class="link" href="#_export_and_import_2">Export and import</a></h5>
<div class="paragraph">
<p>To export the networks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/export_networks.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create networks.yml file in the data directory, similar to
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_version</span><span class="pi">:</span> <span class="s">0.17.0</span>
<span class="na">resources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">_info</span><span class="pi">:</span>
      <span class="na">availability_zones</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">nova</span>
      <span class="na">created_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-04-07T14:08:30Z'</span>
      <span class="na">id</span><span class="pi">:</span> <span class="s">a1eb31f6-2cdc-4896-b582-8950dafa34aa</span>
      <span class="na">project_id</span><span class="pi">:</span> <span class="s">2f444c71265048f7a9d21f81db6f21a4</span>
      <span class="na">qos_policy_id</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">revision_number</span><span class="pi">:</span> <span class="m">3</span>
      <span class="na">status</span><span class="pi">:</span> <span class="s">ACTIVE</span>
      <span class="na">subnet_ids</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">a5052e10-5e00-432b-a826-29695677aca0</span>
        <span class="pi">-</span> <span class="s">d450ffd0-972e-4398-ab49-6ba9e29e2499</span>
      <span class="na">updated_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-04-07T14:08:34Z'</span>
    <span class="na">params</span><span class="pi">:</span>
      <span class="na">availability_zone_hints</span><span class="pi">:</span> <span class="pi">[]</span>
      <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">'</span>
      <span class="na">dns_domain</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">is_admin_state_up</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">is_default</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">is_port_security_enabled</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">is_router_external</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">is_shared</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">is_vlan_transparent</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">mtu</span><span class="pi">:</span> <span class="m">1450</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">osm_net</span>
      <span class="na">provider_network_type</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">provider_physical_network</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">provider_segmentation_id</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">qos_policy_name</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">segments</span><span class="pi">:</span> <span class="no">null</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">openstack.network.Network</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You may edit the file as needed and then run the "import_networks"
playbook to import the networks from this file into the destination
cloud:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/import_networks.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can repeat this process for other resources like subnets, security
groups, security group rules, routers, router interfaces, images and
keypairs.</p>
</div>
<div class="paragraph">
<p>For a full list of available playbooks, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">ls</span> <span class="nv">$OSM_DIR</span>/playbooks</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_diagrams_2"><a class="anchor" href="#_diagrams_2"></a><a class="link" href="#_diagrams_2">Diagrams</a></h5>
<div class="imageblock">
<div class="content">
<img src="../images/plantuml/render/pre-workload-migration-workflow.png" alt="Pre-workload Migration (workflow)" width="50%">
</div>
<div class="title">Figure 2. Pre-workload Migration (workflow)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/plantuml/render/pre-workload-migration-data-flow.png" alt="Pre-workload Migration (data flow)" width="50%">
</div>
<div class="title">Figure 3. Pre-workload Migration (data flow)</div>
</div>
</div>
<div class="sect4">
<h5 id="_demo_3"><a class="anchor" href="#_demo_3"></a><a class="link" href="#_demo_3">Demo</a></h5>
<div class="paragraph">
<p><a href="https://youtu.be/e7KXy5Hq4CMA">Pre-workload migration recorded demo</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://youtu.be/e7KXy5Hq4CMA"><img src="https://img.youtube.com/vi/e7KXy5Hq4CM/maxresdefault.jpg" alt="maxresdefault"></a>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_detached_volume_migration"><a class="anchor" href="#_detached_volume_migration"></a><a class="link" href="#_detached_volume_migration">5.4.3. Detached volume migration</a></h4>
<div class="paragraph">
<p>It is possible to migrate detached volumes in the same way as we do
with other openstack resource types. The migration process includes
exporting these volumes from the source cloud onto the migrator machine,
attaching the volume to the conversion host in source cloud, creating
the volume in the destination cloud and transferring the content
of the volumes.
It is possible to choose the volumes to migrate using the reource filter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_detached_volumes_filter</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">detached_volume1</span>
<span class="pi">-</span> <span class="s">detached_volume2</span>
<span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">^myprefix_.**</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example says: Export only volumes named <code>detached_volume1</code> <strong>or</strong>
<code>detached_volume2</code> <strong>or</strong> starting with <code>myprefix_</code>.</p>
</div>
<div class="paragraph">
<p>To export the volumes it is needed to execute the playbook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/export_detached_volumes.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create detached_volumes.yml file in the data directory, similar to
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_version</span><span class="pi">:</span> <span class="s">1.0.1</span>
<span class="na">resources</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">_info</span><span class="pi">:</span>
    <span class="na">attachments</span><span class="pi">:</span> <span class="pi">[]</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s">0e9ff1ab-fb8d-4c12-81c4-29d519d09cb9</span>
    <span class="na">is_bootable</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">size</span><span class="pi">:</span> <span class="m">5</span>
  <span class="na">_migration_params</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="na">params</span><span class="pi">:</span>
    <span class="na">availability_zone</span><span class="pi">:</span> <span class="s">nova</span>
    <span class="na">description</span><span class="pi">:</span> <span class="no">null</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">test-detached-volume</span>
    <span class="na">volume_type</span><span class="pi">:</span> <span class="s">tripleo</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">openstack.network.ServerVolume</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You may edit the file as needed and then run the "import_detached_volumes"
playbook to import the volumes from this file into the destination
cloud:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/import_detached_volumes.yml</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_diagram"><a class="anchor" href="#_diagram"></a><a class="link" href="#_diagram">Diagram</a></h5>
<div class="imageblock">
<div class="content">
<img src="../images/plantuml/render/detached-volume-migration-data-flow.png" alt="Detached volume migration (data flow)" width="50%">
</div>
<div class="title">Figure 4. Detached volume migration (data flow)</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_workload_migration_3"><a class="anchor" href="#_workload_migration_3"></a><a class="link" href="#_workload_migration_3">5.4.4. Workload migration</a></h4>
<div class="paragraph">
<p>Workload information is exported in a similar method to networks,
security groups, etc. as in the previous sections. Run the
"export_workloads" playbook, and edit the resulting workloads.yml as
desired:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_version</span><span class="pi">:</span> <span class="s">0.17.0</span>
<span class="na">resources</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">_info</span><span class="pi">:</span>
    <span class="na">addresses</span><span class="pi">:</span>
      <span class="na">external_network</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">OS-EXT-IPS-MAC:mac_addr: fa:16:3e:98:19:a0</span>
        <span class="s">OS-EXT-IPS:type: fixed</span>
        <span class="s">addr</span><span class="err">:</span> <span class="s">10.19.2.41</span>
        <span class="s">version</span><span class="err">:</span> <span class="m">4</span>
    <span class="na">flavor_id</span><span class="pi">:</span> <span class="s">a96b2815-3525-4eea-9ab4-14ba58e17835</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s">0025f062-f684-4e02-9da2-3219e011ec74</span>
    <span class="na">status</span><span class="pi">:</span> <span class="s">SHUTOFF</span>
  <span class="na">params</span><span class="pi">:</span>
    <span class="na">flavor_name</span><span class="pi">:</span> <span class="s">m1.small</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">migration-vm</span>
    <span class="na">security_group_names</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">testing123</span>
    <span class="pi">-</span> <span class="s">default</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">openstack.compute.Server</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this playbook only extracts metadata about servers in the
specified tenant - it does not download OpenStack volumes directly to
the migration data directory. Data transfer is handled by the
import_workloads playbook. The data is transfered directly between the
clouds, meaning both clouds have to be running and reachable at the
same time. The following sections describe the process in more detail.</p>
</div>
<div class="sect4">
<h5 id="_process_summary_2"><a class="anchor" href="#_process_summary_2"></a><a class="link" href="#_process_summary_2">Process Summary</a></h5>
<div class="paragraph">
<p>This flowchart illustrates the high-level migration workflow, from a
user&#8217;s point of view:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/plantuml/render/workload-migration-workflow.png" alt="Workload migration (workflow)" width="50%">
</div>
<div class="title">Figure 5. Workload migration (workflow)</div>
</div>
<div class="paragraph">
<p>The process involves the deployment of a "conversion host" on source
and destination clouds. A conversion host is an OpenStack server which
will be used to transfer binary volume data from the source to the
destination cloud. The conversion hosts are expected to be created
from CentOS 9 or RHEL 8 cloud images.</p>
</div>
<div class="paragraph">
<p>The following diagram helps explain the need for a conversion host VM:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/plantuml/render/workload-migration-data-flow.png" alt="Workload migration (data flow)" width="80%">
</div>
<div class="title">Figure 6. Workload migration (data flow)</div>
</div>
<div class="paragraph">
<p>This shows that volumes on the source and destination clouds are
removed from their original VMs and attached to their respective
conversion hosts, and then transferred over the network from the
source conversion host to the destination. The tooling inside the
conversion host migrates one server by automating these actions on
the source and destination clouds:</p>
</div>
<div class="paragraph">
<p>Source Cloud:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Detach volumes from the target server to migrate</p>
</li>
<li>
<p>Attach the volumes to the source conversion host</p>
</li>
<li>
<p>Export the volumes as block devices and wait for destination
conversion host to connect</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Destination Cloud:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create new volumes on the destination conversion host, one for each
source volume</p>
</li>
<li>
<p>Attach the new volumes to the destination conversion host</p>
</li>
<li>
<p>Connect to the block devices exported by source conversion host, and
copy the data to the new attached volumes</p>
</li>
<li>
<p>Detach the volumes from the destination conversion host</p>
</li>
<li>
<p>Create a new server using the new volumes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This method keeps broad compatibility with the various flavors and
configurations of OpenStack using as much of an API-only approach as
possible, while allowing the use of libguestfs-based tooling to minimize
total data transfer.</p>
</div>
</div>
<div class="sect4">
<h5 id="_preparation_2"><a class="anchor" href="#_preparation_2"></a><a class="link" href="#_preparation_2">Preparation</a></h5>
<div class="paragraph">
<p>We&#8217;ll put additional parameters into <code>os-migrate-vars.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_conversion_external_network_name</span><span class="pi">:</span> <span class="s">public</span>
<span class="na">os_migrate_conversion_flavor_name</span><span class="pi">:</span> <span class="s">m1.large</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These define the flavor and external network we want to use for our
conversion hosts.</p>
</div>
<div class="paragraph">
<p>By default the migration will use an image named <code>os_migrate_conv</code> for
conversion hosts. Make sure this image exists in Glance on both clouds.
Currently it should be a
<a href="https://cloud.centos.org/centos/9-stream/x86_64/images/CentOS-Stream-GenericCloud-9-20220914.0.x86_64.qcow2">CentOS 9 Cloud Image</a>
or
<a href="https://access.redhat.com/downloads/content/479/ver=/rhel---8/8.3/x86_64/product-software">RHEL 8 KVM Guest Image</a>.</p>
</div>
<div class="paragraph">
<p>When using RHEL as conversion host, make sure to set the necessary <a href="https://os-migrate.github.io/os-migrate/user/variables-guide.html#conversion-host-rhel-variables">RHEL variables</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_deployment_2"><a class="anchor" href="#_conversion_host_deployment_2"></a><a class="link" href="#_conversion_host_deployment_2">Conversion host deployment</a></h5>
<div class="paragraph">
<p>The conversion host deployment playbook creates the servers, installs
additional required packages, and authorizes the destination conversion
host to connect to the source conversion host for the actual data
transfer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/deploy_conversion_hosts.yml</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_export_2"><a class="anchor" href="#_export_2"></a><a class="link" href="#_export_2">Export</a></h5>
<div class="paragraph">
<p>Before migrating workloads, the destination cloud must have imported all
other resources (networks, security groups, etc.) or the migration will
fail. Matching named resources (including flavor names) must exist on
the destination before the servers are created.</p>
</div>
<div class="paragraph">
<p>Export workload information with the export_workloads playbook. Each
server listed in the resulting workloads.yml will be migrated,
except for the one matching the name given to the source conversion
host server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/export_workloads.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting workloads.yml file will look similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_version</span><span class="pi">:</span> <span class="s">0.17.0</span>
<span class="na">resources</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">_info</span><span class="pi">:</span>
    <span class="na">created_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-11-12T17:55:40Z'</span>
    <span class="na">flavor_id</span><span class="pi">:</span> <span class="s">cd6258f9-c34b-4a9c-a1e2-8cb81826781e</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s">af615f8c-378a-4a2e-be6a-b4d38a954242</span>
    <span class="na">launched_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-11-12T17:56:00.000000'</span>
    <span class="na">security_group_ids</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">1359ec88-4873-40d2-aa0b-18ad0588f107</span>
    <span class="na">status</span><span class="pi">:</span> <span class="s">SHUTOFF</span>
    <span class="na">updated_at</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2020-11-12T17:56:30Z'</span>
    <span class="na">user_id</span><span class="pi">:</span> <span class="s">48be0a2e86a84682b8e4992a65d39e3e</span>
  <span class="na">_migration_params</span><span class="pi">:</span>
    <span class="na">boot_disk_copy</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">params</span><span class="pi">:</span>
    <span class="na">availability_zone</span><span class="pi">:</span> <span class="s">nova</span>
    <span class="na">config_drive</span><span class="pi">:</span> <span class="no">null</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">osm_server</span>
    <span class="na">disk_config</span><span class="pi">:</span> <span class="s">MANUAL</span>
    <span class="na">flavor_ref</span><span class="pi">:</span>
      <span class="na">domain_name</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">m1.xtiny</span>
      <span class="na">project_name</span><span class="pi">:</span> <span class="no">null</span>
    <span class="na">image_ref</span><span class="pi">:</span>
      <span class="na">domain_name</span><span class="pi">:</span> <span class="no">null</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">cirros-0.4.0-x86_64-disk.img</span>
      <span class="na">project_name</span><span class="pi">:</span> <span class="no">null</span>
    <span class="na">key_name</span><span class="pi">:</span> <span class="s">osm_key</span>
    <span class="na">metadata</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">osm_server</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">_info</span><span class="pi">:</span>
        <span class="na">device_id</span><span class="pi">:</span> <span class="s">af615f8c-378a-4a2e-be6a-b4d38a954242</span>
        <span class="na">device_owner</span><span class="pi">:</span> <span class="s">compute:nova</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">cf5d73c3-089b-456b-abb9-dc5da988844e</span>
      <span class="na">_migration_params</span><span class="pi">:</span> <span class="pi">{}</span>
      <span class="na">params</span><span class="pi">:</span>
        <span class="na">fixed_ips_refs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">ip_address</span><span class="pi">:</span> <span class="s">192.168.20.7</span>
          <span class="na">subnet_ref</span><span class="pi">:</span>
            <span class="na">domain_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
            <span class="na">name</span><span class="pi">:</span> <span class="s">osm_subnet</span>
            <span class="na">project_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
        <span class="na">network_ref</span><span class="pi">:</span>
          <span class="na">domain_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">osm_net</span>
          <span class="na">project_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">openstack.network.ServerPort</span>
    <span class="na">scheduler_hints</span><span class="pi">:</span> <span class="no">null</span>
    <span class="na">security_group_refs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">domain_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">osm_security_group</span>
      <span class="na">project_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%auth%'</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[]</span>
    <span class="na">user_data</span><span class="pi">:</span> <span class="no">null</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">openstack.compute.Server</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_migration_parameters_2"><a class="anchor" href="#_migration_parameters_2"></a><a class="link" href="#_migration_parameters_2">Migration parameters</a></h5>
<div class="paragraph">
<p>You can edit the exported <code>workloads.yml</code> to adjust desired
properties for the servers which will be created in the destination
cloud during migration. You can also edit migration parameters to
control how a workload should be migrated. Refer to
<a href="migration-params-guide.html">Migration Parameters Guide</a>
for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ansible_variables_2"><a class="anchor" href="#_ansible_variables_2"></a><a class="link" href="#_ansible_variables_2">Ansible Variables</a></h5>
<div class="paragraph">
<p>In addition to the migration parameters in the resource YAML files,
you can alter the behavior of OS Migrate via Ansible variables,
e.g. to specify a subset of resources/workloads that will be exported
or imported. Refer to the <a href="variables-guide.html">Variables Guide</a> for
details.</p>
</div>
</div>
<div class="sect4">
<h5 id="_migration_2"><a class="anchor" href="#_migration_2"></a><a class="link" href="#_migration_2">Migration</a></h5>
<div class="paragraph">
<p>Then run the import_workloads playbook to migrate the workloads:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/import_workloads.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any server marked "changed" should be successfully migrated to the
destination cloud. Servers are "skipped" if they match the name or
ID of the specified conversion host. If there is already an server
on the destination matching the name of the current server, it will
be marked "ok" and no extra work will be performed.</p>
</div>
</div>
<div class="sect4">
<h5 id="_cleanup_of_conversion_hosts_2"><a class="anchor" href="#_cleanup_of_conversion_hosts_2"></a><a class="link" href="#_cleanup_of_conversion_hosts_2">Cleanup of conversion hosts</a></h5>
<div class="paragraph">
<p>When you are done migrating workloads in given tenants, delete their
conversion hosts via the delete_conversion_hosts playbook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">$OSM_CMD</span> <span class="nv">$OSM_DIR</span>/playbooks/delete_conversion_hosts.yml</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_demo_4"><a class="anchor" href="#_demo_4"></a><a class="link" href="#_demo_4">Demo</a></h5>
<div class="paragraph">
<p><a href="https://youtu.be/gEKvgIZqrQY">Workload migration recorded demo</a>:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://youtu.be/gEKvgIZqrQY"><img src="https://img.youtube.com/vi/gEKvgIZqrQY/maxresdefault.jpg" alt="maxresdefault"></a>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_general_usage_notes"><a class="anchor" href="#_general_usage_notes"></a><a class="link" href="#_general_usage_notes">5.5. General usage notes</a></h3>
<div class="ulist">
<ul>
<li>
<p>Run against <strong>testing/staging clouds first</strong>, verify that you are
getting the expected results.</p>
</li>
<li>
<p>Use <strong>different <code>os_migrate_data_dir</code> per project</strong> you&#8217;re
authenticating to. OS Migrate works in project (tenant) scope most
of the time. The data dir will be populated with the source
project&#8217;s exported resources, and should not be mixed with another
project&#8217;s resources.</p>
<div class="paragraph">
<p>When you are changing <code>os_migrate_src_auth</code> or
<code>os_migrate_src_region_name</code> parameters, make sure to also change
<code>os_migrate_data_dir</code>.</p>
</div>
</li>
<li>
<p>Use the <strong>same version of OS Migrate for export and import</strong>. We
currently do not guarantee that data files are compatible across
versions.</p>
</li>
<li>
<p>OS Migrate may not fit each use case out of the box. You can craft
custom playbooks using the OS Migrate collection pieces (roles and
modules) as building blocks.</p>
</li>
<li>
<p>OS Migrate has supported migrations for OSP versions 13 to 16,
16 to 18, and simple upgrades from 15 to 16 or 16 to 17. We have
tested migrations between 13 to 16, 16 to 18 using RHEL 8.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_variables_guide"><a class="anchor" href="#_variables_guide"></a><a class="link" href="#_variables_guide">5.6. Variables Guide</a></h3>
<div class="paragraph">
<p>The goal of this document is to guide users to correctly configure the
most important variables in OS Migrate. For a complete listing of
variables configurable for each Ansible role, refer to the
documentation of the individual roles.</p>
</div>
<div class="sect3">
<h4 id="_general_variables"><a class="anchor" href="#_general_variables"></a><a class="link" href="#_general_variables">5.6.1. General variables</a></h4>
<div class="sect4">
<h5 id="_resource_filters"><a class="anchor" href="#_resource_filters"></a><a class="link" href="#_resource_filters">Resource filters</a></h5>
<div class="paragraph">
<p>Resource filters allow the user to control which resources will be
migrated. The filters match against resource <strong>names</strong>.</p>
</div>
<div class="paragraph">
<p>The filters work <strong>both during export and during import</strong>, and it is
not required that the same value is used during export and
import. This feature can be used e.g. to export a subset of the
existing resources, and then during import further limit the subset of
resources being imported into batches.</p>
</div>
<div class="paragraph">
<p>The value of a filter variable is a list, where each item can be a
string (exact match) or a dictionary with <code>regex</code> key (regular
expression match). A resource is exported if it matches at least one
of the list items.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_networks_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">my_net</span>
  <span class="pi">-</span> <span class="s">other_net</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">^myprefix_.*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example says: Export only networks named <code>my_net</code> <strong>or</strong>
<code>other_net</code> <strong>or</strong> starting with <code>myprefix_</code>.</p>
</div>
<div class="paragraph">
<p>The filters default to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>meaning "export all resources". (The set of resources exported will
still be limited to those you can see with the authentication
variables you used.)</p>
</div>
<div class="paragraph">
<p>Sometimes two roles use the same variable where this makes sense,
especially for attached resources. E.g. roles
<code>export_security_groups</code> and <code>export_security_group_rules</code> both
use <code>os_migrate_security_groups_filter</code>. Similarly,
<code>export_routers</code> and <code>export_router_interfaces</code> both use
<code>os_migrate_routers_filter</code>.</p>
</div>
<div class="paragraph">
<p>List of the currently implemented filters with default values you can
copy into your variables file and customize:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_flavors_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span>
<span class="na">os_migrate_images_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span>
<span class="na">os_migrate_keypairs_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span>
<span class="na">os_migrate_networks_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span>
<span class="na">os_migrate_projects_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span>
<span class="na">os_migrate_routers_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span>
<span class="na">os_migrate_security_groups_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span>
<span class="na">os_migrate_subnets_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span>
<span class="na">os_migrate_users_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span>
<span class="na">os_migrate_workloads_filter</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">regex</span><span class="pi">:</span> <span class="s">.*</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_conversion_host_variables"><a class="anchor" href="#_conversion_host_variables"></a><a class="link" href="#_conversion_host_variables">5.6.2. Conversion host variables</a></h4>
<div class="paragraph">
<p>The following variables are those that need to be configured prior to
running OS Migrate.</p>
</div>
<div class="sect4">
<h5 id="_conversion_host_name"><a class="anchor" href="#_conversion_host_name"></a><a class="link" href="#_conversion_host_name">Conversion host name</a></h5>
<div class="paragraph">
<p>The conversion hosts might be configured using different names,
this is in case an operator needs to have them registered
with the subscription manager and avoid collisions with the names.</p>
</div>
<div class="paragraph">
<p>The conversion hosts names can be customized using the
following variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_host_name
os_migrate_dst_conversion_host_name</pre>
</div>
</div>
<div class="paragraph">
<p>By default, these variables have the same value
for both conversion hosts <code>os_migrate_conv_src</code>
and <code>os_migrate_conv_dst</code> respectively.</p>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_image_name"><a class="anchor" href="#_conversion_host_image_name"></a><a class="link" href="#_conversion_host_image_name">Conversion host image name</a></h5>
<div class="paragraph">
<p>The conversion host image is the guest configure to execute the
instances migrations.</p>
</div>
<div class="paragraph">
<p>The variables to be configured are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_image_name
os_migrate_dst_conversion_image_name</pre>
</div>
</div>
<div class="paragraph">
<p>This image must be accessible to both tenants/projects prior to
executing the conversion host deployment playbook. The variables
default to <code>os_migrate_conv</code>, so if a conversion host image is
uploaded to Glance as public image with this name (in both src and dst
clouds), these variables do not need to be configured explicitly.</p>
</div>
<div class="paragraph">
<p>Make sure this image exists in Glance on both clouds.  Currently it
should be a
<a href="https://cloud.centos.org/centos/9-stream/x86_64/images/CentOS-Stream-GenericCloud-9-20220914.0.x86_64.qcow2">CentOS 9 Cloud Image</a>
or
<a href="https://access.redhat.com/downloads/content/479/ver=/rhel---8/8.3/x86_64/product-software">RHEL 8 KVM Guest Image</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_flavor_name"><a class="anchor" href="#_conversion_host_flavor_name"></a><a class="link" href="#_conversion_host_flavor_name">Conversion host flavor name</a></h5>
<div class="paragraph">
<p>The conversion host flavor defines the compute, memory, and storage
capacity that will be allocated for the conversion hosts. It needs to
have at least a volume with 20GB.</p>
</div>
<div class="paragraph">
<p>The variables to be configured are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_flavor_name
os_migrate_dst_conversion_flavor_name</pre>
</div>
</div>
<div class="paragraph">
<p>Usually, 'm1.medium' will suffice this requirement, but again, it can
be different between deployments.</p>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_external_network_name"><a class="anchor" href="#_conversion_host_external_network_name"></a><a class="link" href="#_conversion_host_external_network_name">Conversion host external network name</a></h5>
<div class="paragraph">
<p>The external network configuration allows the connection of the
conversion host router for external access, this external network must
be able to allocate floating IPs reachable between both conversion
hosts.</p>
</div>
<div class="paragraph">
<p>Set the name of the external (public) network to which conversion host
private subnet will be attached via its router, for source and
destination clouds respectively, via these variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_external_network_name
os_migrate_dst_conversion_external_network_name</pre>
</div>
</div>
<div class="paragraph">
<p>This is not required if you are attaching your conversion host to
pre-existing network (when
<code>os_migrate_src/dst_conversion_manage_network</code> is <code>false</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_other_conversion_host_dependency_names"><a class="anchor" href="#_other_conversion_host_dependency_names"></a><a class="link" href="#_other_conversion_host_dependency_names">Other conversion host dependency names</a></h5>
<div class="paragraph">
<p>In addition to the name variables described above, it is possible to
customize names of other conversion host dependency resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_net_name
os_migrate_dst_conversion_net_name
os_migrate_src_conversion_subnet_name
os_migrate_dst_conversion_subnet_name
os_migrate_src_conversion_router_name
os_migrate_dst_conversion_router_name
os_migrate_src_conversion_secgroup_name
os_migrate_dst_conversion_secgroup_name
os_migrate_src_conversion_keypair_name
os_migrate_dst_conversion_keypair_name</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_availablility_zone_management"><a class="anchor" href="#_conversion_host_availablility_zone_management"></a><a class="link" href="#_conversion_host_availablility_zone_management">Conversion host availablility zone management</a></h5>
<div class="paragraph">
<p>Availability zones are defined by attaching specific metadata
information to an aggregate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_availability_zone
os_migrate_dst_conversion_availability_zone</pre>
</div>
</div>
<div class="paragraph">
<p>The conversion host can set logical abstractions for partitioning
instances to a specific set of hosts belonging to an aggregate.</p>
</div>
<div class="paragraph">
<p>The default is <code>false</code> (meaning no specification provided).</p>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_network_management"><a class="anchor" href="#_conversion_host_network_management"></a><a class="link" href="#_conversion_host_network_management">Conversion host network management</a></h5>
<div class="paragraph">
<p>It is possible to disable creation and deletion of conversion host
private network by setting these variables to <code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_manage_network
os_migrate_dst_conversion_manage_network</pre>
</div>
</div>
<div class="paragraph">
<p>This disables creation of the network, the subnet, and the router that
typically makes the conversion host reachable from outside the cloud.</p>
</div>
<div class="paragraph">
<p>When disabling network management like this, you&#8217;ll need pre-existing
network that the conversion host can attach to and use it to talk to
the other conversion host. Set these network name variables
accordingly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_net_name
os_migrate_dst_conversion_net_name</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_floating_ip_management"><a class="anchor" href="#_conversion_host_floating_ip_management"></a><a class="link" href="#_conversion_host_floating_ip_management">Conversion host floating IP management</a></h5>
<div class="paragraph">
<p>OS Migrate can be told to not attempt to create any floating IPs on
the conversion hosts. This can be useful when attaching a conversion
host to some public network, where its IP address will be
automatically reachable from outside. The variables to control whether
conversion hosts should have floating IPs are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_manage_fip
os_migrate_dst_conversion_manage_fip</pre>
</div>
</div>
<div class="paragraph">
<p>When the conversion hosts are removed, the required and
assigned floating IPs need to be detached or removed.</p>
</div>
<div class="paragraph">
<p>The following variables allow to change the behavior
of deleting of detaching the floating IP when deleting the conversion
hosts (default: true):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_host_delete_fip
os_migrate_dst_conversion_host_delete_fip</pre>
</div>
</div>
<div class="paragraph">
<p>When the corresponding <code>&#8230;&#8203;_manage_fip</code> variable is set to <code>false</code>,
floating IP deletion is not attempted even if <code>&#8230;&#8203;_delete_fip</code> is set
to <code>true</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_specific_floating_ip"><a class="anchor" href="#_conversion_host_specific_floating_ip"></a><a class="link" href="#_conversion_host_specific_floating_ip">Conversion host specific floating IP</a></h5>
<div class="paragraph">
<p>Each conversion host needs to have a floating IP,
these floating IPs can be assigned automatically or
defined by the operator with the usage of the
following variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_floating_ip_address
os_migrate_dst_conversion_floating_ip_address</pre>
</div>
</div>
<div class="paragraph">
<p>When using this variable to specify an exact IP address, the floating
IP must already exist and be available for attaching.</p>
</div>
</div>
<div class="sect4">
<h5 id="_attaching_conversion_hosts_onto_public_networks"><a class="anchor" href="#_attaching_conversion_hosts_onto_public_networks"></a><a class="link" href="#_attaching_conversion_hosts_onto_public_networks">Attaching conversion hosts onto public networks</a></h5>
<div class="paragraph">
<p>A combination of variables described earlier can be used to attach the
conversion hosts directly onto pre-existing public networks. We need
to make sure that we don&#8217;t try to create any private network, we don&#8217;t
try to create a floating IP, and we set the conversion host network
names accordingly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_manage_network: false
os_migrate_dst_conversion_manage_network: false
os_migrate_src_conversion_manage_fip: false
os_migrate_dst_conversion_manage_fip: false
os_migrate_src_conversion_net_name: some_public_net_src
os_migrate_dst_conversion_net_name: some_public_net_dst</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_storage_migration_modes"><a class="anchor" href="#_storage_migration_modes"></a><a class="link" href="#_storage_migration_modes">Storage migration modes</a></h5>
<div class="paragraph">
<p>The modes for workload migrations can be changed in either
cloud. The variable that control the behavior are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_workloads_data_copy</pre>
</div>
</div>
<div class="paragraph">
<p>The default is <code>true</code> (meaning the copying of data using
os-migrate is skipped).</p>
</div>
<div class="paragraph">
<p>This is useful if there are pre-created volumes in the
destination cloud that we just want to attach when creating
the VM in the destination.</p>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_boot_from_volume"><a class="anchor" href="#_conversion_host_boot_from_volume"></a><a class="link" href="#_conversion_host_boot_from_volume">Conversion host boot from volume</a></h5>
<div class="paragraph">
<p>The conversion hosts can be created as boot-from-volume servers in
either cloud. The variables that control the behavior are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_host_boot_from_volume
os_migrate_dst_conversion_host_boot_from_volume</pre>
</div>
</div>
<div class="paragraph">
<p>The default is <code>false</code> (meaning boot from Nova local disk).</p>
</div>
<div class="paragraph">
<p>When creating boot-from-volume conversion hosts, it is possible to
customize the size in GB for the boot volume:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_host_volume_size
os_migrate_dst_conversion_host_volume_size</pre>
</div>
</div>
<div class="paragraph">
<p>The size should be 20 or more, the default is 20.</p>
</div>
</div>
<div class="sect4">
<h5 id="_conversion_host_rhel_variables"><a class="anchor" href="#_conversion_host_rhel_variables"></a><a class="link" href="#_conversion_host_rhel_variables">Conversion host RHEL variables</a></h5>
<div class="paragraph">
<p>When using RHEL as conversion host, set the SSH user name as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_conversion_host_ssh_user: cloud-user</pre>
</div>
</div>
<div class="paragraph">
<p>It is also necessary to set RHEL registration variables. The
variables part of this role are set to <code>omit</code> by default.</p>
</div>
<div class="paragraph">
<p>The variables <code>os_migrate_conversion_rhsm_auto_attach</code>
and <code>os_migrate_conversion_rhsm_activationkey</code> are mutually
exclusive, given that, they are both defaulted to omit.</p>
</div>
<div class="paragraph">
<p>Typically the only registration variables to set are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_conversion_rhsm_username
os_migrate_conversion_rhsm_password</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>os_migrate_conversion_rhsm_auto_attach</code> should be set to <code>True</code>
in order to fetch automatically the content once the node is registered.</p>
</div>
<div class="paragraph">
<p>or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_conversion_rhsm_activationkey
os_migrate_conversion_rhsm_org_id</pre>
</div>
</div>
<div class="paragraph">
<p>For this case, <code>os_migrate_conversion_rhsm_auto_attach</code> must be left
undefined with its default value of <code>omit</code>.</p>
</div>
<div class="paragraph">
<p>The complete list of registration variables corresponds to the
<a href="https://docs.ansible.com/ansible/latest/collections/community/general/redhat_subscription_module.html">redhat_subscription</a>
Ansible module. In OS Migrate they are named as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_conversion_rhsm_activationkey
os_migrate_conversion_rhsm_auto_attach
os_migrate_conversion_rhsm_consumer_id
os_migrate_conversion_rhsm_consumer_name
os_migrate_conversion_rhsm_consumer_type
os_migrate_conversion_rhsm_environment
os_migrate_conversion_rhsm_force_register
os_migrate_conversion_rhsm_org_id
os_migrate_conversion_rhsm_password
os_migrate_conversion_rhsm_pool
os_migrate_conversion_rhsm_pool_ids
os_migrate_conversion_rhsm_release
os_migrate_conversion_rhsm_rhsm_baseurl
os_migrate_conversion_rhsm_rhsm_repo_ca_cert
os_migrate_conversion_rhsm_server_hostname
os_migrate_conversion_rhsm_server_insecure
os_migrate_conversion_rhsm_server_proxy_hostname
os_migrate_conversion_rhsm_server_proxy_password
os_migrate_conversion_rhsm_server_proxy_port
os_migrate_conversion_rhsm_server_proxy_user
os_migrate_conversion_rhsm_syspurpose
os_migrate_conversion_rhsm_username</pre>
</div>
</div>
<div class="paragraph">
<p>Additionally is possible to enable specific repositories in the
conversion hosts using the following variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_conversion_rhsm_repositories</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>os_migrate_conversion_rhsm_repositories</code> variable is a
list of those repositories that will be enabled on the conversion
host.</p>
</div>
</div>
<div class="sect4">
<h5 id="_enabling_password_based_ssh_access_to_the_conversion_hosts"><a class="anchor" href="#_enabling_password_based_ssh_access_to_the_conversion_hosts"></a><a class="link" href="#_enabling_password_based_ssh_access_to_the_conversion_hosts">Enabling password-based SSH access to the conversion hosts</a></h5>
<div class="paragraph">
<p>When required, a user can configure password-based SSH access to
the conversion hosts, this feature might be useful for debugging
when the private key of the hosts is not available anymore.</p>
</div>
<div class="paragraph">
<p>The variables required in order to configure the password-based
access are named as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_conversion_host_ssh_user_enable_password_access
os_migrate_conversion_host_ssh_user_password</pre>
</div>
</div>
<div class="paragraph">
<p>The variable <code>os_migrate_conversion_host_ssh_user_enable_password_access</code>
is set by default to <code>false</code>, and the variable
<code>os_migrate_conversion_host_ssh_user_password</code> is set by default to the
following string <code>weak_password_disabled_by_default</code>.</p>
</div>
<div class="paragraph">
<p>The user enabled to access the conversion hosts with password-based authentication
is the one defined in the <code>os_migrate_conversion_host_ssh_user</code> variable.</p>
</div>
</div>
<div class="sect4">
<h5 id="_running_custom_bash_scripts_in_the_conversion_hosts"><a class="anchor" href="#_running_custom_bash_scripts_in_the_conversion_hosts"></a><a class="link" href="#_running_custom_bash_scripts_in_the_conversion_hosts">Running custom bash scripts in the conversion hosts</a></h5>
<div class="paragraph">
<p>It is possible to run custom bash scripts in the conversion
hosts before and after configuring their content.
The content of the conversion hosts is a set of required packages
and in the case of using RHEL then the configuration of the
subscription manager.</p>
</div>
<div class="paragraph">
<p>The variables allowing to run the custom scripts are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_host_pre_content_hook
os_migrate_src_conversion_host_post_content_hook
os_migrate_dst_conversion_host_pre_content_hook
os_migrate_dst_conversion_host_post_content_hook</pre>
</div>
</div>
<div class="paragraph">
<p>The Ansible module used to achieve this is shell,
so users can execute a simple one-liner command, or more
complex scripts like the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_host_pre_content_hook: |
  ls -ltah
  echo "hello world"
  df -h</pre>
</div>
</div>
<div class="paragraph">
<p>or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_src_conversion_host_pre_content_hook: "echo 'this is a simple command'"</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_disabling_the_subscription_manager_tasks"><a class="anchor" href="#_disabling_the_subscription_manager_tasks"></a><a class="link" href="#_disabling_the_subscription_manager_tasks">Disabling the subscription manager tasks</a></h5>
<div class="paragraph">
<p>It is possible to disable the subscription manager
native tasks by setting to false the following variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>os_migrate_conversion_rhsm_manage</pre>
</div>
</div>
<div class="paragraph">
<p>This will skip the tasks related to RHSM when using RHEL
in the conversion hosts. Disabling RHSM can be useful in
those cases where the operator has custom scripts they
need to use instead the standard Ansible module.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openstack_rest_api_tls_variables"><a class="anchor" href="#_openstack_rest_api_tls_variables"></a><a class="link" href="#_openstack_rest_api_tls_variables">5.6.3. OpenStack REST API TLS variables</a></h4>
<div class="paragraph">
<p>If either of your clouds uses TLS endpoints that are not trusted by
the Migrator host by default (e.g. using self-signed certificates), or
if the Migrator host should authenticate itself via key+cert, you will
need to set TLS-related variables.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>os_migrate_src_validate_certs</code> / <code>os_migrate_dst_validate_certs</code> -
Setting these to <code>false</code> disables certificate validity checks of
the source/destination API endpoints.</p>
</li>
<li>
<p><code>os_migrate_src_ca_cert</code> / <code>os_migrate_dst_ca_cert</code> - These
variables allow you to specify a custom CA certificate that should
be used to validate the source/destination API certificates.</p>
</li>
<li>
<p><code>os_migrate_src_client_cert</code>, <code>os_migrate_src_client_key</code> /
<code>os_migrate_dst_client_cert</code>, <code>os_migrate_dst_client_key</code> - If the
Migrator host should authenticate itself using a TLS key<br>
certificate when talking to source/destination APIs, set these
variables.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_workload_importexport_variables"><a class="anchor" href="#_workload_importexport_variables"></a><a class="link" href="#_workload_importexport_variables">5.6.4. Workload import/export variables</a></h4>
<div class="ulist">
<ul>
<li>
<p><code>os_migrate_workload_stop_before_migration</code> - Set to true if you wish
for os_migrate to stop your workloads/vms prior to migration. Note that
only workloads/vms in <code>SHUTOFF</code> state will be migrated.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_workload_migration_variables"><a class="anchor" href="#_workload_migration_variables"></a><a class="link" href="#_workload_migration_variables">5.6.5. Workload migration variables</a></h4>
<div class="paragraph">
<p>Workloads to be migrated with OS Migrate can have varying storage configurations in
the source cloud, and the desired way to migrate their storage also varies, per cloud
operators preference.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the matrix of options (whats in the source, how
it should be migrated, how should OS Migrate workloads YAML file be configured,
is the conversion host required for this mode of migration, is this migration
mode implemented).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://github.com/user-attachments/assets/1862b21b-4f67-47c0-ba73-f62df0d4568a" alt="Screenshot 2024-07-15 at 2 59 17 PM">
</div>
<div class="title">Figure 7. Screenshot 2024-07-15 at 2 59 17 PM</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://github.com/user-attachments/assets/939c98fb-f425-4f53-aca4-fd03f111fd33" alt="Screenshot 2024-07-15 at 3 02 28 PM">
</div>
<div class="title">Figure 8. Screenshot 2024-07-15 at 3 02 28 PM</div>
</div>
<div class="imageblock">
<div class="content">
<img src="https://github.com/user-attachments/assets/faf09224-fb11-417e-865a-72c9936bc8bf" alt="Screenshot 2024-07-15 at 3 03 16 PM">
</div>
<div class="title">Figure 9. Screenshot 2024-07-15 at 3 03 16 PM</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_migration_parameters_guide"><a class="anchor" href="#_migration_parameters_guide"></a><a class="link" href="#_migration_parameters_guide">5.7. Migration Parameters Guide</a></h3>
<div class="sect3">
<h4 id="_what_are_migration_parameters"><a class="anchor" href="#_what_are_migration_parameters"></a><a class="link" href="#_what_are_migration_parameters">5.7.1. What are migration parameters</a></h4>
<div class="paragraph">
<p>Resource YAML files generated by OS Migrate when exporting are
editable by the user. The parameters in <code>params</code> section of a
resource generally specify direct resource properties, i.e. <strong>what</strong> the
resource is like. Sometimes, a resource can be copied from source to
destination in multiple different ways, each suitable for different
use cases. To control <strong>how</strong> an individual resource should be migrated,
there is another editable section in resource serializations, called
<code>_migration_params</code>. The descriptions of the most important ones are
in this guide.</p>
</div>
</div>
<div class="sect3">
<h4 id="_workload_migration_parameters"><a class="anchor" href="#_workload_migration_parameters"></a><a class="link" href="#_workload_migration_parameters">5.7.2. Workload migration parameters</a></h4>
<div class="ulist">
<ul>
<li>
<p><code>boot_disk_copy</code> controls how if the boot disk of the destination
server is copied or re-imaged:</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code>: The destination server will be booted from a
Glance image of the same name as the source server. (This is the
default for servers which were booted from an image in the
source cloud.)</p>
</li>
<li>
<p><code>true</code>: The source server&#8217;s boot disk will be copied
into the destination as a volume, and the destination server
will be created as boot-from-volume. (For servers which are
already boot-from-volume in the source cloud, this is the
default and the only possible path.)</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>data_copy</code> controls storage migration modes for workloads:</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code>: The copying of data using os-migrate is skipped.</p>
</li>
<li>
<p><code>true</code>: (Default) We result to using os-migrate for data copying.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>boot_volume_params</code> controls new boot disk creation parameters in
the destination, in case the source VM has no boot disk, but
<code>boot_disk_copy</code> is <code>true</code>.</p>
<div class="paragraph">
<p>There are a few pre-filled parameters, defaulted to <code>None</code>.  Then
<code>None</code> value means those parameters will not be specified when
creating the boot volume, or in case of the <code>name</code> parameter, the
default for workload migration will be used (prefix + VM name).</p>
</div>
<div class="paragraph">
<p>When the source VM <strong>does</strong> have a boot volume already, do not use
<code>boot_volume_params</code> to edit the destination creation
parameters. Instead, edit the serialized volume in the <code>volumes</code>
section of the workload&#8217;s <code>params</code>.</p>
</div>
</li>
<li>
<p><code>boot_volume</code> controls new boot disk creation parameters for
workload migrations with storage mode (data_copy) set to false.</p>
<div class="paragraph">
<p>There are a few pre-filled parameters, defaulted to <code>None</code>.  Then
<code>None</code> value means those parameters will not be specified when
creating the boot volume, or in case of the <code>name</code> parameter, the
default for workload migration will be used (prefix + VM name).</p>
</div>
<div class="paragraph">
<p>When the source VM <strong>does</strong> have a boot volume already, do not use
<code>boot_volume_params</code> to edit the destination creation
parameters. Instead, edit the serialized volume in the <code>volumes</code>
section of the workload&#8217;s <code>params</code>.</p>
</div>
</li>
<li>
<p><code>additional_volumes</code> any additonal volumes to be configured for
workload migrations with storage mode (data_copy) set to false.</p>
</li>
<li>
<p><code>floating_ip_mode</code> controls whether and how floating IPs should be
created for workloads:</p>
<div class="ulist">
<ul>
<li>
<p><code>skip</code>: Do not create any floating IPs on the destination
server.</p>
</li>
<li>
<p><code>new</code>: Create a new floating IP (auto-assigned address).</p>
</li>
<li>
<p><code>existing</code>: Assume the floating IP address as specified in
the workload serialization is already assigned to the
destination project, but not attached. Attach this floating
IP. If this is not possible for some reason, fail.</p>
</li>
<li>
<p><code>auto</code> (default): Attempt the <code>existing</code> method of floating
IP assignment first, but should it fail, fall back to the
<code>new</code> method instead.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>General remarks regarding floating IPs:</p>
</div>
<div class="paragraph">
<p>In the <code>workloads.yml</code> export, each serialized floating IP
contains a <code>fixed_ip_address</code> property, so a floating IP will
be created on the port with this address. (When editing
ports/fixed addresses of a workload, make sure to also edit the
<code>fixed_ip_address</code> properties of its floating IPs accordingly.)</p>
</div>
<div class="paragraph">
<p>It is important to note that the address of a newly created
floating IP will be automatically selected by the cloud, it will
not match the floating IP address of the source server. (In most
cases, the floating IP ranges of src/dst clouds don&#8217;t overlap
anyway.)</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_it_works_workload_migration"><a class="anchor" href="#_how_it_works_workload_migration"></a><a class="link" href="#_how_it_works_workload_migration">5.8. How it works: Workload migration</a></h3>
<div class="paragraph">
<p>The information described in this page is not necessary knowledge for
using OS Migrate workload migration. However, knowing how the
migration works under the hood may be useful for troubleshooting or
forming deeper understanding of OS Migrate.</p>
</div>
<div class="sect3">
<h4 id="_data_flow_2"><a class="anchor" href="#_data_flow_2"></a><a class="link" href="#_data_flow_2">5.8.1. Data flow</a></h4>
<div class="paragraph">
<p>The workload migration utilizes so called <strong>conversion hosts</strong> to
transfer data from the source cloud to the destination cloud.</p>
</div>
<div class="paragraph">
<p>The conversion hosts are temporarily deployed in the source &amp;
destination projects. Being in the same project as the source (and
destination, respectively) VMs ensures that the conversion hosts will
have access to the data that needs to be migrated (snapshots and
volumes).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/plantuml/render/workload-migration-data-flow.png" alt="Workload migration (data flow)" width="80%">
</div>
<div class="title">Figure 10. Workload migration (data flow)</div>
</div>
</div>
<div class="sect3">
<h4 id="_migration_sequence_2"><a class="anchor" href="#_migration_sequence_2"></a><a class="link" href="#_migration_sequence_2">5.8.2. Migration sequence</a></h4>
<div class="paragraph">
<p>The <code>export_workloads.yml</code> playbook simply exports workload metadata
into <code>workloads.yml</code>.</p>
</div>
<div class="paragraph">
<p>The actual main migration sequence happens inside
<code>import_workloads.yml</code> playbook and the <code>import_workloads</code>
role. The initial common steps are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The resources loaded from <code>workloads.yml</code> are validated.</p>
</li>
<li>
<p>Resources are filtered according to <code>os_migrate_workloads_filter</code>.</p>
</li>
<li>
<p>Reachability of source &amp; destination conversion hosts is verified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you&#8217;re defaulting to the default storage migration mode <code>data_copy</code>
then the role starts iterating over all workloads that passed the
filter. The steps performed for each workload (Nova Server) are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>import_workload_prelim</code> module creates log and state files
under <code>{{ os_migrate_data_dir }}/workload_logs</code>. It also takes
care of skipping migration of VMs that already exist in the
destination, and skipping of conversion hosts, should such
migration be attempted.</p>
</li>
<li>
<p>The <code>import_workload_dst_check</code> module checks whether migration
prerequisites are satisfied in the destination cloud/project. This
means verifying that resources which are referenced by name from
the workload serialization can be de-referenced in the destination
cloud. In other words, this verifies the networks, subnets etc.,
that the destination VM should be attached to, indeed exist in the
destination cloud.</p>
</li>
<li>
<p>If <code>os_migrate_workload_stop_before_migration</code> is <code>true</code>, the VM
in the source cloud is stopped.</p>
</li>
<li>
<p>The <code>import_workload_src_check</code> checks whether the source workload
is ready to be migrated. This means verifying that the Nova Server
is <code>SHUTOFF</code>.</p>
</li>
<li>
<p>The <code>import_workload_export_volumes</code> module prepares data for
transfer to the destination cloud:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>boot_disk_copy</code> is <code>true</code>, a snapshot of the source VM is
created, converted to a Cinder volume and attached to the source
conversion host.</p>
</li>
<li>
<p>Additional Cinder volumes attached to the source VM are detached
from it and attached to the source conversion host.</p>
</li>
<li>
<p>All VM&#8217;s volumes (boot &amp; additional) on the conversion host are
exported as NBD drives, listening on localhost only.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>import_workload_transfer_volumes</code> copies data from source to
destination:</p>
<div class="ulist">
<ul>
<li>
<p>SSH port forwarding is created for the NBD drives of the source
conversion host, so that they are accessible on the destination
conversion host, again on localhost only. (The data transfer
mechanism could be described as "NBD over SSH".)</p>
</li>
<li>
<p>Cinder volumes are created in the destination project for both
the boot disk and additional volumes (as applicable). The
destination volume sizes match the volume sizes in the source
cloud. The volumes are attached to the destination conversion
host.</p>
</li>
<li>
<p>Sparsification of the NBDs is performed, only for recognizable
filesystems that the <code>virt-sparsify</code> tool supports. This
significantly speeds up copying of empty space on supported
filesystems.</p>
</li>
<li>
<p>Data is copied from the NBDs to the respective destination Cinder
volumes.</p>
</li>
<li>
<p>SSH port forwarding for the NBDs are closed, and volumes are
detached from the destination conversion host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>import_workload_create_instance</code> creates new Nova server in
the destination cloud according to the data from the resource
serialization, and using the copied Cinder volumes as applicable.</p>
</li>
<li>
<p>The <code>import_workload_src_cleanup</code> cleans up after the migration in
the source cloud. It closes the NBD exports, detaches volumes from
the conversion host, deletes the temporary boot disk snapshot
volume and re-attaches any additional volumes back onto the
source VM (as applicable).</p>
</li>
<li>
<p>In case of failure during the migration, the
<code>import_workload_src_cleanup</code> module is executed too, and an
extra <code>import_workload_dst_failure_cleanup</code> module is executed,
which aims to clean up failed partial migration from the
destination cloud. (In case of successful migration, no further
clean up is necessary in the destination cloud.)</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/plantuml/render/workload-migration-sequence.png" alt="Sequence diagram of workload migration internal actions" width="100%">
</div>
<div class="title">Figure 11. Sequence diagram of workload migration internal actions</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_2"><a class="anchor" href="#_troubleshooting_2"></a><a class="link" href="#_troubleshooting_2">5.9. Troubleshooting</a></h3>
<div class="sect3">
<h4 id="_general_tips"><a class="anchor" href="#_general_tips"></a><a class="link" href="#_general_tips">5.9.1. General tips</a></h4>
<div class="ulist">
<ul>
<li>
<p>Run <code>ansible-playbook</code> with <code>-v</code> parameter to get more detailed
output.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_common_issues_2"><a class="anchor" href="#_common_issues_2"></a><a class="link" href="#_common_issues_2">5.9.2. Common issues</a></h4>
<div class="ulist">
<ul>
<li>
<p><code>DataVersionMismatch: OS Migrate runtime is version 'X.Y.Z', but
tried to parse data file 'abc.yml' with os_migrate_version field
set to 'A.B.C'. (Exported data is not guaranteed to be compatible
across versions. After upgrading OS Migrate, make sure to remove
the old YAML exports from the data directory.)</code></p>
<div class="paragraph">
<p>When OS Migrate export playbooks run, the existing data files
aren&#8217;t automatically truncated. OS Migrate gradually adds each
resource serialization to the (perhaps existing) YAML file, or it
updates a resource serialization if one with the same ID is already
present in the file.</p>
</div>
<div class="paragraph">
<p>OS Migrate will refuse to parse YAML files which were created with
a different version. In many cases such parsing would "just work",
but not always, so OS Migrate is being defensive and requires
clearing out the data directory when upgrading to a new version,
and re-running the export playbooks.</p>
</div>
<div class="paragraph">
<p>Alternatively, an advanced user can verify that the previous and
new OS Migrate does not include any change in export data
structures, and can edit the <code>os_migrate_version</code> field in the
data files. This option should be used with caution, but it may
prove useful in special scenarios, e.g. if external causes prevent
re-exporting the data.</p>
</div>
</li>
<li>
<p><code>AnsibleCensoringStringIssue: workloads.yml setup task altering
log_file path during preliminary import workload steps. (As a
result susequent import tasks are failing due to non-existent path
error.)</code></p>
<div class="paragraph">
<p>OS Migrate uses OpenStack modules to build their argument spec by
using a function in OpenStack module utils. When project names are
marked as <code>no_log</code> it causes values to be censored in the
response. This is seen here in the import workloads setup task  where
<code>/home/project_name/workloads/import_workloads.yml</code> becomes
<code>/home/<strong><strong></strong></strong>/workloads/import_workloads.yml</code>.</p>
</div>
<div class="paragraph">
<p>OS Migrate cannot specify that only the password in the credentials
dictionary should be treated as a secret, instead the whole
credentials dictionary is marked as a secret.</p>
</div>
<div class="paragraph">
<p>A workaround to this is to sanitize the project name with something
in a pre-migration playbook that sets up storage directories for
OS Migrate variables or data. This can prove beneficial in the
event of users running into censored string issues relating to
ansible.</p>
</div>
</li>
<li>
<p><code>KeypairMigrationPitfalls: Keys are not seen by user performing
migrations. When a user creates keypairs and assigns those keypairs
to its inteded resource its noted that users used in the migration
process can access the inteded resources but not the required keys.
This leads to checks failing since the user can&#8217;t check if the key
exist in the source cloud.</code></p>
<div class="paragraph">
<p>OS Migrate has an export_user_keypairs.yml which escalates using admin
privileges. By default it iterates over all users and their keys,
but it listens for filter variables which can help scope down the export.</p>
</div>
<div class="paragraph">
<p>How to use those key exports depends on how the workload migration
should be done. Either the keys can be uploaded to destination to the
respective users via import_users_keypairs.yml playbook, and destination
credentials for workload migration have to be of the users who can see the
keys.</p>
</div>
<div class="paragraph">
<p>An alternative for the following issues is the user_ref.name and
user_ref.domain_name in the exported YAML could be edited from actual
names to %auth% values, and that data file could then be used with
import_keypairs.yml (run as a tenant user, not admin), which would import
all the various keys under a single user, and that user could then
perform the migration, having all the necessary public keys.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documented_roles_in_os_migrate"><a class="anchor" href="#_documented_roles_in_os_migrate"></a><a class="link" href="#_documented_roles_in_os_migrate">6. Documented roles in os-migrate</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_contents_2"><a class="anchor" href="#_contents_2"></a><a class="link" href="#_contents_2">6.1. Contents</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_conversion_host"><a class="anchor" href="#_role_conversion_host"></a><a class="link" href="#_role_conversion_host">7. Role - conversion_host</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/conversion_host</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_conversion_host_content"><a class="anchor" href="#_role_conversion_host_content"></a><a class="link" href="#_role_conversion_host_content">8. Role - conversion_host_content</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/conversion_host_content</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_detached_volumes"><a class="anchor" href="#_role_export_detached_volumes"></a><a class="link" href="#_role_export_detached_volumes">9. Role - export_detached_volumes</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_detached_volumes</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_flavors"><a class="anchor" href="#_role_export_flavors"></a><a class="link" href="#_role_export_flavors">10. Role - export_flavors</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_flavors</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_images"><a class="anchor" href="#_role_export_images"></a><a class="link" href="#_role_export_images">11. Role - export_images</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_images</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_keypairs"><a class="anchor" href="#_role_export_keypairs"></a><a class="link" href="#_role_export_keypairs">12. Role - export_keypairs</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_keypairs</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_networks"><a class="anchor" href="#_role_export_networks"></a><a class="link" href="#_role_export_networks">13. Role - export_networks</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_networks</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_projects"><a class="anchor" href="#_role_export_projects"></a><a class="link" href="#_role_export_projects">14. Role - export_projects</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_projects</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_router_interfaces"><a class="anchor" href="#_role_export_router_interfaces"></a><a class="link" href="#_role_export_router_interfaces">15. Role - export_router_interfaces</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_router_interfaces</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_routers"><a class="anchor" href="#_role_export_routers"></a><a class="link" href="#_role_export_routers">16. Role - export_routers</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_routers</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_security_group_rules"><a class="anchor" href="#_role_export_security_group_rules"></a><a class="link" href="#_role_export_security_group_rules">17. Role - export_security_group_rules</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_security_group_rules</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_security_groups"><a class="anchor" href="#_role_export_security_groups"></a><a class="link" href="#_role_export_security_groups">18. Role - export_security_groups</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_security_groups</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_subnets"><a class="anchor" href="#_role_export_subnets"></a><a class="link" href="#_role_export_subnets">19. Role - export_subnets</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_subnets</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_user_project_role_assignments"><a class="anchor" href="#_role_export_user_project_role_assignments"></a><a class="link" href="#_role_export_user_project_role_assignments">20. Role - export_user_project_role_assignments</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_user_project_role_assignments</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_users"><a class="anchor" href="#_role_export_users"></a><a class="link" href="#_role_export_users">21. Role - export_users</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_users</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_users_keypairs"><a class="anchor" href="#_role_export_users_keypairs"></a><a class="link" href="#_role_export_users_keypairs">22. Role - export_users_keypairs</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This role is meant to be run with admin privileges. It imports Nova
keypairs matching <code>os_migrate_keypairs_filter</code> for all users
matching <code>os_migrate_users_filter</code>.</p>
</div>
<div class="paragraph">
<p>When using this role, make sure you have recent enough OpenStack SDK
(0.57+).</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_users_keypairs</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_export_workloads"><a class="anchor" href="#_role_export_workloads"></a><a class="link" href="#_role_export_workloads">23. Role - export_workloads</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/export_workloads</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_detached_volumes"><a class="anchor" href="#_role_import_detached_volumes"></a><a class="link" href="#_role_import_detached_volumes">24. Role - import_detached_volumes</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_detached_volumes</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_flavors"><a class="anchor" href="#_role_import_flavors"></a><a class="link" href="#_role_import_flavors">25. Role - import_flavors</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_flavors</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_images"><a class="anchor" href="#_role_import_images"></a><a class="link" href="#_role_import_images">26. Role - import_images</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_images</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_keypairs"><a class="anchor" href="#_role_import_keypairs"></a><a class="link" href="#_role_import_keypairs">27. Role - import_keypairs</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_keypairs</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_networks"><a class="anchor" href="#_role_import_networks"></a><a class="link" href="#_role_import_networks">28. Role - import_networks</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_networks</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_projects"><a class="anchor" href="#_role_import_projects"></a><a class="link" href="#_role_import_projects">29. Role - import_projects</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_projects</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_router_interfaces"><a class="anchor" href="#_role_import_router_interfaces"></a><a class="link" href="#_role_import_router_interfaces">30. Role - import_router_interfaces</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_router_interfaces</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_routers"><a class="anchor" href="#_role_import_routers"></a><a class="link" href="#_role_import_routers">31. Role - import_routers</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_routers</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_security_group_rules"><a class="anchor" href="#_role_import_security_group_rules"></a><a class="link" href="#_role_import_security_group_rules">32. Role - import_security_group_rules</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_security_group_rules</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_security_groups"><a class="anchor" href="#_role_import_security_groups"></a><a class="link" href="#_role_import_security_groups">33. Role - import_security_groups</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_security_groups</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_subnets"><a class="anchor" href="#_role_import_subnets"></a><a class="link" href="#_role_import_subnets">34. Role - import_subnets</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_subnets</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_user_project_role_assignments"><a class="anchor" href="#_role_import_user_project_role_assignments"></a><a class="link" href="#_role_import_user_project_role_assignments">35. Role - import_user_project_role_assignments</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_user_project_role_assignments</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_users"><a class="anchor" href="#_role_import_users"></a><a class="link" href="#_role_import_users">36. Role - import_users</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_users</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_users_keypairs"><a class="anchor" href="#_role_import_users_keypairs"></a><a class="link" href="#_role_import_users_keypairs">37. Role - import_users_keypairs</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This role is meant to be run with admin privileges. It exports Nova
keypairs matching <code>os_migrate_keypairs_filter</code> for all users
matching <code>os_migrate_users_filter</code>.</p>
</div>
<div class="paragraph">
<p>When using this role, make sure you have recent enough OpenStack SDK
(0.57+).</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_users_keypairs</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_import_workloads"><a class="anchor" href="#_role_import_workloads"></a><a class="link" href="#_role_import_workloads">38. Role - import_workloads</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/import_workloads</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_prelude_common"><a class="anchor" href="#_role_prelude_common"></a><a class="link" href="#_role_prelude_common">39. Role - prelude_common</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/prelude_common</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_prelude_dst"><a class="anchor" href="#_role_prelude_dst"></a><a class="link" href="#_role_prelude_dst">40. Role - prelude_dst</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/prelude_dst</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_prelude_src"><a class="anchor" href="#_role_prelude_src"></a><a class="link" href="#_role_prelude_src">41. Role - prelude_src</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/prelude_src</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_validate_data_dir"><a class="anchor" href="#_role_validate_data_dir"></a><a class="link" href="#_role_validate_data_dir">42. Role - validate_data_dir</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/validate_data_dir</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_validate_resource_files"><a class="anchor" href="#_role_validate_resource_files"></a><a class="link" href="#_role_validate_resource_files">43. Role - validate_resource_files</a></h2>
<div class="sectionbody">
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>ansibleautoplugin::
:role: os_migrate/roles/validate_resource_files</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documented_modules_in_os_migrate"><a class="anchor" href="#_documented_modules_in_os_migrate"></a><a class="link" href="#_documented_modules_in_os_migrate">44. Documented modules in os-migrate</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_contents_3"><a class="anchor" href="#_contents_3"></a><a class="link" href="#_contents_3">44.1. Contents</a></h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_auth_info"><a class="anchor" href="#_module_auth_info"></a><a class="link" href="#_module_auth_info">45. Module - auth_info</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>auth_info</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/auth_info.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_detached_volume"><a class="anchor" href="#_module_export_detached_volume"></a><a class="link" href="#_module_export_detached_volume">46. Module - export_detached_volume</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_detached_volume</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_detached_volume.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_flavor"><a class="anchor" href="#_module_export_flavor"></a><a class="link" href="#_module_export_flavor">47. Module - export_flavor</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_flavor</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_flavor.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_image_blob"><a class="anchor" href="#_module_export_image_blob"></a><a class="link" href="#_module_export_image_blob">48. Module - export_image_blob</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_image_blob</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_image_blob.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_image_meta"><a class="anchor" href="#_module_export_image_meta"></a><a class="link" href="#_module_export_image_meta">49. Module - export_image_meta</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_image_meta</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_image_meta.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_keypair"><a class="anchor" href="#_module_export_keypair"></a><a class="link" href="#_module_export_keypair">50. Module - export_keypair</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_keypair</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_keypair.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_network"><a class="anchor" href="#_module_export_network"></a><a class="link" href="#_module_export_network">51. Module - export_network</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_network</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_network.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_project"><a class="anchor" href="#_module_export_project"></a><a class="link" href="#_module_export_project">52. Module - export_project</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_project</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_project.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_router"><a class="anchor" href="#_module_export_router"></a><a class="link" href="#_module_export_router">53. Module - export_router</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_router</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_router.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_router_interfaces"><a class="anchor" href="#_module_export_router_interfaces"></a><a class="link" href="#_module_export_router_interfaces">54. Module - export_router_interfaces</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_router_interfaces</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_router_interfaces.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_security_group"><a class="anchor" href="#_module_export_security_group"></a><a class="link" href="#_module_export_security_group">55. Module - export_security_group</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_security_group</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_security_group.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_security_group_rules"><a class="anchor" href="#_module_export_security_group_rules"></a><a class="link" href="#_module_export_security_group_rules">56. Module - export_security_group_rules</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_security_group_rules</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_security_group_rules.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_subnet"><a class="anchor" href="#_module_export_subnet"></a><a class="link" href="#_module_export_subnet">57. Module - export_subnet</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_subnet</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_subnet.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_user"><a class="anchor" href="#_module_export_user"></a><a class="link" href="#_module_export_user">58. Module - export_user</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_user</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_user.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_user_project_role_assignment"><a class="anchor" href="#_module_export_user_project_role_assignment"></a><a class="link" href="#_module_export_user_project_role_assignment">59. Module - export_user_project_role_assignment</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_user_project_role_assignment</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_user_project_role_assignment.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_export_workload"><a class="anchor" href="#_module_export_workload"></a><a class="link" href="#_module_export_workload">60. Module - export_workload</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>export_workload</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/export_workload.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_flavor"><a class="anchor" href="#_module_import_flavor"></a><a class="link" href="#_module_import_flavor">61. Module - import_flavor</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_flavor</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_flavor.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_image"><a class="anchor" href="#_module_import_image"></a><a class="link" href="#_module_import_image">62. Module - import_image</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_image</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_image.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_keypair"><a class="anchor" href="#_module_import_keypair"></a><a class="link" href="#_module_import_keypair">63. Module - import_keypair</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_keypair</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_keypair.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_network"><a class="anchor" href="#_module_import_network"></a><a class="link" href="#_module_import_network">64. Module - import_network</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_network</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_network.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_project"><a class="anchor" href="#_module_import_project"></a><a class="link" href="#_module_import_project">65. Module - import_project</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_project</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_project.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_router"><a class="anchor" href="#_module_import_router"></a><a class="link" href="#_module_import_router">66. Module - import_router</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_router</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_router.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_router_interface"><a class="anchor" href="#_module_import_router_interface"></a><a class="link" href="#_module_import_router_interface">67. Module - import_router_interface</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_router_interface</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_router_interface.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_security_group"><a class="anchor" href="#_module_import_security_group"></a><a class="link" href="#_module_import_security_group">68. Module - import_security_group</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_security_group</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_security_group.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_security_group_rule"><a class="anchor" href="#_module_import_security_group_rule"></a><a class="link" href="#_module_import_security_group_rule">69. Module - import_security_group_rule</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_security_group_rule</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_security_group_rule.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_subnet"><a class="anchor" href="#_module_import_subnet"></a><a class="link" href="#_module_import_subnet">70. Module - import_subnet</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_subnet</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_subnet.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_user"><a class="anchor" href="#_module_import_user"></a><a class="link" href="#_module_import_user">71. Module - import_user</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_user</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_user.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_user_project_role_assignment"><a class="anchor" href="#_module_import_user_project_role_assignment"></a><a class="link" href="#_module_import_user_project_role_assignment">72. Module - import_user_project_role_assignment</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_user_project_role_assignment</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_user_project_role_assignment.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_volumes_export"><a class="anchor" href="#_module_import_volumes_export"></a><a class="link" href="#_module_import_volumes_export">73. Module - import_volumes_export</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_volumes_export</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_volumes_export.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_volumes_src_cleanup"><a class="anchor" href="#_module_import_volumes_src_cleanup"></a><a class="link" href="#_module_import_volumes_src_cleanup">74. Module - import_volumes_src_cleanup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_volumes_src_cleanup</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_volumes_src_cleanup.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_volumes_transfer"><a class="anchor" href="#_module_import_volumes_transfer"></a><a class="link" href="#_module_import_volumes_transfer">75. Module - import_volumes_transfer</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_volumes_transfer</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_volumes_transfer.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_workload_create_instance"><a class="anchor" href="#_module_import_workload_create_instance"></a><a class="link" href="#_module_import_workload_create_instance">76. Module - import_workload_create_instance</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_workload_create_instance</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_workload_create_instance.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_workload_dst_check"><a class="anchor" href="#_module_import_workload_dst_check"></a><a class="link" href="#_module_import_workload_dst_check">77. Module - import_workload_dst_check</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_workload_dst_check</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_workload_dst_check.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_workload_dst_failure_cleanup"><a class="anchor" href="#_module_import_workload_dst_failure_cleanup"></a><a class="link" href="#_module_import_workload_dst_failure_cleanup">78. Module - import_workload_dst_failure_cleanup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_workload_dst_failure_cleanup</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_workload_dst_failure_cleanup.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_workload_export_volumes"><a class="anchor" href="#_module_import_workload_export_volumes"></a><a class="link" href="#_module_import_workload_export_volumes">79. Module - import_workload_export_volumes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_workload_export_volumes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_workload_export_volumes.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_workload_prelim"><a class="anchor" href="#_module_import_workload_prelim"></a><a class="link" href="#_module_import_workload_prelim">80. Module - import_workload_prelim</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_workload_prelim</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_workload_prelim.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_workload_src_check"><a class="anchor" href="#_module_import_workload_src_check"></a><a class="link" href="#_module_import_workload_src_check">81. Module - import_workload_src_check</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_workload_src_check</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_workload_src_check.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_workload_src_cleanup"><a class="anchor" href="#_module_import_workload_src_cleanup"></a><a class="link" href="#_module_import_workload_src_cleanup">82. Module - import_workload_src_cleanup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_workload_src_cleanup</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_workload_src_cleanup.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_import_workload_transfer_volumes"><a class="anchor" href="#_module_import_workload_transfer_volumes"></a><a class="link" href="#_module_import_workload_transfer_volumes">83. Module - import_workload_transfer_volumes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import_workload_transfer_volumes</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/import_workload_transfer_volumes.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_os_conversion_host_info"><a class="anchor" href="#_module_os_conversion_host_info"></a><a class="link" href="#_module_os_conversion_host_info">84. Module - os_conversion_host_info</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>os_conversion_host_info</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/os_conversion_host_info.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_os_keypairs_info"><a class="anchor" href="#_module_os_keypairs_info"></a><a class="link" href="#_module_os_keypairs_info">85. Module - os_keypairs_info</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>os_keypairs_info</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/os_keypairs_info.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_os_role_assignments_info"><a class="anchor" href="#_module_os_role_assignments_info"></a><a class="link" href="#_module_os_role_assignments_info">86. Module - os_role_assignments_info</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>os_role_assignments_info</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/os_role_assignments_info.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_os_routers_info"><a class="anchor" href="#_module_os_routers_info"></a><a class="link" href="#_module_os_routers_info">87. Module - os_routers_info</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>os_routers_info</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/os_routers_info.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_os_security_groups_info"><a class="anchor" href="#_module_os_security_groups_info"></a><a class="link" href="#_module_os_security_groups_info">88. Module - os_security_groups_info</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>os_security_groups_info</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/os_security_groups_info.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_read_resources"><a class="anchor" href="#_module_read_resources"></a><a class="link" href="#_module_read_resources">89. Module - read_resources</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>read_resources</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/read_resources.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_module_validate_resource_files"><a class="anchor" href="#_module_validate_resource_files"></a><a class="link" href="#_module_validate_resource_files">90. Module - validate_resource_files</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This module provides for the following ansible plugin:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>validate_resource_files</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>:module: os_migrate/plugins/modules/validate_resource_files.py
:documentation: true
:examples: true</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_os_migrate_developer_documentation"><a class="anchor" href="#_os_migrate_developer_documentation"></a><a class="link" href="#_os_migrate_developer_documentation">91. OS Migrate Developer Documentation</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_os_migrate_design"><a class="anchor" href="#_os_migrate_design"></a><a class="link" href="#_os_migrate_design">92. OS Migrate Design</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_high_level_development_goals"><a class="anchor" href="#_high_level_development_goals"></a><a class="link" href="#_high_level_development_goals">92.1. High-level development goals</a></h3>
<div class="ulist">
<ul>
<li>
<p>I/O-based. Fetch metadata and/or content from source cloud &#8594; write
them as outputs &#8594; read them as inputs &#8594; push it to the destination
cloud. This allows other tools to enter the phase between the "write
output" and "read input".</p>
<div class="ulist">
<ul>
<li>
<p>E.g. arbitrary/custom yaml-parsing tools can be used as a smart
filter to analyze the exported contents from source cloud and
choose what (not) to import into the destination cloud.</p>
</li>
<li>
<p>Sometimes (e.g. in workload migration) only metadata may be
written out and editable on the migrator machine, and the actual
binary data is transferred in a direct path between the clouds
for performance reasons.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logging. When contributing code, don&#8217;t forget about logging and how
will information be presented to the user. Try to think about what
can potentially fail and what kind of log output might help figuring
out what went wrong, and on the contrary, what kind of log output
would add clutter without much information value.</p>
</li>
<li>
<p>Testing. Unit-test semantics of small parts wherever possible.
Emphasize automated functional tests (end-to-end, talking to a real
OpenStack backend). Functional tests are closest to the real use
cases and provide at least basic level of comfort that the software
does what it should.</p>
<div class="ulist">
<ul>
<li>
<p>Avoid excessive mocking in unit tests. Focus on writing unit
tests for self-contained (pure) functions/methods, and structure
the code so that as much as possible is written as pure
functions/methods. When this is not possible, consider writing
functional/end-to-end tests instead of unit tests.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Always talking to OpenStack via API. The tool must be able to be
deployed externally to both source and destination clouds. No looking
at DBs or other hacks. If we hit a hurdle due to no-hacks approach,
it could mean that OpenStack&#8217;s capabilities for tenant-to-tenant
content migration are lacking, and an RFE for OpenStack might be
required.</p>
</li>
<li>
<p>Idempotency where possible. When a command fails, it should be
possible to retry with the same command.</p>
</li>
<li>
<p>Whenever simplicity / understandability / clarity gets into conflict
with convenience / ease-of-use, we prefer simplicity /
understandability / clarity.</p>
<div class="ulist">
<ul>
<li>
<p>Prefer running several CLI commands to do something where each
command is simple and human can enter the process by amending
inputs/outputs e.g. with additional tools or a text editor,
rather than one magical command which aims to satisfy all use
cases and eventually turns out to satisfy very few, and tends to
fail in mysterious ways with partial completion and limited
re-runnability.</p>
</li>
</ul>
</div>
</li>
<li>
<p>OS Migrate is intended to be a building block for tenant migrations
rather than a push-button solution. The assumption is that to cover
needs of a particular tenant migration, a knowledgeable human is
running OS Migrate manually and/or has tweaked it to their needs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_challenges_of_the_problem_domain"><a class="anchor" href="#_challenges_of_the_problem_domain"></a><a class="link" href="#_challenges_of_the_problem_domain">92.2. Challenges of the problem domain</a></h3>
<div class="ulist">
<ul>
<li>
<p>Generally, admins can view resources of all projects, but cannot
create resources in those projects (unless they have a role in the
project). To create a resource under a project, either credentials of
the target non-admin user have to be used for importing, or the admin
user has to be added into the project for the duration of the import.</p>
<div class="ulist">
<ul>
<li>
<p>This is not true for <strong>some</strong> resources. As of January 2020,
e.g. networking resources can be created under arbitrary
domain/project by admin using Networking API v2, but it&#8217;s not the
case for e.g. volumes, servers, keypairs. At least initially, we
will assume the general scenario that we&#8217;re running the migration
as the tenant who owns the resources on both src/dst sides.</p>
</li>
</ul>
</div>
</li>
<li>
<p>OpenStack doesn&#8217;t have strict requirements on resource naming
(doesn&#8217;t require non-empty, unique names). The migration tool will
enforce names which are non-empty, and unique per resource type. This
is to allow idempotent imports, which is necessary for retrying
imports on failure. The tool should allow to export/serialize
resources that are not properly named, but the exported data should
fail validation and be refused when fed into the import command.</p>
<div class="ulist">
<ul>
<li>
<p>In the future, if we implement running all migrations as admin
(might need OpenStack RFEs) instead of the tenant, we&#8217;d perhaps
require uniqueness per resource type per tenant, rather than just
per resource type.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_basic_ansible_workflow_design"><a class="anchor" href="#_basic_ansible_workflow_design"></a><a class="link" href="#_basic_ansible_workflow_design">92.3. Basic Ansible workflow design</a></h3>
<div class="ulist">
<ul>
<li>
<p>The challenge and a goal here is to give meaningful Ansible log
output for debugging. This means, for example, that we shouldn&#8217;t have
a single Ansible task (one module call) to export/import the whole
tenant, and we should also consider not having a single task to
export/import all resources of some type. Ideally, each resource
export/import would have its own module call (own task in Ansible
playbook), so if the export or import fails, we can easily tell which
resource was the one that caused a failure.</p>
<div class="ulist">
<ul>
<li>
<p>We have a YAML file per resource type. Export modules are able to
add a resource (idempotently) to an existing YAML file without
affecting the rest. There is reusable code for this idempotence.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example workflow: export networks. Provided playbook.</p>
<div class="ulist">
<ul>
<li>
<p>Ansible task, provided: fetch metadata (at least name and ID, but
perhaps the more the better for advanced filtering) of all
networks that are visible for the tenant, register a list
variable.</p>
</li>
<li>
<p>Ansible task(s) optionally added by user into our playbook on
per-environment basis: filter the metadata according to custom
needs, re-register the list var.</p>
<div class="ulist">
<ul>
<li>
<p>Eventually we may want to provide some hooks here, but
initially we&#8217;d be fine with users simply editing the provided
playbook.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Ansible task, provided: filter networks by names, either via exact
matches or via regexes.</p>
</li>
<li>
<p>Anisble task, provided, calling our custom module: Iterate
(<code>loop</code>) over the list of metadata, and call our module which
will fetch the data and write a YAML with our defined format for
Network resources. If necessary, do any data mangling here to
satisfy the format requirements.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example workflow: transform networks.</p>
<div class="ulist">
<ul>
<li>
<p>Initially we will not provide any tooling here, but at this point
the user should have a YAML file (or a bunch of them) with the
serialized resources. They can use any automation (Ansible, yq,
sed, ) to go through them and edit as they please before
importing.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Example workflow: import networks. Provided playbook.</p>
<div class="ulist">
<ul>
<li>
<p>Ansible task, provided: read the serialized YAML networks into
memory, register a list variable.</p>
</li>
<li>
<p>Anisble task, provided: Iterate (<code>loop</code>) over the list of
networks, and call an Ansible module to create each network. We&#8217;ll
want to create our own module here to deal with our file format
specifics, but underneath we may be calling the community
OpenStack Ansible module if that proves helpful.</p>
</li>
</ul>
</div>
</li>
<li>
<p>We may want to consider using <code>tags</code> on our tasks to allow some
sub-executions. However, it may be that chunking up the code and
using <code>import_playbook</code> might be more clear and safe to use than
<code>tags</code> in many cases. If we do happen to add <code>tags</code>, they
shouldn&#8217;t be added wildly, use cases should be thought through and
documented for both users and developers. Tags need clarity and
disciplined use in order to be helpful.</p>
<div class="ulist">
<ul>
<li>
<p>The above talks about tags in end-user code. We do use tags in
our test suites, and it&#8217;s much less sensitive there as we can
change those tags any time without breaking user expectations.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_misc"><a class="anchor" href="#_misc"></a><a class="link" href="#_misc">92.4. Misc</a></h3>
<div class="ulist">
<ul>
<li>
<p>Naming conventions - <a href="https://github.com/ansible/galaxy/issues/1128#issuecomment-454519526">underscores rather than hyphens in Ansible</a>.</p>
<div class="ulist">
<ul>
<li>
<p>Github does not support underscores in organization URLs though.
So we have repo named os-migrate/os-migrate, and inside we have
os_migrate Ansible collection.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Distribution - the preference is to distribute os-migrate via Ansible
Galaxy.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_development_environment_setup"><a class="anchor" href="#_development_environment_setup"></a><a class="link" href="#_development_environment_setup">93. Development Environment Setup</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prerequisites_5"><a class="anchor" href="#_prerequisites_5"></a><a class="link" href="#_prerequisites_5">93.1. Prerequisites</a></h3>
<div class="ulist">
<ul>
<li>
<p>Local clone of the os-migrate git repo from
<a href="https://github.com/os-migrate/os-migrate" class="bare">https://github.com/os-migrate/os-migrate</a></p>
</li>
<li>
<p><a href="https://podman.io/">Podman</a> and <a href="https://buildah.io/">Buildah</a>
for running rootless development environment containers.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_running_e2e_tests"><a class="anchor" href="#_running_e2e_tests"></a><a class="link" href="#_running_e2e_tests">93.2. Running e2e tests</a></h3>
<div class="paragraph">
<p>OS Migrate also has a suite of end to end, e2e, tests which tests a migration from one existing openstack deployment
to another existing openstack deployment.</p>
</div>
<div class="paragraph">
<p>You can also test with a single existing openstack deployment migrating from one project to another.</p>
</div>
<div class="paragraph">
<p>These docs cover the testing of a single existing openstack deployment migrating from one project to another scenario.</p>
</div>
<div class="paragraph">
<p>The concepts and prerequisites are the same for other deployments.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_for_e2e_test"><a class="anchor" href="#_prerequisites_for_e2e_test"></a><a class="link" href="#_prerequisites_for_e2e_test">93.2.1. Prerequisites for e2e test</a></h4>
<div class="ulist">
<ul>
<li>
<p>Source environment credentials</p>
</li>
<li>
<p>Destination environment credentials</p>
</li>
<li>
<p>Existing images in both source and destination environments</p>
</li>
<li>
<p>Flavors</p>
</li>
<li>
<p>Public network</p>
</li>
<li>
<p>Space requirements</p>
<div class="ulist">
<ul>
<li>
<p>2 images totalling 1.25 GB</p>
</li>
<li>
<p>1 volume totalling 1 GB in source environment</p>
</li>
<li>
<p>2 volumes totalling 6 GB in destination environment</p>
</li>
<li>
<p>2 VMs totalling 35 GB disk usage in each environment</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Below are the steps required to satisfy the above requirements and run e2e tests in a test environment, migrating
resources from one project to another.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_source_environment_and_destination_environment_projects_and_users"><a class="anchor" href="#_create_source_environment_and_destination_environment_projects_and_users"></a><a class="link" href="#_create_source_environment_and_destination_environment_projects_and_users">93.2.2. Create source environment and destination environment projects and users</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Create the src user in the default domain with password 'redhat'</span>
openstack user create <span class="nt">--domain</span> default <span class="nt">--password</span> redhat src

<span class="c"># Create the src project</span>
openstack project create <span class="nt">--domain</span> default src

<span class="c"># Assign src user a 'member' role in the src project</span>
openstack role add <span class="se">\</span>
<span class="nt">--user</span> src <span class="nt">--user-domain</span> default <span class="se">\</span>
<span class="nt">--project</span> src <span class="nt">--project-domain</span> default member

<span class="c"># Confirm role assignment was successful</span>
openstack role assignment list <span class="nt">--project</span> src

<span class="c"># Create the dst user in the default domain with password 'redhat'</span>
openstack user create <span class="nt">--domain</span> default <span class="nt">--password</span> redhat dst

<span class="c"># Create the dst project</span>
openstack project create <span class="nt">--domain</span> default dst

<span class="c"># Assign dst user a 'member' role in the src project</span>
openstack role add <span class="se">\</span>
<span class="nt">--user</span> dst <span class="nt">--user-domain</span> default <span class="se">\</span>
<span class="nt">--project</span> dst <span class="nt">--project-domain</span> default member

<span class="c"># Confirm role assignment was successful</span>
openstack role assignment list <span class="nt">--project</span> dst</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_images"><a class="anchor" href="#_create_images"></a><a class="link" href="#_create_images">93.2.3. Create images</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Download images</span>
wget https://cloud.centos.org/centos/9-stream/x86_64/images/CentOS-Stream-GenericCloud-9-20230704.1.x86_64.qcow2
wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img

<span class="c"># Create images in glance from these downloads</span>
openstack image create <span class="nt">--public</span> <span class="nt">--disk-format</span> qcow2 <span class="nt">--file</span> <span class="se">\</span>
    CentOS-Stream-GenericCloud-9-20230704.1.x86_64.qcow2 CentOS-Stream-GenericCloud-9-20230704.1.x86_64.qcow2
openstack image create <span class="nt">--public</span> <span class="nt">--disk-format</span> raw <span class="nt">--file</span> cirros-0.4.0-x86_64-disk.img cirros-0.4.0-x86_64-disk.img</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_flavors"><a class="anchor" href="#_create_flavors"></a><a class="link" href="#_create_flavors">93.2.4. Create flavors</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">openstack flavor create <span class="nt">--public</span> <span class="se">\</span>
<span class="nt">--ram</span> 256 <span class="nt">--disk</span> 5 <span class="nt">--vcpus</span> 1 <span class="nt">--rxtx-factor</span> 1 m1.xtiny

openstack flavor create <span class="nt">--public</span> <span class="se">\</span>
<span class="nt">--ram</span> 2048 <span class="nt">--disk</span> 30 <span class="nt">--vcpus</span> 2 <span class="nt">--rxtx-factor</span> 1 m1.large</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_public_network"><a class="anchor" href="#_create_public_network"></a><a class="link" href="#_create_public_network">93.2.5. Create public network</a></h4>
<div class="paragraph">
<p>If your OpenStack environment doesn&#8217;t have a public network created
yet, you&#8217;ll need to create one. The parameters below should work if
you&#8217;re deploying your OpenStack environment with Infrared Virsh
plugin. If you deployed using something else, you may need to adjust
the parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">openstack network create <span class="se">\</span>
     <span class="nt">--mtu</span> 1500 <span class="se">\</span>
     <span class="nt">--external</span> <span class="se">\</span>
     <span class="nt">--provider-network-type</span> flat <span class="se">\</span>
     <span class="nt">--provider-physical-network</span> datacentre <span class="se">\</span>
     public

openstack subnet create <span class="se">\</span>
    <span class="nt">--network</span> public <span class="se">\</span>
    <span class="nt">--gateway</span> 10.0.0.1 <span class="se">\</span>
    <span class="nt">--subnet-range</span> 10.0.0.0/24 <span class="se">\</span>
    <span class="nt">--allocation-pool</span> <span class="nv">start</span><span class="o">=</span>10.0.0.150,end<span class="o">=</span>10.0.0.190 <span class="se">\</span>
    public</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sample_e2e_config_yaml_using_the_above_prerequisites"><a class="anchor" href="#_sample_e2e_config_yaml_using_the_above_prerequisites"></a><a class="link" href="#_sample_e2e_config_yaml_using_the_above_prerequisites">93.2.6. Sample e2e config yaml using the above prerequisites</a></h4>
<div class="paragraph">
<p>Also see <a href="https://github.com/os-migrate/os-migrate/blob/main/tests/e2e/tenant/scenario_variables.yml" class="bare">https://github.com/os-migrate/os-migrate/blob/main/tests/e2e/tenant/scenario_variables.yml</a></p>
</div>
<div class="paragraph">
<p>Auth URLs and network names will change based on your environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">os_migrate_src_auth</span><span class="pi">:</span>
  <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://10.0.0.131:5000/v3</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">redhat</span>
  <span class="na">project_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">project_name</span><span class="pi">:</span> <span class="s">src</span>
  <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">src</span>
<span class="na">os_migrate_src_region_name</span><span class="pi">:</span> <span class="s">regionOne</span>
<span class="na">os_migrate_dst_auth</span><span class="pi">:</span>
  <span class="na">auth_url</span><span class="pi">:</span> <span class="s">http://10.0.0.131:5000/v3</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">redhat</span>
  <span class="na">project_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">project_name</span><span class="pi">:</span> <span class="s">dst</span>
  <span class="na">user_domain_name</span><span class="pi">:</span> <span class="s">Default</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">dst</span>
<span class="na">os_migrate_dst_region_name</span><span class="pi">:</span> <span class="s">regionOne</span>

<span class="na">os_migrate_data_dir</span><span class="pi">:</span> <span class="s">/root/os_migrate/local/migrate-data</span>

<span class="na">os_migrate_conversion_host_ssh_user</span><span class="pi">:</span> <span class="s">cloud-user</span>
<span class="na">os_migrate_src_conversion_external_network_name</span><span class="pi">:</span> <span class="s">nova</span>
<span class="na">os_migrate_dst_conversion_external_network_name</span><span class="pi">:</span> <span class="s">nova</span>
<span class="na">os_migrate_conversion_flavor_name</span><span class="pi">:</span> <span class="s">m1.large</span>
<span class="na">os_migrate_conversion_image_name</span><span class="pi">:</span> <span class="s">CentOS-Stream-GenericCloud-8-20220913.0.x86_64.qcow2</span>

<span class="na">os_migrate_src_osm_server_flavor</span><span class="pi">:</span> <span class="s">m1.xtiny</span>
<span class="na">os_migrate_src_osm_server_image</span><span class="pi">:</span> <span class="s">cirros-0.4.0-x86_64-disk.img</span>
<span class="na">os_migrate_src_osm_router_external_network</span><span class="pi">:</span> <span class="s">nova</span>

<span class="na">os_migrate_src_validate_certs</span><span class="pi">:</span> <span class="s">False</span>
<span class="na">os_migrate_dst_validate_certs</span><span class="pi">:</span> <span class="s">False</span>

<span class="na">os_migrate_src_release</span><span class="pi">:</span> <span class="m">16</span>
<span class="na">os_migrate_dst_release</span><span class="pi">:</span> <span class="m">16</span>

<span class="na">os_migrate_src_conversion_net_mtu</span><span class="pi">:</span> <span class="m">1400</span>
<span class="na">os_migrate_dst_conversion_net_mtu</span><span class="pi">:</span> <span class="s">1400</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_e2e_test_using_the_os_migrate_toolbox_and_the_above_config"><a class="anchor" href="#_run_e2e_test_using_the_os_migrate_toolbox_and_the_above_config"></a><a class="link" href="#_run_e2e_test_using_the_os_migrate_toolbox_and_the_above_config">93.2.7. Run e2e test using the OS Migrate toolbox and the above config</a></h4>
<div class="paragraph">
<p>Copy the above config to file <code>custom-config.yaml</code> in the <code>local</code> directory of your local <code>os-migrate</code> source.</p>
</div>
<div class="paragraph">
<p>Run the full test suite using the above config.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nv">OS_MIGRATE_E2E_TEST_ARGS</span><span class="o">=</span><span class="s1">'-e @/root/os_migrate/local/custom-config.yaml'</span> ./toolbox/run make test-e2e-tenant</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expected_output_from_successful_e2e_test_run"><a class="anchor" href="#_expected_output_from_successful_e2e_test_run"></a><a class="link" href="#_expected_output_from_successful_e2e_test_run">93.2.8. Expected output from successful e2e test run</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">PLAY RECAP <span class="k">********************************************************************************************************</span>
localhost                  : <span class="nv">ok</span><span class="o">=</span>318  <span class="nv">changed</span><span class="o">=</span>110  <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0    <span class="nv">skipped</span><span class="o">=</span>27   <span class="nv">rescued</span><span class="o">=</span>0    <span class="nv">ignored</span><span class="o">=</span>0
os_migrate_conv_dst        : <span class="nv">ok</span><span class="o">=</span>12   <span class="nv">changed</span><span class="o">=</span>5    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0    <span class="nv">skipped</span><span class="o">=</span>3    <span class="nv">rescued</span><span class="o">=</span>0    <span class="nv">ignored</span><span class="o">=</span>0
os_migrate_conv_src        : <span class="nv">ok</span><span class="o">=</span>12   <span class="nv">changed</span><span class="o">=</span>5    <span class="nv">unreachable</span><span class="o">=</span>0    <span class="nv">failed</span><span class="o">=</span>0    <span class="nv">skipped</span><span class="o">=</span>3    <span class="nv">rescued</span><span class="o">=</span>0    <span class="nv">ignored</span><span class="o">=</span>0

Wednesday 21 July 2021  09:59:17 +0000 <span class="o">(</span>0:00:03.419<span class="o">)</span>       0:29:17.016 <span class="k">********</span>
<span class="o">===============================================================================</span>
os_migrate.os_migrate.conversion_host_content : update all packages <span class="nt">---------------------------------------</span> 435.56s
os_migrate.os_migrate.import_workloads : transfer volumes to destination <span class="nt">----------------------------------</span> 101.72s
os_migrate.os_migrate.import_workloads : expose <span class="nb">source </span>volumes <span class="nt">---------------------------------------------</span> 66.67s
os_migrate.os_migrate.conversion_host_content : <span class="nb">install </span>content <span class="nt">--------------------------------------------</span> 62.35s
os_migrate.os_migrate.import_workloads : transfer volumes to destination <span class="nt">-----------------------------------</span> 58.75s
os_migrate.os_migrate.import_workloads : clean up <span class="k">in </span>the <span class="nb">source </span>cloud after migration <span class="nt">----------------------</span> 27.40s
os_migrate.os_migrate.import_workloads : expose <span class="nb">source </span>volumes <span class="nt">---------------------------------------------</span> 27.30s
Create osm_server <span class="nt">------------------------------------------------------------------------------------------</span> 24.71s
create osm_image <span class="nt">-------------------------------------------------------------------------------------------</span> 23.86s
os_migrate.os_migrate.export_images : <span class="nb">export </span>image blobs <span class="nt">---------------------------------------------------</span> 23.80s
os_migrate.os_migrate.import_images : import images <span class="nt">--------------------------------------------------------</span> 23.69s
os_migrate.os_migrate.import_workloads : create destination instance <span class="nt">---------------------------------------</span> 23.30s
os_migrate.os_migrate.import_workloads : create destination instance <span class="nt">---------------------------------------</span> 21.93s
Create osm_server <span class="nt">------------------------------------------------------------------------------------------</span> 21.61s
os_migrate.os_migrate.import_workloads : clean up <span class="k">in </span>the <span class="nb">source </span>cloud after migration <span class="nt">----------------------</span> 21.16s
os_migrate.os_migrate.conversion_host : create os_migrate conversion host <span class="nt">----------------------------------</span> 20.03s
Remove osm_server <span class="nt">------------------------------------------------------------------------------------------</span> 19.01s
os_migrate.os_migrate.conversion_host : create os_migrate conversion host <span class="nt">----------------------------------</span> 18.23s
Shutdown osm_server <span class="nt">----------------------------------------------------------------------------------------</span> 18.14s
Shutdown osm_server <span class="nt">----------------------------------------------------------------------------------------</span> 17.88s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_optional_tags_to_pass_to_e2e_tests"><a class="anchor" href="#_optional_tags_to_pass_to_e2e_tests"></a><a class="link" href="#_optional_tags_to_pass_to_e2e_tests">93.2.9. Optional tags to pass to e2e tests</a></h4>
<div class="paragraph">
<p>There are a set of tags that can be used to filter which tasks to run during test.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>test_clean_before</p>
</li>
<li>
<p>test_workload</p>
</li>
<li>
<p>test_image_workload_boot_copy</p>
</li>
<li>
<p>test_image_workload_boot_nocopy</p>
</li>
<li>
<p>test_image_workload_boot_copy_clean</p>
</li>
<li>
<p>test_clean_before</p>
</li>
<li>
<p>test_pre_workload</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_optional_playbook_variable"><a class="anchor" href="#_optional_playbook_variable"></a><a class="link" href="#_optional_playbook_variable">93.2.10. Optional playbook variable</a></h4>
<div class="paragraph">
<p>There is also an optional variable <code>test_clean_conversion_hosts_after</code> which can be set to <code>false</code> if you do not wish
to clean up conversion hosts after test is complete.</p>
</div>
</div>
<div class="sect3">
<h4 id="_environment_variables"><a class="anchor" href="#_environment_variables"></a><a class="link" href="#_environment_variables">93.2.11. Environment variables</a></h4>
<div class="paragraph">
<p>The following environment variables can be used when running e2e tests.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OS_MIGRATE_E2E_TEST_ARGS</code>: All of the above tags and playbook variables can be set using the
<code>OS_MIGRATE_E2E_TEST_ARGS</code> environment variable. This variable is also used to pass in the playbook custom config
file. eg:</p>
<div class="literalblock">
<div class="content">
<pre>`OS_MIGRATE_E2E_TEST_ARGS='-e @/root/os_migrate/local/custom-config.yaml \
--tags test_clean_before,test_workload --skip-tags test_clean_after -e test_clean_conversion_hosts_after=false'`</pre>
</div>
</div>
</li>
<li>
<p><code>ROOT_DIR</code>: Absolute directory path to OS Migrate source. When not set the default when run using OS Migrate developer
toolbox this is set to <code>/root/os_migrate</code>.</p>
</li>
<li>
<p><code>OS_MIGRATE</code>: Absolute directory path to the OS Migrate ansible collection. When not set the default when run using
os-migrate developer toolbox this is set to <code>/root/.ansible/collections/ansible_collections/os_migrate/os_migrate</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_general_contribution_guidelines"><a class="anchor" href="#_general_contribution_guidelines"></a><a class="link" href="#_general_contribution_guidelines">94. General Contribution Guidelines</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_commit_messages_for_changelog"><a class="anchor" href="#_commit_messages_for_changelog"></a><a class="link" href="#_commit_messages_for_changelog">94.1. Commit Messages for Changelog</a></h3>
<div class="paragraph">
<p>OS Migrate uses commit messages for automated generation of project
changelog. For every pull request we request contributors to be
compliant with the following commit message notation.</p>
</div>
<div class="sect3">
<h4 id="_format"><a class="anchor" href="#_format"></a><a class="link" href="#_format">94.1.1. Format</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">&lt;type&gt;</span>: &lt;summary&gt;
<span class="go">
</span><span class="gp">&lt;body&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Accepted <code>&lt;type&gt;</code> values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>new</code> - newly implemented user-facing features</p>
</li>
<li>
<p><code>chg</code> - changes in existing user-facing features</p>
</li>
<li>
<p><code>fix</code> - user-facing bugfixes</p>
</li>
<li>
<p><code>oth</code> - other changes which users should know about</p>
</li>
<li>
<p><code>dev</code> - any developer-facing changes, regardless of
new/chg/fix status</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_keeping_changelog_clean"><a class="anchor" href="#_keeping_changelog_clean"></a><a class="link" href="#_keeping_changelog_clean">94.1.2. Keeping Changelog Clean</a></h4>
<div class="paragraph">
<p>If the commit message subject starts with <code>dev:</code>, it will be omitted
when rendering the changelog.</p>
</div>
<div class="paragraph">
<p>Using this convention is important to keep the changelog document
concise and focused on user-facing changes. Any developer-facing
changes (developer environment, CI, developer-only docs) or miniature
"cosmetic" edits should be tagged as <code>dev</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_summary_first_line"><a class="anchor" href="#_summary_first_line"></a><a class="link" href="#_summary_first_line">94.1.3. Summary (First Line)</a></h4>
<div class="paragraph">
<p>The first line should not be longer than 75 characters, the second
line is always blank and other lines should be wrapped at 80
characters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_message_body"><a class="anchor" href="#_message_body"></a><a class="link" href="#_message_body">94.1.4. Message Body</a></h4>
<div class="paragraph">
<p>Uses the imperative, present tense: "change" not "changed" nor
"changes" and includes motivation for the change and contrasts with
previous behavior. Think how the commit message will appear in the
project changelog.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_code"><a class="anchor" href="#_contributing_code"></a><a class="link" href="#_contributing_code">95. Contributing Code</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As an open source project, OS Migrate welcomes contributions from the
community at large. The following guide provides information on how to
add a new role to the project and where additional testing or
documentation artifacts should be added. This isn&#8217;t an exhaustive
reference and is a living document subject to change as needed when
the project formalizes any practice or pattern.</p>
</div>
<div class="sect2">
<h3 id="_adding_a_new_role"><a class="anchor" href="#_adding_a_new_role"></a><a class="link" href="#_adding_a_new_role">95.1. Adding a New Role</a></h3>
<div class="paragraph">
<p>The most common contribution to OS Migrate is adding a new role to
support the export or import of resources. The construction of the roles
will likely follow a similar pattern. Each role also has specific unit
and functional test requirements. The most common pattern for adding a
new role will follow these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a resource class to <code>os_migrate/plugins/module_utils</code> that
inherits from
<code>ansible_collections.os_migrate.os_migrate.plugins.module_utils.resource.Resource</code></p>
</li>
<li>
<p>Add a unit test to <code>os_migrate/tests/unit</code> to test serializing and
de-serializing data, and any other functionality your class may have.</p>
</li>
<li>
<p>Create a new module in <code>os_migrate/plugins/modules</code> to facilitate
the import or export of the resource.</p>
</li>
<li>
<p>Add a new playbook to <code>os_migrate/playbooks</code>.</p>
</li>
<li>
<p>Add a new role to <code>os_migrate/roles</code>.</p>
</li>
<li>
<p>Add functional tests to <code>tests/func</code> that test primary use,
idempotency, and updates as a minimum. Additional tests as necessary.</p>
</li>
<li>
<p>Add documentation within classes and roles/playbooks as required.
Update developer or user documentation as needed.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_creating_the_role_skeleton_automatically"><a class="anchor" href="#_creating_the_role_skeleton_automatically"></a><a class="link" href="#_creating_the_role_skeleton_automatically">95.1.1. Creating the role skeleton automatically</a></h4>
<div class="paragraph">
<p>Adding roles into os-migrate can be easily achieved by
creating the role structure skeleton automatically.</p>
</div>
<div class="paragraph">
<p>From the repository root directory execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-playbook <span class="se">\</span>
   <span class="nt">-i</span> <span class="s1">'localhost,'</span> <span class="se">\</span>
   ./scripts/role-addition.yml <span class="se">\</span>
   <span class="nt">-e</span> <span class="nv">ansible_connection</span><span class="o">=</span><span class="nb">local</span> <span class="se">\</span>
   <span class="nt">-e</span> <span class="nv">role_name</span><span class="o">=</span>import_example_resource</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate the role, the default variables file,
and the documentation stub.</p>
</div>
</div>
<div class="sect3">
<h4 id="_resources"><a class="anchor" href="#_resources"></a><a class="link" href="#_resources">95.1.2. Resources</a></h4>
<div class="paragraph">
<p>Resources are the primary data structures that are exported from and
imported to clouds. In
<code>os_migrate/plugins/module_utils/resource.py</code>, there is a
<code>Resource</code> class provided for your new resource to inherit from. It
provides a way to quickly build an organized class that uses
openstacksdk to retrieve, create and update data within a connected
OpenStack tenant. See how other classes in the <code>module_utils</code>
directory inherit from <code>Resource</code> for inspiration.</p>
</div>
<div class="paragraph">
<p>Two very important properties are the 'params' and '_info', as these are
the primary data fields that will be exported and imported. At a
minimum, the name property of any resource should be in params_from_sdk,
and most likely addresses should be there too. The difference between
info and params is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A property that would be an '_info' type is something that we don&#8217;t
want or cannot "make the same" in the destination cloud. For example,
typically UUIDs can&#8217;t be the same between two tenants so an 'id'
property should remain in info.</p>
</li>
<li>
<p>A property that would be in a 'params' type are things that we do
want to copy to the destination cloud. These typically also get
looked at when we&#8217;re making sure the import behavior is idempotent.
I.e. when we re-run import playbooks, things that already got
imported before are not attempted to be imported again.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_export_roles"><a class="anchor" href="#_export_roles"></a><a class="link" href="#_export_roles">95.1.3. Export Roles</a></h4>
<div class="paragraph">
<p>In the <code>defaults/main.yml</code> file, at a minimum you will need to
define the <code>os_migrate_[resource]_filter</code> variable to support
filtering of resources by the name property.</p>
</div>
<div class="paragraph">
<p>In the <code>meta/main.yml</code> file you will likely just need to add the
following default content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="nn">---</span>
<span class="na">galaxy_info</span><span class="pi">:</span>
  <span class="na">author</span><span class="pi">:</span> <span class="s">os-migrate</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">os-migrate resource</span>
  <span class="na">company</span><span class="pi">:</span> <span class="s">Red Hat</span>
  <span class="na">license</span><span class="pi">:</span> <span class="s">Apache-2.0</span>
  <span class="na">min_ansible_version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2.9"</span>
  <span class="na">platforms</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Fedora</span>
      <span class="na">versions</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">34"</span>
  <span class="na">galaxy_tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">osmigrate"</span><span class="pi">]</span>
<span class="na">dependencies</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate.prelude_src</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>tasks/main.yml</code> file, add your Ansible tasks for exporting the
data. A common pattern is retrieving data from an OpenStack tenant via a
<a href="https://docs.ansible.com/ansible/latest/collections/openstack/cloud/index.html">cloud module</a>,
creating a collection of name/id pairs for export, filtering the names
for specific resources, and then calling the module you created for
export.</p>
</div>
</div>
<div class="sect3">
<h4 id="_import_roles"><a class="anchor" href="#_import_roles"></a><a class="link" href="#_import_roles">95.1.4. Import Roles</a></h4>
<div class="paragraph">
<p>In the <code>defaults/main.yml</code> file, at a minimum you will need to
define the same <code>os_migrate_[resource]<em>filter</code> variable as with
export, and <code>import</em>[resource]_validate_file: true</code> variable to set
whether or not the import data file should be validated for this
role. In most cases, it should be set to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>In the <code>meta/main.yml</code> file you will likely just need to add the
following default content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="nn">---</span>
<span class="na">galaxy_info</span><span class="pi">:</span>
  <span class="na">author</span><span class="pi">:</span> <span class="s">os-migrate</span>
  <span class="na">description</span><span class="pi">:</span> <span class="s">os-migrate resource</span>
  <span class="na">company</span><span class="pi">:</span> <span class="s">Red Hat</span>
  <span class="na">license</span><span class="pi">:</span> <span class="s">Apache-2.0</span>
  <span class="na">min_ansible_version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2.9"</span>
  <span class="na">platforms</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Fedora</span>
      <span class="na">versions</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">34"</span>
  <span class="na">galaxy_tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">osmigrate"</span><span class="pi">]</span>
<span class="na">dependencies</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">role</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate.prelude_dst</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>tasks/main.yml</code> file, add your Ansible tasks for importing the
data. A common pattern is validating the data file created by the
associated export role, reading the data file and then calling the
module you created for import.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_tests"><a class="anchor" href="#_writing_tests"></a><a class="link" href="#_writing_tests">95.2. Writing Tests</a></h3>
<div class="paragraph">
<p>For newly implemented resources, ensure comprehensive test coverage by following this checklist:</p>
</div>
<div class="sect3">
<h4 id="_functional_tests"><a class="anchor" href="#_functional_tests"></a><a class="link" href="#_functional_tests">95.2.1. Functional Tests</a></h4>
<div class="ulist">
<ul>
<li>
<p>Ensure both import and export functionalities are tested, not just idempotency.</p>
</li>
<li>
<p>Include tests for admin-only resources, ensuring they are renamed before import.</p>
</li>
<li>
<p>Test resources as a tenant whenever possible to ensure broader coverage.</p>
</li>
<li>
<p>For resources with special properties like <code>links</code> or <code>extra_specs</code>, write detailed tests inspecting these properties closely.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_unit_tests"><a class="anchor" href="#_unit_tests"></a><a class="link" href="#_unit_tests">95.2.2. Unit Tests</a></h4>
<div class="ulist">
<ul>
<li>
<p>Write unit tests for each new module created, focusing on the logic within the module.</p>
</li>
<li>
<p>Ensure that edge cases and error handling paths are covered in unit tests.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_integration_tests"><a class="anchor" href="#_integration_tests"></a><a class="link" href="#_integration_tests">95.2.3. Integration Tests</a></h4>
<div class="ulist">
<ul>
<li>
<p>Add integration tests that cover the entire process of exporting and then importing the resource, verifying the integrity and consistency of the data.</p>
</li>
<li>
<p>Verify that the resource behaves as expected in the context of the os-migrate ecosystem.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_documentation_and_examples"><a class="anchor" href="#_documentation_and_examples"></a><a class="link" href="#_documentation_and_examples">95.2.4. Documentation and Examples</a></h4>
<div class="ulist">
<ul>
<li>
<p>In the <code>DOCUMENTATION</code> constant of each module, include examples of how to use the module in a playbook.</p>
</li>
<li>
<p>Ensure that the <code>README.md</code> file for the new role is comprehensive, covering the role&#8217;s purpose, usage, and any dependencies.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_test_execution_in_ci"><a class="anchor" href="#_test_execution_in_ci"></a><a class="link" href="#_test_execution_in_ci">95.2.5. Test Execution in CI</a></h4>
<div class="ulist">
<ul>
<li>
<p>Confirm that all tests are executed in the Continuous Integration (CI) environment before merging.</p>
</li>
<li>
<p>If a feature is merged without proper tests due to specific circumstances, create a technical debt tracking card to follow up.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_review_and_inspection"><a class="anchor" href="#_review_and_inspection"></a><a class="link" href="#_review_and_inspection">95.2.6. Review and Inspection</a></h4>
<div class="ulist">
<ul>
<li>
<p>Conduct thorough reviews, especially when introducing new resources, to catch potential issues early.</p>
</li>
<li>
<p>Implement policies or checklists in development documentation to ensure test soundness and coverage.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_location_of_tests"><a class="anchor" href="#_location_of_tests"></a><a class="link" href="#_location_of_tests">95.2.7. Location of Tests</a></h4>
<div class="ulist">
<ul>
<li>
<p>Place functional and integration tests in the <code>tests/e2e</code> or <code>tests/func</code> directory respectively, following the existing structure for similar resources.</p>
</li>
<li>
<p>Unit tests should reside alongside the modules they are testing, in the <code>os_migrate/tests/</code> directory.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_special_considerations_2"><a class="anchor" href="#_special_considerations_2"></a><a class="link" href="#_special_considerations_2">95.2.8. Special Considerations</a></h4>
<div class="ulist">
<ul>
<li>
<p>For resources that are only accessible by admin users, ensure tests reflect this by running them with appropriate permissions.</p>
</li>
<li>
<p>Address any known issues from previous retrospectives, such as fixing the handling of Nova keypairs or ensuring resources are tested in tenant context.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_necessary_documentation"><a class="anchor" href="#_necessary_documentation"></a><a class="link" href="#_necessary_documentation">95.2.9. Necessary Documentation</a></h4>
<div class="paragraph">
<p>If this is your first time adding a pull request to the os-migrate
repository, add your author information to <code>galaxy.yml</code>.</p>
</div>
<div class="paragraph">
<p>In each Ansible module in <code>os_migrate/plugins/modules</code>, there is a
<code>DOCUMENTATION</code> constant where you must provide standard
documentation on what the module does and an example of how you would
use it in a playbook.</p>
</div>
<div class="paragraph">
<p>Each new role must have a <code>README.md</code> file as a requirement for
Ansible Galaxy publishing.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_documentation"><a class="anchor" href="#_contributing_documentation"></a><a class="link" href="#_contributing_documentation">96. Contributing Documentation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you notice missing or errorneous documentation, you can either
create an <a href="https://github.com/os-migrate/os-migrate/issues">issue on Github</a>,
or you can create a <a href="https://github.com/os-migrate/os-migrate/pulls">pull request</a>
with the desired documentation changes.</p>
</div>
<div class="paragraph">
<p>Documentation sources in the repository:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The majority of documentation is located under <code>docs/src</code> folder.</p>
</li>
<li>
<p>Individual roles have a readme file under
<code>os_migrate/roles/&lt;ROLE&gt;/README.md</code> (Ansible Galaxy requirement).</p>
</li>
<li>
<p>Modules are documented directly in their Python file
<code>os_migrate/plugins/modules/&lt;MODULE&gt;.py</code> (Ansible convention).</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_rendering_the_documentation"><a class="anchor" href="#_rendering_the_documentation"></a><a class="link" href="#_rendering_the_documentation">96.1. Rendering the Documentation</a></h3>
<div class="paragraph">
<p>After you make your change and before you submit a pull request, it&#8217;s
good to verify that the changes you made are getting rendered into
HTML correctly.</p>
</div>
<div class="paragraph">
<p>If you haven&#8217;t yet built a toolbox container for OS Migrate
development, do so now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>make toolbox-build</pre>
</div>
</div>
<div class="paragraph">
<p>To build the documentation, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./toolbox/run make docs</pre>
</div>
</div>
<div class="paragraph">
<p>You can inspect the rendered documentation by opening
<code>docs/src/_build/html/index.html</code> in your web browser.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_execution_environment_aee_images"><a class="anchor" href="#_ansible_execution_environment_aee_images"></a><a class="link" href="#_ansible_execution_environment_aee_images">97. Ansible Execution Environment (AEE) Images</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>os-migrate and vmware-migration-kit provide containerized Ansible Execution Environment (AEE) images that encapsulate all necessary dependencies for running migration playbooks in a consistent, isolated environment.</p>
</div>
<div class="sect2">
<h3 id="_overview_2"><a class="anchor" href="#_overview_2"></a><a class="link" href="#_overview_2">97.1. Overview</a></h3>
<div class="paragraph">
<p>Ansible Execution Environments are container images that provide a standardized runtime environment for Ansible automation. They include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ansible Core and Ansible Runner</p>
</li>
<li>
<p>Python runtime and required packages</p>
</li>
<li>
<p>os-migrate and vmware-migration-kit collections</p>
</li>
<li>
<p>All necessary dependencies and tools</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This approach ensures consistent behavior across different environments and simplifies deployment and maintenance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_available_aee_images"><a class="anchor" href="#_available_aee_images"></a><a class="link" href="#_available_aee_images">97.2. Available AEE Images</a></h3>
<div class="sect3">
<h4 id="_os_migrate_aee"><a class="anchor" href="#_os_migrate_aee"></a><a class="link" href="#_os_migrate_aee">97.2.1. os-migrate AEE</a></h4>
<div class="paragraph">
<p>The os-migrate AEE image contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ansible Core</p>
</li>
<li>
<p>os-migrate Ansible collection</p>
</li>
<li>
<p>OpenStack SDK and related Python packages</p>
</li>
<li>
<p>All required dependencies for OpenStack resource migration</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_vmware_migration_kit_aee"><a class="anchor" href="#_vmware_migration_kit_aee"></a><a class="link" href="#_vmware_migration_kit_aee">97.2.2. vmware-migration-kit AEE</a></h4>
<div class="paragraph">
<p>The vmware-migration-kit AEE image contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ansible Core</p>
</li>
<li>
<p>vmware-migration-kit Ansible collection</p>
</li>
<li>
<p>VMware SDK and related Python packages</p>
</li>
<li>
<p>All required dependencies for VMware to OpenStack migration</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_building_aee_images"><a class="anchor" href="#_building_aee_images"></a><a class="link" href="#_building_aee_images">97.3. Building AEE Images</a></h3>
<div class="sect3">
<h4 id="_prerequisites_6"><a class="anchor" href="#_prerequisites_6"></a><a class="link" href="#_prerequisites_6">97.3.1. Prerequisites</a></h4>
<div class="paragraph">
<p>Before building AEE images, ensure you have the following tools installed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ansible-builder</code> - Tool for building execution environments</p>
</li>
<li>
<p><code>podman</code> or <code>docker</code> - Container runtime</p>
</li>
<li>
<p><code>git</code> - Version control system</p>
</li>
<li>
<p><code>python3</code> - Python runtime (version 3.8 or higher)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_setting_up_a_virtual_environment"><a class="anchor" href="#_setting_up_a_virtual_environment"></a><a class="link" href="#_setting_up_a_virtual_environment">Setting Up a Virtual Environment</a></h5>
<div class="paragraph">
<p>It&#8217;s recommended to use a Python virtual environment to isolate dependencies and avoid conflicts with system packages.</p>
</div>
<div class="paragraph">
<p>Create and activate a virtual environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Create virtual environment</span>
python3 <span class="nt">-m</span> venv .venv

<span class="c"># Activate virtual environment (Linux/macOS)</span>
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Activate virtual environment (Windows)</span>
.venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_installing_dependencies"><a class="anchor" href="#_installing_dependencies"></a><a class="link" href="#_installing_dependencies">Installing Dependencies</a></h5>
<div class="paragraph">
<p>Install the required dependencies using the project-specific requirements files:</p>
</div>
<div class="paragraph">
<p><strong>For os-migrate:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Clone the repository</span>
git clone https://github.com/os-migrate/os-migrate.git
<span class="nb">cd </span>os-migrate

<span class="c"># Create and activate virtual environment</span>
python3 <span class="nt">-m</span> venv .venv
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Install build dependencies</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements-build.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For vmware-migration-kit:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Clone the repository</span>
git clone https://github.com/os-migrate/vmware-migration-kit.git
<span class="nb">cd </span>vmware-migration-kit

<span class="c"># Create and activate virtual environment</span>
python3 <span class="nt">-m</span> venv .venv
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Install build dependencies</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements-build.txt</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_requirements_files"><a class="anchor" href="#_requirements_files"></a><a class="link" href="#_requirements_files">Requirements Files</a></h5>
<div class="paragraph">
<p>Both repositories provide <code>requirements-build.txt</code> files that contain all necessary dependencies for building AEE images:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>os-migrate requirements</strong>: <a href="https://github.com/os-migrate/os-migrate/blob/main/requirements-build.txt" class="bare">https://github.com/os-migrate/os-migrate/blob/main/requirements-build.txt</a></p>
</li>
<li>
<p><strong>vmware-migration-kit requirements</strong>: <a href="https://github.com/os-migrate/vmware-migration-kit/blob/main/requirements-build.txt" class="bare">https://github.com/os-migrate/vmware-migration-kit/blob/main/requirements-build.txt</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These files include:
* <code>ansible-builder</code> - Core tool for building execution environments
* <code>ansible-core</code> - Ansible runtime
* <code>ansible-runner</code> - Execution environment runner
* Additional Python packages required for the build process</p>
</div>
</div>
<div class="sect4">
<h5 id="_collection_requirements_in_aee"><a class="anchor" href="#_collection_requirements_in_aee"></a><a class="link" href="#_collection_requirements_in_aee">Collection Requirements in AEE</a></h5>
<div class="paragraph">
<p>The AEE images use <code>requirements.yml</code> files to specify which Ansible collections to install. The collection installation method depends on the build context:</p>
</div>
<div class="paragraph">
<p><strong>For main branch builds (development):</strong></p>
</div>
<div class="paragraph">
<p>Install collections directly from Git repositories using the main branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># requirements.yml for main branch builds</span>
<span class="na">collections</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">https://github.com/os-migrate/os-migrate.git</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">git</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">main</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">https://github.com/os-migrate/vmware-migration-kit.git</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">git</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s">main</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>For stable/tagged builds (production):</strong></p>
</div>
<div class="paragraph">
<p>Install collections from Ansible Galaxy using specific version tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># requirements.yml for stable/tagged builds</span>
<span class="na">collections</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1.0.1"</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">os_migrate.vmware_migration_kit</span>
    <span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2.0.4"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Benefits of this approach:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Main branch builds</strong>: Always get the latest development code with latest features and fixes</p>
</li>
<li>
<p><strong>Stable builds</strong>: Use tested, released versions for production stability</p>
</li>
<li>
<p><strong>Version consistency</strong>: AEE image tags match the collection versions they contain</p>
</li>
<li>
<p><strong>Reproducible builds</strong>: Same collection versions produce identical AEE images</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_alternative_installation_methods"><a class="anchor" href="#_alternative_installation_methods"></a><a class="link" href="#_alternative_installation_methods">Alternative Installation Methods</a></h5>
<div class="paragraph">
<p>If you prefer not to use virtual environments, you can install ansible-builder globally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Install ansible-builder globally</span>
pip <span class="nb">install </span>ansible-builder

<span class="c"># Or install from requirements file</span>
pip <span class="nb">install</span> <span class="nt">-r</span> requirements-build.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: Global installation may cause dependency conflicts with other Python projects on your system.</p>
</div>
</div>
<div class="sect4">
<h5 id="_virtual_environment_management"><a class="anchor" href="#_virtual_environment_management"></a><a class="link" href="#_virtual_environment_management">Virtual Environment Management</a></h5>
<div class="paragraph">
<p>After completing your work, you can deactivate the virtual environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Deactivate virtual environment</span>
deactivate</code></pre>
</div>
</div>
<div class="paragraph">
<p>To reactivate the virtual environment in future sessions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Navigate to the project directory</span>
<span class="nb">cd</span> /path/to/os-migrate  <span class="c"># or vmware-migration-kit</span>

<span class="c"># Activate the virtual environment</span>
<span class="nb">source</span> .venv/bin/activate</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_troubleshooting_virtual_environment_issues"><a class="anchor" href="#_troubleshooting_virtual_environment_issues"></a><a class="link" href="#_troubleshooting_virtual_environment_issues">Troubleshooting Virtual Environment Issues</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Virtual environment not found</strong></dt>
<dd>
<p>Ensure you&#8217;re in the correct directory and the virtual environment was created successfully.</p>
</dd>
<dt class="hdlist1"><strong>Permission denied</strong></dt>
<dd>
<p>On some systems, you may need to use <code>python3</code> instead of <code>python</code> to create the virtual environment.</p>
</dd>
<dt class="hdlist1"><strong>Dependencies not found</strong></dt>
<dd>
<p>Make sure the virtual environment is activated before installing dependencies or building AEE images.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Check if virtual environment is active</span>
<span class="nb">echo</span> <span class="nv">$VIRTUAL_ENV</span>

<span class="c"># Verify ansible-builder is installed</span>
which ansible-builder
ansible-builder <span class="nt">--version</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_os_migrate_aee"><a class="anchor" href="#_building_os_migrate_aee"></a><a class="link" href="#_building_os_migrate_aee">97.3.2. Building os-migrate AEE</a></h4>
<div class="paragraph">
<p>Navigate to the os-migrate repository and build the AEE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Navigate to the repository</span>
<span class="nb">cd</span> /path/to/os-migrate

<span class="c"># Activate virtual environment (if using one)</span>
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Navigate to AEE directory</span>
<span class="nb">cd </span>aee

<span class="c"># Build the AEE image</span>
ansible-builder build <span class="nt">--tag</span> os-migrate:latest</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_building_vmware_migration_kit_aee"><a class="anchor" href="#_building_vmware_migration_kit_aee"></a><a class="link" href="#_building_vmware_migration_kit_aee">97.3.3. Building vmware-migration-kit AEE</a></h4>
<div class="paragraph">
<p>Navigate to the vmware-migration-kit repository and build the AEE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Navigate to the repository</span>
<span class="nb">cd</span> /path/to/vmware-migration-kit

<span class="c"># Activate virtual environment (if using one)</span>
<span class="nb">source</span> .venv/bin/activate

<span class="c"># Navigate to AEE directory</span>
<span class="nb">cd </span>aee

<span class="c"># Build the AEE image</span>
ansible-builder build <span class="nt">--tag</span> vmware-migration-kit:latest</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_automated_build_process"><a class="anchor" href="#_automated_build_process"></a><a class="link" href="#_automated_build_process">97.3.4. Automated Build Process</a></h4>
<div class="paragraph">
<p>Both repositories include GitHub Actions workflows that automatically build and test AEE images:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>os-migrate/.github/workflows/build-aee.yml</code></p>
</li>
<li>
<p><code>vmware-migration-kit/.github/workflows/build-aee.yml</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Trigger on pushes to main branch and pull requests</p>
</li>
<li>
<p>Build the AEE image using ansible-builder</p>
</li>
<li>
<p>Run basic validation tests</p>
</li>
<li>
<p>Push images to container registries (when configured)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_release_versioning_and_tagging_strategy"><a class="anchor" href="#_release_versioning_and_tagging_strategy"></a><a class="link" href="#_release_versioning_and_tagging_strategy">97.3.5. Release Versioning and Tagging Strategy</a></h4>
<div class="paragraph">
<p>The GitHub Actions workflows implement a sophisticated versioning strategy for AEE images:</p>
</div>
<div class="sect4">
<h5 id="_main_branch_builds"><a class="anchor" href="#_main_branch_builds"></a><a class="link" href="#_main_branch_builds">Main Branch Builds</a></h5>
<div class="paragraph">
<p>Images built from the <code>main</code> branch are tagged as <code>latest</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># When building from main branch</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push AEE image</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">github.ref == 'refs/heads/main'</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">ansible-builder build --tag ${{ github.repository }}:latest</span>
    <span class="s">podman push ${{ github.repository }}:latest</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_tag_based_builds"><a class="anchor" href="#_tag_based_builds"></a><a class="link" href="#_tag_based_builds">Tag-based Builds</a></h5>
<div class="paragraph">
<p>When building from Git tags, images receive multiple tags for maximum compatibility:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># When building from tags</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and push AEE image with version tags</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">startsWith(github.ref, 'refs/tags/')</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">TAG_VERSION=${GITHUB_REF#refs/tags/}</span>
    <span class="s">ansible-builder build --tag ${{ github.repository }}:$TAG_VERSION</span>
    <span class="s">ansible-builder build --tag ${{ github.repository }}:stable</span>

    <span class="s">podman push ${{ github.repository }}:$TAG_VERSION</span>
    <span class="s">podman push ${{ github.repository }}:stable</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_tagging_strategy"><a class="anchor" href="#_tagging_strategy"></a><a class="link" href="#_tagging_strategy">Tagging Strategy</a></h5>
<div class="paragraph">
<p>The versioning strategy follows these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>latest</code> - Always points to the most recent build from <code>main</code> branch</p>
</li>
<li>
<p><code>stable</code> - Points to the most recent tagged release (production-ready)</p>
</li>
<li>
<p><code>1.2.3</code> - Version without 'v' prefix for compatibility</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_usage_examples"><a class="anchor" href="#_usage_examples"></a><a class="link" href="#_usage_examples">Usage Examples</a></h5>
<div class="paragraph">
<p>Use the appropriate tag based on your requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Use latest development version</span>
podman run <span class="nt">--rm</span> os-migrate:latest ansible <span class="nt">--version</span>

<span class="c"># Use latest stable release</span>
podman run <span class="nt">--rm</span> os-migrate:stable ansible <span class="nt">--version</span>

<span class="c"># Use specific version</span>
podman run <span class="nt">--rm</span> os-migrate:1.2.3 ansible <span class="nt">--version</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_workflow_triggers"><a class="anchor" href="#_workflow_triggers"></a><a class="link" href="#_workflow_triggers">Workflow Triggers</a></h5>
<div class="paragraph">
<p>The GitHub Actions workflows are triggered by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>push</code> to <code>main</code> branch  builds <code>latest</code> tag</p>
</li>
<li>
<p><code>push</code> of tags  builds version-specific and <code>stable</code> tags</p>
</li>
<li>
<p><code>pull_request</code> to <code>main</code>  builds and tests (no push to registry)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_registry_configuration"><a class="anchor" href="#_registry_configuration"></a><a class="link" href="#_registry_configuration">Registry Configuration</a></h5>
<div class="paragraph">
<p>Configure the container registry in the workflow using environment variables and secrets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">env</span><span class="pi">:</span>
  <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">quay.io</span>
  <span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">os-migrate/os-migrate</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Container Registry</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">podman login -u ${{ secrets.REGISTRY_USERNAME }} \</span>
                 <span class="s">-p ${{ secrets.REGISTRY_PASSWORD }} \</span>
                 <span class="s">${{ env.REGISTRY }}</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">ansible-builder build --tag ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ steps.version.outputs.tag }}</span>
    <span class="s">podman push ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ steps.version.outputs.tag }}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configuring_secrets_and_environment_variables"><a class="anchor" href="#_configuring_secrets_and_environment_variables"></a><a class="link" href="#_configuring_secrets_and_environment_variables">Configuring Secrets and Environment Variables</a></h5>
<div class="paragraph">
<p>GitHub Actions supports multiple levels of configuration for secrets and variables. Understanding these levels is crucial for proper AEE workflow configuration.</p>
</div>
<div class="sect5">
<h6 id="_repository_level_secrets"><a class="anchor" href="#_repository_level_secrets"></a><a class="link" href="#_repository_level_secrets">Repository-Level Secrets</a></h6>
<div class="paragraph">
<p>Create secrets at the repository level for AEE workflows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to your repository on GitHub</p>
</li>
<li>
<p>Click <strong>Settings</strong>  <strong>Secrets and variables</strong>  <strong>Actions</strong></p>
</li>
<li>
<p>Click <strong>New repository secret</strong></p>
</li>
<li>
<p>Add the following secrets for AEE workflows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Required secrets for AEE workflows</span>
<span class="na">REGISTRY_USERNAME</span><span class="pi">:</span> <span class="s">your-registry-username</span>
<span class="na">REGISTRY_PASSWORD</span><span class="pi">:</span> <span class="s">your-registry-password</span>
<span class="na">REGISTRY_TOKEN</span><span class="pi">:</span> <span class="s">your-registry-token</span>  <span class="c1"># Alternative to username/password</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_environment_level_secrets"><a class="anchor" href="#_environment_level_secrets"></a><a class="link" href="#_environment_level_secrets">Environment-Level Secrets</a></h6>
<div class="paragraph">
<p>For production deployments, use environment-level secrets:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <strong>Settings</strong>  <strong>Environments</strong></p>
</li>
<li>
<p>Create environments like <code>production</code>, <code>staging</code>, <code>development</code></p>
</li>
<li>
<p>Configure environment-specific secrets:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Environment-specific secrets</span>
<span class="na">production</span><span class="pi">:</span>
  <span class="na">REGISTRY_USERNAME</span><span class="pi">:</span> <span class="s">prod-registry-user</span>
  <span class="na">REGISTRY_PASSWORD</span><span class="pi">:</span> <span class="s">prod-registry-password</span>

<span class="na">staging</span><span class="pi">:</span>
  <span class="na">REGISTRY_USERNAME</span><span class="pi">:</span> <span class="s">staging-registry-user</span>
  <span class="na">REGISTRY_PASSWORD</span><span class="pi">:</span> <span class="s">staging-registry-password</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_organization_level_variables"><a class="anchor" href="#_organization_level_variables"></a><a class="link" href="#_organization_level_variables">Organization-Level Variables</a></h6>
<div class="paragraph">
<p>Use organization-level variables for shared configuration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to organization <strong>Settings</strong>  <strong>Secrets and variables</strong>  <strong>Actions</strong></p>
</li>
<li>
<p>Add organization variables:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Organization variables (not secrets)</span>
<span class="na">DEFAULT_REGISTRY</span><span class="pi">:</span> <span class="s">quay.io</span>
<span class="na">DEFAULT_IMAGE_PREFIX</span><span class="pi">:</span> <span class="s">os-migrate</span>
<span class="na">ANSIBLE_BUILDER_VERSION</span><span class="pi">:</span> <span class="s">3.0.0</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_repository_level_variables"><a class="anchor" href="#_repository_level_variables"></a><a class="link" href="#_repository_level_variables">Repository-Level Variables</a></h6>
<div class="paragraph">
<p>Create repository-level variables for project-specific configuration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to your repository on GitHub</p>
</li>
<li>
<p>Click <strong>Settings</strong>  <strong>Secrets and variables</strong>  <strong>Actions</strong></p>
</li>
<li>
<p>Click <strong>Variables</strong> tab  <strong>New repository variable</strong></p>
</li>
<li>
<p>Add variables for AEE workflows:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Repository variables for AEE workflows</span>
<span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">os-migrate</span>
<span class="na">BASE_IMAGE</span><span class="pi">:</span> <span class="s">quay.io/ansible/ansible-runner:latest</span>
<span class="na">ANSIBLE_VERSION</span><span class="pi">:</span> <span class="s">6.0.0</span>
<span class="na">PYTHON_VERSION</span><span class="pi">:</span> <span class="m">3.11</span>
<span class="na">BUILD_CONTEXT</span><span class="pi">:</span> <span class="s">./aee</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_environment_level_variables"><a class="anchor" href="#_environment_level_variables"></a><a class="link" href="#_environment_level_variables">Environment-Level Variables</a></h6>
<div class="paragraph">
<p>Configure environment-specific variables:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <strong>Settings</strong>  <strong>Environments</strong></p>
</li>
<li>
<p>Select an environment (e.g., <code>production</code>)</p>
</li>
<li>
<p>Add environment-specific variables:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Environment-specific variables</span>
<span class="na">production</span><span class="pi">:</span>
  <span class="na">IMAGE_TAG</span><span class="pi">:</span> <span class="s">latest</span>
  <span class="na">REGISTRY_URL</span><span class="pi">:</span> <span class="s">quay.io</span>
  <span class="na">BUILD_ARGS</span><span class="pi">:</span> <span class="s">--no-cache --compress</span>

<span class="na">staging</span><span class="pi">:</span>
  <span class="na">IMAGE_TAG</span><span class="pi">:</span> <span class="s">staging</span>
  <span class="na">REGISTRY_URL</span><span class="pi">:</span> <span class="s">ghcr.io</span>
  <span class="na">BUILD_ARGS</span><span class="pi">:</span> <span class="s">--no-cache</span>

<span class="na">development</span><span class="pi">:</span>
  <span class="na">IMAGE_TAG</span><span class="pi">:</span> <span class="s">dev</span>
  <span class="na">REGISTRY_URL</span><span class="pi">:</span> <span class="s">ghcr.io</span>
  <span class="na">BUILD_ARGS</span><span class="pi">:</span> <span class="s">--progress=plain</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_using_variables_in_workflows"><a class="anchor" href="#_using_variables_in_workflows"></a><a class="link" href="#_using_variables_in_workflows">Using Variables in Workflows</a></h6>
<div class="paragraph">
<p>Access variables using the <code>vars</code> context in your workflows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s">AEE Build with Variables</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Podman</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">redhat-actions/setup-podman@v1</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build AEE Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">cd ${{ vars.BUILD_CONTEXT }}</span>
          <span class="s">ansible-builder build \</span>
            <span class="s">--tag ${{ vars.REGISTRY_URL }}/${{ vars.IMAGE_NAME }}:${{ vars.IMAGE_TAG }} \</span>
            <span class="s">${{ vars.BUILD_ARGS }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Push Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">podman push ${{ vars.REGISTRY_URL }}/${{ vars.IMAGE_NAME }}:${{ vars.IMAGE_TAG }}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_variable_precedence"><a class="anchor" href="#_variable_precedence"></a><a class="link" href="#_variable_precedence">Variable Precedence</a></h6>
<div class="paragraph">
<p>GitHub Actions follows this precedence order for variables and secrets:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Environment variables</strong> (highest priority)</p>
</li>
<li>
<p><strong>Environment-level secrets/variables</strong></p>
</li>
<li>
<p><strong>Repository-level secrets/variables</strong></p>
</li>
<li>
<p><strong>Organization-level secrets/variables</strong></p>
</li>
<li>
<p><strong>System variables</strong> (lowest priority)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="c1"># Example showing variable precedence</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">Variable Precedence Example</span>
<span class="na">on</span><span class="pi">:</span> <span class="s">push</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">test</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Show Variable Values</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">echo "Repository variable: ${{ vars.IMAGE_NAME }}"</span>
          <span class="s">echo "Environment variable: ${{ vars.IMAGE_TAG }}"</span>
          <span class="s">echo "Organization variable: ${{ vars.DEFAULT_REGISTRY }}"</span>
          <span class="s">echo "System variable: ${{ github.ref_name }}"</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="c1"># This overrides all other variables</span>
          <span class="na">IMAGE_NAME</span><span class="pi">:</span> <span class="s">override-from-env</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_workflow_configuration_examples"><a class="anchor" href="#_workflow_configuration_examples"></a><a class="link" href="#_workflow_configuration_examples">Workflow Configuration Examples</a></h6>

</div>
<div class="sect5">
<h6 id="_basic_registry_authentication"><a class="anchor" href="#_basic_registry_authentication"></a><a class="link" href="#_basic_registry_authentication">Basic Registry Authentication</a></h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s">Build AEE Image</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">v*'</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>  <span class="c1"># Uses environment-level secrets</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Podman</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">redhat-actions/setup-podman@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">podman-version</span><span class="pi">:</span> <span class="s">latest</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Registry</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
            <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
            <span class="s">--password-stdin \</span>
            <span class="s">${{ vars.DEFAULT_REGISTRY }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build AEE Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">cd aee</span>
          <span class="s">ansible-builder build --tag ${{ vars.DEFAULT_REGISTRY }}/${{ vars.DEFAULT_IMAGE_PREFIX }}:${{ github.ref_name }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Push Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">podman push ${{ vars.DEFAULT_REGISTRY }}/${{ vars.DEFAULT_IMAGE_PREFIX }}:${{ github.ref_name }}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_multi_registry_support"><a class="anchor" href="#_multi_registry_support"></a><a class="link" href="#_multi_registry_support">Multi-Registry Support</a></h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push to Multiple Registries</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">v*'</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">registry</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">quay.io</span><span class="pi">,</span> <span class="nv">ghcr.io</span><span class="pi">,</span> <span class="nv">docker.io</span><span class="pi">]</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Podman</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">redhat-actions/setup-podman@v1</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to ${{ matrix.registry }}</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">case "${{ matrix.registry }}" in</span>
            <span class="s">"quay.io")</span>
              <span class="s">echo ${{ secrets.QUAY_TOKEN }} | podman login --username ${{ secrets.QUAY_USERNAME }} --password-stdin quay.io</span>
              <span class="s">;;</span>
            <span class="s">"ghcr.io")</span>
              <span class="s">echo ${{ secrets.GITHUB_TOKEN }} | podman login --username ${{ github.actor }} --password-stdin ghcr.io</span>
              <span class="s">;;</span>
            <span class="s">"docker.io")</span>
              <span class="s">echo ${{ secrets.DOCKERHUB_TOKEN }} | podman login --username ${{ secrets.DOCKERHUB_USERNAME }} --password-stdin docker.io</span>
              <span class="s">;;</span>
          <span class="s">esac</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">cd aee</span>
          <span class="s">ansible-builder build --tag ${{ matrix.registry }}/os-migrate:${{ github.ref_name }}</span>
          <span class="s">podman push ${{ matrix.registry }}/os-migrate:${{ github.ref_name }}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_secure_secret_handling"><a class="anchor" href="#_secure_secret_handling"></a><a class="link" href="#_secure_secret_handling">Secure Secret Handling</a></h6>
<div class="paragraph">
<p>Follow security best practices when using secrets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Secure Secret Usage</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">#  Good: Use environment variables</span>
    <span class="s">export REGISTRY_PASSWORD="${{ secrets.REGISTRY_PASSWORD }}"</span>
    <span class="s">podman login --username ${{ secrets.REGISTRY_USERNAME }} --password-stdin ${{ env.REGISTRY }}</span>

    <span class="s">#  Good: Use proper quoting</span>
    <span class="s">podman login --username "${{ secrets.REGISTRY_USERNAME }}" --password "${{ secrets.REGISTRY_PASSWORD }}" ${{ env.REGISTRY }}</span>

    <span class="s">#  Bad: Direct command line usage without quoting</span>
    <span class="s">podman login --username ${{ secrets.REGISTRY_USERNAME }} --password ${{ secrets.REGISTRY_PASSWORD }} ${{ env.REGISTRY }}</span>
  <span class="na">env</span><span class="pi">:</span>
    <span class="na">REGISTRY</span><span class="pi">:</span> <span class="s">${{ vars.DEFAULT_REGISTRY }}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_conditional_secret_usage"><a class="anchor" href="#_conditional_secret_usage"></a><a class="link" href="#_conditional_secret_usage">Conditional Secret Usage</a></h6>
<div class="paragraph">
<p>Use secrets conditionally based on workflow context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Conditional Registry Login</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">github.event_name == 'push' &amp;&amp; github.ref == 'refs/heads/main'</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
      <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
      <span class="s">--password-stdin \</span>
      <span class="s">${{ env.REGISTRY }}</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push (Main Branch)</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">github.event_name == 'push' &amp;&amp; github.ref == 'refs/heads/main'</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">cd aee</span>
    <span class="s">ansible-builder build --tag ${{ env.REGISTRY }}/os-migrate:latest</span>
    <span class="s">podman push ${{ env.REGISTRY }}/os-migrate:latest</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build and Push (Tags)</span>
  <span class="na">if</span><span class="pi">:</span> <span class="s">github.event_name == 'push' &amp;&amp; startsWith(github.ref, 'refs/tags/')</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">cd aee</span>
    <span class="s">TAG_VERSION=${GITHUB_REF#refs/tags/}</span>
    <span class="s">ansible-builder build --tag ${{ env.REGISTRY }}/os-migrate:$TAG_VERSION</span>
    <span class="s">ansible-builder build --tag ${{ env.REGISTRY }}/os-migrate:stable</span>
    <span class="s">podman push ${{ env.REGISTRY }}/os-migrate:$TAG_VERSION</span>
    <span class="s">podman push ${{ env.REGISTRY }}/os-migrate:stable</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_secret_rotation_and_management"><a class="anchor" href="#_secret_rotation_and_management"></a><a class="link" href="#_secret_rotation_and_management">Secret Rotation and Management</a></h6>
<div class="paragraph">
<p>Implement secret rotation strategies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Validate Secrets</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">if [ -z "${{ secrets.REGISTRY_USERNAME }}" ]; then</span>
      <span class="s">echo " REGISTRY_USERNAME secret is not set"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span>

    <span class="s">if [ -z "${{ secrets.REGISTRY_PASSWORD }}" ]; then</span>
      <span class="s">echo " REGISTRY_PASSWORD secret is not set"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span>

    <span class="s">echo " All required secrets are configured"</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test Registry Access</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
      <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
      <span class="s">--password-stdin \</span>
      <span class="s">${{ env.REGISTRY }} --test</span>
    <span class="s">echo " Registry authentication successful"</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_environment_specific_configuration"><a class="anchor" href="#_environment_specific_configuration"></a><a class="link" href="#_environment_specific_configuration">Environment-Specific Configuration</a></h6>
<div class="paragraph">
<p>Use different configurations for different environments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">name</span><span class="pi">:</span> <span class="s">AEE Build Matrix</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">,</span> <span class="nv">develop</span><span class="pi">]</span>
    <span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">v*'</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">strategy</span><span class="pi">:</span>
      <span class="na">matrix</span><span class="pi">:</span>
        <span class="na">include</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">environment</span><span class="pi">:</span> <span class="s">development</span>
            <span class="na">registry</span><span class="pi">:</span> <span class="s">ghcr.io</span>
            <span class="na">image_tag</span><span class="pi">:</span> <span class="s">dev</span>
          <span class="pi">-</span> <span class="na">environment</span><span class="pi">:</span> <span class="s">staging</span>
            <span class="na">registry</span><span class="pi">:</span> <span class="s">quay.io</span>
            <span class="na">image_tag</span><span class="pi">:</span> <span class="s">staging</span>
          <span class="pi">-</span> <span class="na">environment</span><span class="pi">:</span> <span class="s">production</span>
            <span class="na">registry</span><span class="pi">:</span> <span class="s">quay.io</span>
            <span class="na">image_tag</span><span class="pi">:</span> <span class="s">latest</span>

    <span class="na">environment</span><span class="pi">:</span> <span class="s">${{ matrix.environment }}</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v4</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Podman</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">redhat-actions/setup-podman@v1</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Login to Registry</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
            <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
            <span class="s">--password-stdin \</span>
            <span class="s">${{ matrix.registry }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build AEE Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">cd aee</span>
          <span class="s">ansible-builder build --tag ${{ matrix.registry }}/os-migrate:${{ matrix.image_tag }}</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Push Image</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">podman push ${{ matrix.registry }}/os-migrate:${{ matrix.image_tag }}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_aee_images"><a class="anchor" href="#_using_aee_images"></a><a class="link" href="#_using_aee_images">97.4. Using AEE Images</a></h3>
<div class="sect3">
<h4 id="_running_playbooks_with_aee"><a class="anchor" href="#_running_playbooks_with_aee"></a><a class="link" href="#_running_playbooks_with_aee">97.4.1. Running Playbooks with AEE</a></h4>
<div class="paragraph">
<p>Execute os-migrate playbooks using the AEE container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">podman run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/runner <span class="se">\</span>
  <span class="nt">-v</span> ~/.ssh:/home/runner/.ssh:ro <span class="se">\</span>
  os-migrate:latest <span class="se">\</span>
  ansible-playbook <span class="nt">-i</span> inventory playbook.yml</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_interactive_shell_access"><a class="anchor" href="#_interactive_shell_access"></a><a class="link" href="#_interactive_shell_access">97.4.2. Interactive Shell Access</a></h4>
<div class="paragraph">
<p>Access the AEE container interactively for debugging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">podman run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/runner <span class="se">\</span>
  <span class="nt">-v</span> ~/.ssh:/home/runner/.ssh:ro <span class="se">\</span>
  os-migrate:latest <span class="se">\</span>
  /bin/bash</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_volume_mounts"><a class="anchor" href="#_volume_mounts"></a><a class="link" href="#_volume_mounts">97.4.3. Volume Mounts</a></h4>
<div class="paragraph">
<p>Common volume mounts for AEE usage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>$(pwd):/runner</code> - Mount current directory as working directory</p>
</li>
<li>
<p><code>~/.ssh:/home/runner/.ssh:ro</code> - Mount SSH keys (read-only)</p>
</li>
<li>
<p><code>~/.config/openstack:/home/runner/.config/openstack:ro</code> - Mount OpenStack credentials</p>
</li>
<li>
<p><code>/path/to/inventory:/runner/inventory:ro</code> - Mount inventory files</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aee_configuration"><a class="anchor" href="#_aee_configuration"></a><a class="link" href="#_aee_configuration">97.5. AEE Configuration</a></h3>
<div class="sect3">
<h4 id="_execution_environment_definition"><a class="anchor" href="#_execution_environment_definition"></a><a class="link" href="#_execution_environment_definition">97.5.1. Execution Environment Definition</a></h4>
<div class="paragraph">
<p>AEE images are defined using <code>execution-environment.yml</code> files that specify:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Base image (typically <code>quay.io/ansible/ansible-runner:latest</code>)</p>
</li>
<li>
<p>Python dependencies</p>
</li>
<li>
<p>Ansible collections</p>
</li>
<li>
<p>Additional system packages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">version</span><span class="pi">:</span> <span class="m">1</span>
<span class="na">dependencies</span><span class="pi">:</span>
  <span class="na">galaxy</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">os_migrate.os_migrate</span>
      <span class="na">source</span><span class="pi">:</span> <span class="s">https://github.com/os-migrate/os-migrate</span>
  <span class="na">python</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">openstacksdk&gt;=1.0.0</span>
    <span class="pi">-</span> <span class="s">ansible&gt;=6.0.0</span>
  <span class="na">system</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">git</span>
    <span class="pi">-</span> <span class="s">openssh-clients</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_aee_images"><a class="anchor" href="#_customizing_aee_images"></a><a class="link" href="#_customizing_aee_images">97.5.2. Customizing AEE Images</a></h4>
<div class="paragraph">
<p>To customize AEE images for specific requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the <code>execution-environment.yml</code> file</p>
</li>
<li>
<p>Add custom requirements or collections</p>
</li>
<li>
<p>Rebuild the image using ansible-builder</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">ansible-builder build <span class="nt">--tag</span> custom-aee:latest</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_3"><a class="anchor" href="#_troubleshooting_3"></a><a class="link" href="#_troubleshooting_3">97.6. Troubleshooting</a></h3>
<div class="sect3">
<h4 id="_secrets_and_variables_issues"><a class="anchor" href="#_secrets_and_variables_issues"></a><a class="link" href="#_secrets_and_variables_issues">97.6.1. Secrets and Variables Issues</a></h4>
<div class="sect4">
<h5 id="_common_secret_configuration_problems"><a class="anchor" href="#_common_secret_configuration_problems"></a><a class="link" href="#_common_secret_configuration_problems">Common Secret Configuration Problems</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Secret Not Found</strong></dt>
<dd>
<p>Ensure the secret is created at the correct level (repository, environment, or organization) and the name matches exactly in the workflow.</p>
</dd>
<dt class="hdlist1"><strong>Permission Denied</strong></dt>
<dd>
<p>Verify that the workflow has access to the environment containing the secrets. Check environment protection rules and required reviewers.</p>
</dd>
<dt class="hdlist1"><strong>Empty Secret Value</strong></dt>
<dd>
<p>Secrets that are not set return empty strings. Always validate secret existence before use.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Validate Required Secrets</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">if [ -z "${{ secrets.REGISTRY_USERNAME }}" ]; then</span>
      <span class="s">echo " REGISTRY_USERNAME secret is not configured"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span>

    <span class="s">if [ -z "${{ secrets.REGISTRY_PASSWORD }}" ]; then</span>
      <span class="s">echo " REGISTRY_PASSWORD secret is not configured"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span>

    <span class="s">echo " All required secrets are available"</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_variable_access_issues"><a class="anchor" href="#_variable_access_issues"></a><a class="link" href="#_variable_access_issues">Variable Access Issues</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Variable Not Defined</strong></dt>
<dd>
<p>Check that variables are created at the appropriate level and use the correct context (<code>vars</code> for variables, <code>secrets</code> for secrets).</p>
</dd>
<dt class="hdlist1"><strong>Wrong Variable Context</strong></dt>
<dd>
<p>Use <code>${{ vars.VARIABLE_NAME }}</code> for variables and <code>${{ secrets.SECRET_NAME }}</code> for secrets.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Debug Variable Access</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">echo "Repository variables:"</span>
    <span class="s">echo "  IMAGE_NAME: ${{ vars.IMAGE_NAME }}"</span>
    <span class="s">echo "  BUILD_CONTEXT: ${{ vars.BUILD_CONTEXT }}"</span>

    <span class="s">echo "Environment variables:"</span>
    <span class="s">echo "  IMAGE_TAG: ${{ vars.IMAGE_TAG }}"</span>
    <span class="s">echo "  REGISTRY_URL: ${{ vars.REGISTRY_URL }}"</span>

    <span class="s">echo "Organization variables:"</span>
    <span class="s">echo "  DEFAULT_REGISTRY: ${{ vars.DEFAULT_REGISTRY }}"</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_registry_authentication_troubleshooting"><a class="anchor" href="#_registry_authentication_troubleshooting"></a><a class="link" href="#_registry_authentication_troubleshooting">Registry Authentication Troubleshooting</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Authentication Failed</strong></dt>
<dd>
<p>Verify credentials are correct and have appropriate permissions for the registry.</p>
</dd>
<dt class="hdlist1"><strong>Token Expired</strong></dt>
<dd>
<p>Check if the registry token has expired and needs renewal.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Test Registry Authentication</span>
  <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">echo "Testing authentication to ${{ vars.DEFAULT_REGISTRY }}"</span>

    <span class="s"># Test login without pushing</span>
    <span class="s">echo ${{ secrets.REGISTRY_PASSWORD }} | podman login \</span>
      <span class="s">--username ${{ secrets.REGISTRY_USERNAME }} \</span>
      <span class="s">--password-stdin \</span>
      <span class="s">${{ vars.DEFAULT_REGISTRY }} --test</span>

    <span class="s">if [ $? -eq 0 ]; then</span>
      <span class="s">echo " Registry authentication successful"</span>
    <span class="s">else</span>
      <span class="s">echo " Registry authentication failed"</span>
      <span class="s">exit 1</span>
    <span class="s">fi</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_debugging_aee_issues"><a class="anchor" href="#_debugging_aee_issues"></a><a class="link" href="#_debugging_aee_issues">97.6.2. Debugging AEE Issues</a></h4>
<div class="paragraph">
<p>Enable verbose output for troubleshooting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">podman run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="se">\</span>
  <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/runner <span class="se">\</span>
  os-migrate:latest <span class="se">\</span>
  ansible-playbook <span class="nt">-vvv</span> <span class="nt">-i</span> inventory playbook.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check container logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">podman logs &lt;container_id&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_performance_optimization"><a class="anchor" href="#_performance_optimization"></a><a class="link" href="#_performance_optimization">97.6.3. Performance Optimization</a></h4>
<div class="ulist">
<ul>
<li>
<p>Use volume mounts instead of copying files into containers</p>
</li>
<li>
<p>Mount only necessary directories to reduce I/O overhead</p>
</li>
<li>
<p>Consider using read-only mounts where possible</p>
</li>
<li>
<p>Use appropriate resource limits for container execution</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_maintenance"><a class="anchor" href="#_maintenance"></a><a class="link" href="#_maintenance">97.7. Maintenance</a></h3>
<div class="sect3">
<h4 id="_updating_aee_images"><a class="anchor" href="#_updating_aee_images"></a><a class="link" href="#_updating_aee_images">97.7.1. Updating AEE Images</a></h4>
<div class="paragraph">
<p>Regular updates ensure security and compatibility:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update base images in execution environment definitions</p>
</li>
<li>
<p>Update Ansible collections to latest versions</p>
</li>
<li>
<p>Update Python dependencies</p>
</li>
<li>
<p>Rebuild and test AEE images</p>
</li>
<li>
<p>Update documentation with any changes</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_version_management"><a class="anchor" href="#_version_management"></a><a class="link" href="#_version_management">97.7.2. Version Management</a></h4>
<div class="paragraph">
<p>The automated GitHub Actions workflows handle version management based on Git references:</p>
</div>
<div class="sect4">
<h5 id="_manual_version_management"><a class="anchor" href="#_manual_version_management"></a><a class="link" href="#_manual_version_management">Manual Version Management</a></h5>
<div class="paragraph">
<p>For local development, you can manually tag images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Build specific version locally</span>
ansible-builder build <span class="nt">--tag</span> os-migrate:1.2.3

<span class="c"># Build latest development version</span>
ansible-builder build <span class="nt">--tag</span> os-migrate:latest</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_automated_version_management"><a class="anchor" href="#_automated_version_management"></a><a class="link" href="#_automated_version_management">Automated Version Management</a></h5>
<div class="paragraph">
<p>The GitHub Actions workflows automatically handle versioning:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Main branch pushes</strong>  <code>latest</code> tag</p>
</li>
<li>
<p><strong>Tag pushes</strong>  version-specific tag + <code>stable</code> tag</p>
</li>
<li>
<p><strong>Pull requests</strong>  build and test only (no registry push)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_creating_releases"><a class="anchor" href="#_creating_releases"></a><a class="link" href="#_creating_releases">Creating Releases</a></h5>
<div class="paragraph">
<p>To create a new release:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create and push a Git tag:
[source,bash]
----
git tag -a 1.2.3 -m "Release version 1.2.3"
git push origin 1.2.3
----</p>
</li>
<li>
<p>The GitHub Actions workflow will automatically:</p>
<div class="ulist">
<ul>
<li>
<p>Build the AEE image</p>
</li>
<li>
<p>Tag it with <code>1.2.3</code> and <code>stable</code></p>
</li>
<li>
<p>Push to the configured registry</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_version_tag_strategy"><a class="anchor" href="#_version_tag_strategy"></a><a class="link" href="#_version_tag_strategy">Version Tag Strategy</a></h5>
<div class="ulist">
<ul>
<li>
<p><code>latest</code> - Development builds from main branch</p>
</li>
<li>
<p><code>stable</code> - Latest tagged release (production-ready)</p>
</li>
<li>
<p><code>1.2.3</code> - Specific version</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_considerations"><a class="anchor" href="#_security_considerations"></a><a class="link" href="#_security_considerations">97.7.3. Security Considerations</a></h4>
<div class="ulist">
<ul>
<li>
<p>Regularly update base images to include security patches</p>
</li>
<li>
<p>Scan AEE images for vulnerabilities</p>
</li>
<li>
<p>Use minimal base images when possible</p>
</li>
<li>
<p>Review and audit all included dependencies</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_best_practices_2"><a class="anchor" href="#_best_practices_2"></a><a class="link" href="#_best_practices_2">97.8. Best Practices</a></h3>
<div class="sect3">
<h4 id="_development_workflow"><a class="anchor" href="#_development_workflow"></a><a class="link" href="#_development_workflow">97.8.1. Development Workflow</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Test changes locally using AEE containers</p>
</li>
<li>
<p>Use version-controlled execution environment definitions</p>
</li>
<li>
<p>Document any customizations or modifications</p>
</li>
<li>
<p>Test AEE images in target environments before deployment</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_production_usage"><a class="anchor" href="#_production_usage"></a><a class="link" href="#_production_usage">97.8.2. Production Usage</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use specific version tags instead of <code>latest</code></p>
</li>
<li>
<p>Implement proper monitoring and logging</p>
</li>
<li>
<p>Regular security updates and vulnerability scanning</p>
</li>
<li>
<p>Backup and disaster recovery planning</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_documentation"><a class="anchor" href="#_documentation"></a><a class="link" href="#_documentation">97.8.3. Documentation</a></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Keep execution environment definitions well-documented</p>
</li>
<li>
<p>Document any custom modifications or extensions</p>
</li>
<li>
<p>Provide clear usage examples and troubleshooting guides</p>
</li>
<li>
<p>Maintain compatibility matrices for different versions</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_todo"><a class="anchor" href="#_todo"></a><a class="link" href="#_todo">97.9. TODO</a></h3>
<div class="sect3">
<h4 id="_collection_installation_improvements"><a class="anchor" href="#_collection_installation_improvements"></a><a class="link" href="#_collection_installation_improvements">97.9.1. Collection Installation Improvements</a></h4>
<div class="paragraph">
<p>Improve the way collections (os-migrate or vmware-migration-kit) are installed within AEE images to ensure proper version alignment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Main branch builds</strong>: When the image tag is <code>main</code>, install the collection content directly from the main branch repository as the source of installation using Git-based requirements</p>
</li>
<li>
<p><strong>Stable/tagged builds</strong>: When the image tag is <code>stable</code> or matches a repository tag, ensure the installation uses the corresponding tagged version of the collection from Ansible Galaxy</p>
</li>
<li>
<p><strong>Dynamic requirements.yml</strong>: Implement automated generation of <code>requirements.yml</code> files based on build context to ensure proper collection versioning</p>
</li>
<li>
<p><strong>Version consistency validation</strong>: Add build-time checks to verify that AEE image tags match the collection versions they contain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This improvement will ensure that AEE images always contain the correct version of the collection that matches the build context and tag strategy, providing better reproducibility and version alignment.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_releasing_the_os_migrate_collection"><a class="anchor" href="#_releasing_the_os_migrate_collection"></a><a class="link" href="#_releasing_the_os_migrate_collection">98. Releasing the OS Migrate collection</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Set env vars with old and new versions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OLD_VERSION=$(./toolbox/run bash -c 'cat os_migrate/galaxy.yml | shyaml get-value version')
echo "OLD_VERSION=$OLD_VERSION"

NEW_VERSION="SOME.NEW.VERSION"</pre>
</div>
</div>
<div class="paragraph">
<p>Edit the version in galaxy.yml and any hardcoded values in functional
tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="nb">sed</span> <span class="nt">-i</span> <span class="nt">-e</span> <span class="s2">"s/^version: </span><span class="nv">$OLD_VERSION</span><span class="s2">/version: </span><span class="nv">$NEW_VERSION</span><span class="s2">/"</span> ./os_migrate/galaxy.yml
<span class="nb">grep</span> <span class="nt">-lr</span> <span class="s2">"os_migrate_version: </span><span class="nv">$OLD_VERSION</span><span class="s2">"</span> ./tests | xargs <span class="nb">sed</span> <span class="nt">-i</span> <span class="nt">-e</span> <span class="s2">"s/^os_migrate_version: </span><span class="nv">$OLD_VERSION</span><span class="s2">/os_migrate_version: </span><span class="nv">$NEW_VERSION</span><span class="s2">/"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A build is required to update const.py:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./toolbox/run make</pre>
</div>
</div>
<div class="paragraph">
<p>Create a pull request with these changes. Once it&#8217;s merged, check out
the merge commit and release to galaxy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git checkout $MERGED_COMMIT
./toolbox/run ./scripts/publish.sh -k &lt;YOUR_GALAXY_TOKEN&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>After a successful release, create a tag on the commit you built the
release from, and push the tag to the upstream repo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git tag -m "$NEW_VERSION" "$NEW_VERSION"
# assuming the os-migrate upstream repo is named 'upstream' in your repo clone
git push upstream --tags</pre>
</div>
</div>
<div class="paragraph">
<p>If you&#8217;ve incremented "X" or "Y" in "X.Y.Z" version scheme, create also
a stable branch to allow us to create ".Z" releases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>STABLE_VERSION=$(awk -F. '{ print $1 "." $2; }' &lt;&lt;&lt;"$NEW_VERSION")
git checkout -b stable/$STABLE_VERSION
git push upstream stable/$STABLE_VERSION</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installing_vagrant_directly_on_host_alternative_path"><a class="anchor" href="#_installing_vagrant_directly_on_host_alternative_path"></a><a class="link" href="#_installing_vagrant_directly_on_host_alternative_path">99. Installing Vagrant directly on host (alternative path)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Normally you should run Vagrant containerized as the <a href="dev-env-setup.adoc">developer environment setup</a> doc suggests. If you have a
reason to install on bare metal instead, here are relevant
instructions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>yum install https://releases.hashicorp.com/vagrant/2.4.1/vagrant-2.4.1-1.x86_64.rpm -y
vagrant --version</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>virsh pool-define-as vagrant dir - - - - "/var/lib/libvirt/images/vagrant"
virsh pool-list --all
virsh pool-build vagrant
virsh pool-start vagrant
virsh pool-autostart vagrant
virsh pool-info vagrant</pre>
</div>
</div>
<div class="paragraph">
<p>We need to install the libvirt provider</p>
</div>
<div class="listingblock">
<div class="content">
<pre>yum groupinstall "Virtualization Host" -y
yum install libvirt-devel -y
vagrant plugin install vagrant-libvirt
systemctl restart libvirtd</pre>
</div>
</div>
<div class="paragraph">
<p>Go to the toolbox/vagrant folder</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cd toolbox/vagrant</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>vagrant box add --name fedora37 https://app.vagrantup.com/fedora/boxes/37-cloud-base/versions/37.20221105.0/providers/libvirt/unknown/vagrant.box</pre>
</div>
</div>
<div class="paragraph">
<p>Start the environment using the libvirt provider</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vagrant up --provider libvirt</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-09-05 18:51:44 -0400
</div>
</div>
</body>
</html>